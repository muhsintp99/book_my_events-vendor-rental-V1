import{p as fe,d as je,r as o,j as e,B as c,c as Z,s as S,t as be,T as x,H as ee,k as te,a as u,S as W,F as ve,I as ye,o as Se,M as ae,x as Ce,b as se,w as ie,h as y}from"./index-i4VdWCGq.js";import{A as ke}from"./Add-CX0Jg6d1.js";import{S as oe}from"./Switch-CDbQDBwk.js";import{C as re}from"./Close-BGkFvPa6.js";import{C as Pe}from"./CloudUpload-Z8FxTU0l.js";import{D as we}from"./Delete-BaJ3AfYz.js";const h="#E91E63",f="https://api.bookmyevent.ae",le="68e5fb0fa4b2718b6cbf64e9",Ie=({section:p,onChange:j,onDelete:g})=>e.jsxs(c,{sx:{position:"relative",border:"1px solid #e5e5e5",borderRadius:2,p:3,mb:3,bgcolor:"white"},children:[e.jsx(S,{onClick:g,sx:{position:"absolute",top:12,right:12,color:h},children:e.jsx(we,{fontSize:"small"})}),e.jsx(u,{fullWidth:!0,label:e.jsxs("span",{children:["Section Title ",e.jsx("span",{style:{color:"red"},children:"*"})]}),value:p.title||"",onChange:m=>j("title",m.target.value),sx:{mb:2}}),e.jsx(u,{fullWidth:!0,label:e.jsxs("span",{children:["Items (comma separated) ",e.jsx("span",{style:{color:"red"},children:"*"})]}),placeholder:"e.g. Candid Photography, Drone Video",value:Array.isArray(p.items)?p.items.join(", "):"",onChange:m=>j("items",m.target.value),multiline:!0,rows:2,helperText:"Separate items with commas"})]}),_e=()=>{const{id:p}=fe(),j=je(),g=!!p,[m,_]=o.useState(!0),[z,$]=o.useState(!1),[F,C]=o.useState(""),[M,d]=o.useState(""),[k,ne]=o.useState([]),[ce,N]=o.useState(!0),[l,R]=o.useState(null),[P,G]=o.useState(""),[w,L]=o.useState([]),[I,U]=o.useState(""),[A,O]=o.useState(""),[H,q]=o.useState(""),[J,K]=o.useState(""),[E,Y]=o.useState(!1),[T,Q]=o.useState(!0),[B,b]=o.useState([{id:Date.now(),title:"",items:[]}]),[v,V]=o.useState([]),[D,X]=o.useState([]);o.useEffect(()=>{try{const a=localStorage.getItem("vendor")||localStorage.getItem("user")||localStorage.getItem("vendorData");if(a){const t=JSON.parse(a);R(t)}else{const t=localStorage.getItem("vendorId")||localStorage.getItem("userId");t&&R({_id:t,id:t})}}catch(a){console.error("Error loading vendor info:",a)}},[]),o.useEffect(()=>{(async()=>{try{N(!0);const t=await y.get(`${f}/api/categories/modules/${le}`);ne(t.data.data||[])}catch{d("Failed to load categories")}finally{N(!1)}})()},[]),o.useEffect(()=>{if(!g){_(!1);return}(async()=>{var t,s;try{const r=(await y.get(`${f}/api/photography-packages/${p}`)).data.data;G(r.packageTitle),L(r.categories.map(i=>i._id)),U(r.price),O(r.description),q(r.cancellationPolicy),K(r.advanceBookingAmount),Y(r.travelToVenue),Q(r.isActive),((t=r.includedServices)==null?void 0:t.length)>0&&b(r.includedServices.map(i=>({id:i._id,title:i.title,items:i.items}))),((s=r.gallery)==null?void 0:s.length)>0&&X(r.gallery.map(i=>`${f}${i}`))}catch{d("Failed to load package")}finally{_(!1)}})()},[p,g]);const de=()=>{b(a=>[...a,{id:Date.now(),title:"",items:[]}])},pe=(a,t,s)=>{b(n=>n.map(r=>r.id===a?{...r,[t]:t==="items"?s.split(",").map(i=>i.trim()).filter(Boolean):s}:r))},ge=a=>{B.length>1&&b(t=>t.filter(s=>s.id!==a))},he=a=>{const t=Array.from(a.target.files);if(v.length+D.length+t.length>10)return alert("Maximum 10 images allowed");V(n=>[...n,...t])},ue=a=>V(t=>t.filter((s,n)=>n!==a)),xe=a=>X(t=>t.filter((s,n)=>n!==a)),me=async()=>{var n,r;const a=(l==null?void 0:l._id)||(l==null?void 0:l.id);if(!a)return d("Vendor not authenticated");if(!P.trim())return d("Package title required");if(w.length===0)return d("Select at least one category");if(!I)return d("Price required");if(!A.trim())return d("Description required");const t=new FormData;t.append("module",le),t.append("packageTitle",P.trim()),t.append("description",A.trim()),w.forEach(i=>t.append("categories",i)),t.append("price",I),t.append("cancellationPolicy",H),t.append("advanceBookingAmount",J),t.append("travelToVenue",E),t.append("isActive",T),t.append("providerId",a);const s=B.filter(i=>i.title.trim()&&i.items.length>0).map(i=>({title:i.title.trim(),items:i.items}));t.append("includedServices",JSON.stringify(s)),v.forEach(i=>t.append("gallery",i));try{$(!0),d(""),C(""),g?(await y.put(`${f}/api/photography-packages/${p}`,t),C("Package updated successfully!")):(await y.post(`${f}/api/photography-packages`,t),C("Package created successfully!"))}catch(i){d(((r=(n=i.response)==null?void 0:n.data)==null?void 0:r.message)||"Error saving package")}finally{$(!1),window.scrollTo({top:0,behavior:"smooth"})}};return m||ce?e.jsx(c,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:e.jsx(Z,{size:60})}):e.jsxs(c,{sx:{bgcolor:"#f9f9fc",minHeight:"100vh"},children:[e.jsxs(c,{sx:{bgcolor:"white",borderBottom:"1px solid #eee",p:2,px:4,position:"sticky",top:0,zIndex:10},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(S,{onClick:()=>j(-1),children:e.jsx(be,{})}),e.jsxs(x,{variant:"h5",fontWeight:"bold",children:[g?"Edit":"Add"," Photography Package"]})]}),l&&e.jsxs(x,{variant:"body2",color:"text.secondary",sx:{ml:7},children:["Creating as: ",(l==null?void 0:l.firstName)||(l==null?void 0:l.email)||(l==null?void 0:l._id)]})]}),e.jsxs(c,{sx:{p:{xs:2,md:4}},children:[F&&e.jsx(ee,{severity:"success",sx:{mb:3},children:F}),M&&e.jsx(ee,{severity:"error",sx:{mb:3},children:M}),e.jsxs(te,{elevation:3,sx:{borderRadius:3,p:{xs:3,md:6}},children:[e.jsx(u,{fullWidth:!0,label:e.jsxs("span",{children:["Package Title ",e.jsx("span",{style:{color:"red"},children:"*"})]}),value:P,onChange:a=>G(a.target.value),sx:{mb:3}}),e.jsx(W,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:e.jsxs(ve,{fullWidth:!0,children:[e.jsx(ye,{children:"Categories *"}),e.jsx(Se,{multiple:!0,value:w,onChange:a=>L(a.target.value),renderValue:a=>e.jsx(c,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:a.map(t=>{const s=k.find(n=>n._id===t);return e.jsx(Ce,{label:(s==null?void 0:s.title)||"Unknown",size:"small"},t)})}),children:k.length===0?e.jsx(ae,{disabled:!0,children:"No categories available"}):k.map(a=>e.jsx(ae,{value:a._id,children:a.title},a._id))})]})}),e.jsxs(W,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsx(u,{fullWidth:!0,label:e.jsxs("span",{children:["Price ",e.jsx("span",{style:{color:"red"},children:"*"})]}),type:"number",value:I,onChange:a=>U(a.target.value)}),e.jsx(u,{fullWidth:!0,label:"Advance Booking Amount (%)",value:J,onChange:a=>K(a.target.value),placeholder:"e.g. 50%"})]}),e.jsx(u,{fullWidth:!0,label:e.jsxs("span",{children:["Description ",e.jsx("span",{style:{color:"red"},children:"*"})]}),multiline:!0,rows:4,value:A,onChange:a=>O(a.target.value),sx:{mb:4}}),e.jsxs(c,{sx:{mb:4},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(x,{variant:"h6",sx:{color:h},children:"Included Services"}),e.jsx(se,{variant:"contained",startIcon:e.jsx(ke,{}),sx:{bgcolor:h,"&:hover":{bgcolor:"#c2185b"}},onClick:de,children:"Add Section"})]}),B.map(a=>e.jsx(Ie,{section:a,onChange:(t,s)=>pe(a.id,t,s),onDelete:()=>ge(a.id)},a.id))]}),e.jsx(u,{fullWidth:!0,label:"Cancellation Policy",multiline:!0,rows:3,value:H,onChange:a=>q(a.target.value),sx:{mb:4},placeholder:"e.g. No refund within 48 hours"}),e.jsxs(W,{direction:"row",spacing:4,sx:{mb:4},children:[e.jsx(ie,{control:e.jsx(oe,{checked:E,onChange:()=>Y(!E)}),label:"Travel to Venue"}),e.jsx(ie,{control:e.jsx(oe,{checked:T,onChange:()=>Q(!T)}),label:"Package Active"})]}),e.jsx(x,{variant:"h6",sx:{color:h,mb:2},children:"Gallery (Max 10)"}),e.jsxs(te,{onClick:()=>document.getElementById("gallery-input").click(),sx:{border:"2px dashed #ddd",borderRadius:2,p:4,textAlign:"center",cursor:"pointer",mb:4,"&:hover":{borderColor:h}},children:[e.jsx("input",{id:"gallery-input",type:"file",hidden:!0,multiple:!0,accept:"image/*",onChange:he}),v.length>0||D.length>0?e.jsxs(c,{sx:{display:"flex",flexWrap:"wrap",gap:2,justifyContent:"center"},children:[D.map((a,t)=>e.jsxs(c,{sx:{position:"relative"},children:[e.jsx("img",{src:a,alt:"",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(S,{onClick:s=>{s.stopPropagation(),xe(t)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white",boxShadow:2},size:"small",children:e.jsx(re,{fontSize:"small"})})]},`ex-${t}`)),v.map((a,t)=>e.jsxs(c,{sx:{position:"relative"},children:[e.jsx("img",{src:URL.createObjectURL(a),alt:"",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(S,{onClick:s=>{s.stopPropagation(),ue(t)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white",boxShadow:2},size:"small",children:e.jsx(re,{fontSize:"small"})})]},`new-${t}`))]}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{sx:{fontSize:60,color:"#ccc"}}),e.jsx(x,{sx:{mt:2,color:h,fontWeight:"bold"},children:"Click to Upload Images"}),e.jsx(x,{variant:"body2",color:"text.secondary",children:"Supports: JPG, PNG, WEBP (Max 10MB each)"})]})]}),e.jsx(se,{fullWidth:!0,variant:"contained",size:"large",onClick:me,disabled:z||!l,sx:{py:2,bgcolor:h,"&:hover":{bgcolor:"#c2185b"},"&:disabled":{bgcolor:"#ccc"}},children:z?e.jsx(Z,{size:28,color:"inherit"}):g?"Update Package":"Create Package"})]})]})]})};export{_e as default};
