import{u as V,w as Y,r as l,j as e,B as o,T as a,b as f,ak as K,S as Q,g,ar as R,ao as H,x as M,ab as $,ac as z,H as k,W as X,p as Z}from"./index-f5xyXzBZ.js";import{E as L}from"./Edit-C9rfzPiT.js";import{D as _}from"./DialogTitle-Dr6idT6A.js";import{D as F}from"./DialogContentText-D8qzlJzy.js";import{D as O}from"./DialogActions-CUse9M2k.js";import{C as ee}from"./CardMedia-CmWgUE_P.js";import{A as re}from"./Add-Bj2Dv6Od.js";const te=k(Z)(({theme:s})=>({width:280,cursor:"pointer",transition:"0.2s ease-in-out",position:"relative","&:hover":{transform:"translateY(-4px)",boxShadow:s.shadows[4]}})),se=k(o)({position:"absolute",top:8,right:8,display:"flex",gap:1,backgroundColor:"rgba(255, 255, 255, 0.9)",borderRadius:"50%",padding:"4px",opacity:0,transition:"opacity 0.2s"}),ae=k(o)(({theme:s})=>({width:280,height:300,border:"2px dashed #E15B65",borderRadius:s.shape.borderRadius,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer","&:hover":{borderColor:s.palette.primary.main,backgroundColor:s.palette.action.hover}})),v="https://api.bookmyevent.ae",oe=()=>{try{const s=localStorage.getItem("user");if(!s)return null;const n=JSON.parse(s);return(n==null?void 0:n._id)||null}catch(s){return console.error("Provider parse error",s),null}},y=s=>{if(!s)return"/placeholder.jpg";let n=String(s).replace(/^uploads/i,"/uploads");return n.startsWith("/")||(n="/"+n),`${v}${n}`},ue=()=>{const s=V(),n=Y(),[b,m]=l.useState("list"),[N,W]=l.useState([]),[i,C]=l.useState(null),[q,p]=l.useState(!0),[w,d]=l.useState(!1),[S,h]=l.useState(""),[P,x]=l.useState("success"),[D,u]=l.useState(!1),[U,G]=l.useState(null);l.useEffect(()=>{I()},[]);const I=async()=>{p(!0);const r=oe();if(!r){p(!1),h("Provider ID missing"),x("error"),d(!0);return}const t=localStorage.getItem("token");if(!t){p(!1),h("Token missing. Please login."),x("error"),d(!0);return}try{const c=await fetch(`${v}/api/catering/provider/${r}`,{headers:{Authorization:`Bearer ${t}`}}),j=await c.json();if(!c.ok)throw new Error(j.message);W(j.data||[])}catch(c){console.error("Fetch error:",c),h("Failed to load packages"),x("error"),d(!0)}finally{p(!1)}},J=r=>{C(r),m("preview")},E=r=>{n("/catering/addpackage",{state:{editPackage:r}})},T=r=>{G(r),u(!0)},A=async()=>{const r=localStorage.getItem("token");if(!r){h("Missing token"),x("error"),d(!0);return}try{const t=await fetch(`${v}/api/catering/${U}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}}),c=await t.json();if(!t.ok)throw new Error(c.message);h("Package deleted successfully"),x("success"),d(!0),I(),m("list"),C(null)}catch(t){console.error("Delete error:",t),h("Failed to delete package"),x("error"),d(!0)}finally{u(!1)}},B=()=>d(!1);return q&&b==="list"?e.jsx(o,{sx:{p:3,minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(a,{variant:"h6",children:"Loading packages..."})}):b==="preview"&&i?e.jsxs(o,{sx:{p:3,backgroundColor:s.palette.grey[100],minHeight:"100vh"},children:[e.jsxs(o,{sx:{backgroundColor:"white",borderRadius:2,p:3,boxShadow:s.shadows[1]},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(f,{onClick:()=>m("list"),children:e.jsx(K,{})}),e.jsx(a,{variant:"h5",sx:{ml:2},children:"Package Preview"})]}),e.jsx("img",{src:y(i.thumbnail),style:{width:"100%",height:220,objectFit:"cover",borderRadius:8}}),e.jsx(a,{variant:"h6",sx:{mt:3},children:i.title}),e.jsx(a,{variant:"body2",sx:{mb:2},children:i.subtitle}),e.jsx(a,{variant:"body1",sx:{mb:3},children:i.description}),e.jsx(a,{variant:"h6",children:"Includes"}),(i.includes||[]).map((r,t)=>e.jsxs(o,{sx:{mb:2},children:[e.jsx(a,{variant:"subtitle1",children:r.title}),e.jsx("ul",{children:r.items.map((c,j)=>e.jsx("li",{children:e.jsx(a,{variant:"body2",children:c})},j))})]},t)),e.jsxs(o,{sx:{textAlign:"center",my:3},children:[e.jsx(a,{variant:"h6",children:"Starting Price"}),e.jsxs(a,{variant:"h4",color:"primary",children:["₹",i.price," Per Head"]})]}),e.jsx(a,{variant:"h6",sx:{mb:1},children:"Gallery"}),e.jsx(Q,{direction:"row",spacing:2,flexWrap:"wrap",children:(i.images||[]).map((r,t)=>e.jsx("img",{src:y(r),style:{width:120,height:120,objectFit:"cover",borderRadius:8}},t))}),e.jsxs(o,{sx:{display:"flex",gap:2,justifyContent:"center",mt:3},children:[e.jsx(g,{variant:"outlined",startIcon:e.jsx(L,{}),onClick:()=>E(i),children:"Edit Package"}),e.jsx(g,{variant:"contained",color:"error",startIcon:e.jsx(R,{}),onClick:()=>T(i._id),children:"Delete"})]})]}),e.jsx(H,{open:w,onClose:B,autoHideDuration:3e3,children:e.jsx(M,{severity:P,children:S})}),e.jsxs($,{open:D,onClose:()=>u(!1),children:[e.jsx(_,{children:"Delete Package?"}),e.jsx(z,{children:e.jsx(F,{children:"This action cannot be undone. Continue?"})}),e.jsxs(O,{children:[e.jsx(g,{onClick:()=>u(!1),children:"Cancel"}),e.jsx(g,{color:"error",onClick:A,children:"Delete"})]})]})]}):e.jsx(o,{sx:{p:3,backgroundColor:s.palette.grey[100],minHeight:"100vh"},children:e.jsxs(o,{sx:{p:3,backgroundColor:"white",borderRadius:2,boxShadow:s.shadows[1]},children:[e.jsx(a,{variant:"h4",sx:{mb:3,textAlign:"center"},children:"Catering Packages"}),e.jsxs(o,{sx:{display:"flex",gap:3,flexWrap:"wrap",justifyContent:"center"},children:[N.map(r=>e.jsxs(te,{onClick:()=>J(r),onMouseEnter:t=>t.currentTarget.querySelector(".action-overlay").style.setProperty("opacity","1"),onMouseLeave:t=>t.currentTarget.querySelector(".action-overlay").style.setProperty("opacity","0"),children:[e.jsxs(o,{sx:{position:"relative"},children:[e.jsx(ee,{component:"img",height:"200",image:y(r.thumbnail)}),e.jsxs(se,{className:"action-overlay",children:[e.jsx(f,{size:"small",onClick:t=>{t.stopPropagation(),E(r)},children:e.jsx(L,{fontSize:"small",color:"primary"})}),e.jsx(f,{size:"small",onClick:t=>{t.stopPropagation(),T(r._id)},children:e.jsx(R,{fontSize:"small",color:"error"})})]})]}),e.jsxs(X,{children:[e.jsx(a,{variant:"h6",children:r.title}),e.jsx(a,{variant:"body2",sx:{mb:1},children:r.subtitle}),e.jsxs(a,{variant:"h6",color:"primary",children:["₹",r.price," Per Head"]})]})]},r._id)),e.jsxs(ae,{onClick:()=>n("/catering/addpackage"),children:[e.jsx(re,{sx:{fontSize:48,color:"#E15B65"}}),e.jsx(a,{variant:"h6",color:"#E15B65",children:"Add New Package"})]})]}),e.jsx(H,{open:w,autoHideDuration:3e3,onClose:B,children:e.jsx(M,{severity:P,children:S})}),e.jsxs($,{open:D,onClose:()=>u(!1),children:[e.jsx(_,{children:"Delete Package?"}),e.jsx(z,{children:e.jsx(F,{children:"This action cannot be undone. Continue?"})}),e.jsxs(O,{children:[e.jsx(g,{onClick:()=>u(!1),children:"Cancel"}),e.jsx(g,{color:"error",onClick:A,children:"Delete"})]})]})]})})};export{ue as default};
