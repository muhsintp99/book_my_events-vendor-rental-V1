import{c as C,j as e,w as Le,a9 as Ae,u as Ee,k as Fe,r as n,B as a,S as b,b as g,aa as Re,o as ae,T as x,aw as le,t as ce,am as z,a4 as Oe,q as Pe,D as de,bp as Te,G as xe,Q as Ne,an as Ve,U as B,h as he,a1 as D,$ as He,ax as Ge,ay as $e,a0 as Ue}from"./index-s0QLBFc1.js";import{s as f,S as Ye}from"./socket-zBXwGRui.js";import{S as L}from"./Search-DJBru7CE.js";import{C as Qe}from"./Close-BAWo_bOw.js";import{C as Je}from"./Chat-BLt0AxsD.js";import{A as Ke}from"./Add-CaxTzTke.js";import{E as Xe}from"./EmojiEmotions-wfaQIMvH.js";import{D as Ze}from"./DeleteOutline-BhVuQCyh.js";import{F as qe}from"./FilterList-DIznf5Cq.js";import{L as et}from"./ListItem-CIwi42uB.js";import{L as tt}from"./ListItemAvatar-B44uVYHO.js";const st=C(e.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"})),rt=C(e.jsx("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2m0-15.5c2.49 0 4 2.02 4 4.5v.1l2 2V11c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68c-.24.06-.47.15-.69.23l1.64 1.64c.18-.02.36-.05.55-.05M5.41 3.35 4 4.76l2.81 2.81C6.29 8.57 6 9.74 6 11v5l-2 2v1h14.24l1.74 1.74 1.41-1.41zM16 17H8v-6c0-.68.12-1.32.34-1.9L16 16.76z"})),it=C(e.jsx("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"})),ot=C(e.jsx("path",{d:"M12 5.9c1.16 0 2.1.94 2.1 2.1s-.94 2.1-2.1 2.1S9.9 9.16 9.9 8s.94-2.1 2.1-2.1m0 9c2.97 0 6.1 1.46 6.1 2.1v1.1H5.9V17c0-.64 3.13-2.1 6.1-2.1M12 4C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 9c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4"})),l={primary:"#9C27B0",secondary:"#E91E63",dark:"#1A1A2E"},nt=["ðŸ˜Š","ðŸ˜‚","ðŸ˜","ðŸ‘","ðŸ™","ðŸ”¥","âœ¨","â¤ï¸","ðŸŽ‰","ðŸ‘—","ðŸ‘œ","ðŸ“","ðŸ’¯","ðŸ‘","ðŸ™Œ","â­"],at="https://api.bookmyevent.ae",lt=i=>{if(!i)return"assets/img/default-placeholder.jpg";if(typeof i=="string"&&i.startsWith("http"))return i;typeof i=="string"&&i.startsWith("/var/www/backend/")&&(i=i.replace("/var/www/backend/",""));const m=String(i).replace(/^\//,"");return`${at}/${m}`},S=i=>{var m;return i?(m=i.userId)!=null&&m.firstName?(i.userId.firstName+" "+(i.userId.lastName||"")).trim():i.fullName||"Customer":"Customer"},pe=i=>{if(!i)return"?";const m=i.split(" ");return m.length>=2?(m[0][0]+m[1][0]).toUpperCase():i.substring(0,2).toUpperCase()},wt=()=>{var Z,q,ee,te,se,re;Le();const i=Ae(),m=Ee(),h=Fe(m.breakpoints.down("md")),me=localStorage.getItem("user")||"{}",p=JSON.parse(me),j=(p==null?void 0:p.providerId)||(p==null?void 0:p._id),[A,ue]=n.useState([]),[s,E]=n.useState(((Z=i.state)==null?void 0:Z.enquiry)||null),[v,w]=n.useState([]),[F,k]=n.useState(""),[ge,R]=n.useState(!0),[fe,O]=n.useState(!1),[_,je]=n.useState(""),[P,T]=n.useState(null),[N,V]=n.useState(null),[H,G]=n.useState(!1),[be,$]=n.useState(""),[U,Y]=n.useState(!!((q=i.state)!=null&&q.enquiry)),Q=n.useRef(null),J=n.useRef(null),M=n.useRef(new Set),K=n.useMemo(()=>{var o,r;let t=A;return(r=(o=i.state)==null?void 0:o.product)!=null&&r._id&&(t=t.filter(c=>String(c.packageId)===String(i.state.product._id))),t.filter(c=>S(c).toLowerCase().includes(_.toLowerCase()))},[A,_,(te=(ee=i.state)==null?void 0:ee.product)==null?void 0:te._id]),we=()=>{var t;(t=J.current)==null||t.scrollIntoView({behavior:"smooth"})};n.useEffect(()=>{if(!j)return;(async()=>{try{R(!0);const c=((await he.get(`https://api.bookmyevent.ae/api/enquiries/provider/${j}`)).data.data||[]).filter(d=>{var ie,oe,ne;const u=(d.description||"").toLowerCase(),I=(((ie=d.moduleId)==null?void 0:ie.moduleType)||"").toLowerCase(),We=(((oe=d.moduleId)==null?void 0:oe.title)||"").toLowerCase(),ze=typeof d.moduleId=="string"?d.moduleId:((ne=d.moduleId)==null?void 0:ne._id)||"",Be=I==="boutique"||We.includes("boutique")||ze==="68e5fd7b8164d482d281c37f",De=u.includes("customize")||u.includes("design")||u.includes("boutique");return Be&&De});ue(c),!s&&c.length>0&&E(c[0])}catch(o){console.error("Failed to fetch enquiries:",o)}finally{R(!1)}})()},[j]),n.useEffect(()=>{if(!(s!=null&&s._id))return;(async()=>{var o;try{O(!0);const r=await he.get(`https://api.bookmyevent.ae/api/enquiries/${s._id}/messages`);w(((o=r.data)==null?void 0:o.data)||[])}catch(r){console.error("Failed to fetch messages:",r)}finally{O(!1)}})()},[s==null?void 0:s._id]),n.useEffect(()=>{if(!(s!=null&&s._id)||!j)return;f.connected||f.connect(),f.emit("join_enquiry",{enquiryId:s._id,vendorId:j});const t=r=>{if(r.enquiryId&&r.enquiryId!==s._id)return;const c=r._id||r.timestamp;if(M.current.has(c)){M.current.delete(c),w(d=>d.map(u=>u.timestamp===r.timestamp&&String(u.senderId)===String(r.senderId)?{...r,time:r.time||new Date(r.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}:u));return}w(d=>d.some(I=>I._id===r._id||r.timestamp&&I.timestamp===r.timestamp)?d:[...d,{...r,time:r.time||new Date(r.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}])},o=r=>{w(c=>c.filter(d=>d._id!==r.messageId))};return f.on("receive_message",t),f.on("message_deleted",o),()=>{f.off("receive_message",t),f.off("message_deleted",o)}},[s==null?void 0:s._id,j]),n.useEffect(()=>{we()},[v]);const W=(t=F,o="text")=>{var d;if(o==="text"&&!t.trim()||!(s!=null&&s._id))return;const r=new Date().toISOString(),c={enquiryId:s._id,senderId:j,receiverId:((d=s.userId)==null?void 0:d._id)||s.userId,senderName:(p==null?void 0:p.businessName)||(p==null?void 0:p.name)||"Vendor",senderRole:"vendor",text:o==="text"?t:"Sent an image",message:o==="text"?t:"Sent an image",timestamp:r,type:o};M.current.add(r),w(u=>[...u,{...c,_id:"optimistic-"+Date.now(),time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}]),f.emit("send_message",c),o==="text"&&k("")},Se=()=>{var t;return(t=Q.current)==null?void 0:t.click()},ye=t=>{const o=t.target.files[0];if(o){const r=new FileReader;r.onload=c=>W(c.target.result,"image"),r.readAsDataURL(o)}},Ie=t=>T(t.currentTarget),X=()=>T(null),Ce=t=>{k(o=>o+t),X()},ve=t=>V(t.currentTarget),y=()=>V(null),ke=()=>{w([]),y()},_e=t=>{E(t),h&&Y(!0)},Me=()=>e.jsxs(a,{sx:{width:{xs:"100%",md:350},height:"100%",borderRight:"1px solid #E0E4EC",display:"flex",flexDirection:"column",bgcolor:"white"},children:[e.jsxs(a,{sx:{p:2,bgcolor:"white"},children:[e.jsxs(b,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[e.jsx(x,{variant:"h5",fontWeight:800,color:l.primary,children:"Customization"}),e.jsx(b,{direction:"row",spacing:1,children:e.jsx(g,{size:"small",sx:{bgcolor:D(l.primary,.05)},children:e.jsx(qe,{fontSize:"small"})})})]}),e.jsxs(z,{sx:{p:"2px 8px",display:"flex",alignItems:"center",bgcolor:"#F1F5F9",borderRadius:"12px",boxShadow:"none"},children:[e.jsx(L,{sx:{color:"#64748B",ml:1}}),e.jsx(le,{sx:{ml:1,flex:1,p:1,fontWeight:500},placeholder:"Search customers...",value:_,onChange:t=>je(t.target.value)})]})]}),e.jsx(He,{sx:{flexGrow:1,overflowY:"auto",py:0},children:ge?e.jsx(a,{sx:{p:4,textAlign:"center"},children:e.jsx(ce,{size:30})}):K.length===0?e.jsx(a,{sx:{p:4,textAlign:"center"},children:e.jsx(x,{variant:"body2",color:"text.secondary",children:"No customizations found"})}):K.map(t=>e.jsx(et,{disablePadding:!0,children:e.jsxs(Ge,{selected:(s==null?void 0:s._id)===t._id,onClick:()=>_e(t),sx:{py:2,px:2,borderLeft:`4px solid ${(s==null?void 0:s._id)===t._id?l.primary:"transparent"}`,"&.Mui-selected":{bgcolor:D(l.primary,.05)}},children:[e.jsx(tt,{children:e.jsx($e,{overlap:"circle",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot",color:"success",sx:{"& .MuiBadge-badge":{border:"2px solid white"}},children:e.jsx(ae,{sx:{bgcolor:D(l.primary,.1),color:l.primary,fontWeight:700},children:pe(S(t))})})}),e.jsx(Ue,{primary:e.jsxs(b,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(x,{variant:"subtitle1",fontWeight:700,children:S(t)}),e.jsx(x,{variant:"caption",color:"text.secondary",children:new Date(t.createdAt).toLocaleDateString([],{month:"short",day:"numeric"})})]}),secondary:e.jsx(x,{variant:"body2",noWrap:!0,sx:{maxWidth:"180px",color:"#64748B"},children:t.description})})]})},t._id))})]});return e.jsxs(a,{sx:{height:"calc(100vh - 120px)",display:"flex",bgcolor:"white",borderRadius:"24px",overflow:"hidden",boxShadow:"0 20px 50px rgba(0,0,0,0.1)",border:"1px solid rgba(224, 228, 236, 0.5)",m:{xs:1,md:3}},children:[(!h||!U)&&e.jsx(Me,{}),(!h||U)&&e.jsxs(a,{sx:{flexGrow:1,display:"flex",flexDirection:"column",bgcolor:"#F8FAFC"},children:[e.jsx("input",{type:"file",hidden:!0,ref:Q,onChange:ye,accept:"image/*"}),e.jsxs(a,{sx:{p:h?1.5:2,bgcolor:"white",borderBottom:"1px solid #E0E4EC",display:"flex",alignItems:"center",justifyContent:"space-between",zIndex:10},children:[e.jsxs(b,{direction:"row",spacing:2,alignItems:"center",sx:{flexGrow:1},children:[h&&e.jsx(g,{onClick:()=>Y(!1),children:e.jsx(Re,{})}),H?e.jsxs(a,{sx:{flex:1,bgcolor:"#f1f5f9",borderRadius:"12px",px:2,py:1,display:"flex",alignItems:"center",animation:"fadeIn 0.3s ease-in-out"},children:[e.jsx(L,{sx:{color:"#64748B",mr:1}}),e.jsx(le,{fullWidth:!0,placeholder:"Search messages...",value:be,onChange:t=>$(t.target.value),sx:{fontWeight:500}}),e.jsx(g,{size:"small",onClick:()=>{G(!1),$("")},children:e.jsx(Qe,{fontSize:"small"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{sx:{width:h?35:45,height:h?35:45,bgcolor:l.primary,fontWeight:800,fontSize:h?"0.9rem":"1.1rem"},children:pe(S(s))}),e.jsxs(a,{sx:{minWidth:0},children:[e.jsx(x,{variant:h?"subtitle2":"subtitle1",fontWeight:800,sx:{lineHeight:1.2,noWrap:!0,overflow:"hidden",textOverflow:"ellipsis"},children:S(s)}),e.jsxs(b,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(x,{variant:"caption",sx:{color:l.secondary,fontWeight:700},children:s==null?void 0:s.email}),!h&&e.jsx(a,{sx:{width:4,height:4,borderRadius:"50%",bgcolor:"#CBD5E1"}}),!h&&e.jsx(x,{variant:"caption",sx:{color:"#64748B",fontWeight:600},children:s==null?void 0:s.contact})]})]}),e.jsx(a,{sx:{flexGrow:1}}),(s==null?void 0:s.packageDetails)&&e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1.5,p:"4px 10px",borderRadius:"12px",bgcolor:"rgba(255, 255, 255, 0.85)",backdropFilter:"blur(12px)",border:"1px solid rgba(156, 39, 176, 0.1)",boxShadow:"0 4px 15px rgba(0,0,0,0.05)",maxWidth:{xs:"140px",sm:"260px"},mr:1.5,transition:"all 0.3s ease","&:hover":{boxShadow:"0 6px 20px rgba(156, 39, 176, 0.1)",transform:"translateY(-1px)",bgcolor:"white"}},children:[e.jsx(a,{sx:{width:38,height:38,borderRadius:"8px",overflow:"hidden",flexShrink:0,border:"1.5px solid white",boxShadow:"0 2px 6px rgba(0,0,0,0.06)"},children:e.jsx("img",{src:lt(s.packageDetails.thumbnail),alt:"Package",style:{width:"100%",height:"100%",objectFit:"cover"}})}),e.jsxs(a,{sx:{minWidth:0,flexGrow:1},children:[e.jsx(x,{variant:"caption",sx:{display:"block",fontWeight:800,color:l.dark,fontSize:"0.68rem",noWrap:!0,overflow:"hidden",textOverflow:"ellipsis",lineHeight:1.1},children:s.packageDetails.name}),e.jsxs(b,{direction:"row",alignItems:"center",spacing:.5,children:[e.jsxs(x,{variant:"caption",sx:{fontWeight:900,color:l.primary,fontSize:"0.78rem"},children:["â‚¹",((se=s.packageDetails.buyPricing)==null?void 0:se.totalPrice)||((re=s.packageDetails.rentalPricing)==null?void 0:re.totalPrice)||"0"]}),e.jsx(g,{size:"small",component:"a",href:`https://bookmyevent.ae/boutique-details.html?id=${s.packageId}`,target:"_blank",sx:{p:0,color:l.primary,opacity:.6,"&:hover":{opacity:1,bgcolor:"transparent"}},children:e.jsx(it,{sx:{fontSize:11}})})]})]})]})]})]}),e.jsxs(b,{direction:"row",spacing:.5,alignItems:"center",children:[!H&&e.jsx(g,{onClick:()=>G(!0),sx:{color:"#64748B"},children:e.jsx(L,{fontSize:"small"})}),e.jsx(g,{onClick:ve,sx:{color:"#64748B"},children:e.jsx(st,{fontSize:"small"})})]})]}),e.jsxs(a,{sx:{flexGrow:1,overflowY:"auto",p:h?1.5:3,display:"flex",flexDirection:"column",gap:2,backgroundImage:"radial-gradient(#9C27B010 1px, transparent 1px)",backgroundSize:"20px 20px"},children:[fe?e.jsx(a,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx(ce,{size:40})}):v.length===0?e.jsxs(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",opacity:.3},children:[e.jsx(Je,{sx:{fontSize:60,color:l.primary,mb:1}}),e.jsx(x,{variant:"h6",fontWeight:600,children:"No messages yet"})]}):v.map((t,o)=>{const r=t.senderRole==="vendor";return e.jsxs(a,{sx:{alignSelf:r?"flex-end":"flex-start",maxWidth:{xs:"90%",md:"70%"},display:"flex",flexDirection:"column",alignItems:r?"flex-end":"flex-start"},children:[e.jsx(z,{sx:{p:t.type==="image"?.5:2,borderRadius:r?"20px 20px 4px 20px":"20px 20px 20px 4px",bgcolor:r?l.primary:"white",color:r?"white":l.dark,boxShadow:r?"0 8px 16px rgba(156, 39, 176, 0.2)":"0 4px 12px rgba(0,0,0,0.05)",border:r?"none":"1px solid rgba(224, 228, 236, 0.5)",overflow:"hidden"},children:t.type==="image"?e.jsx(a,{sx:{width:"100%",borderRadius:"16px",overflow:"hidden",display:"flex"},children:e.jsx("img",{src:t.file,alt:"sent",style:{maxWidth:"100%",maxHeight:"400px",objectFit:"cover"}})}):e.jsx(x,{variant:"body1",sx:{fontWeight:500,lineHeight:1.5},children:t.text||t.message})}),e.jsxs(x,{variant:"caption",sx:{mt:.5,px:1,color:"#94A3B8",fontWeight:600},children:[t.time||new Date(t.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})," ",r&&e.jsx(Oe,{sx:{fontSize:12,ml:.5,verticalAlign:"middle",color:l.primary}})]})]},t._id||o)}),e.jsx("div",{ref:J})]}),e.jsx(a,{sx:{p:h?1.5:2.5,bgcolor:"white",borderTop:"1px solid #E0E4EC"},children:e.jsxs(z,{component:"form",onSubmit:t=>{t.preventDefault(),W()},sx:{p:"4px 8px",display:"flex",alignItems:"center",borderRadius:"16px",bgcolor:"#F8FAFC",border:"1px solid #E2E8F0",boxShadow:"none"},children:[e.jsx(g,{onClick:Se,sx:{color:"#64748B"},children:e.jsx(Ke,{})}),e.jsx(Pe,{fullWidth:!0,placeholder:"Type a message...",variant:"standard",value:F,onChange:t=>k(t.target.value),InputProps:{disableUnderline:!0},sx:{ml:1,flex:1,"& .MuiInputBase-input":{fontWeight:500}}}),e.jsx(g,{onClick:Ie,sx:{color:"#64748B"},children:e.jsx(Xe,{})}),e.jsx(de,{sx:{height:28,mx:1},orientation:"vertical"}),e.jsx(g,{onClick:()=>W(),sx:{p:1.2,color:"white",bgcolor:l.primary,"&:hover":{bgcolor:l.secondary}},children:e.jsx(Ye,{sx:{fontSize:20}})})]})})]}),e.jsx(Te,{open:!!P,anchorEl:P,onClose:X,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"right"},PaperProps:{sx:{p:1,borderRadius:"16px"}},children:e.jsx(xe,{container:!0,spacing:1,sx:{width:"200px",p:1},children:nt.map(t=>e.jsx(xe,{item:!0,xs:3,children:e.jsx(g,{onClick:()=>Ce(t),size:"small",sx:{fontSize:"1.2rem"},children:t})},t))})}),e.jsxs(Ne,{anchorEl:N,open:!!N,onClose:y,TransitionComponent:Ve,PaperProps:{sx:{borderRadius:"16px",minWidth:180,mt:1.5}},children:[e.jsxs(B,{onClick:y,children:[e.jsx(ot,{sx:{mr:1.5,color:l.primary}}),e.jsx(x,{variant:"body2",fontWeight:600,children:"View Profile"})]}),e.jsxs(B,{onClick:y,children:[e.jsx(rt,{sx:{mr:1.5,color:"#64748B"}}),e.jsx(x,{variant:"body2",fontWeight:600,children:"Mute Chat"})]}),e.jsx(de,{}),e.jsxs(B,{onClick:ke,sx:{color:"#F44336"},children:[e.jsx(Ze,{sx:{mr:1.5}}),e.jsx(x,{variant:"body2",fontWeight:600,children:"Clear History"})]})]}),e.jsx("style",{children:"@keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }"})]})};export{wt as default};
