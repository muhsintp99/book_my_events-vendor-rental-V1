import{u as K,w as V,r as l,j as e,B as o,T as a,b as y,aa as Y,S as Q,g,aq as R,af as M,ak as $,x as z,ah as F,at as H,ai as L,aj as _,s as k,K as X,n as Z}from"./index-s0QLBFc1.js";import{D as O}from"./DialogContentText-CSiwUnt_.js";import{C as ee}from"./CardMedia-DyFE9SjL.js";import{A as te}from"./Add-CaxTzTke.js";const re=k(Z)(({theme:s})=>({width:280,cursor:"pointer",transition:"0.2s ease-in-out",position:"relative","&:hover":{transform:"translateY(-4px)",boxShadow:s.shadows[4]}})),se=k(o)({position:"absolute",top:8,right:8,display:"flex",gap:1,backgroundColor:"rgba(255, 255, 255, 0.9)",borderRadius:"50%",padding:"4px",opacity:0,transition:"opacity 0.2s"}),ae=k(o)(({theme:s})=>({width:280,height:300,border:"2px dashed #E15B65",borderRadius:s.shape.borderRadius,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer","&:hover":{borderColor:s.palette.primary.main,backgroundColor:s.palette.action.hover}})),v="https://api.bookmyevent.ae",oe=()=>{try{const s=localStorage.getItem("user");if(!s)return null;const i=JSON.parse(s);return(i==null?void 0:i._id)||null}catch(s){return console.error("Provider parse error",s),null}},f=s=>{if(!s)return"/placeholder.jpg";let i=String(s).replace(/^uploads/i,"/uploads");return i.startsWith("/")||(i="/"+i),`${v}${i}`},de=()=>{const s=K(),i=V(),[b,m]=l.useState("list"),[N,q]=l.useState([]),[n,C]=l.useState(null),[W,p]=l.useState(!0),[w,d]=l.useState(!1),[S,h]=l.useState(""),[P,x]=l.useState("success"),[D,u]=l.useState(!1),[U,G]=l.useState(null);l.useEffect(()=>{I()},[]);const I=async()=>{p(!0);const t=oe();if(!t){p(!1),h("Provider ID missing"),x("error"),d(!0);return}const r=localStorage.getItem("token");if(!r){p(!1),h("Token missing. Please login."),x("error"),d(!0);return}try{const c=await fetch(`${v}/api/catering/provider/${t}`,{headers:{Authorization:`Bearer ${r}`}}),j=await c.json();if(!c.ok)throw new Error(j.message);q(j.data||[])}catch(c){console.error("Fetch error:",c),h("Failed to load packages"),x("error"),d(!0)}finally{p(!1)}},J=t=>{C(t),m("preview")},E=t=>{i("/catering/addpackage",{state:{editPackage:t}})},T=t=>{G(t),u(!0)},A=async()=>{const t=localStorage.getItem("token");if(!t){h("Missing token"),x("error"),d(!0);return}try{const r=await fetch(`${v}/api/catering/${U}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}}),c=await r.json();if(!r.ok)throw new Error(c.message);h("Package deleted successfully"),x("success"),d(!0),I(),m("list"),C(null)}catch(r){console.error("Delete error:",r),h("Failed to delete package"),x("error"),d(!0)}finally{u(!1)}},B=()=>d(!1);return W&&b==="list"?e.jsx(o,{sx:{p:3,minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(a,{variant:"h6",children:"Loading packages..."})}):b==="preview"&&n?e.jsxs(o,{sx:{p:3,backgroundColor:s.palette.grey[100],minHeight:"100vh"},children:[e.jsxs(o,{sx:{backgroundColor:"white",borderRadius:2,p:3,boxShadow:s.shadows[1]},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(y,{onClick:()=>m("list"),children:e.jsx(Y,{})}),e.jsx(a,{variant:"h5",sx:{ml:2},children:"Package Preview"})]}),e.jsx("img",{src:f(n.thumbnail),style:{width:"100%",height:220,objectFit:"cover",borderRadius:8}}),e.jsx(a,{variant:"h6",sx:{mt:3},children:n.title}),e.jsx(a,{variant:"body2",sx:{mb:2},children:n.subtitle}),e.jsx(a,{variant:"body1",sx:{mb:3},children:n.description}),e.jsx(a,{variant:"h6",children:"Includes"}),(n.includes||[]).map((t,r)=>e.jsxs(o,{sx:{mb:2},children:[e.jsx(a,{variant:"subtitle1",children:t.title}),e.jsx("ul",{children:t.items.map((c,j)=>e.jsx("li",{children:e.jsx(a,{variant:"body2",children:c})},j))})]},r)),e.jsxs(o,{sx:{textAlign:"center",my:3},children:[e.jsx(a,{variant:"h6",children:"Starting Price"}),e.jsxs(a,{variant:"h4",color:"primary",children:["₹",n.price," Per Head"]}),n.price>0&&e.jsxs(a,{variant:"body2",color:"text.secondary",children:["Advance Booking (10% Fixed): ₹",(n.price*.1).toFixed(2)]})]}),e.jsx(a,{variant:"h6",sx:{mb:1},children:"Gallery"}),e.jsx(Q,{direction:"row",spacing:2,flexWrap:"wrap",children:(n.images||[]).map((t,r)=>e.jsx("img",{src:f(t),style:{width:120,height:120,objectFit:"cover",borderRadius:8}},r))}),e.jsxs(o,{sx:{display:"flex",gap:2,justifyContent:"center",mt:3},children:[e.jsx(g,{variant:"outlined",startIcon:e.jsx(R,{}),onClick:()=>E(n),children:"Edit Package"}),e.jsx(g,{variant:"contained",color:"error",startIcon:e.jsx(M,{}),onClick:()=>T(n._id),children:"Delete"})]})]}),e.jsx($,{open:w,onClose:B,autoHideDuration:3e3,children:e.jsx(z,{severity:P,children:S})}),e.jsxs(F,{open:D,onClose:()=>u(!1),children:[e.jsx(H,{children:"Delete Package?"}),e.jsx(L,{children:e.jsx(O,{children:"This action cannot be undone. Continue?"})}),e.jsxs(_,{children:[e.jsx(g,{onClick:()=>u(!1),children:"Cancel"}),e.jsx(g,{color:"error",onClick:A,children:"Delete"})]})]})]}):e.jsx(o,{sx:{p:3,backgroundColor:s.palette.grey[100],minHeight:"100vh"},children:e.jsxs(o,{sx:{p:3,backgroundColor:"white",borderRadius:2,boxShadow:s.shadows[1]},children:[e.jsx(a,{variant:"h4",sx:{mb:3,textAlign:"center"},children:"Catering Packages"}),e.jsxs(o,{sx:{display:"flex",gap:3,flexWrap:"wrap",justifyContent:"center"},children:[N.map(t=>e.jsxs(re,{onClick:()=>J(t),onMouseEnter:r=>r.currentTarget.querySelector(".action-overlay").style.setProperty("opacity","1"),onMouseLeave:r=>r.currentTarget.querySelector(".action-overlay").style.setProperty("opacity","0"),children:[e.jsxs(o,{sx:{position:"relative"},children:[e.jsx(ee,{component:"img",height:"200",image:f(t.thumbnail)}),e.jsxs(se,{className:"action-overlay",children:[e.jsx(y,{size:"small",onClick:r=>{r.stopPropagation(),E(t)},children:e.jsx(R,{fontSize:"small",color:"primary"})}),e.jsx(y,{size:"small",onClick:r=>{r.stopPropagation(),T(t._id)},children:e.jsx(M,{fontSize:"small",color:"error"})})]})]}),e.jsxs(X,{children:[e.jsx(a,{variant:"h6",children:t.title}),e.jsx(a,{variant:"body2",sx:{mb:1},children:t.subtitle}),e.jsxs(a,{variant:"h6",color:"primary",children:["₹",t.price," Per Head"]})]})]},t._id)),e.jsxs(ae,{onClick:()=>i("/catering/addpackage"),children:[e.jsx(te,{sx:{fontSize:48,color:"#E15B65"}}),e.jsx(a,{variant:"h6",color:"#E15B65",children:"Add New Package"})]})]}),e.jsx($,{open:w,autoHideDuration:3e3,onClose:B,children:e.jsx(z,{severity:P,children:S})}),e.jsxs(F,{open:D,onClose:()=>u(!1),children:[e.jsx(H,{children:"Delete Package?"}),e.jsx(L,{children:e.jsx(O,{children:"This action cannot be undone. Continue?"})}),e.jsxs(_,{children:[e.jsx(g,{onClick:()=>u(!1),children:"Cancel"}),e.jsx(g,{color:"error",onClick:A,children:"Delete"})]})]})]})})};export{de as default};
