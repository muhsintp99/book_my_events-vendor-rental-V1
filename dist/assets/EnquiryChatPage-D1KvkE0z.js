import{r as o,j as e,H as v,B as r,T as a,s as b,A as I,o as C,a as _,d as w,m as y,Y as S}from"./index-BaH8rYCR.js";import{s as l,S as k}from"./socket-rF0ZUajw.js";import{C as D}from"./Close-GR0SV3nW.js";import{C as A}from"./ChatBubbleOutline-d_Jv7vru.js";const W=({open:f,onClose:n,enquiry:t})=>{var p,m;const[c,d]=o.useState(""),[x,E]=o.useState([]),u=o.useRef(null),i=JSON.parse(localStorage.getItem("user"));if(!t||!i)return null;if(!(t.vendorId===i._id||((p=t.vendorId)==null?void 0:p._id)===i._id))return e.jsx(v,{open:f,onClose:n,children:e.jsx(r,{p:4,textAlign:"center",children:e.jsx(a,{color:"error",fontWeight:600,children:"You are not authorized to view this chat"})})});o.useEffect(()=>{if(t!=null&&t._id)return l.connect(),l.emit("join_enquiry",{enquiryId:t._id,vendorId:i._id}),l.on("receive_message",s=>{E(h=>[...h,s])}),()=>{l.off("receive_message"),l.disconnect()}},[t,i._id]),o.useEffect(()=>{var s;(s=u.current)==null||s.scrollIntoView({behavior:"smooth"})},[x]);const g=()=>{if(!c.trim())return;const s={enquiryId:t._id,senderId:i._id,senderRole:"vendor",text:c,time:new Date().toLocaleTimeString()};l.emit("send_message",s),d("")};return e.jsxs(v,{open:f,onClose:n,fullWidth:!0,maxWidth:"sm",children:[e.jsx(r,{sx:{px:2,py:1.5,bgcolor:"#075E54",color:"#fff"},children:e.jsxs(b,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(I,{sx:{bgcolor:"#25D366"},children:(m=t.fullName)==null?void 0:m.charAt(0)}),e.jsxs(r,{flex:1,children:[e.jsx(a,{fontWeight:600,children:t.fullName}),e.jsx(a,{variant:"caption",sx:{opacity:.8},children:"Vendor Chat"})]}),e.jsx(C,{onClick:n,sx:{color:"#fff"},children:e.jsx(D,{})})]})}),e.jsxs(r,{sx:{height:420,px:2,py:1,overflowY:"auto",bgcolor:"#ECE5DD"},children:[x.map((s,h)=>{const j=s.senderId===i._id;return e.jsx(r,{display:"flex",justifyContent:j?"flex-end":"flex-start",mb:1,children:e.jsxs(r,{sx:{px:2,py:1.2,maxWidth:"75%",borderRadius:2,bgcolor:j?"#DCF8C6":"#fff",boxShadow:"0 1px 1px rgba(0,0,0,0.15)"},children:[e.jsx(a,{variant:"body2",sx:{wordBreak:"break-word"},children:s.text}),e.jsx(a,{variant:"caption",sx:{display:"block",textAlign:"right",opacity:.6,mt:.5,fontSize:"0.7rem"},children:s.time})]})},h)}),e.jsx("div",{ref:u})]}),e.jsx(r,{sx:{p:1.5,bgcolor:"#f7f7f7",borderTop:"1px solid #ddd"},children:e.jsxs(b,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(A,{sx:{color:"#888"}}),e.jsx(_,{fullWidth:!0,size:"small",placeholder:"Type a message",value:c,onChange:s=>d(s.target.value),onKeyDown:s=>s.key==="Enter"&&g(),sx:{bgcolor:"#fff",borderRadius:5}}),e.jsx(C,{onClick:g,sx:{bgcolor:"#25D366",color:"#fff","&:hover":{bgcolor:"#1ebd5a"}},children:e.jsx(k,{})})]})})]})},M=()=>{const f=w(),{state:n}=y(),[t,c]=o.useState(!0),[d,x]=o.useState(null);return o.useEffect(()=>{x(n||{fullName:"John Doe",description:"Need evening makeup service",moduleId:{title:"Makeup Artist"}})},[n]),d?e.jsxs(r,{p:3,children:[e.jsxs(S,{sx:{minHeight:"70vh",bgcolor:"#f5f7fa",p:4,textAlign:"center"},children:[e.jsx(a,{variant:"h5",fontWeight:600,children:"Enquiry Chat"}),e.jsx(a,{color:"text.secondary",children:"Chat with customer"})]}),e.jsx(W,{open:t,enquiry:d,onClose:()=>{c(!1),f("/makeupartist/Enqury")}})]}):null};export{M as default};
