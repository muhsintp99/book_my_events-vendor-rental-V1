import{c as se,j as e,r as p,a8 as oe,a as ne,bp as le,bq as ce,br as de,B as o,T as l,p as w,bs as pe,S as P,am as u,t as A,b as O,v as he,G as x,x as U,f as H,d as N,ae as ge,h as _,ak as xe}from"./index-CudumdJl.js";import{C as q}from"./Close-9hHxCm7b.js";import{A as V,a as me,R as ue}from"./RotateLeft-B7ZNwszU.js";const fe=se(e.jsx("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2m0 15-5-2.18L7 18V5h10z"})),W={},be=ce({palette:{primary:{main:"#E15B65",dark:"#C2444E",light:"#F09898",contrastText:"#fff"},secondary:{main:"#D4A017"},background:{default:"#FDF6EE",paper:"#fff"},text:{primary:"#1A0A00",secondary:"#7A5C4A"}},typography:{fontFamily:"'DM Sans', sans-serif",h4:{fontFamily:"'Playfair Display', serif"}},shape:{borderRadius:14},components:{MuiCssBaseline:{styleOverrides:"@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,500&family=DM+Sans:wght@300;400;500;600&display=swap');"},MuiOutlinedInput:{styleOverrides:{root:{borderRadius:12,backgroundColor:"#FFFBF7",fontFamily:"'DM Sans', sans-serif",fontSize:"14.5px","& fieldset":{borderColor:"rgba(225, 91, 101,0.2)"},"&:hover fieldset":{borderColor:"rgba(225, 91, 101,0.5) !important"},"&.Mui-focused fieldset":{borderColor:"#E15B65 !important",borderWidth:"2px"}},input:{padding:"15px 16px"}}},MuiInputLabel:{styleOverrides:{root:{fontFamily:"'DM Sans', sans-serif",fontSize:"14px",color:"#8B3A0F","&.Mui-focused":{color:"#E15B65"}}}},MuiButton:{styleOverrides:{root:{textTransform:"none",fontFamily:"'DM Sans', sans-serif",fontWeight:600,borderRadius:12}}}}}),f=({children:a})=>e.jsx(l,{sx:{fontSize:"10.5px",fontWeight:700,letterSpacing:"0.13em",textTransform:"uppercase",color:"#E15B65",mb:1.25},children:a}),b={bgcolor:"#fff",border:"1px solid rgba(225, 91, 101, 0.11)",borderRadius:"16px",p:{xs:2.5,sm:3},boxShadow:"0 2px 14px rgba(225, 91, 101, 0.05)"};function Se(){const[a,C]=p.useState({name:"",description:"",price:"",advance:"",category:""}),[F,E]=p.useState(null),[z,y]=p.useState(null),[J,I]=p.useState([]),[T,j]=p.useState([]),[d,B]=p.useState({}),[D,v]=p.useState({open:!1,msg:"",severity:"success"}),[R,M]=p.useState(!1),[$,Y]=p.useState([]),[K,L]=p.useState(!1),{id:S}=oe();ne();const m=!!S,h=(W==null?void 0:W.VITE_API_BASE_URL)||"https://api.bookmyevent.ae";p.useEffect(()=>{if(!S)return;(async()=>{var t;try{const i=localStorage.getItem("token"),g=await(await fetch(`${h}/api/invitation-printing/${S}`,{headers:{Authorization:`Bearer ${i}`}})).json();if(g.success){const s=g.data;C({name:s.packageName||"",description:s.description||"",price:s.packagePrice!=null?String(s.packagePrice):"",advance:s.advanceBookingAmount!=null?String(s.advanceBookingAmount):"",category:((t=s.category)==null?void 0:t._id)||s.category||""}),s.thumbnail&&y(`${h}${s.thumbnail.startsWith("/")?"":"/"}${s.thumbnail}`),s.images&&Array.isArray(s.images)&&j(s.images.map(c=>`${h}${c.startsWith("/")?"":"/"}${c}`))}}catch(i){console.error(i)}})()},[S,h]);const k=(r,t)=>{C(i=>({...i,[r]:t})),d[r]&&B(i=>({...i,[r]:""}))};p.useEffect(()=>{(async()=>{try{L(!0);const t=localStorage.getItem("moduleId");if(!t)return;const n=await(await fetch(`${h}/api/categories/modules/${t}`)).json();n.success&&Y(n.data||[])}catch(t){console.error("Fetch categories error:",t)}finally{L(!1)}})()},[h]);const Q=r=>{if(!(r!=null&&r.type.startsWith("image/")))return;E(r);const t=new FileReader;t.onload=i=>{y(i.target.result),B(n=>({...n,thumbnail:""}))},t.readAsDataURL(r)},X=r=>{const i=Array.from(r).filter(n=>n.type.startsWith("image/"));I(n=>[...n,...i]),i.forEach(n=>{const g=new FileReader;g.onload=s=>j(c=>[...c,s.target.result]),g.readAsDataURL(n)})},Z=r=>{I(t=>t.filter((i,n)=>n!==r)),j(t=>t.filter((i,n)=>n!==r))},ee=()=>{const r={};return a.name.trim()||(r.name="Required"),a.description.trim()||(r.description="Required"),(!a.price||+a.price<=0)&&(r.price="Enter a valid price"),(a.advance===""||+a.advance<0)&&(r.advance="Enter a valid amount"),a.category||(r.category="Please select a category"),!m&&!F&&(r.thumbnail="Please upload a thumbnail"),r},re=async r=>{r.preventDefault();const t=ee();if(Object.keys(t).length){B(t),v({open:!0,msg:"Please fix the highlighted fields.",severity:"error"});return}try{M(!0);const i=localStorage.getItem("moduleId"),g=JSON.parse(localStorage.getItem("user")||"{}")._id,s=localStorage.getItem("token");if(!i||!g)throw new Error("Module or Vendor session missing");const c=new FormData;c.append("secondaryModule",i),c.append("providerId",g),c.append("packageName",a.name),c.append("description",a.description),c.append("packagePrice",a.price),c.append("advanceBookingAmount",a.advance),c.append("category",a.category),F&&c.append("thumbnail",F),J.forEach(ie=>c.append("images",ie));const te=m?`${h}/api/invitation-printing/${S}`:`${h}/api/invitation-printing/create`,G=await fetch(te,{method:m?"PUT":"POST",headers:s?{Authorization:`Bearer ${s}`}:void 0,body:c}),ae=await G.json();if(!G.ok)throw new Error(ae.message||"Something went wrong");v({open:!0,msg:"Invitation package published! ðŸŽ‰",severity:"success"}),m||(C({name:"",description:"",price:"",advance:"",category:""}),E(null),y(null),I([]),j([]))}catch(i){v({open:!0,msg:i.message,severity:"error"})}finally{M(!1)}};return e.jsxs(le,{theme:be,children:[e.jsx(de,{}),e.jsxs(o,{sx:{width:"100%",bgcolor:"#FDF6EE",minHeight:"100%",py:{xs:3,sm:4},px:{xs:2,sm:3,md:4}},children:[e.jsxs(o,{sx:{mb:3.5},children:[e.jsxs(l,{variant:"h4",fontWeight:700,sx:{fontSize:{xs:"1.65rem",sm:"2rem"},lineHeight:1.2},children:["Add"," ",e.jsx(o,{component:"em",sx:{color:"primary.main",fontStyle:"italic"},children:"Invitation"})," ","Package"]}),e.jsx(l,{variant:"body2",color:"text.secondary",mt:.75,fontSize:"13.5px",children:"Design and showcase your printing & invitation masterpieces."})]}),e.jsxs(o,{sx:{bgcolor:"#1A0A00",px:3.5,py:2.25,borderRadius:"16px 16px 0 0",display:"flex",alignItems:"center",gap:2},children:[e.jsx(w,{sx:{bgcolor:"rgba(225, 91, 101, 0.3)",borderRadius:"10px",width:38,height:38,fontSize:"15px"},children:"âœ¦"}),e.jsxs(o,{children:[e.jsx(l,{sx:{color:"#F7EDE0",fontFamily:"'Playfair Display', serif",fontSize:"1.05rem"},children:"Package Details"}),e.jsx(l,{sx:{color:"rgba(255,255,255,0.3)",fontSize:"11.5px"},children:"All * fields are required"})]})]}),R&&e.jsx(pe,{color:"primary"}),e.jsx(o,{component:"form",onSubmit:re,noValidate:!0,sx:{border:"1px solid rgba(225, 91, 101, 0.11)",borderTop:"none",borderRadius:"0 0 16px 16px",bgcolor:"#FDF6EE",p:3,boxShadow:"0 4px 24px rgba(225, 91, 101, 0.06)"},children:e.jsxs(P,{spacing:2.5,children:[e.jsxs(u,{elevation:0,sx:b,children:[e.jsx(f,{children:"Package Name"}),e.jsx(A,{label:"Package Name *",placeholder:"e.g. Premium Laser-Cut Wedding Invite",fullWidth:!0,value:a.name,onChange:r=>k("name",r.target.value),error:!!d.name,helperText:d.name})]}),e.jsxs(u,{elevation:0,sx:b,children:[e.jsx(f,{children:"Description"}),e.jsx(A,{label:"Description *",placeholder:"Paper quality, print type, card dimensions, inclusions...",fullWidth:!0,multiline:!0,rows:4,value:a.description,onChange:r=>k("description",r.target.value),error:!!d.description,helperText:d.description})]}),e.jsxs(u,{elevation:0,sx:b,children:[e.jsx(f,{children:"Pricing"}),e.jsxs(P,{direction:{xs:"column",sm:"row"},spacing:2.5,children:[e.jsx(A,{label:"Base Price *",placeholder:"0",fullWidth:!0,type:"number",value:a.price,onChange:r=>k("price",r.target.value),error:!!d.price,helperText:d.price,InputProps:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(l,{color:"primary.main",fontWeight:700,children:"â‚¹"})})}}),e.jsx(A,{label:"Advance Amount *",placeholder:"0",fullWidth:!0,type:"number",value:a.advance,onChange:r=>k("advance",r.target.value),error:!!d.advance,helperText:d.advance,InputProps:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(l,{color:"secondary.main",fontWeight:700,children:"â‚¹"})})}})]})]}),e.jsxs(u,{elevation:0,sx:{...b,bgcolor:"#fff"},children:[e.jsx(f,{children:"Select Category"}),e.jsx(l,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:"Choose the type of invitation service you provide."}),K?e.jsx(o,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(he,{size:24})}):$.length>0?e.jsx(x,{container:!0,spacing:2,children:$.map(r=>e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(o,{onClick:()=>k("category",r._id),sx:{cursor:"pointer",p:2,borderRadius:"12px",border:"1px solid",borderColor:a.category===r._id?"#E15B65":"rgba(0,0,0,0.06)",bgcolor:a.category===r._id?"rgba(225, 91, 101, 0.04)":"#fff",display:"flex",alignItems:"center",gap:2,transition:"all 0.2s ease","&:hover":{borderColor:"#E15B65",transform:"translateY(-2px)",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"}},children:[e.jsx(w,{src:r.image?r.image.startsWith("http")?r.image:`${h}${r.image}`:"",sx:{width:40,height:40,borderRadius:"8px",bgcolor:"rgba(225, 91, 101, 0.1)",color:"#E15B65"},children:!r.image&&e.jsx(fe,{fontSize:"small"})}),e.jsxs(o,{sx:{flexGrow:1},children:[e.jsx(l,{variant:"subtitle2",sx:{fontWeight:600,color:a.category===r._id?"#E15B65":"inherit"},children:r.title}),r.description&&e.jsx(l,{variant:"caption",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden"},children:r.description})]}),a.category===r._id&&e.jsx(w,{sx:{width:20,height:20,bgcolor:"#E15B65",color:"#fff"},children:e.jsx(o,{component:"span",sx:{fontSize:"12px"},children:"âœ“"})})]})},r._id))}):e.jsx(U,{severity:"info",sx:{borderRadius:"12px"},children:"No categories found for this module. Please contact administrator."}),d.category&&e.jsx(H,{error:!0,sx:{mt:1,ml:1},children:d.category})]}),e.jsxs(x,{container:!0,spacing:3,children:[e.jsx(x,{item:!0,xs:12,md:6,children:e.jsxs(u,{elevation:0,sx:{...b,height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(f,{children:"Package Thumbnail"}),e.jsx(l,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:"Main image displayed in catalogs and lists."}),e.jsxs(o,{component:"label",htmlFor:"thumb-img",sx:{flexGrow:1,border:"2px dashed",borderColor:d.thumbnail?"#dc2626":"rgba(225, 91, 101, 0.2)",borderRadius:"16px",p:2,textAlign:"center",cursor:"pointer",bgcolor:"#FFFBF7",transition:"all 0.3s ease",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:220,"&:hover":{borderColor:"#E15B65",bgcolor:"rgba(225, 91, 101, 0.04)",transform:"scale(1.01)"}},children:[e.jsx("input",{id:"thumb-img",type:"file",accept:"image/*",hidden:!0,onChange:r=>Q(r.target.files[0])}),z?e.jsxs(o,{sx:{position:"relative",width:"100%",height:"100%",minHeight:180},children:[e.jsx(o,{component:"img",src:z,sx:{width:"100%",height:"100%",maxHeight:220,objectFit:"cover",borderRadius:"10px"}}),e.jsx(N,{size:"small",sx:{position:"absolute",top:8,right:8,bgcolor:"rgba(255,255,255,0.9)","&:hover":{bgcolor:"#fff"}},onClick:r=>{r.preventDefault(),y(null),E(null)},children:e.jsx(q,{fontSize:"small"})})]}):e.jsxs(P,{alignItems:"center",spacing:1.5,children:[e.jsx(w,{sx:{bgcolor:"rgba(225, 91, 101, 0.1)",color:"#E15B65",width:56,height:56},children:e.jsx(ge,{})}),e.jsxs(o,{children:[e.jsx(l,{variant:"subtitle2",fontWeight:700,children:"Click to upload thumbnail"}),e.jsx(l,{variant:"caption",color:"text.secondary",children:"PNG, JPG or JPEG (Max 5MB)"})]})]})]}),d.thumbnail&&e.jsx(H,{error:!0,sx:{mt:1,ml:1},children:d.thumbnail})]})}),e.jsx(x,{item:!0,xs:12,md:6,children:e.jsxs(u,{elevation:0,sx:{...b,height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(f,{children:"Gallery"}),e.jsx(l,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:"Additional photos showcasing details and variations."}),e.jsxs(o,{component:"label",htmlFor:"gallery-imgs",sx:{flexGrow:1,border:"2px dashed rgba(225, 91, 101, 0.2)",borderRadius:"16px",p:2,textAlign:"center",cursor:"pointer",bgcolor:"#FFFBF7",transition:"all 0.3s ease",display:"flex",flexDirection:"column",minHeight:220,"&:hover":{borderColor:"#E15B65",bgcolor:"rgba(225, 91, 101, 0.04)"}},children:[e.jsx("input",{id:"gallery-imgs",type:"file",accept:"image/*",multiple:!0,hidden:!0,onChange:r=>X(r.target.files)}),T.length>0?e.jsxs(x,{container:!0,spacing:1.5,children:[T.map((r,t)=>e.jsx(x,{item:!0,xs:4,children:e.jsxs(o,{sx:{position:"relative",pt:"100%"},children:[e.jsx(o,{component:"img",src:r,sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",borderRadius:"8px",border:"1px solid rgba(0,0,0,0.05)"}}),e.jsx(N,{size:"small",sx:{position:"absolute",top:4,right:4,bgcolor:"rgba(255,255,255,0.8)",p:.3,"&:hover":{bgcolor:"#fff"}},onClick:i=>{i.preventDefault(),Z(t)},children:e.jsx(q,{sx:{fontSize:14}})})]})},t)),e.jsx(x,{item:!0,xs:4,children:e.jsx(o,{sx:{pt:"100%",position:"relative",border:"2px dashed rgba(225, 91, 101, 0.15)",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center","&:hover":{bgcolor:"rgba(225, 91, 101, 0.05)"}},children:e.jsx(V,{color:"primary",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",opacity:.6}})})})]}):e.jsxs(P,{alignItems:"center",spacing:1.5,sx:{my:"auto"},children:[e.jsx(w,{sx:{bgcolor:"rgba(212, 160, 23, 0.1)",color:"#D4A017",width:56,height:56},children:e.jsx(V,{})}),e.jsxs(o,{children:[e.jsx(l,{variant:"subtitle2",fontWeight:700,children:"Add Gallery Images"}),e.jsx(l,{variant:"caption",color:"text.secondary",children:"Upload up to 10 gallery photos"})]})]})]})]})})]}),e.jsxs(P,{direction:"row",spacing:2,pt:2,children:[e.jsx(_,{type:"submit",variant:"contained",size:"large",fullWidth:!0,startIcon:e.jsx(me,{}),disabled:R,sx:{py:1.5,background:"linear-gradient(135deg, #E15B65 0%, #C2444E 100%)"},children:R?"Processing...":m?"Update Package":"Publish Invitation"}),!m&&e.jsx(_,{variant:"outlined",size:"large",fullWidth:!0,startIcon:e.jsx(ue,{}),onClick:()=>{C({name:"",description:"",price:"",advance:"",category:""}),y(null),j([])},children:"Reset"})]})]})})]}),e.jsx(xe,{open:D.open,autoHideDuration:3500,onClose:()=>v(r=>({...r,open:!1})),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(U,{severity:D.severity,variant:"filled",onClose:()=>v(r=>({...r,open:!1})),sx:{borderRadius:"12px"},children:D.msg})})]})}export{Se as default};
