import{r as p,j as e,B as y,s as z,v as I,T as n,a7 as F,S as B,q as G,f as C,ag as A,g as N}from"./index-BJj5dOw1.js";import{T as R}from"./TableContainer-Y1CAEngc.js";import{T as H,a as J,b as T,c as s,d as U}from"./TableRow-B1k_Ntd2.js";const V=()=>{try{const u=localStorage.getItem("user");if(!u)return null;const m=JSON.parse(u);return(m==null?void 0:m._id)||null}catch{return null}},X=()=>{const[u,m]=p.useState([]),[h,P]=p.useState(""),[E,w]=p.useState(!0),[D,S]=p.useState(null),[g,W]=p.useState(null),k=V();p.useEffect(()=>{if(!k){S("No provider ID found. Please log in."),w(!1);return}(async()=>{var r,d,l;try{w(!0);const t=((r=(await N.get(`https://api.bookmyevent.ae/api/bookings/provider/${k}`)).data)==null?void 0:r.data)||[];console.log("=== MAKEUP CONFIRMED BOOKINGS DEBUG ==="),console.log("Total bookings fetched:",t.length),console.log("Provider ID:",k),t.length>0&&console.log("Sample booking:",t[0]);const j={},v={};t.forEach(c=>{const i=String(c.status||"undefined").toLowerCase(),x=String(c.moduleType||"undefined").toLowerCase();j[i]=(j[i]||0)+1,v[x]=(v[x]||0)+1}),console.log("Bookings by status:",j),console.log("Bookings by module:",v);const b=t.filter(c=>{const i=String(c.status||"").trim().toLowerCase(),x=String(c.moduleType||"").trim().toLowerCase(),L=i==="accepted"||i==="confirmed"||i==="approve"||i==="approved",M=x==="makeup"||x==="makeup artist"||x==="makeupartist";return console.log(`Booking ${c._id}: status=${i}, module=${x}, isAccepted=${L}, isMakeup=${M}`),L&&M});console.log("✅ Filtered confirmed makeup bookings:",b.length),console.log("Confirmed bookings:",b),W({total:t.length,accepted:t.filter(c=>{const i=String(c.status||"").toLowerCase();return i==="accepted"||i==="confirmed"||i==="approved"}).length,makeup:t.filter(c=>{const i=String(c.moduleType||"").toLowerCase();return i==="makeup"||i==="makeup artist"||i==="makeupartist"}).length,confirmedMakeup:b.length,statusCounts:j,moduleCounts:v}),m(b),S(null)}catch(a){console.error("❌ Error loading confirmed bookings:",a),S(((l=(d=a.response)==null?void 0:d.data)==null?void 0:l.message)||"Failed to load bookings")}finally{w(!1)}})()},[k]);const f=p.useMemo(()=>{if(!h.trim())return u;const o=h.toLowerCase();return u.filter(r=>{var d,l,a,t;return((d=r._id)==null?void 0:d.toLowerCase().includes(o))||((l=r.fullName)==null?void 0:l.toLowerCase().includes(o))||((a=r.emailAddress)==null?void 0:a.toLowerCase().includes(o))||((t=r.contactNumber)==null?void 0:t.includes(h))})},[h,u]),_=async(o,r)=>{var l,a;if(r.stopPropagation(),!!window.confirm("Are you sure you want to delete this booking? This action cannot be undone."))try{await N.delete(`https://api.bookmyevent.ae/api/bookings/${o}`),m(t=>t.filter(j=>j._id!==o)),alert("✅ Booking Deleted Successfully!")}catch(t){console.error("❌ Delete error:",t),alert(((a=(l=t.response)==null?void 0:l.data)==null?void 0:a.message)||"Failed to delete booking")}},O=(o,r)=>{r.stopPropagation(),console.log("View booking:",o)},$=(o,r)=>{r.stopPropagation(),console.log("Download invoice for:",o._id)};return E?e.jsx(y,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:e.jsx(z,{})}):D?e.jsx(y,{p:2,children:e.jsx(I,{severity:"error",children:D})}):e.jsxs(y,{p:2,children:[e.jsx(n,{variant:"h4",gutterBottom:!0,fontWeight:600,children:"Confirmed Makeup Bookings"}),g&&e.jsxs(I,{severity:"info",sx:{mb:2},children:[e.jsxs(n,{variant:"body2",children:[e.jsx("strong",{children:"Debug Info:"})," Total Bookings: ",g.total," | Accepted/Confirmed: ",g.accepted," | Makeup Module:"," ",g.makeup," |",e.jsxs("strong",{children:[" Confirmed Makeup: ",g.confirmedMakeup]})]}),e.jsxs(n,{variant:"caption",display:"block",sx:{mt:1},children:["Status breakdown: ",JSON.stringify(g.statusCounts)]}),e.jsxs(n,{variant:"caption",display:"block",children:["Module breakdown: ",JSON.stringify(g.moduleCounts)]})]}),e.jsxs(F,{sx:{mt:2},children:[e.jsxs(B,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"space-between",alignItems:"center",p:2,children:[e.jsx(G,{label:"Search by Booking ID, Name, Email, or Phone",value:h,onChange:o=>P(o.target.value),size:"small",sx:{minWidth:350},placeholder:"Type to search..."}),e.jsx(C,{variant:"contained",color:"primary",children:"Export Data"})]}),e.jsx(R,{children:e.jsxs(H,{stickyHeader:!0,children:[e.jsx(J,{children:e.jsxs(T,{children:[e.jsx(s,{children:e.jsx("strong",{children:"S#"})}),e.jsx(s,{children:e.jsx("strong",{children:"Booking ID"})}),e.jsx(s,{children:e.jsx("strong",{children:"Module"})}),e.jsx(s,{children:e.jsx("strong",{children:"Customer"})}),e.jsx(s,{children:e.jsx("strong",{children:"Email"})}),e.jsx(s,{children:e.jsx("strong",{children:"Guests"})}),e.jsx(s,{children:e.jsx("strong",{children:"Booking Date"})}),e.jsx(s,{children:e.jsx("strong",{children:"Amount"})}),e.jsx(s,{children:e.jsx("strong",{children:"Payment Status"})}),e.jsx(s,{children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(U,{children:f.length>0?f.map((o,r)=>{var d,l,a;return e.jsxs(T,{hover:!0,sx:{"&:hover":{bgcolor:"#f5f5f5"}},children:[e.jsx(s,{children:r+1}),e.jsx(s,{children:e.jsxs(n,{variant:"body2",fontWeight:600,color:"primary",children:["#",((d=o._id)==null?void 0:d.slice(-8).toUpperCase())||"N/A"]})}),e.jsx(s,{children:e.jsx(A,{label:o.moduleType||"Makeup",size:"small",sx:{bgcolor:"#fef3c7",color:"#92400e",fontWeight:600}})}),e.jsxs(s,{children:[e.jsx(n,{variant:"body2",children:o.fullName||"-"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:o.contactNumber||"-"})]}),e.jsx(s,{children:e.jsx(n,{variant:"body2",sx:{wordBreak:"break-word"},children:o.emailAddress||"-"})}),e.jsx(s,{children:e.jsx(n,{variant:"body2",children:o.numberOfGuests||o.guests||"-"})}),e.jsxs(s,{children:[e.jsx(n,{variant:"body2",children:o.bookingDate?new Date(o.bookingDate).toLocaleDateString("en-GB"):"-"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:o.timeSlot||""})]}),e.jsx(s,{children:e.jsxs(n,{variant:"body2",fontWeight:700,color:"success.main",children:["₹",((l=o.finalPrice)==null?void 0:l.toLocaleString())||((a=o.totalAmount)==null?void 0:a.toLocaleString())||0]})}),e.jsx(s,{children:e.jsx(A,{label:o.status||"Accepted",size:"small",sx:{bgcolor:"#dcfce7",color:"#16a34a",fontWeight:600}})}),e.jsx(s,{children:e.jsxs(B,{direction:"row",spacing:1,children:[e.jsx(C,{variant:"outlined",size:"small",color:"primary",onClick:t=>O(o,t),children:"View"}),e.jsx(C,{variant:"outlined",size:"small",color:"info",onClick:t=>$(o,t),children:"Download"}),e.jsx(C,{variant:"outlined",size:"small",color:"error",onClick:t=>_(o._id,t),children:"Delete"})]})})]},o._id)}):e.jsx(T,{children:e.jsx(s,{colSpan:10,align:"center",children:e.jsxs(y,{py:4,children:[e.jsx(n,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:h?"No matching bookings found":"No Confirmed Makeup Bookings"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:h?"Try adjusting your search criteria":"Confirmed makeup bookings will appear here"})]})})})})]})}),f.length>0&&e.jsxs(y,{p:2,bgcolor:"#f9fafb",borderTop:"1px solid #e5e7eb",display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(B,{direction:"row",spacing:4,children:[e.jsxs(n,{variant:"body2",fontWeight:600,children:["Total Bookings: ",e.jsx("strong",{children:f.length})]}),e.jsxs(n,{variant:"body2",fontWeight:600,color:"success.main",children:["Total Revenue:"," ",e.jsxs("strong",{children:["₹",f.reduce((o,r)=>o+(r.finalPrice||r.totalAmount||0),0).toLocaleString()]})]})]}),e.jsxs(n,{variant:"caption",color:"text.secondary",children:["Showing ",f.length," of ",u.length," bookings"]})]})]})]})};export{X as default};
