import{r as u,j as e,B as j,t as I,x as E,T as i,a8 as O,S as b,s as W,g as f,a4 as A,h as S}from"./index-1IPimUki.js";import{T as _}from"./TableContainer-CGHXGt47.js";import{T as z,a as w,b as n,c as F}from"./TableRow-BO5nN1rQ.js";import{T as G}from"./TableHead-D2RHFueV.js";const H=()=>{try{const t=localStorage.getItem("user");if(!t)return null;const l=JSON.parse(t);return(l==null?void 0:l._id)||null}catch{return null}},R=t=>t?typeof t=="string"?t:Array.isArray(t)?t.map(l=>typeof l=="object"?l.label||l.time:l).join(", "):typeof t=="object"&&(t.label||t.time)||"N/A":"N/A",K=()=>{const[t,l]=u.useState([]),[h,D]=u.useState(""),[k,g]=u.useState(!0),[C,p]=u.useState(null),y=H();u.useEffect(()=>{if(!y){p("No provider ID found. Please log in."),g(!1);return}(async()=>{var s,d,c;try{g(!0);const v=(((s=(await S.get(`https://api.bookmyevent.ae/api/bookings/provider/${y}`)).data)==null?void 0:s.data)||[]).filter(T=>{const m=String(T.status||"").trim().toLowerCase(),B=String(T.moduleType||"").trim().toLowerCase();return(m==="accepted"||m==="confirmed"||m==="approve"||m==="approved")&&(B==="ornament"||B==="ornaments")});l(v),p(null)}catch(a){console.error("❌ Error loading confirmed bookings:",a),p(((c=(d=a.response)==null?void 0:d.data)==null?void 0:c.message)||"Failed to load bookings")}finally{g(!1)}})()},[y]);const x=u.useMemo(()=>{if(!h.trim())return t;const r=h.toLowerCase();return t.filter(s=>{var d,c,a,o;return((d=s._id)==null?void 0:d.toLowerCase().includes(r))||((c=s.fullName)==null?void 0:c.toLowerCase().includes(r))||((a=s.emailAddress)==null?void 0:a.toLowerCase().includes(r))||((o=s.contactNumber)==null?void 0:o.includes(h))})},[h,t]),N=async(r,s)=>{var c,a;if(s.stopPropagation(),!!window.confirm("Are you sure you want to delete this booking? This action cannot be undone."))try{await S.delete(`https://api.bookmyevent.ae/api/bookings/${r}`),l(o=>o.filter(v=>v._id!==r)),alert("✅ Booking Deleted Successfully!")}catch(o){console.error("❌ Delete error:",o),alert(((a=(c=o.response)==null?void 0:c.data)==null?void 0:a.message)||"Failed to delete booking")}},L=(r,s)=>{s.stopPropagation(),console.log("View booking:",r)},P=(r,s)=>{s.stopPropagation(),console.log("Download invoice for:",r._id)};return k?e.jsx(j,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:e.jsx(I,{})}):C?e.jsx(j,{p:2,children:e.jsx(E,{severity:"error",children:C})}):e.jsxs(j,{p:2,children:[e.jsx(i,{variant:"h4",gutterBottom:!0,fontWeight:600,children:"Confirmed Ornaments Bookings"}),e.jsxs(O,{sx:{mt:2},children:[e.jsxs(b,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"space-between",alignItems:"center",p:2,children:[e.jsx(W,{label:"Search by Booking ID, Name, Email, or Phone",value:h,onChange:r=>D(r.target.value),size:"small",sx:{minWidth:350},placeholder:"Type to search..."}),e.jsx(f,{variant:"contained",color:"primary",children:"Export Data"})]}),e.jsx(_,{children:e.jsxs(z,{stickyHeader:!0,children:[e.jsx(G,{children:e.jsxs(w,{children:[e.jsx(n,{children:e.jsx("strong",{children:"S#"})}),e.jsx(n,{children:e.jsx("strong",{children:"Booking ID"})}),e.jsx(n,{children:e.jsx("strong",{children:"Module"})}),e.jsx(n,{children:e.jsx("strong",{children:"Customer"})}),e.jsx(n,{children:e.jsx("strong",{children:"Email"})}),e.jsx(n,{children:e.jsx("strong",{children:"Guests"})}),e.jsx(n,{children:e.jsx("strong",{children:"Booking Date"})}),e.jsx(n,{children:e.jsx("strong",{children:"Amount"})}),e.jsx(n,{children:e.jsx("strong",{children:"Payment Status"})}),e.jsx(n,{children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(F,{children:x.length>0?x.map((r,s)=>{var d,c,a;return e.jsxs(w,{hover:!0,sx:{"&:hover":{bgcolor:"#f5f5f5"}},children:[e.jsx(n,{children:s+1}),e.jsx(n,{children:e.jsxs(i,{variant:"body2",fontWeight:600,color:"primary",children:["#",((d=r._id)==null?void 0:d.slice(-8).toUpperCase())||"N/A"]})}),e.jsx(n,{children:e.jsx(A,{label:r.moduleType||"Ornaments",size:"small",sx:{bgcolor:"#fef3c7",color:"#92400e",fontWeight:600}})}),e.jsxs(n,{children:[e.jsx(i,{variant:"body2",children:r.fullName||"-"}),e.jsx(i,{variant:"caption",color:"text.secondary",children:r.contactNumber||"-"})]}),e.jsx(n,{children:e.jsx(i,{variant:"body2",sx:{wordBreak:"break-word"},children:r.emailAddress||"-"})}),e.jsx(n,{children:e.jsx(i,{variant:"body2",children:r.numberOfGuests||r.guests||"-"})}),e.jsxs(n,{children:[e.jsx(i,{variant:"body2",children:r.bookingDate?new Date(r.bookingDate).toLocaleDateString("en-GB"):"-"}),e.jsx(i,{variant:"caption",color:"text.secondary",children:R(r.timeSlot)})]}),e.jsx(n,{children:e.jsxs(i,{variant:"body2",fontWeight:700,color:"success.main",children:["₹",((c=r.finalPrice)==null?void 0:c.toLocaleString())||((a=r.totalAmount)==null?void 0:a.toLocaleString())||0]})}),e.jsx(n,{children:e.jsx(A,{label:r.status||"Accepted",size:"small",sx:{bgcolor:"#dcfce7",color:"#16a34a",fontWeight:600}})}),e.jsx(n,{children:e.jsxs(b,{direction:"row",spacing:1,children:[e.jsx(f,{variant:"outlined",size:"small",color:"primary",onClick:o=>L(r,o),children:"View"}),e.jsx(f,{variant:"outlined",size:"small",color:"info",onClick:o=>P(r,o),children:"Download"}),e.jsx(f,{variant:"outlined",size:"small",color:"error",onClick:o=>N(r._id,o),children:"Delete"})]})})]},r._id)}):e.jsx(w,{children:e.jsx(n,{colSpan:10,align:"center",children:e.jsxs(j,{py:4,children:[e.jsx(i,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:h?"No matching bookings found":"No Confirmed Ornaments Bookings"}),e.jsx(i,{variant:"body2",color:"text.secondary",children:h?"Try adjusting your search criteria":"Confirmed ornaments bookings will appear here"})]})})})})]})}),x.length>0&&e.jsxs(j,{p:2,bgcolor:"#f9fafb",borderTop:"1px solid #e5e7eb",display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(b,{direction:"row",spacing:4,children:[e.jsxs(i,{variant:"body2",fontWeight:600,children:["Total Bookings: ",e.jsx("strong",{children:x.length})]}),e.jsxs(i,{variant:"body2",fontWeight:600,color:"success.main",children:["Total Revenue:"," ",e.jsxs("strong",{children:["₹",x.reduce((r,s)=>r+(s.finalPrice||s.totalAmount||0),0).toLocaleString()]})]})]}),e.jsxs(i,{variant:"caption",color:"text.secondary",children:["Showing ",x.length," of ",t.length," bookings"]})]})]})]})};export{K as default};
