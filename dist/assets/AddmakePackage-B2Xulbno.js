import{p as De,d as Me,r as s,h as j,j as e,B as c,c as pe,s as k,t as We,T as x,H as ue,k as _,a as u,S as O,F as ge,I as he,o as xe,M as $,x as _e,a1 as Oe,w as S,z as $e,b as me}from"./index-De4GTXyc.js";import{A as Fe}from"./Add-nzu5tRBx.js";import{S as F}from"./Switch-CTDi0Qy7.js";import{C as fe}from"./Close-BqhJje-8.js";import{C as Le}from"./CloudUpload-zl9eIXpj.js";import{D as ze}from"./Delete--UMz92cn.js";const h="#E91E63",m="https://api.bookmyevent.ae",je="68e5fc09651cc12c1fc0f9c9",Ne=({section:p,onChange:b,onDelete:g})=>e.jsxs(c,{sx:{position:"relative",border:"1px solid #e5e5e5",borderRadius:2,p:3,mb:3,bgcolor:"white"},children:[e.jsx(k,{onClick:g,sx:{position:"absolute",top:12,right:12,color:h},children:e.jsx(ze,{fontSize:"small"})}),e.jsx(u,{fullWidth:!0,label:e.jsxs("span",{children:["Section Title ",e.jsx("span",{style:{color:"red"},children:"*"})]}),value:p.title||"",onChange:f=>b("title",f.target.value),sx:{mb:2}}),e.jsx(u,{fullWidth:!0,label:e.jsxs("span",{children:["Items (comma separated) ",e.jsx("span",{style:{color:"red"},children:"*"})]}),placeholder:"e.g. Bridal Bun, Curls, Waves",value:Array.isArray(p.items)?p.items.join(", "):"",onChange:f=>b("items",f.target.value),multiline:!0,rows:2,helperText:"Separate items with commas"})]}),Ke=()=>{const{id:p}=De(),b=Me(),g=!!p,[f,L]=s.useState(!0),[z,N]=s.useState(!1),[R,C]=s.useState(""),[U,d]=s.useState(""),[G,be]=s.useState([]),[ve,ye]=s.useState(!0),[Se,H]=s.useState([]),[ke,Ce]=s.useState(!0),[r,q]=s.useState(null),[P,J]=s.useState(""),[I,K]=s.useState([]),[A,Q]=s.useState(""),[w,V]=s.useState(""),[X,Y]=s.useState(""),[T,Z]=s.useState(""),[ee,te]=s.useState(""),[ae,se]=s.useState(""),[E,ie]=s.useState(!1),[B,le]=s.useState(!1),[D,ne]=s.useState(!0),[re,v]=s.useState([{id:Date.now(),title:"",items:[]}]),[M,oe]=s.useState({hairStyling:!1,sareeDraping:!1,eyelashExtension:!1,nailPolish:!1}),[y,ce]=s.useState([]),[W,de]=s.useState([]);s.useEffect(()=>{try{const t=localStorage.getItem("vendor")||localStorage.getItem("user")||localStorage.getItem("vendorData");if(t)q(JSON.parse(t));else{const a=localStorage.getItem("vendorId")||localStorage.getItem("userId");a&&q({_id:a})}}catch(t){console.error("Vendor load error:",t)}},[]),s.useEffect(()=>{j.get(`${m}/api/categories/modules/${je}`).then(t=>be(t.data.data||[])).catch(()=>d("Failed to load categories")).finally(()=>ye(!1))},[]),s.useEffect(()=>{j.get(`${m}/api/makeup-types`).then(t=>H(t.data.data||[])).catch(()=>H([])).finally(()=>Ce(!1))},[]),s.useEffect(()=>{if(!g){L(!1);return}(async()=>{var a,l;try{const{data:o}=await j.get(`${m}/api/makeup-packages/${p}`),i=o.data;J(i.packageTitle),K(i.categories.map(n=>n._id)),Q(i.makeupType),V(i.basePrice),Y(i.offerPrice),Z(i.description),te(i.cancellationPolicy),se(i.advanceBookingAmount),ie(i.trialMakeupIncluded),le(i.travelToVenue),ne(i.isActive),((a=i.includedServices)==null?void 0:a.length)>0&&v(i.includedServices.map(n=>({id:n._id,title:n.title,items:n.items}))),((l=i.gallery)==null?void 0:l.length)>0&&de(i.gallery.map(n=>`${m}${n}`)),i.basicAddOns&&oe({hairStyling:i.basicAddOns.hairStyling||!1,sareeDraping:i.basicAddOns.sareeDraping||!1,eyelashExtension:i.basicAddOns.eyelashExtension||!1,nailPolish:i.basicAddOns.nailPolish||!1})}catch{d("Failed to load package")}finally{L(!1)}})()},[g,p]);const Pe=()=>{v(t=>[...t,{id:Date.now(),title:"",items:[]}])},Ie=(t,a,l)=>{v(o=>o.map(i=>i.id===t?{...i,[a]:a==="items"?l.split(",").map(n=>n.trim()).filter(Boolean):l}:i))},Ae=t=>{v(a=>a.filter(l=>l.id!==t))},we=t=>{const a=Array.from(t.target.files);if(y.length+W.length+a.length>5){alert("Maximum 5 images allowed");return}ce(o=>[...o,...a])},Te=t=>ce(a=>a.filter((l,o)=>o!==t)),Ee=t=>de(a=>a.filter((l,o)=>o!==t)),Be=async()=>{var o,i;const t=(r==null?void 0:r._id)||(r==null?void 0:r.id);if(!t)return d("Vendor not authenticated");if(!P.trim())return d("Package title required");if(!I.length)return d("Select categories");if(!A)return d("Select makeup type");if(!w)return d("Base price required");if(!T.trim())return d("Description required");const a=new FormData;a.append("module",je),a.append("packageTitle",P),a.append("description",T),a.append("makeupType",A),a.append("basePrice",w),a.append("offerPrice",X||"0"),a.append("advanceBookingAmount",ae),a.append("cancellationPolicy",ee),a.append("isActive",D),a.append("providerId",t),a.append("trialMakeupIncluded",E),a.append("travelToVenue",B),I.forEach(n=>a.append("categories",n)),a.append("basicAddOns",JSON.stringify(M));const l=re.filter(n=>n.title.trim()&&n.items.length>0).map(n=>({title:n.title,items:n.items}));a.append("includedServices",JSON.stringify(l)),y.forEach(n=>a.append("gallery",n));try{N(!0),d(""),C(""),g?(await j.put(`${m}/api/makeup-packages/${p}`,a),C("Package updated successfully!")):(await j.post(`${m}/api/makeup-packages`,a),C("Package created successfully!"))}catch(n){d(((i=(o=n.response)==null?void 0:o.data)==null?void 0:i.message)||"Error saving package")}finally{N(!1)}};return f||ve||ke?e.jsx(c,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:e.jsx(pe,{size:60})}):e.jsxs(c,{sx:{bgcolor:"#f9f9fc",minHeight:"100vh"},children:[e.jsxs(c,{sx:{bgcolor:"white",borderBottom:"1px solid #eee",p:2,px:4,position:"sticky",top:0,zIndex:10},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(k,{onClick:()=>b(-1),children:e.jsx(We,{})}),e.jsxs(x,{variant:"h5",fontWeight:"bold",children:[g?"Edit":"Add"," Makeup Package"]})]}),r&&e.jsxs(x,{variant:"body2",color:"text.secondary",sx:{ml:7},children:["Creating as: ",(r==null?void 0:r.firstName)||(r==null?void 0:r.email)||(r==null?void 0:r._id)]})]}),e.jsxs(c,{sx:{p:{xs:2,md:4}},children:[R&&e.jsx(ue,{severity:"success",sx:{mb:3},children:R}),U&&e.jsx(ue,{severity:"error",sx:{mb:3},children:U}),e.jsxs(_,{elevation:3,sx:{borderRadius:3,p:{xs:3,md:6}},children:[e.jsx(u,{fullWidth:!0,label:"Package Title *",value:P,onChange:t=>J(t.target.value),sx:{mb:3}}),e.jsxs(O,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsxs(ge,{fullWidth:!0,children:[e.jsx(he,{children:"Category *"}),e.jsx(xe,{multiple:!0,value:I,onChange:t=>K(t.target.value),renderValue:t=>e.jsx(c,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(a=>{const l=G.find(o=>o._id===a);return e.jsx(_e,{label:l==null?void 0:l.title,size:"small"},a)})}),children:G.map(t=>e.jsx($,{value:t._id,children:t.title},t._id))})]}),e.jsxs(ge,{fullWidth:!0,children:[e.jsx(he,{children:"Makeup Type *"}),e.jsxs(xe,{value:A,onChange:t=>Q(t.target.value),children:[e.jsx($,{value:"",disabled:!0,children:"Select Type"}),Se.map(t=>e.jsx($,{value:t._id,children:t.name},t._id))]})]})]}),e.jsxs(O,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsx(u,{fullWidth:!0,label:"Base Price *",type:"number",value:w,onChange:t=>V(t.target.value)}),e.jsx(u,{fullWidth:!0,label:"Offer Price",type:"number",value:X,onChange:t=>Y(t.target.value),helperText:"Leave empty if no discount"}),e.jsx(u,{fullWidth:!0,label:"Advance Booking Amount",value:ae,onChange:t=>se(t.target.value)})]}),e.jsx(u,{fullWidth:!0,label:"Description *",multiline:!0,rows:4,value:T,onChange:t=>Z(t.target.value),sx:{mb:4}}),e.jsx(x,{variant:"h6",sx:{mb:2,color:h},children:"Basic Add-ons"}),e.jsx(_,{variant:"outlined",sx:{p:3,mb:4,bgcolor:"#fafafa"},children:e.jsx(Oe,{row:!0,children:Object.keys(M).map(t=>e.jsx(S,{control:e.jsx($e,{checked:M[t],onChange:a=>oe(l=>({...l,[t]:a.target.checked}))}),label:{hairStyling:"Hair Styling",sareeDraping:"Saree Draping",eyelashExtension:"Eyelash Extension",nailPolish:"Nail Polish"}[t]},t))})}),e.jsxs(c,{sx:{mb:4},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(x,{variant:"h6",sx:{color:h},children:"Custom Service Sections"}),e.jsx(me,{variant:"contained",startIcon:e.jsx(Fe,{}),sx:{bgcolor:h},onClick:Pe,children:"Add Section"})]}),re.map(t=>e.jsx(Ne,{section:t,onChange:(a,l)=>Ie(t.id,a,l),onDelete:()=>Ae(t.id)},t.id))]}),e.jsx(u,{fullWidth:!0,label:"Cancellation Policy",multiline:!0,rows:3,value:ee,onChange:t=>te(t.target.value),sx:{mb:4}}),e.jsxs(O,{direction:"row",spacing:4,sx:{mb:4},children:[e.jsx(S,{control:e.jsx(F,{checked:E,onChange:()=>ie(!E)}),label:"Trial Makeup Included"}),e.jsx(S,{control:e.jsx(F,{checked:B,onChange:()=>le(!B)}),label:"Travel to Venue"}),e.jsx(S,{control:e.jsx(F,{checked:D,onChange:()=>ne(!D)}),label:"Package Active"})]}),e.jsx(x,{variant:"h6",sx:{color:h,mb:2},children:"Gallery (Max 5)"}),e.jsxs(_,{onClick:()=>document.getElementById("gallery-input").click(),sx:{border:"2px dashed #ddd",borderRadius:2,p:4,textAlign:"center",cursor:"pointer",mb:4},children:[e.jsx("input",{id:"gallery-input",type:"file",hidden:!0,multiple:!0,accept:"image/*",onChange:we}),y.length>0||W.length>0?e.jsxs(c,{sx:{display:"flex",flexWrap:"wrap",gap:2},children:[W.map((t,a)=>e.jsxs(c,{sx:{position:"relative"},children:[e.jsx("img",{src:t,alt:"",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(k,{onClick:l=>{l.stopPropagation(),Ee(a)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(fe,{fontSize:"small"})})]},`ex-${a}`)),y.map((t,a)=>e.jsxs(c,{sx:{position:"relative"},children:[e.jsx("img",{src:URL.createObjectURL(t),alt:"",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(k,{onClick:l=>{l.stopPropagation(),Te(a)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(fe,{fontSize:"small"})})]},`new-${a}`))]}):e.jsxs(e.Fragment,{children:[e.jsx(Le,{sx:{fontSize:60,color:"#ccc"}}),e.jsx(x,{sx:{mt:2,color:h,fontWeight:"bold"},children:"Click to Upload Images"})]})]}),e.jsx(me,{fullWidth:!0,variant:"contained",size:"large",onClick:Be,disabled:z||!r,sx:{py:2,bgcolor:h,"&:hover":{bgcolor:"#c2185b"}},children:z?e.jsx(pe,{size:28,color:"inherit"}):g?"Update Package":"Create Package"})]})]})]})};export{Ke as default};
