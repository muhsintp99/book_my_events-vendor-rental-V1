import{r as s,w as he,h as f,j as e,B as u,T as i,p as M,M as Z,s as ue,F as G,I as V,ac as J,W as m,am as xe,g as c,t as pe,ap as ge,x as fe,a9 as me,aa as je,ab as be,ad as ye}from"./index-1IPimUki.js";import{T as ve,a as F,b as o,c as Be}from"./TableRow-BO5nN1rQ.js";import{T as Ce}from"./TableHead-D2RHFueV.js";import{D as Se}from"./DialogContentText--MeNBLeb.js";const y="https://api.bookmyevent.ae/api/banners",Te="https://api.bookmyevent.ae/api/zones",ke="https://api.bookmyevent.ae/uploads/banners",Ie=xe(u)(({theme:j})=>({border:"2px dashed #e0e0e0",borderRadius:8,height:180,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",cursor:"pointer",backgroundColor:"#fafafa","&:hover":{backgroundColor:"#f0f0f0"}})),Ae=()=>{const[j,v]=s.useState(""),[B,C]=s.useState(""),[A,H]=s.useState([]),[S,_]=s.useState(null),[$,T]=s.useState(null),[k,P]=s.useState([]),[q,I]=s.useState(!1),[x,R]=s.useState(null),[w,D]=s.useState(""),[K,E]=s.useState(!1),[Q,X]=s.useState(""),[Y,ee]=s.useState("success"),[ne,b]=s.useState(!1),[re,L]=s.useState(null),[N,p]=s.useState(!0),te=he(),g=(()=>{try{const n=localStorage.getItem("user");if(n){const r=JSON.parse(n);return r._id||r.id||null}return null}catch(n){return console.error("Error parsing user from localStorage:",n),null}})();s.useEffect(()=>{z(),se()},[]);const t=(n,r="success")=>{X(n),ee(r),E(!0)},O=n=>!n||n.startsWith("http")?n:`${ke}${n.replace("/var/www/backend/Uploads/banners","")}`,se=async()=>{var n;try{const r=localStorage.getItem("token"),l=((n=(await f.get(Te,{headers:{Authorization:`Bearer ${r}`}})).data)==null?void 0:n.data)||[];H(l)}catch(r){console.error("Error fetching zones:",r),t("Failed to load zones","error")}},z=async()=>{var n,r,a;try{I(!0);const l=localStorage.getItem("token");if(!g){console.error("Vendor ID not available for fetching banners"),t("Vendor ID not found. Please log in again.","error"),I(!1);return}console.log("Fetching banners for vendorId:",g);const de=(((r=(n=(await f.get(`${y}/vendor/${g}`,{headers:{Authorization:`Bearer ${l}`}})).data)==null?void 0:n.data)==null?void 0:r.banners)||[]).map(U=>({...U,image:O(U.image)}));P(de)}catch(l){((a=l.response)==null?void 0:a.status)===404?(t("No banners found for this vendor","info"),P([])):t("Failed to load banners","error")}finally{I(!1)}},ae=n=>{const r=n.target.files[0];if(r){if(!["image/jpeg","image/png","image/jpg"].includes(r.type))return t("Only JPG, JPEG, PNG files allowed","error");if(r.size>2*1024*1024)return t("File size must be less than 2MB","error");_(r),T(URL.createObjectURL(r))}},oe=async n=>{var r,a,l;if(n.preventDefault(),!j.trim())return t("Title is required","error");if(!B)return t("Please select a zone","error");if(!w)return t("Please select a banner type","error");if(!S&&!x)return t("Banner image is required","error");if(!g)return t("Vendor ID not found. Please log in again.","error");try{const h=localStorage.getItem("token"),d=new FormData;d.append("title",j),d.append("zone",B),d.append("bannerType",w),d.append("vendor",g),S&&d.append("image",S),x?(await f.put(`${y}/${x}`,d,{headers:{Authorization:`Bearer ${h}`,"Content-Type":"multipart/form-data"}}),t("Banner updated successfully!")):(await f.post(y,d,{headers:{Authorization:`Bearer ${h}`,"Content-Type":"multipart/form-data"}}),t("Banner added successfully!")),W(),p(!1),setTimeout(()=>{z()},1e3)}catch(h){console.error("Banner submit error:",h),console.error("Response:",(r=h.response)==null?void 0:r.data),t(((l=(a=h.response)==null?void 0:a.data)==null?void 0:l.message)||"Operation failed","error")}},le=async()=>{try{const n=localStorage.getItem("token");await f.delete(`${y}/${re}`,{headers:{Authorization:`Bearer ${n}`}}),t("Banner deleted successfully!"),z()}catch(n){console.error("Delete failed:",n),t("Failed to delete banner","error")}finally{b(!1),L(null)}},ie=n=>{L(n),b(!0)},ce=n=>{var a;const r=O(n.image);R(n._id),v(n.title),T(r),C(((a=n.zone)==null?void 0:a._id)||n.zone||""),D(n.bannerType||""),p(!0)},W=()=>{v(""),C(""),_(null),T(null),R(null),D(""),p(!0)};return e.jsxs(u,{sx:{p:3,backgroundColor:"#fff",minHeight:"100vh"},children:[N?e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"h5",sx:{mb:3},children:x?"Edit Banner":"Add New Banner"}),e.jsx(M,{sx:{p:2,mb:4,border:"1px solid #e0e0e0"},children:e.jsxs(Z,{children:[e.jsx(ue,{fullWidth:!0,label:"venue Banner Title",value:j,onChange:n=>v(n.target.value),sx:{mb:2}}),e.jsxs(G,{fullWidth:!0,sx:{mb:2},children:[e.jsx(V,{children:"Select Zone"}),e.jsx(J,{value:B,label:"Select Zone",onChange:n=>C(n.target.value),children:A.length>0?A.map(n=>e.jsx(m,{value:n._id||n.id,children:n.zoneName||n.name},n._id||n.id)):e.jsx(m,{disabled:!0,children:"No zones available"})})]}),e.jsxs(G,{fullWidth:!0,sx:{mb:2},children:[e.jsx(V,{children:"Banner Type"}),e.jsxs(J,{value:w,label:"Banner Type",onChange:n=>D(n.target.value),children:[e.jsx(m,{value:"top_deal",children:"Top Deal"}),e.jsx(m,{value:"cash_back",children:"Cash Back"}),e.jsx(m,{value:"zone_wise",children:"Zone Wise"})]})]}),e.jsx(i,{variant:"subtitle1",sx:{mb:1},children:"Banner Image"}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"JPG, JPEG, PNG Less Than 2MB (Ratio 3:1)"}),e.jsxs(Ie,{onClick:()=>document.getElementById("banner-upload").click(),sx:{borderColor:"#E15B65"},children:[$?e.jsx("img",{src:$,alt:"Preview",style:{maxHeight:160,borderRadius:8}}):e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"body2",color:"#E15B65",children:"Click to upload"}),e.jsx(i,{variant:"caption",color:"#E15B65",children:"Or drag and drop"})]}),e.jsx("input",{id:"banner-upload",type:"file",accept:"image/jpeg,image/png",style:{display:"none"},onChange:ae})]})]})}),e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsx(c,{variant:"outlined",onClick:()=>p(!1),sx:{color:"#E15B65",borderColor:"#E15B65"},children:"View Banners List"}),e.jsxs(u,{sx:{display:"flex",gap:2},children:[e.jsx(c,{variant:"outlined",color:"#E15B65",onClick:W,sx:{color:"#E15B65"},children:"Cancel"}),e.jsx(c,{variant:"contained",color:"#E15B65",onClick:oe,sx:{color:"white",bgcolor:"#E15B65"},children:x?"Update":"Submit"})]})]})]}):e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(c,{variant:"outlined",onClick:()=>te(-1),sx:{color:"#E15B65",borderColor:"#E15B65"},children:"Back"}),e.jsx(i,{variant:"h5",children:"Banner Management"}),e.jsx(c,{variant:"contained",onClick:()=>p(!0),sx:{color:"white",bgcolor:"#E15B65"},children:"Add New Banner"})]}),!N&&e.jsxs(e.Fragment,{children:[e.jsxs(i,{variant:"h6",sx:{mb:2},children:["Banner List"," ",e.jsx("span",{style:{background:"#e0e0e0",padding:"2px 8px",borderRadius:12},children:k.length})]}),q?e.jsx(u,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(pe,{})}):e.jsx(M,{sx:{border:"1px solid #e0e0e0"},children:e.jsx(Z,{children:e.jsxs(ve,{children:[e.jsx(Ce,{children:e.jsxs(F,{children:[e.jsx(o,{sx:{fontWeight:"bold"},children:"SL"}),e.jsx(o,{sx:{fontWeight:"bold"},children:"Banner Info"}),e.jsx(o,{sx:{fontWeight:"bold"},children:"Zone"}),e.jsx(o,{sx:{fontWeight:"bold"},children:"Type"}),e.jsx(o,{sx:{fontWeight:"bold"},children:"Action"})]})}),e.jsx(Be,{children:k.length>0?k.map((n,r)=>{var a;return e.jsxs(F,{children:[e.jsx(o,{children:r+1}),e.jsx(o,{children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx("img",{src:n.image,alt:n.title,style:{width:80,height:40,borderRadius:6,objectFit:"cover",border:"1px solid #ddd"},onError:l=>{console.error(`Failed to load image: ${n.image}`),l.target.src="/placeholder-image.jpg"}}),e.jsx(i,{children:n.title})]})}),e.jsx(o,{children:((a=n.zone)==null?void 0:a.name)||"-"}),e.jsx(o,{children:n.bannerType||"-"}),e.jsxs(o,{children:[e.jsx(c,{size:"small",variant:"outlined",color:"green",onClick:()=>ce(n),sx:{mr:1,color:"green",borderColor:"green"},children:"Edit"}),e.jsx(c,{size:"small",color:"error",variant:"outlined",onClick:()=>ie(n._id),children:"Delete"})]})]},n._id)}):e.jsx(F,{children:e.jsx(o,{colSpan:6,align:"center",children:e.jsx(i,{color:"text.secondary",children:"No Data Found"})})})})]})})})]}),e.jsx(ge,{open:K,autoHideDuration:4e3,onClose:()=>E(!1),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(fe,{onClose:()=>E(!1),severity:Y,sx:{width:"100%"},children:Q})}),e.jsxs(me,{open:ne,onClose:()=>b(!1),children:[e.jsx(je,{children:"Confirm Delete"}),e.jsx(be,{children:e.jsx(Se,{children:"Are you sure you want to delete this banner? This action cannot be undone."})}),e.jsxs(ye,{children:[e.jsx(c,{onClick:()=>b(!1),children:"Cancel"}),e.jsx(c,{onClick:le,color:"error",variant:"contained",children:"Delete"})]})]})]})};export{Ae as default};
