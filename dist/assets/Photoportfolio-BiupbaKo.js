import{r as n,h as qe,j as e,B as d,t as Ye,a6 as je,aj as Qe,p as Xe,M as k,T as y,s as u,ag as w,g as C,G as S,c as g,a7 as be,a8 as Ze,aa as et}from"./index-uLeiVYul.js";import{T as tt,a as ve}from"./Tabs-BqTVHKM1.js";import{C as ye}from"./CloudUpload-BWMNnZgG.js";import{C as _}from"./Close-rKfQ4Rhr.js";import{T as we}from"./TableContainer-kTzKnZ5Y.js";import{T as Ce,a as Te,b as j,c as a,d as ke}from"./TableRow-BrhgsaVQ.js";import{D as Se}from"./Delete-hrzXmXeA.js";import{L as st,V as ot,C as it,a as rt}from"./VideoLibrary-Djbvf50l.js";const z="https://api.bookmyevent.ae",I=qe.create({baseURL:z}),l="#e53935";function ut({providerId:Ie}){var ge;const[L,Le]=n.useState(0),[De,f]=n.useState(!1),[T,$]=n.useState({open:!1,message:"",severity:"success"}),[B,D]=n.useState(!1),b=Ie||((ge=JSON.parse(localStorage.getItem("user")||"{}"))==null?void 0:ge._id)||localStorage.getItem("userId"),[Ve,N]=n.useState(!1),[v,Pe]=n.useState([]),[H,V]=n.useState(0),[Ue,Re]=n.useState(!1),[J,G]=n.useState(""),[K,q]=n.useState(""),[Y,P]=n.useState([]),[Q,X]=n.useState(""),[U,R]=n.useState([]),[Z,Fe]=n.useState([]),[ee,te]=n.useState(""),[se,oe]=n.useState(""),[ie,F]=n.useState([]),[re,le]=n.useState(""),[A,M]=n.useState([]),[ae,W]=n.useState([]),[E,ne]=n.useState(""),[ce,Ae]=n.useState([]);n.useEffect(()=>{b&&(O(),Me())},[b]);const Me=async()=>{var t;try{const i=(t=(await I.get(`/api/subscriptions/user/${b}`)).data.subscription)==null?void 0:t.planId;!i||i.price===0||i.planType==="free"?D(!0):D(!1)}catch{D(!0)}},O=async()=>{try{f(!0);const t=await I.get(`/api/portfolio/provider/${b}`);if(!t.data.success)return;const s=t.data.data||[],i=s.filter(r=>{var c;return(c=r.media)==null?void 0:c.some(p=>p.type==="image")});Fe(i.map(r=>({id:r._id,title:r.workTitle||"Untitled",description:r.description||"",tags:Array.isArray(r.tags)?r.tags:[],media:r.media.filter(c=>c.type==="image").flatMap(c=>c.images||[])})));const o=s.filter(r=>{var c;return(c=r.media)==null?void 0:c.some(p=>p.type==="video"||p.type==="videoLink")});Ae(o.map(r=>({id:r._id,title:r.workTitle||"Untitled",description:r.description||"",tags:r.tags||[],media:r.media.flatMap(c=>c.type==="video"?(c.videos||[]).map(p=>({type:"video",url:p})):c.type==="videoLink"?(c.videoLinks||[]).map(p=>({type:"videoLink",url:p})):[])})))}catch{x("Unable to load portfolio","error")}finally{f(!1)}},x=(t,s="success")=>$({open:!0,message:t,severity:s}),de=(t,s=0,i=!1)=>{const o=t.map(r=>r.type==="videoLink"?We(r.url):`${z}/${r.url}`);Pe(o),V(s),Re(i),N(!0)},We=t=>t.includes("youtube.com")?t.replace("watch?v=","embed/"):t.includes("youtu.be")?t.replace("youtu.be/","youtube.com/embed/"):t.includes("vimeo.com")?`https://player.vimeo.com/video/${t.split("/").pop().split("?")[0]}`:t,pe=()=>N(!1),Ee=()=>V(t=>t===0?v.length-1:t-1),Oe=()=>V(t=>t===v.length-1?0:t+1),he=(t,s,i)=>{t.trim()&&(i(o=>[...o,t.trim()]),s(""))},_e=t=>{const i=Array.from(t.target.files).map(o=>({file:o,preview:URL.createObjectURL(o)}));R(o=>[...o,...i])},ze=t=>{URL.revokeObjectURL(U[t].preview),R(s=>s.filter((i,o)=>o!==t))},$e=t=>{const i=Array.from(t.target.files).map(o=>({file:o,preview:URL.createObjectURL(o)}));M(o=>[...o,...i])},Be=t=>{URL.revokeObjectURL(A[t].preview),M(s=>s.filter((i,o)=>o!==t))},Ne=()=>{E.trim()&&(W(t=>[...t,E.trim()]),ne(""))},He=t=>W(s=>s.filter((i,o)=>o!==t)),xe=async(t,s,i,o,r,c,p,Je,Ge,fe,Ke=!1)=>{var me;if(B)return x("Upgrade your plan to add portfolio","warning");if(!t.trim()||o.length===0&&r.length===0)return x("Title and media required","warning");const h=new FormData;h.append("providerId",b),h.append("module","default"),h.append("workTitle",t),h.append("description",s),h.append("tags",JSON.stringify(i)),Ke?(o.forEach(m=>h.append("videos",m.file)),r.length>0&&h.append("videoLinks",JSON.stringify(r))):o.forEach(m=>h.append("images",m.file));try{f(!0),await I.post("/api/portfolio",h),x("Added successfully"),O(),c(""),p(""),Je([]),Ge([]),fe&&fe([])}catch(m){((me=m.response)==null?void 0:me.status)===403?x(m.response.data.message,"warning"):x("Upload failed","error")}finally{f(!1)}},ue=async t=>{if(window.confirm("Delete permanently?"))try{f(!0),await I.delete(`/api/portfolio/${t}`),x("Deleted!"),O()}catch{x("Delete failed","error")}finally{f(!1)}};return e.jsxs(d,{sx:{p:3},children:[De&&e.jsx(d,{sx:{position:"fixed",inset:0,bgcolor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:e.jsx(Ye,{size:60,sx:{color:l}})}),B&&e.jsx(je,{severity:"warning",sx:{mb:3,border:`1px solid ${l}`,color:l},children:"You are on a FREE plan. Upgrade to add portfolio."}),e.jsx(Qe,{open:T.open,autoHideDuration:4e3,onClose:()=>$({...T,open:!1}),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(je,{severity:T.severity,children:T.message})}),e.jsxs(Xe,{children:[e.jsxs(tt,{value:L,onChange:(t,s)=>Le(s),textColor:"inherit",TabIndicatorProps:{style:{backgroundColor:l}},sx:{"& .MuiTab-root.Mui-selected":{color:l,fontWeight:600}},children:[e.jsx(ve,{label:"Images"}),e.jsx(ve,{label:"Videos"})]}),L===0&&e.jsxs(e.Fragment,{children:[e.jsxs(k,{children:[e.jsx(y,{variant:"h6",sx:{color:l},children:"Add Portfolio Images"}),e.jsx(u,{fullWidth:!0,label:"Title",value:J,onChange:t=>G(t.target.value),sx:{mb:3}}),e.jsx(u,{fullWidth:!0,multiline:!0,rows:3,label:"Description",value:K,onChange:t=>q(t.target.value),sx:{mb:3}}),e.jsx(d,{sx:{mb:2},children:Y.map((t,s)=>e.jsx(w,{label:t,onDelete:()=>P(i=>i.filter((o,r)=>r!==s)),sx:{mr:1,bgcolor:l,color:"white"}},s))}),e.jsx(u,{fullWidth:!0,label:"Add Tag (Enter)",value:Q,onChange:t=>X(t.target.value),onKeyDown:t=>t.key==="Enter"&&(t.preventDefault(),he(Q,X,P)),sx:{mb:3}}),e.jsxs(C,{variant:"contained",component:"label",startIcon:e.jsx(ye,{}),sx:{mb:2,bgcolor:l,"&:hover":{bgcolor:"#c62828"}},children:["Upload Images",e.jsx("input",{hidden:!0,type:"file",multiple:!0,accept:"image/*",onChange:_e})]}),e.jsx(S,{container:!0,spacing:2,children:U.map((t,s)=>e.jsx(S,{item:!0,xs:6,sm:4,md:3,children:e.jsxs(d,{sx:{position:"relative"},children:[e.jsx("img",{src:t.preview,style:{width:"100%",height:150,objectFit:"cover",borderRadius:8}}),e.jsx(g,{size:"small",onClick:()=>ze(s),sx:{position:"absolute",top:4,right:4,bgcolor:l,color:"white"},children:e.jsx(_,{})})]})},s))}),e.jsx(C,{fullWidth:!0,variant:"contained",sx:{mt:4,bgcolor:l,"&:hover":{bgcolor:"#c62828"}},onClick:()=>xe(J,K,Y,U,[],G,q,P,R,null,!1),children:"Add Portfolio"})]}),e.jsxs(k,{children:[e.jsx(y,{variant:"h6",sx:{color:l},children:"Portfolio List"}),e.jsx(we,{component:be,children:e.jsxs(Ce,{children:[e.jsx(Te,{sx:{bgcolor:"#ffebee"},children:e.jsxs(j,{children:[e.jsx(a,{children:"SI"}),e.jsx(a,{children:"Title"}),e.jsx(a,{children:"Preview"}),e.jsx(a,{children:"Count"}),e.jsx(a,{children:"Tags"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(ke,{children:Z.length===0?e.jsx(j,{children:e.jsx(a,{colSpan:6,align:"center",children:"No images"})}):Z.map((t,s)=>e.jsxs(j,{children:[e.jsx(a,{children:s+1}),e.jsx(a,{children:t.title}),e.jsx(a,{children:e.jsx(d,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:t.media.slice(0,3).map((i,o)=>e.jsx("img",{src:`${z}/${i}`,style:{width:70,height:60,objectFit:"cover",borderRadius:4,cursor:"pointer"},onClick:()=>de(t.media.map(r=>({type:"image",url:r})),o,!1)},o))})}),e.jsx(a,{children:t.media.length}),e.jsx(a,{children:t.tags.map((i,o)=>e.jsx(w,{size:"small",label:i,sx:{mr:.5,bgcolor:l,color:"white"}},o))}),e.jsx(a,{children:e.jsx(g,{onClick:()=>ue(t.id),sx:{color:l},children:e.jsx(Se,{})})})]},t.id))})]})})]})]}),L===1&&e.jsxs(e.Fragment,{children:[e.jsxs(k,{children:[e.jsx(y,{variant:"h6",sx:{color:l},children:"Add Portfolio Videos"}),e.jsx(u,{fullWidth:!0,label:"Title",value:ee,onChange:t=>te(t.target.value),sx:{mb:3}}),e.jsx(u,{fullWidth:!0,multiline:!0,rows:3,label:"Description",value:se,onChange:t=>oe(t.target.value),sx:{mb:3}}),e.jsx(d,{sx:{mb:2},children:ie.map((t,s)=>e.jsx(w,{label:t,onDelete:()=>F(i=>i.filter((o,r)=>r!==s)),sx:{mr:1,bgcolor:l,color:"white"}},s))}),e.jsx(u,{fullWidth:!0,label:"Add Tag (Enter)",value:re,onChange:t=>le(t.target.value),onKeyDown:t=>t.key==="Enter"&&(t.preventDefault(),he(re,le,F)),sx:{mb:3}}),e.jsxs(C,{variant:"contained",component:"label",startIcon:e.jsx(ye,{}),sx:{mb:2,bgcolor:l,"&:hover":{bgcolor:"#c62828"}},children:["Upload Videos",e.jsx("input",{hidden:!0,type:"file",multiple:!0,accept:"video/*",onChange:$e})]}),e.jsx(y,{sx:{my:2},children:"Or add video links"}),e.jsxs(d,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(u,{fullWidth:!0,label:"Video Link",value:E,onChange:t=>ne(t.target.value)}),e.jsx(C,{variant:"contained",sx:{bgcolor:l,"&:hover":{bgcolor:"#c62828"}},onClick:Ne,children:"Add"})]}),e.jsx(d,{sx:{mb:2},children:ae.map((t,s)=>e.jsx(w,{label:t,onDelete:()=>He(s),sx:{mr:1,mb:1,bgcolor:l,color:"white"}},s))}),e.jsx(S,{container:!0,spacing:2,children:A.map((t,s)=>e.jsx(S,{item:!0,xs:6,sm:4,md:3,children:e.jsxs(d,{sx:{position:"relative"},children:[e.jsx("video",{src:t.preview,controls:!0,style:{width:"100%",height:150,borderRadius:8}}),e.jsx(g,{size:"small",onClick:()=>Be(s),sx:{position:"absolute",top:4,right:4,bgcolor:l,color:"white"},children:e.jsx(_,{})})]})},s))}),e.jsx(C,{fullWidth:!0,variant:"contained",sx:{mt:4,bgcolor:l,"&:hover":{bgcolor:"#c62828"}},onClick:()=>xe(ee,se,ie,A,ae,te,oe,F,M,W,!0),children:"Add Video"})]}),e.jsxs(k,{children:[e.jsx(y,{variant:"h6",sx:{color:l},children:"Video List"}),e.jsx(we,{component:be,children:e.jsxs(Ce,{children:[e.jsx(Te,{sx:{bgcolor:"#ffebee"},children:e.jsxs(j,{children:[e.jsx(a,{children:"SI"}),e.jsx(a,{children:"Title"}),e.jsx(a,{children:"Preview"}),e.jsx(a,{children:"Count"}),e.jsx(a,{children:"Tags"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(ke,{children:ce.length===0?e.jsx(j,{children:e.jsx(a,{colSpan:6,align:"center",children:"No videos"})}):ce.map((t,s)=>e.jsxs(j,{children:[e.jsx(a,{children:s+1}),e.jsx(a,{children:t.title}),e.jsx(a,{children:e.jsx(d,{sx:{display:"flex",gap:1},children:t.media.slice(0,3).map((i,o)=>e.jsx(d,{onClick:()=>de(t.media,o,!0),sx:{width:80,height:60,borderRadius:2,cursor:"pointer",background:l,color:"white",display:"flex",alignItems:"center",justifyContent:"center"},children:i.type==="videoLink"?e.jsx(st,{}):e.jsx(ot,{})},o))})}),e.jsx(a,{children:t.media.length}),e.jsx(a,{children:t.tags.map((i,o)=>e.jsx(w,{size:"small",label:i,sx:{mr:.5,bgcolor:l,color:"white"}},o))}),e.jsx(a,{children:e.jsx(g,{onClick:()=>ue(t.id),sx:{color:l},children:e.jsx(Se,{})})})]},t.id))})]})})]})]})]}),e.jsx(Ze,{open:Ve,onClose:pe,maxWidth:"lg",fullWidth:!0,children:e.jsxs(et,{sx:{bgcolor:"black",position:"relative",minHeight:"80vh",p:0},children:[e.jsx(g,{onClick:pe,sx:{position:"absolute",top:10,right:10,color:l},children:e.jsx(_,{fontSize:"large"})}),Ue?e.jsx("iframe",{src:v[H],style:{width:"100%",height:"75vh",border:"none"},allow:"autoplay; fullscreen",allowFullScreen:!0}):e.jsx("img",{src:v[H],style:{maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",display:"block",margin:"auto"}}),v.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(g,{onClick:Ee,sx:{position:"absolute",top:"50%",left:10,color:l,bgcolor:"rgba(255,255,255,0.1)"},children:e.jsx(it,{fontSize:"large"})}),e.jsx(g,{onClick:Oe,sx:{position:"absolute",top:"50%",right:10,color:l,bgcolor:"rgba(255,255,255,0.1)"},children:e.jsx(rt,{fontSize:"large"})})]})]})})]})}export{ut as default};
