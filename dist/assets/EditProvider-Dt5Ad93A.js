import{r as s,j as o,B as d,T as f,p as Y,N as Z,s as R,g as j,am as ee,x as oe}from"./index-DkD_OfQp.js";import{T as te,a as L}from"./Tabs-B8Sbr5ln.js";function E(u){const{children:C,value:i,index:p,...h}=u;return o.jsx("div",{role:"tabpanel",hidden:i!==p,id:`simple-tabpanel-${p}`,"aria-labelledby":`simple-tab-${p}`,...h,children:i===p&&o.jsx(d,{sx:{p:3},children:C})})}function T(u){return{id:`simple-tab-${u}`,"aria-controls":`simple-tabpanel-${u}`}}const le=()=>{const[u,C]=s.useState(0),[i,p]=s.useState(""),[h,A]=s.useState(""),[g,D]=s.useState(""),[c,$]=s.useState(null),[x,O]=s.useState(null),[a,U]=s.useState(null),[m,_]=s.useState(null),[W,k]=s.useState(!1),[l,y]=s.useState(""),[I,w]=s.useState(""),[B,v]=s.useState(""),[q,P]=s.useState(!0),[S,H]=s.useState(null),[re,V]=s.useState(null),b="https://api.bookmyevent.ae/api";s.useEffect(()=>{console.log("EditProvider useEffect triggered - mounting component");const t=localStorage.getItem("user");if(console.log("Stored user from localStorage:",t),t){const e=JSON.parse(t);console.log("Parsed user:",e),console.log("User ID for fetch:",e._id||e.id),H(e),z(e._id||e.id),J(e._id||e.id)}else console.log("No user found in localStorage - cannot fetch data"),P(!1)},[]);const z=async t=>{try{console.log("Fetching user data for ID:",t);const e=await fetch(`${b}/users/${t}`);console.log("User fetch response status:",e.status);const r=await e.json();console.log("User API Response:",r),r.user?(V(r.user),p(r.user.email||""),console.log("User data set - Email:",r.user.email||"empty")):console.error("Failed to fetch user data:",r.message)}catch(e){console.error("Error fetching user data:",e)}},J=async t=>{try{console.log("fetchProviderData called with userId:",t),console.log("API URL for fetch:",`${b}/providerprofiles/${t}`),P(!0);const e=await fetch(`${b}/providerprofiles/${t}`);console.log("Fetch response status:",e.status);const r=await e.json();if(console.log("Provider API Response:",r),r.success&&r.data){const n=r.data;console.log("Provider data received:",n),console.log("Setting states with provider data"),A(n.address||""),D(n.phone||""),O(n.logo||null),_(n.coverPhoto||null),console.log("States set - Address:",n.address||"empty","Phone:",n.phone||"empty")}else console.log("API did not return success/data - response:",r),console.error("Failed to fetch provider data:",r.message||"Unknown error")}catch(e){console.error("Error fetching provider data:",e)}finally{P(!1),console.log("fetchProviderData completed - loading set to false")}},M=(t,e)=>{C(e)},G=t=>{const e=t.target.files[0];console.log("Logo file selected:",e==null?void 0:e.name),e&&$(e)},K=t=>{const e=t.target.files[0];if(console.log("Cover photo file selected:",e==null?void 0:e.name),e){const r=new Image;r.onload=()=>{const n=r.width/r.height;console.log("Cover photo dimensions - width:",r.width,"height:",r.height,"ratio:",n),n!==2?(v("Cover photo must have a 2:1 ratio (e.g., 200x100 pixels)."),U(null)):(v(""),U(e))},r.src=URL.createObjectURL(e)}},Q=async()=>{if(console.log("handleUpdate called"),console.log("Current states - Email:",i,"Address:",h,"Phone:",g),console.log("Logo file:",(c==null?void 0:c.name)||"none","Current logo URL:",x),console.log("Cover file:",(a==null?void 0:a.name)||"none","Current cover URL:",m),v(""),y(""),w(""),!i||!h||!g||!c&&!x||!a&&!m){y("All required fields (email, address, contact number, logo, cover photo) must be filled."),console.log("Validation failed - missing fields");return}if(!/^\+\d{1,4}\s\d{10}$/.test(g)){w("Please enter a valid 10-digit contact number (e.g., +91 1234567890)."),console.log("Phone validation failed");return}if(a){const t=new Image;t.onload=async()=>{const e=t.width/t.height;if(console.log("New cover photo ratio check:",e),e!==2){v("Cover photo must have a 2:1 ratio (e.g., 200x100 pixels)."),console.log("Cover ratio invalid");return}console.log("Cover ratio valid - proceeding to update"),await F()},t.src=URL.createObjectURL(a)}else console.log("No new cover photo - proceeding to update"),await F()},F=async()=>{try{console.log("performUpdate called");const t=S._id||S.id;console.log("Updating for userId:",t);const e=new FormData;e.append("email",i),e.append("address",h),e.append("phone",g),c&&(e.append("logo",c),console.log("Appending new logo file")),a&&(e.append("coverPhoto",a),console.log("Appending new cover photo file")),console.log("FormData prepared - sending PUT request to:",`${b}/providerprofiles/${t}`);const r=await fetch(`${b}/providerprofiles/${t}`,{method:"PUT",body:e});if(console.log("Update response status:",r.status),r.ok)console.log("Update successful"),window.history.back(),k(!0);else{const n=await r.json();console.error("Update failed - response:",n)}}catch(t){console.error("Error updating provider data:",t)}},X=()=>{console.log("handleCancel called"),$(null),U(null),y(""),w(""),v(""),window.history.back()},N=()=>{k(!1)};return console.log("Render cycle - Loading:",q,"Email state:",i,"User:",S?"set":"null"),q?(console.log("Rendering loading state"),o.jsx(d,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},children:o.jsx(f,{children:"Loading..."})})):o.jsxs(d,{sx:{p:3,backgroundColor:"#f5f5f5",minHeight:"100vh"},children:[o.jsx(Y,{sx:{maxWidth:2500,margin:"auto",p:3,boxShadow:1},children:o.jsxs(Z,{children:[o.jsx(f,{variant:"h3",gutterBottom:!0,children:"Edit Provider Info"}),o.jsx(d,{sx:{borderBottom:1,borderColor:"divider"},children:o.jsxs(te,{value:u,onChange:M,"aria-label":"provider info tabs",children:[o.jsx(L,{label:"Basic Info",...T(0)}),o.jsx(L,{label:"Contact",...T(1)}),o.jsx(L,{label:"Media",...T(2)})]})}),o.jsxs(E,{value:u,index:0,children:[o.jsx(R,{fullWidth:!0,label:"Email *",variant:"outlined",value:i,onChange:t=>p(t.target.value),sx:{mb:2},required:!0,error:!i&&l,helperText:!i&&l?"Required field":""}),o.jsx(R,{fullWidth:!0,label:"Address *",variant:"outlined",value:h,onChange:t=>A(t.target.value),sx:{mb:2},required:!0,error:!h&&l,helperText:!h&&l?"Required field":"",multiline:!0,rows:3})]}),o.jsx(E,{value:u,index:1,children:o.jsx(R,{fullWidth:!0,label:"Contact number *",variant:"outlined",value:g,onChange:t=>D(t.target.value),sx:{mb:2},required:!0,error:!!I||!g&&l,helperText:I||(!g&&l?"Required field":"")})}),o.jsx(E,{value:u,index:2,children:o.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[o.jsxs(d,{sx:{p:2,border:"1px solid #e0e0e0",borderRadius:4,textAlign:"center",width:"45%"},children:[o.jsx(f,{variant:"h6",gutterBottom:!0,children:"Upload Logo *"}),o.jsx(d,{sx:{mb:2},children:o.jsx("img",{src:c?URL.createObjectURL(c):x||"https://via.placeholder.com/100?text=Logo",alt:"Logo",style:{width:"100px",height:"100px"}})}),o.jsxs(j,{variant:"outlined",component:"label",children:["Choose File",o.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:G})]}),o.jsx(f,{variant:"caption",display:"block",gutterBottom:!0,color:l&&!c&&!x?"error":"textSecondary",children:c?"New file selected.":x?"Current logo displayed.":l||"Required field"})]}),o.jsxs(d,{sx:{p:2,border:"1px solid #e0e0e0",borderRadius:4,textAlign:"center",width:"45%"},children:[o.jsx(f,{variant:"h6",gutterBottom:!0,children:"Upload Cover Photo (Ratio 2:1) *"}),o.jsx(d,{sx:{mb:2},children:o.jsx("img",{src:a?URL.createObjectURL(a):m||"https://via.placeholder.com/200x100?text=Cover+Photo",alt:"Cover Photo",style:{width:"200px",height:"100px",borderRadius:"8px"}})}),o.jsxs(j,{variant:"outlined",component:"label",children:["Choose File",o.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:K})]}),o.jsx(f,{variant:"caption",display:"block",gutterBottom:!0,color:!a&&!m&&l||B?"error":"textSecondary",children:a?"New file selected.":m?"Current cover photo displayed.":l||B||"Required field"})]})]})}),o.jsxs(d,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:2},children:[o.jsx(j,{variant:"contained",color:"black",onClick:X,children:"Cancel"}),o.jsx(j,{variant:"contained",color:"info",onClick:Q,sx:{color:"white",bgcolor:"#E15B65"},children:"Update"})]})]})}),o.jsx(ee,{open:W,autoHideDuration:3e3,onClose:N,anchorOrigin:{vertical:"top",horizontal:"center"},children:o.jsx(oe,{onClose:N,severity:"success",sx:{backgroundColor:"#1976d2",color:"white"},children:"Update successful!"})})]})};export{le as default};
