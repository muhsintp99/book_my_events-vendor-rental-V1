import{r as i,l as Q,d as X,j as e,aF as _,aG as ee,aH as re,B as n,T as d,A as L,aI as ae,s as C,Y as v,a as S,Z as N,o as te,y as se,w as oe,b as U,N as ie,e as ne}from"./index-DQO8S-Hd.js";import{C as le}from"./Close-DxdnvH5I.js";import{A as ce}from"./AddPhotoAlternate-Bmz3mU4X.js";import{A as de,R as pe}from"./RotateLeft-CkxLoTpn.js";const E={},ge=ee({palette:{primary:{main:"#C4572A",dark:"#8B3A0F",light:"#E07A52",contrastText:"#fff"},secondary:{main:"#D4A017"},background:{default:"#FDF6EE",paper:"#fff"},text:{primary:"#1A0A00",secondary:"#7A5C4A"}},typography:{fontFamily:"'DM Sans', sans-serif",h4:{fontFamily:"'Playfair Display', serif"}},shape:{borderRadius:14},components:{MuiCssBaseline:{styleOverrides:"@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,500&family=DM+Sans:wght@300;400;500;600&display=swap');"},MuiOutlinedInput:{styleOverrides:{root:{borderRadius:12,backgroundColor:"#FFFBF7",fontFamily:"'DM Sans', sans-serif",fontSize:"14.5px","& fieldset":{borderColor:"rgba(196,87,42,0.2)"},"&:hover fieldset":{borderColor:"rgba(196,87,42,0.5) !important"},"&.Mui-focused fieldset":{borderColor:"#C4572A !important",borderWidth:"2px"}},input:{padding:"15px 16px"}}},MuiInputLabel:{styleOverrides:{root:{fontFamily:"'DM Sans', sans-serif",fontSize:"14px",color:"#8B3A0F","&.Mui-focused":{color:"#C4572A"}}}},MuiButton:{styleOverrides:{root:{textTransform:"none",fontFamily:"'DM Sans', sans-serif",fontWeight:600,borderRadius:12}}}}}),j=({children:a})=>e.jsx(d,{sx:{fontSize:"10.5px",fontWeight:700,letterSpacing:"0.13em",textTransform:"uppercase",color:"#C4572A",mb:1.25},children:a}),A={bgcolor:"#fff",border:"1px solid rgba(196,87,42,0.11)",borderRadius:"16px",p:{xs:2.5,sm:3},boxShadow:"0 2px 14px rgba(196,87,42,0.05)"};function Se(){const[a,f]=i.useState({name:"",description:"",price:"",advance:""}),[H,k]=i.useState([]),[me,q]=i.useState([]),[xe,V]=i.useState(!0),[ue,z]=i.useState(null),[w,I]=i.useState(null),[B,b]=i.useState(null),[l,m]=i.useState({}),[P,x]=i.useState({open:!1,msg:"",severity:"success"}),[D,R]=i.useState(!1),[M,F]=i.useState(!1),{id:u}=Q();X();const h=!!u,T=(E==null?void 0:E.VITE_API_BASE_URL)||"https://api.bookmyevent.ae";i.useEffect(()=>{(async()=>{try{const t=localStorage.getItem("moduleId");if(!t)throw new Error("Module ID not found");const s=await fetch(`${T}/api/categories/modules/${t}`);if(!s.ok)throw new Error(`HTTP error! ${s.status}`);const c=await s.json();if(c.success&&Array.isArray(c.data)){const o=c.data.filter(p=>p.isActive).map(p=>({id:p.categoryId||p._id,label:p.title,image:p.image?`${T}${p.image}`:null}));q(o)}else z("No services found")}catch(t){z(t.message)}finally{V(!1)}})()},[]),i.useEffect(()=>{if(!u)return;(async()=>{try{const t=localStorage.getItem("token"),c=await(await fetch(`https://api.bookmyevent.ae/api/mehandi/${u}`,{headers:{Authorization:`Bearer ${t}`}})).json();if(c.success){const o=c.data;f({name:o.packageName||"",description:o.description||"",price:o.packagePrice!=null?String(o.packagePrice):"",advance:o.advanceBookingAmount!=null?String(o.advanceBookingAmount):""}),k(o.services||[]),o.image&&b(`https://api.bookmyevent.ae${o.image.startsWith("/")?"":"/"}${o.image}`)}}catch(t){console.error(t)}})()},[u]);const y=(r,t)=>{f(s=>({...s,[r]:t})),l[r]&&m(s=>({...s,[r]:""}))},W=r=>{if(!(r!=null&&r.type.startsWith("image/")))return;I(r);const t=new FileReader;t.onload=s=>{b(s.target.result),m(c=>({...c,image:""}))},t.readAsDataURL(r)},G=()=>{const r={};return a.name.trim()||(r.name="Required"),a.description.trim()||(r.description="Required"),(!a.price||+a.price<=0)&&(r.price="Enter a valid price"),(a.advance===""||+a.advance<0)&&(r.advance="Enter a valid amount"),!h&&!w&&(r.image="Please upload a package image"),r},J=async r=>{r.preventDefault();const t=G();if(Object.keys(t).length){m(t),x({open:!0,msg:"Please fix the highlighted fields.",severity:"error"});return}try{R(!0);const s=localStorage.getItem("moduleId"),c=localStorage.getItem("user");if(!s||!c)throw new Error("Module ID or Vendor ID missing in localStorage");const p=JSON.parse(c)._id,O=localStorage.getItem("token");if(!s||!p)throw new Error("Module ID or Vendor ID missing in localStorage");const g=new FormData;g.append("module",s),g.append("providerId",p),g.append("packageName",a.name),g.append("description",a.description),g.append("packagePrice",a.price),g.append("advanceBookingAmount",a.advance),g.append("services",JSON.stringify(H)),w&&g.append("image",w);const Z=h?`https://api.bookmyevent.ae/api/mehandi/${u}`:"https://api.bookmyevent.ae/api/mehandi/create",$=await fetch(Z,{method:h?"PUT":"POST",headers:O?{Authorization:`Bearer ${O}`}:void 0,body:g}),K=await $.json();if(!$.ok)throw new Error(K.message||"Something went wrong");x({open:!0,msg:"Package published successfully ðŸŽ‰",severity:"success"}),f({name:"",description:"",price:"",advance:""}),k([]),I(null),b(null),m({})}catch(s){x({open:!0,msg:s.message,severity:"error"})}finally{R(!1)}},Y=()=>{f({name:"",description:"",price:"",advance:""}),k([]),setImage(null),m({})};return e.jsxs(_,{theme:ge,children:[e.jsx(re,{}),e.jsxs(n,{sx:{width:"100%",bgcolor:"#FDF6EE",minHeight:"100%",py:{xs:3,sm:4},px:{xs:2,sm:3,md:4}},children:[e.jsxs(n,{sx:{mb:3.5},children:[e.jsxs(d,{variant:"h4",fontWeight:700,sx:{fontSize:{xs:"1.65rem",sm:"2rem"},lineHeight:1.2},children:["Add"," ",e.jsx(n,{component:"em",sx:{color:"primary.main",fontStyle:"italic"},children:"Florist"})," ","Package"]}),e.jsx(d,{variant:"body2",color:"text.secondary",mt:.75,fontSize:"13.5px",children:"Fill in the details below to create and publish a new package."})]}),e.jsxs(n,{sx:{bgcolor:"#1A0A00",px:{xs:2.5,sm:3.5},py:2.25,borderRadius:"16px 16px 0 0",display:"flex",alignItems:"center",gap:2},children:[e.jsx(L,{sx:{bgcolor:"rgba(196,87,42,0.3)",borderRadius:"10px",width:38,height:38,fontSize:"15px"},children:"âœ¦"}),e.jsxs(n,{children:[e.jsx(d,{sx:{color:"#F7EDE0",fontFamily:"'Playfair Display', serif",fontSize:"1.05rem"},children:"Package Details"}),e.jsx(d,{sx:{color:"rgba(255,255,255,0.3)",fontSize:"11.5px"},children:"All * fields are required"})]})]}),D&&e.jsx(ae,{color:"primary"}),e.jsx(n,{component:"form",onSubmit:J,noValidate:!0,sx:{border:"1px solid rgba(196,87,42,0.11)",borderTop:"none",borderRadius:"0 0 16px 16px",bgcolor:"#FDF6EE",p:{xs:2,sm:3},boxShadow:"0 4px 24px rgba(196,87,42,0.06)"},children:e.jsxs(C,{spacing:2.5,children:[e.jsxs(v,{elevation:0,sx:A,children:[e.jsx(j,{children:"Package Name"}),e.jsx(S,{label:"Package Name *",placeholder:"e.g. Traditional Stage Decoration",fullWidth:!0,value:a.name,onChange:r=>y("name",r.target.value),error:!!l.name,helperText:l.name})]}),e.jsxs(v,{elevation:0,sx:A,children:[e.jsx(j,{children:"Description"}),e.jsx(S,{label:"Description *",placeholder:"Describe design style, coverage area, occasion suitability, cone qualityâ€¦",fullWidth:!0,multiline:!0,rows:4,value:a.description,onChange:r=>y("description",r.target.value),error:!!l.description,helperText:l.description,sx:{"& .MuiOutlinedInput-root .MuiOutlinedInput-input":{padding:"4px 2px"}}})]}),e.jsxs(v,{elevation:0,sx:A,children:[e.jsx(j,{children:"Pricing"}),e.jsxs(n,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2.5},children:[e.jsx(n,{sx:{flex:1},children:e.jsx(S,{label:"Package Price *",placeholder:"0",fullWidth:!0,type:"number",value:a.price,onChange:r=>y("price",r.target.value),error:!!l.price,helperText:l.price,InputProps:{startAdornment:e.jsx(N,{position:"start",children:e.jsx(d,{sx:{color:"primary.main",fontWeight:700,fontSize:"17px"},children:"â‚¹"})})}})}),e.jsx(n,{sx:{flex:1},children:e.jsx(S,{label:"Advance Booking Amount *",placeholder:"0",fullWidth:!0,type:"number",value:a.advance,onChange:r=>y("advance",r.target.value),error:!!l.advance,helperText:l.advance,InputProps:{startAdornment:e.jsx(N,{position:"start",children:e.jsx(d,{sx:{color:"secondary.main",fontWeight:700,fontSize:"17px"},children:"â‚¹"})})}})})]})]}),e.jsxs(v,{elevation:0,sx:A,children:[e.jsx(j,{children:"Package Image"}),B?e.jsxs(n,{sx:{position:"relative",borderRadius:"12px",overflow:"hidden"},children:[e.jsx(n,{component:"img",src:B,alt:"preview",sx:{width:"100%",height:{xs:200,sm:260,md:300},objectFit:"cover",display:"block",borderRadius:"12px",border:"1.5px solid rgba(196,87,42,0.15)"}}),e.jsx(te,{onClick:()=>{I(null),b(null)},size:"small",sx:{position:"absolute",top:10,right:10,bgcolor:"rgba(0,0,0,0.6)",color:"#fff","&:hover":{bgcolor:"primary.main"}},children:e.jsx(le,{fontSize:"small"})}),e.jsxs(n,{sx:{position:"absolute",bottom:10,left:10,bgcolor:"rgba(0,0,0,0.55)",borderRadius:"8px",px:1.5,py:.5,backdropFilter:"blur(6px)",display:"flex",alignItems:"center",gap:.75},children:[e.jsx(ce,{sx:{color:"#fff",fontSize:13}}),e.jsx(d,{sx:{color:"#fff",fontSize:"11.5px"},children:"Package Image"})]})]}):e.jsxs(n,{component:"label",htmlFor:"pkg-img",onDragOver:r=>{r.preventDefault(),F(!0)},onDragLeave:()=>F(!1),onDrop:r=>{r.preventDefault(),F(!1),W(r.dataTransfer.files[0])},sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",border:`2px dashed ${l.image?"#d32f2f":M?"#C4572A":"rgba(196,87,42,0.28)"}`,borderRadius:"12px",py:{xs:4.5,sm:5.5},px:3,cursor:"pointer",bgcolor:M?"rgba(196,87,42,0.04)":"#FFFBF7",textAlign:"center",transition:"all 0.2s","&:hover":{borderColor:"#C4572A",bgcolor:"rgba(196,87,42,0.03)"}},children:[e.jsx("input",{id:"pkg-img",type:"file",accept:"image/*",hidden:!0,onChange:r=>W(r.target.files[0])}),e.jsx(L,{sx:{bgcolor:"rgba(196,87,42,0.1)",width:52,height:52,mb:1.75,borderRadius:"13px"},children:e.jsx(se,{sx:{color:"#C4572A",fontSize:24}})}),e.jsx(d,{fontWeight:600,fontSize:"15px",color:"text.primary",mb:.5,children:"Click to upload image"}),e.jsx(d,{fontSize:"13px",color:"text.secondary",mb:2,children:"Drag & drop also supported"}),e.jsx(C,{direction:"row",spacing:.75,flexWrap:"wrap",justifyContent:"center",children:["JPG","PNG","WEBP","Max 5MB"].map(r=>e.jsx(oe,{label:r,size:"small",sx:{bgcolor:"rgba(196,87,42,0.08)",color:"#8B3A0F",fontSize:"11px",height:24}},r))})]}),l.image&&e.jsx(d,{sx:{color:"error.main",fontSize:"12px",mt:.75},children:l.image})]}),e.jsxs(C,{direction:{xs:"column",sm:"row"},spacing:1.5,alignItems:{sm:"center"},pt:.5,children:[e.jsx(U,{type:"submit",variant:"contained",size:"large",disabled:D,startIcon:e.jsx(de,{}),sx:{flex:{sm:1},py:1.65,fontSize:"15px",background:"linear-gradient(135deg, #C4572A 0%, #8B3A0F 100%)",boxShadow:"0 4px 18px rgba(196,87,42,0.32)","&:hover":{boxShadow:"0 6px 24px rgba(196,87,42,0.44)",transform:"translateY(-1px)"},transition:"all 0.2s"},children:D?h?"Updatingâ€¦":"Publishingâ€¦":h?"Update Package":"Add Package"}),e.jsx(U,{type:"button",variant:"outlined",size:"large",onClick:Y,startIcon:e.jsx(pe,{}),sx:{flex:{sm:1},py:1.65,fontSize:"15px",borderColor:"rgba(196,87,42,0.28)",color:"primary.dark","&:hover":{borderColor:"primary.main",bgcolor:"rgba(196,87,42,0.04)"}},children:"Reset"})]})]})})]}),e.jsx(ie,{open:P.open,autoHideDuration:3500,onClose:()=>x(r=>({...r,open:!1})),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(ne,{severity:P.severity,variant:"filled",onClose:()=>x(r=>({...r,open:!1})),sx:{borderRadius:"12px",fontFamily:"'DM Sans', sans-serif",minWidth:280},children:P.msg})})]})}export{Se as default};
