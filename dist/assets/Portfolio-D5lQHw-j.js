import{r as o,f as Le,j as e,B as l,e as Re,C as $e,q as Ie,T as c,a as L,b as v,y as de,o as y,z as ce,Y as Pe,a1 as Ue,H as ue,a2 as Ee,c as Ve}from"./index-BaH8rYCR.js";import{T as he,a as R}from"./Tabs-BWRfdVNB.js";import{C as We,V as Fe}from"./VideoLibrary-CG_8HBcG.js";import{T as Ae}from"./TableContainer-Bd6SM3fa.js";import{T as Be,a as q,b as a,c as De}from"./TableRow-DlnbilcC.js";import{T as Oe}from"./TableHead-8Aru5CBK.js";import{C as xe}from"./Close-GR0SV3nW.js";const r="https://api.bookmyevent.ae",T=Le.create({baseURL:r}),N="#e53935";function Je(){const $=JSON.parse(localStorage.getItem("user")||"{}"),x=$==null?void 0:$._id,C=localStorage.getItem("moduleId"),[z,me]=o.useState(!1),[pe,H]=o.useState(!1),[m,w]=o.useState(0),[I,P]=o.useState(""),[Y,U]=o.useState(""),[J,E]=o.useState(""),[K,M]=o.useState(null),V=!!K,[Q,X]=o.useState(null),[ge,Z]=o.useState([]),[p,W]=o.useState(null),[ee,F]=o.useState([]),[A,k]=o.useState([]),[S,B]=o.useState(""),[g,D]=o.useState(null),[f,fe]=o.useState(0),[te,be]=o.useState([]),[je,O]=o.useState(!1),[ie,ve]=o.useState([]),[se,oe]=o.useState(0),[ye,_]=o.useState(!1),[b,Te]=o.useState("");o.useEffect(()=>{!x||!C||T.get(`/api/subscription/status/${x}?moduleId=${C}`).then(t=>{var s;const i=(s=t.data)==null?void 0:s.subscription;me((i==null?void 0:i.status)==="active"&&(i==null?void 0:i.isCurrent))})},[x,C]);const G=async()=>{const t=await T.get(`/api/portfolio/provider/${x}`);be(t.data.data||[])};o.useEffect(()=>{G()},[]);const Ce=t=>{if(!t)return null;const i=t.match(/(?:youtube\.com\/.*v=|youtu\.be\/)([^&]+)/);return i?`https://img.youtube.com/vi/${i[1]}/hqdefault.jpg`:null},we=async()=>{if(!z)return alert("Upgrade plan required");if(!I.trim())return alert("Title required");if(m===1){if(!A.length&&!S)return alert("Please upload a video or add a video link");if(!g)return alert("Video thumbnail is required")}const t=new FormData;if(t.append("providerId",x),t.append("module",C),t.append("workTitle",I),t.append("description",Y),t.append("tags",J),m===0){if(!p)return alert("Thumbnail required");t.append("thumbnail",p),ee.forEach(i=>t.append("images",i))}else A.forEach(i=>t.append("videos",i)),S&&t.append("videoLinks",JSON.stringify([S])),g&&t.append("videoThumbnail",g);H(!0),V?await T.put(`/api/portfolio/${K}`,t):await T.post("/api/portfolio",t),H(!1),P(""),U(""),E(""),W(null),F([]),k([]),B(""),D(null),G(),M(null),w(0),X(null),Z([])},ke=async t=>{window.confirm("Delete portfolio?")&&(await T.delete(`/api/portfolio/${t}`),G())},Se=t=>{var u,n,j;M(t._id),P(t.workTitle||""),U(t.description||""),E(t.tags||"");const i=(u=t.media)==null?void 0:u.find(d=>d.type==="image"),s=(n=t.media)==null?void 0:n.find(d=>d.type==="video"||d.type==="videoLink");i&&(w(0),X(i.thumbnail||null),Z(i.gallery||[]),W(null),F([])),s&&(w(1),k([]),B(((j=s.videoLinks)==null?void 0:j[0])||""),D(null)),window.scrollTo({top:0,behavior:"smooth"})},le=f===0?te.filter(t=>{var i;return(i=t.media)==null?void 0:i.some(s=>s.type==="image")}):te.filter(t=>{var i;return(i=t.media)==null?void 0:i.some(s=>s.type==="video"||s.type==="videoLink")});return e.jsxs(l,{sx:{p:3,maxWidth:1800,mx:"auto"},children:[!z&&e.jsx(Re,{severity:"warning",sx:{mb:3},children:"Upgrade to premium to add portfolio works"}),e.jsx($e,{sx:{mb:5,borderRadius:3,width:"100%"},children:e.jsxs(Ie,{children:[e.jsx(c,{variant:"h5",fontWeight:700,mb:2,children:V?"Edit Portfolio Work":"Add Portfolio Work"}),e.jsxs(he,{value:m,onChange:(t,i)=>w(i),sx:{mb:3},children:[e.jsx(R,{label:"Images"}),e.jsx(R,{label:"Videos"})]}),e.jsx(L,{fullWidth:!0,label:"Title",value:I,onChange:t=>P(t.target.value),sx:{mb:3}}),e.jsx(L,{fullWidth:!0,multiline:!0,rows:3,label:"Description",value:Y,onChange:t=>U(t.target.value),sx:{mb:3}}),e.jsx(L,{fullWidth:!0,label:"Tags",value:J,onChange:t=>E(t.target.value),sx:{mb:4}}),m===0&&e.jsxs(e.Fragment,{children:[e.jsxs(v,{component:"label",variant:"contained",sx:{bgcolor:N,mb:2},children:[e.jsx(de,{sx:{mr:1}})," Upload Thumbnail",e.jsx("input",{hidden:!0,type:"file",accept:"image/*",onChange:t=>W(t.target.files[0])})]}),Q&&!p&&e.jsxs(l,{sx:{mb:3},children:[e.jsx(c,{variant:"caption",children:"Current Thumbnail"}),e.jsx("img",{src:`${r}/${Q}`,style:{width:180,height:180,borderRadius:12}})]}),p&&e.jsxs(l,{sx:{mb:3},children:[e.jsx(c,{variant:"caption",children:"New Thumbnail"}),e.jsx("img",{src:URL.createObjectURL(p),style:{width:180,height:180,borderRadius:12}})]}),e.jsxs(v,{component:"label",variant:"outlined",sx:{mb:2},children:[e.jsx(We,{sx:{mr:1}})," Upload Gallery Images",e.jsx("input",{hidden:!0,multiple:!0,type:"file",accept:"image/*",onChange:t=>F([...t.target.files])})]}),e.jsxs(l,{sx:{display:"flex",gap:2,flexWrap:"wrap",mb:4},children:[ge.map((t,i)=>e.jsx("img",{src:`${r}/${t}`,style:{width:100,height:100,borderRadius:10,objectFit:"cover"}},`existing-${i}`)),ee.map((t,i)=>e.jsx("img",{src:URL.createObjectURL(t),style:{width:100,height:100,borderRadius:10,border:"2px solid #4caf50"}},`new-${i}`))]})]}),m===1&&e.jsxs(e.Fragment,{children:[e.jsxs(v,{component:"label",variant:"contained",sx:{bgcolor:N,mb:2},children:[e.jsx(Fe,{sx:{mr:1}})," Upload Videos",e.jsx("input",{hidden:!0,multiple:!0,type:"file",accept:"video/*",onChange:t=>k(Array.from(t.target.files))})]}),A.map((t,i)=>e.jsxs(l,{sx:{mb:2},children:[e.jsx("video",{src:URL.createObjectURL(t),controls:!0,style:{width:260,borderRadius:8}}),e.jsx(y,{color:"error",onClick:()=>k(s=>s.filter((u,n)=>n!==i)),children:e.jsx(ce,{})})]},i)),e.jsxs(v,{component:"label",variant:"outlined",sx:{mb:2},children:[e.jsx(de,{sx:{mr:1}})," Upload Video Thumbnail",e.jsx("input",{hidden:!0,type:"file",accept:"image/*",onChange:t=>D(t.target.files[0])})]}),g&&e.jsxs(l,{sx:{mb:3},children:[e.jsx(c,{variant:"caption",children:"Video Thumbnail Preview"}),e.jsx("img",{src:URL.createObjectURL(g),style:{width:160,height:100,objectFit:"cover",borderRadius:8,display:"block",marginTop:8}})]}),e.jsx(L,{fullWidth:!0,label:"Video Link (YouTube / Vimeo)",value:S,onChange:t=>B(t.target.value),sx:{mb:3}})]}),e.jsx(v,{fullWidth:!0,variant:"contained",sx:{bgcolor:N,py:1.4},onClick:we,children:V?"Update Portfolio":"Add Portfolio"})]})}),e.jsxs(he,{value:f,onChange:(t,i)=>fe(i),sx:{mb:2},children:[e.jsx(R,{label:"Images"}),e.jsx(R,{label:"Videos"})]}),e.jsx(Ae,{component:Pe,sx:{borderRadius:3,width:"100%"},children:e.jsxs(Be,{children:[e.jsx(Oe,{sx:{bgcolor:"#fdeaea"},children:e.jsxs(q,{children:[e.jsx(a,{children:"Work"}),e.jsx(a,{children:"Preview"}),e.jsx(a,{align:"center",children:"Count"}),e.jsx(a,{align:"right",children:"Action"})]})}),e.jsxs(De,{children:[le.length===0&&e.jsx(q,{children:e.jsx(a,{colSpan:4,align:"center",children:e.jsx(c,{color:"text.secondary",children:"No portfolio items found"})})}),le.map(t=>{var u,n,j,d,ae;const i=t.media.find(h=>h.type==="image"),s=t.media.find(h=>h.type==="video"||h.type==="videoLink");return e.jsxs(q,{hover:!0,children:[e.jsxs(a,{children:[e.jsx(c,{fontWeight:600,children:t.workTitle}),e.jsx(c,{variant:"caption",color:"text.secondary",children:t.description})]}),e.jsxs(a,{children:[f===0&&i&&e.jsx("img",{src:`${r}/${i.thumbnail}`,style:{width:70,height:70,borderRadius:10,cursor:"pointer",objectFit:"cover"},onClick:()=>{ve(i.gallery||[]),oe(0),O(!0)}}),f===1&&s&&e.jsxs(l,{sx:{cursor:"pointer"},onClick:()=>{var re,ne;const h=(re=s.videos)!=null&&re[0]?`${r}/${s.videos[0]}`:(ne=s.videoLinks)==null?void 0:ne[0];Te(h),_(!0)},children:[s.thumbnail&&e.jsx("img",{src:`${r}/${s.thumbnail}`,alt:"video thumbnail",style:{width:80,height:60,objectFit:"cover",borderRadius:6}}),!((u=s.videos)!=null&&u.length)&&((n=s.videoLinks)==null?void 0:n[0])&&e.jsx("img",{src:Ce(s.videoLinks[0])||"/video-placeholder.png",alt:"video thumbnail",style:{width:80,height:60,objectFit:"cover",borderRadius:6}})]})]}),e.jsx(a,{align:"center",children:f===0?((j=i==null?void 0:i.gallery)==null?void 0:j.length)||0:(((d=s==null?void 0:s.videos)==null?void 0:d.length)||0)+(((ae=s==null?void 0:s.videoLinks)==null?void 0:ae.length)||0)}),e.jsx(a,{align:"right",children:e.jsxs(l,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[e.jsx(y,{size:"small",color:"primary",onClick:()=>Se(t),children:e.jsx(Ue,{})}),e.jsx(y,{size:"small",color:"error",onClick:()=>ke(t._id),children:e.jsx(ce,{})})]})})]},t._id)})]})]})}),e.jsx(ue,{open:je,onClose:()=>O(!1),fullScreen:!0,children:e.jsxs(l,{sx:{bgcolor:"#000",height:"100vh",p:2},children:[e.jsx(y,{onClick:()=>O(!1),sx:{color:"#fff"},children:e.jsx(xe,{})}),e.jsx(l,{sx:{textAlign:"center",mt:2},children:e.jsx("img",{src:`${r}/${ie[se]}`,style:{maxHeight:"70vh",maxWidth:"100%"}})}),e.jsx(Ee,{sx:{my:2,bgcolor:"#333"}}),e.jsx(l,{sx:{display:"flex",justifyContent:"center",gap:1},children:ie.map((t,i)=>e.jsx("img",{src:`${r}/${t}`,onClick:()=>oe(i),style:{width:60,height:60,borderRadius:8,border:se===i?"2px solid #fff":"1px solid #444",cursor:"pointer"}},i))})]})}),e.jsx(ue,{open:ye,onClose:()=>_(!1),fullScreen:!0,children:e.jsxs(l,{sx:{bgcolor:"#000",height:"100vh",p:2},children:[e.jsx(y,{onClick:()=>_(!1),sx:{color:"#fff"},children:e.jsx(xe,{})}),e.jsx(l,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"80%"},children:b!=null&&b.includes("http")?e.jsx("iframe",{src:b,width:"80%",height:"80%",frameBorder:"0",allowFullScreen:!0}):e.jsx("video",{src:b,controls:!0,style:{maxWidth:"80%"}})})]})}),pe&&e.jsx(Ve,{})]})}export{Je as default};
