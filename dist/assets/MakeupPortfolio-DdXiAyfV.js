import{r,h as je,j as e,B as o,x as ve,p as ye,M as Te,T as m,s as v,g as p,b as y,aq as se,a8 as Ce,a9 as ie,D as we,t as Se}from"./index-CFKf5kR9.js";import{T as re,a as T}from"./Tabs-C705m81l.js";import{C as oe}from"./CloudUpload-laANkked.js";import{C as ke,V as Le}from"./VideoLibrary-BDA_pE_2.js";import{T as Re}from"./TableContainer-DAXyTT63.js";import{T as Ie,a as V,b as a,c as Ue}from"./TableRow-DppFVgW_.js";import{T as Pe}from"./TableHead-CJOI71U9.js";import{C as ae}from"./Close-hVkCq3Wm.js";const n="https://api.bookmyevent.ae",C=je.create({baseURL:n}),$="#e53935";function Be(){const w=JSON.parse(localStorage.getItem("user")||"{}"),d=w==null?void 0:w._id,g=localStorage.getItem("moduleId"),[W,le]=r.useState(!1),[ne,A]=r.useState(!1),[c,de]=r.useState(0),[S,F]=r.useState(""),[D,E]=r.useState(""),[O,B]=r.useState(""),[f,_]=r.useState(null),[q,G]=r.useState([]),[k,L]=r.useState([]),[b,N]=r.useState(""),[u,H]=r.useState(null),[h,ce]=r.useState(0),[J,ue]=r.useState([]),[he,R]=r.useState(!1),[Y,xe]=r.useState([]),[z,K]=r.useState(0),[me,I]=r.useState(!1),[x,pe]=r.useState("");r.useEffect(()=>{!d||!g||C.get(`/api/subscription/status/${d}?moduleId=${g}`).then(t=>{var i;const s=(i=t.data)==null?void 0:i.subscription;le((s==null?void 0:s.status)==="active"&&(s==null?void 0:s.isCurrent))})},[d,g]);const U=async()=>{const t=await C.get(`/api/portfolio/provider/${d}`);ue(t.data.data||[])};r.useEffect(()=>{U()},[]);const ge=t=>{if(!t)return null;const s=t.match(/(?:youtube\.com\/.*v=|youtu\.be\/)([^&]+)/);return s?`https://img.youtube.com/vi/${s[1]}/hqdefault.jpg`:null},fe=async()=>{if(!W)return alert("Upgrade plan required");if(!S.trim())return alert("Title required");if(c===1){if(!k.length&&!b)return alert("Please upload a video or add a video link");if(!u)return alert("Video thumbnail is required")}const t=new FormData;if(t.append("providerId",d),t.append("module",g),t.append("workTitle",S),t.append("description",D),t.append("tags",O),c===0){if(!f)return alert("Thumbnail required");t.append("thumbnail",f),q.forEach(s=>t.append("images",s))}else k.forEach(s=>t.append("videos",s)),b&&t.append("videoLinks",JSON.stringify([b])),u&&t.append("videoThumbnail",u);A(!0),await C.post("/api/portfolio",t),A(!1),F(""),E(""),B(""),_(null),G([]),L([]),N(""),H(null),U()},be=async t=>{window.confirm("Delete portfolio?")&&(await C.delete(`/api/portfolio/${t}`),U())},Q=h===0?J.filter(t=>{var s;return(s=t.media)==null?void 0:s.some(i=>i.type==="image")}):J.filter(t=>{var s;return(s=t.media)==null?void 0:s.some(i=>i.type==="video"||i.type==="videoLink")});return e.jsxs(o,{sx:{p:3,maxWidth:1800,mx:"auto"},children:[!W&&e.jsx(ve,{severity:"warning",sx:{mb:3},children:"Upgrade to premium to add portfolio works"}),e.jsx(ye,{sx:{mb:5,borderRadius:3,width:"100%"},children:e.jsxs(Te,{children:[e.jsx(m,{variant:"h5",fontWeight:700,mb:2,children:"Add Portfolio Work"}),e.jsxs(re,{value:c,onChange:(t,s)=>de(s),sx:{mb:3},children:[e.jsx(T,{label:"Images"}),e.jsx(T,{label:"Videos"})]}),e.jsx(v,{fullWidth:!0,label:"Title",value:S,onChange:t=>F(t.target.value),sx:{mb:3}}),e.jsx(v,{fullWidth:!0,multiline:!0,rows:3,label:"Description",value:D,onChange:t=>E(t.target.value),sx:{mb:3}}),e.jsx(v,{fullWidth:!0,label:"Tags",value:O,onChange:t=>B(t.target.value),sx:{mb:4}}),c===0&&e.jsxs(e.Fragment,{children:[e.jsxs(p,{component:"label",variant:"contained",sx:{bgcolor:$,mb:2},children:[e.jsx(oe,{sx:{mr:1}})," Upload Thumbnail",e.jsx("input",{hidden:!0,type:"file",accept:"image/*",onChange:t=>_(t.target.files[0])})]}),f&&e.jsx(o,{sx:{mb:3},children:e.jsx("img",{src:URL.createObjectURL(f),style:{width:180,height:180,borderRadius:12}})}),e.jsxs(p,{component:"label",variant:"outlined",sx:{mb:2},children:[e.jsx(ke,{sx:{mr:1}})," Upload Gallery Images",e.jsx("input",{hidden:!0,multiple:!0,type:"file",accept:"image/*",onChange:t=>G([...t.target.files])})]}),e.jsx(o,{sx:{display:"flex",gap:2,flexWrap:"wrap",mb:4},children:q.map((t,s)=>e.jsx("img",{src:URL.createObjectURL(t),style:{width:100,height:100,borderRadius:10}},s))})]}),c===1&&e.jsxs(e.Fragment,{children:[e.jsxs(p,{component:"label",variant:"contained",sx:{bgcolor:$,mb:2},children:[e.jsx(Le,{sx:{mr:1}})," Upload Videos",e.jsx("input",{hidden:!0,multiple:!0,type:"file",accept:"video/*",onChange:t=>L(Array.from(t.target.files))})]}),k.map((t,s)=>e.jsxs(o,{sx:{mb:2},children:[e.jsx("video",{src:URL.createObjectURL(t),controls:!0,style:{width:260,borderRadius:8}}),e.jsx(y,{color:"error",onClick:()=>L(i=>i.filter((P,j)=>j!==s)),children:e.jsx(se,{})})]},s)),e.jsxs(p,{component:"label",variant:"outlined",sx:{mb:2},children:[e.jsx(oe,{sx:{mr:1}})," Upload Video Thumbnail",e.jsx("input",{hidden:!0,type:"file",accept:"image/*",onChange:t=>H(t.target.files[0])})]}),u&&e.jsxs(o,{sx:{mb:3},children:[e.jsx(m,{variant:"caption",children:"Video Thumbnail Preview"}),e.jsx("img",{src:URL.createObjectURL(u),style:{width:160,height:100,objectFit:"cover",borderRadius:8,display:"block",marginTop:8}})]}),e.jsx(v,{fullWidth:!0,label:"Video Link (YouTube / Vimeo)",value:b,onChange:t=>N(t.target.value),sx:{mb:3}})]}),e.jsx(p,{fullWidth:!0,variant:"contained",sx:{bgcolor:$,py:1.4},onClick:fe,children:"Add Portfolio"})]})}),e.jsxs(re,{value:h,onChange:(t,s)=>ce(s),sx:{mb:2},children:[e.jsx(T,{label:"Images"}),e.jsx(T,{label:"Videos"})]}),e.jsx(Re,{component:Ce,sx:{borderRadius:3,width:"100%"},children:e.jsxs(Ie,{children:[e.jsx(Pe,{sx:{bgcolor:"#fdeaea"},children:e.jsxs(V,{children:[e.jsx(a,{children:"Work"}),e.jsx(a,{children:"Preview"}),e.jsx(a,{align:"center",children:"Count"}),e.jsx(a,{align:"right",children:"Action"})]})}),e.jsxs(Ue,{children:[Q.length===0&&e.jsx(V,{children:e.jsx(a,{colSpan:4,align:"center",children:e.jsx(m,{color:"text.secondary",children:"No portfolio items found"})})}),Q.map(t=>{var P,j,X,Z,M;const s=t.media.find(l=>l.type==="image"),i=t.media.find(l=>l.type==="video"||l.type==="videoLink");return e.jsxs(V,{hover:!0,children:[e.jsxs(a,{children:[e.jsx(m,{fontWeight:600,children:t.workTitle}),e.jsx(m,{variant:"caption",color:"text.secondary",children:t.description})]}),e.jsxs(a,{children:[h===0&&s&&e.jsx("img",{src:`${n}/${s.thumbnail}`,style:{width:70,height:70,borderRadius:10,cursor:"pointer",objectFit:"cover"},onClick:()=>{xe(s.gallery||[]),K(0),R(!0)}}),h===1&&i&&e.jsxs(o,{sx:{cursor:"pointer"},onClick:()=>{var ee,te;const l=(ee=i.videos)!=null&&ee[0]?`${n}/${i.videos[0]}`:(te=i.videoLinks)==null?void 0:te[0];pe(l),I(!0)},children:[i.thumbnail&&e.jsx("img",{src:`${n}/${i.thumbnail}`,alt:"video thumbnail",style:{width:80,height:60,objectFit:"cover",borderRadius:6}}),!((P=i.videos)!=null&&P.length)&&((j=i.videoLinks)==null?void 0:j[0])&&e.jsx("img",{src:ge(i.videoLinks[0])||"/video-placeholder.png",alt:"video thumbnail",style:{width:80,height:60,objectFit:"cover",borderRadius:6}})]})]}),e.jsx(a,{align:"center",children:h===0?((X=s==null?void 0:s.gallery)==null?void 0:X.length)||0:(((Z=i==null?void 0:i.videos)==null?void 0:Z.length)||0)+(((M=i==null?void 0:i.videoLinks)==null?void 0:M.length)||0)}),e.jsx(a,{align:"right",children:e.jsx(y,{color:"error",onClick:()=>be(t._id),children:e.jsx(se,{})})})]},t._id)})]})]})}),e.jsx(ie,{open:he,onClose:()=>R(!1),fullScreen:!0,children:e.jsxs(o,{sx:{bgcolor:"#000",height:"100vh",p:2},children:[e.jsx(y,{onClick:()=>R(!1),sx:{color:"#fff"},children:e.jsx(ae,{})}),e.jsx(o,{sx:{textAlign:"center",mt:2},children:e.jsx("img",{src:`${n}/${Y[z]}`,style:{maxHeight:"70vh",maxWidth:"100%"}})}),e.jsx(we,{sx:{my:2,bgcolor:"#333"}}),e.jsx(o,{sx:{display:"flex",justifyContent:"center",gap:1},children:Y.map((t,s)=>e.jsx("img",{src:`${n}/${t}`,onClick:()=>K(s),style:{width:60,height:60,borderRadius:8,border:z===s?"2px solid #fff":"1px solid #444",cursor:"pointer"}},s))})]})}),e.jsx(ie,{open:me,onClose:()=>I(!1),fullScreen:!0,children:e.jsxs(o,{sx:{bgcolor:"#000",height:"100vh",p:2},children:[e.jsx(y,{onClick:()=>I(!1),sx:{color:"#fff"},children:e.jsx(ae,{})}),e.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"80%"},children:x!=null&&x.includes("http")?e.jsx("iframe",{src:x,width:"80%",height:"80%",frameBorder:"0",allowFullScreen:!0}):e.jsx("video",{src:x,controls:!0,style:{maxWidth:"80%"}})})]})}),ne&&e.jsx(Se,{})]})}export{Be as default};
