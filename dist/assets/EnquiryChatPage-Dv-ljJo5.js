import{aj as _,w as z,r as n,j as t,B as o,x as R,a8 as E,S,b as y,ak as W,q as M,T as f,t as N,s as B,h as T}from"./index-BVtIu8_J.js";import{S as A}from"./Send-BXjMV8ap.js";import{C as I}from"./ChatBubbleOutline-Bh9bwRfP.js";import{s as d}from"./socket-BpXQx-Y7.js";const L=()=>{var j,v;const w=_(),x=z(),e=(j=w.state)==null?void 0:j.enquiry,[l,b]=n.useState(""),[g,p]=n.useState([]),[C,h]=n.useState(!0),m=n.useRef(null),s=JSON.parse(localStorage.getItem("user"))||{},c=(s==null?void 0:s.providerId)||(s==null?void 0:s._id);n.useEffect(()=>{e!=null&&e._id||x("/venue/enquiries")},[e==null?void 0:e._id,x]),n.useEffect(()=>{if(!(e!=null&&e._id))return;(async()=>{var i;try{h(!0);const r=await T.get(`https://api.bookmyevent.ae/api/enquiries/${e._id}/messages`);p(((i=r.data)==null?void 0:i.data)||[])}catch(r){console.error("Failed to fetch messages:",r),p([])}finally{h(!1)}})()},[e==null?void 0:e._id]),n.useEffect(()=>{if(!(e!=null&&e._id)||!c)return;d.connected||d.connect(),d.emit("join_enquiry",{enquiryId:e._id,vendorId:c});const a=i=>{p(r=>r.some(k=>k.timestamp===i.timestamp&&k.senderId===i.senderId)?r:[...r,i])};return d.on("receive_message",a),()=>{d.off("receive_message",a)}},[e==null?void 0:e._id,c]),n.useEffect(()=>{var a;(a=m.current)==null||a.scrollIntoView({behavior:"smooth"})},[g]);const u=()=>{if(!l.trim()||!(e!=null&&e._id))return;const a={enquiryId:e._id,senderId:c,senderName:(s==null?void 0:s.businessName)||(s==null?void 0:s.name)||"Vendor",senderRole:"vendor",text:l,timestamp:new Date().toISOString()};d.emit("send_message",a),b("")};return e!=null&&e._id?t.jsx(o,{sx:{minHeight:"100vh",background:"linear-gradient(135deg, #f5f9fb 0%, #eef5f8 100%)",display:"flex",justifyContent:"center",alignItems:"center",p:2,position:"relative",overflow:"hidden"},children:t.jsxs(E,{elevation:0,sx:{width:"100%",maxWidth:900,height:"85vh",display:"flex",flexDirection:"column",borderRadius:"16px",overflow:"hidden",background:"#fff",border:"1px solid rgba(26, 188, 156, 0.15)",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(26, 188, 156, 0.1)",position:"relative",zIndex:1,animation:"slideIn 0.6s ease-out","@keyframes slideIn":{from:{opacity:0,transform:"translateY(20px)"},to:{opacity:1,transform:"translateY(0)"}}},children:[t.jsx(o,{sx:{px:3,py:2.5,background:"linear-gradient(135deg, #16a085 0%, #1abc9c 100%)",color:"#fff",position:"relative",borderBottom:"1px solid rgba(26, 188, 156, 0.3)"},children:t.jsxs(S,{direction:"row",alignItems:"center",spacing:2,children:[t.jsx(y,{onClick:()=>x("/venue/enquiries"),sx:{color:"#fff",transition:"all 0.3s ease","&:hover":{bgcolor:"rgba(255, 255, 255, 0.15)",transform:"translateX(-4px)"}},size:"small",children:t.jsx(W,{})}),t.jsx(M,{sx:{bgcolor:"#4ecdc4",fontWeight:700,fontSize:"1.2rem",color:"#fff",width:44,height:44},children:((v=e.fullName)==null?void 0:v.charAt(0))||"C"}),t.jsxs(o,{flex:1,children:[t.jsx(f,{fontWeight:700,sx:{fontSize:"1.1rem",letterSpacing:"0.3px"},children:e.fullName||"Customer"}),t.jsx(f,{variant:"caption",sx:{opacity:.85,fontWeight:500,letterSpacing:"0.2px"},children:"Venue Enquiry"})]})]})}),t.jsxs(o,{sx:{flex:1,overflowY:"auto",background:"linear-gradient(180deg, #f8fbfc 0%, #f5f9fb 100%)",p:3,display:"flex",flexDirection:"column",gap:2,position:"relative","&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{background:"transparent"},"&::-webkit-scrollbar-thumb":{background:"rgba(26, 188, 156, 0.25)",borderRadius:"4px","&:hover":{background:"rgba(26, 188, 156, 0.4)"}}},children:[C?t.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:t.jsx(N,{sx:{color:"#1abc9c"}})}):g.length===0?t.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:t.jsxs(S,{alignItems:"center",spacing:2,children:[t.jsx(I,{sx:{fontSize:"4rem",color:"rgba(26, 188, 156, 0.25)"}}),t.jsx(f,{sx:{color:"rgba(0, 0, 0, 0.45)",fontSize:"1rem",letterSpacing:"0.3px",fontWeight:500},children:"No messages yet. Start the conversation!"})]})}):g.map((a,i)=>{const r=a.senderId===c;return t.jsx(o,{display:"flex",justifyContent:r?"flex-end":"flex-start",sx:{animation:`fadeIn 0.3s ease-out ${i*.05}s both`,"@keyframes fadeIn":{from:{opacity:0,transform:r?"translateX(10px)":"translateX(-10px)"},to:{opacity:1,transform:"translateX(0)"}}},children:t.jsxs(o,{sx:{px:2.5,py:1.5,maxWidth:"65%",borderRadius:r?"16px 4px 16px 16px":"4px 16px 16px 16px",background:r?"linear-gradient(135deg, #1abc9c 0%, #16a085 100%)":"#e8f5f3",border:r?"1px solid rgba(26, 188, 156, 0.3)":"1px solid rgba(26, 188, 156, 0.2)",boxShadow:r?"0 4px 12px rgba(26, 188, 156, 0.2)":"0 2px 8px rgba(0, 0, 0, 0.05)",transition:"all 0.3s ease","&:hover":{transform:"translateY(-2px)",boxShadow:r?"0 8px 20px rgba(26, 188, 156, 0.3)":"0 4px 12px rgba(0, 0, 0, 0.1)"}},children:[t.jsx(f,{variant:"body2",sx:{wordBreak:"break-word",color:r?"#fff":"#1a1a1a",fontWeight:500,lineHeight:1.6,fontSize:"0.95rem"},children:a.text}),t.jsx(f,{variant:"caption",sx:{display:"block",textAlign:"right",opacity:r?.85:.65,mt:.8,fontSize:"0.75rem",color:r?"rgba(255, 255, 255, 0.9)":"rgba(0, 0, 0, 0.6)",fontWeight:500},children:new Date(a.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},i)}),t.jsx("div",{ref:m})]}),t.jsxs(o,{sx:{p:2.5,background:"#fff",borderTop:"1px solid rgba(26, 188, 156, 0.15)",display:"flex",gap:1.5,alignItems:"center"},children:[t.jsx(I,{sx:{color:"rgba(26, 188, 156, 0.6)",transition:"color 0.3s ease",fontSize:"1.3rem"}}),t.jsx(B,{fullWidth:!0,size:"small",placeholder:"Type a message...",value:l,onChange:a=>b(a.target.value),onKeyDown:a=>a.key==="Enter"&&u(),sx:{"& .MuiOutlinedInput-root":{color:"#1a1a1a",borderRadius:"24px",background:"#f8fbfc",border:"1.5px solid rgba(26, 188, 156, 0.3)",transition:"all 0.3s ease","& fieldset":{borderColor:"rgba(26, 188, 156, 0.3)"},"&:hover":{background:"#f0f9f8",borderColor:"rgba(26, 188, 156, 0.4)"},"&.Mui-focused":{background:"#ecf8f7",borderColor:"rgba(26, 188, 156, 0.7)",boxShadow:"0 0 12px rgba(26, 188, 156, 0.15)","& fieldset":{borderColor:"rgba(26, 188, 156, 0.7)"}}},"& .MuiOutlinedInput-input":{fontSize:"0.95rem",fontWeight:500,"&::placeholder":{color:"rgba(0, 0, 0, 0.4)",opacity:1}}}}),t.jsx(y,{onClick:u,disabled:!l.trim(),sx:{background:l.trim()?"linear-gradient(135deg, #1abc9c 0%, #16a085 100%)":"rgba(26, 188, 156, 0.15)",color:l.trim()?"#fff":"rgba(26, 188, 156, 0.3)",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",borderRadius:"12px",padding:"12px","&:hover":l.trim()?{background:"linear-gradient(135deg, #1c9d8f 0%, #179079 100%)",boxShadow:"0 6px 16px rgba(26, 188, 156, 0.3)",transform:"scale(1.05)"}:{},"&:disabled":{cursor:"not-allowed"}},children:t.jsx(A,{sx:{fontSize:"1.3rem"}})})]})]})}):t.jsx(o,{p:4,sx:{minHeight:"100vh",background:"linear-gradient(135deg, #f5f9fb 0%, #eef5f8 100%)",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx(R,{severity:"warning",sx:{bgcolor:"rgba(255, 193, 7, 0.1)",color:"#f57f17",border:"1px solid rgba(255, 193, 7, 0.3)"},children:"No enquiry selected. Redirecting..."})})};export{L as default};
