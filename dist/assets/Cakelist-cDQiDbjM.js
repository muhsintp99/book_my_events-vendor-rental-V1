import{c as Te,j as e,r as o,B as m,ap as Re,aq as Ve,T as r,g,ad as ye,S as j,s as He,a as Me,F as Ue,ag as Ge,$ as be,t as Oe,a9 as y,al as qe,bb as _,b as E,V as Qe,ar as Ye,ab as Ce,ac as ke,p as Ie,q as F,G as p,b9 as Je,D as A,ao as Ke,x as Xe}from"./index-DNjBYNR0.js";import{A as Ze}from"./Add-CZjfXzoc.js";import{S as et}from"./Search-KXAB1rI4.js";import{R as tt,D as st}from"./Refresh-Dd9TN9Uo.js";import{T as at}from"./TableContainer-CRHmGj98.js";import{T as rt,a as it,b as T,c as n,d as nt}from"./TableRow-c_ccnKy0.js";import{E as ot}from"./Edit-D7Ua6pVl.js";import{D as Se}from"./DialogTitle-DDqkk7ER.js";import{C as lt}from"./Close-t5CCXanm.js";import{C as ct}from"./CardMedia-Bjzw5tSn.js";import{I as dt}from"./Image-DBhin1zW.js";import{C as xt}from"./Category-De119AOt.js";import{R as ht}from"./Restaurant-XAEhklrE.js";import{S as mt}from"./Schedule-BbJ94RJX.js";import{C as pt}from"./CheckCircle-BNIgTjSb.js";import{I as ut}from"./Info-CcoJKSKq.js";import{A as we}from"./AttachMoney-DwuvHqwN.js";import{L as gt}from"./LocalOffer-n3ta_kZt.js";import{D as Ee}from"./DialogActions-CaV5HgU7.js";import{D as jt}from"./DialogContentText-HlfMJJpi.js";import{S as ft}from"./Skeleton-CmyPNgvv.js";const Ae=Te(e.jsx("path",{d:"M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12z"})),vt=Te(e.jsx("path",{d:"m23 12-2.44-2.79.34-3.69-3.61-.82-1.89-3.2L12 2.96 8.6 1.5 6.71 4.69 3.1 5.5l.34 3.7L1 12l2.44 2.79-.34 3.7 3.61.82L8.6 22.5l3.4-1.47 3.4 1.46 1.89-3.19 3.61-.82-.34-3.69zm-12.91 4.72-3.8-3.81 1.48-1.48 2.32 2.33 5.85-5.87 1.48 1.48z"})),R="https://api.bookmyevent.ae/api/cakes";function Vt(){var O,q,Q,Y,J,K,X,Z,ee,te,se,ae,re,ie,ne,oe,le,ce,de,xe,he,me,pe,ue;const[f,D]=o.useState([]),[V,P]=o.useState(!0),[C,u]=o.useState({open:!1,message:"",severity:"success"}),[v,H]=o.useState({search:"",category:""}),[L,De]=o.useState(""),[Pe,k]=o.useState(!1),[Le,I]=o.useState(!1),[s,We]=o.useState(null),[M,U]=o.useState(null),[S,G]=o.useState(0),b=localStorage.getItem("token"),W=JSON.parse(localStorage.getItem("vendor")||localStorage.getItem("user")||"{}"),z=W==null?void 0:W._id,N=t=>t?t.startsWith("http")?t:`https://api.bookmyevent.ae/${t.startsWith("/")?t.slice(1):t}`:null,ze=({src:t,alt:a,title:i})=>{var w;const[c,d]=o.useState(!1),[l,h]=o.useState(!0);return!t||c?e.jsx(F,{variant:"rounded",sx:{width:70,height:70,bgcolor:"#E91E63",fontSize:"1.8rem",fontWeight:"bold",color:"white"},children:((w=i==null?void 0:i[0])==null?void 0:w.toUpperCase())||"C"}):e.jsxs(m,{sx:{position:"relative"},children:[l&&e.jsx(ft,{variant:"rectangular",width:70,height:70,sx:{borderRadius:2}}),e.jsx(F,{variant:"rounded",src:t,alt:a,sx:{width:70,height:70,borderRadius:2,display:l?"none":"block"},imgProps:{onLoad:()=>h(!1),onError:()=>{d(!0),h(!1)}}})]})},$=o.useCallback(async()=>{if(!z||!b){u({open:!0,message:"Please login again",severity:"error"}),P(!1);return}P(!0);try{const t=await fetch(`${R}/provider/${z}`,{headers:{Authorization:`Bearer ${b}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to load cake packages");const a=await t.json();a.success&&D(a.data||[])}catch(t){u({open:!0,message:t.message,severity:"error"})}finally{P(!1)}},[z,b]);o.useEffect(()=>{$()},[$]),o.useEffect(()=>{const t=setTimeout(()=>H(a=>({...a,search:L})),400);return()=>clearTimeout(t)},[L]);const Ne=t=>{We(t),G(0),k(!0)},$e=async(t,a)=>{try{(await(await fetch(`${R}/${t}/toggle-active`,{method:"PATCH",headers:{Authorization:`Bearer ${b}`}})).json()).success&&(D(d=>d.map(l=>l._id===t?{...l,isActive:!a}:l)),u({open:!0,message:"Status updated",severity:"success"}))}catch{u({open:!0,message:"Failed to update status",severity:"error"})}},Be=async()=>{try{(await(await fetch(`${R}/${M}`,{method:"DELETE",headers:{Authorization:`Bearer ${b}`}})).json()).success&&(D(i=>i.filter(c=>c._id!==M)),u({open:!0,message:"Cake package deleted",severity:"success"}))}catch{u({open:!0,message:"Delete failed",severity:"error"})}finally{I(!1),U(null)}},B=o.useMemo(()=>f.filter(t=>{var c,d;const a=!v.search||((c=t.name)==null?void 0:c.toLowerCase().includes(v.search.toLowerCase())),i=!v.category||((d=t.category)==null?void 0:d._id)===v.category;return a&&i}),[f,v]),_e=o.useMemo(()=>{const t=new Map;return f.forEach(a=>{a.category&&t.set(a.category._id,a.category)}),Array.from(t.values())},[f]),Fe=()=>{const t=["No","Name","Category","Type","Unit Price","Final Price","Status"],a=B.map((h,w)=>{var ge,je,fe,ve;return[w+1,h.name||"",((ge=h.category)==null?void 0:ge.title)||"",h.itemType||"",((je=h.priceInfo)==null?void 0:je.unitPrice)||0,((fe=h.priceInfo)==null?void 0:fe.unitPrice)-(((ve=h.priceInfo)==null?void 0:ve.discount)||0)||0,h.isActive?"Active":"Inactive"]}),i=[t.join(","),...a.map(h=>h.join(","))].join(`
`),c=new Blob([i],{type:"text/csv"}),d=URL.createObjectURL(c),l=document.createElement("a");l.href=d,l.download=`cake_packages_${new Date().toISOString().slice(0,10)}.csv`,l.click()},x=({icon:t,label:a,value:i,chip:c,success:d,error:l})=>e.jsxs(m,{sx:{display:"flex",alignItems:"flex-start",gap:2,py:1.5,borderBottom:"1px solid #f0f0f0"},children:[e.jsx(m,{sx:{color:"#E91E63",mt:.5},children:t}),e.jsxs(m,{sx:{flex:1},children:[e.jsx(r,{variant:"caption",color:"text.secondary",sx:{fontWeight:500},children:a}),c?e.jsx(y,{label:i,size:"small",color:d?"success":l?"error":"default",sx:{mt:.5}}):e.jsx(r,{variant:"body2",sx:{fontWeight:500,mt:.3},children:i||"Not specified"})]})]});return e.jsxs(m,{sx:{bgcolor:"#fafafa",minHeight:"100vh",p:3},children:[e.jsx(Re,{position:"static",color:"transparent",elevation:0,children:e.jsxs(Ve,{children:[e.jsxs(r,{variant:"h5",sx:{flexGrow:1,fontWeight:600},children:["My Cake Packages (",f.length,")"]}),e.jsx(g,{variant:"contained",startIcon:e.jsx(Ze,{}),sx:{bgcolor:"#E91E63","&:hover":{bgcolor:"#c2185b"}},onClick:()=>window.location.href="/cake/addpackage",children:"Add New Package"})]})}),e.jsx(ye,{sx:{p:2,mt:3},children:e.jsxs(j,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"center",children:[e.jsx(He,{size:"small",placeholder:"Search cake packages...",value:L,onChange:t=>De(t.target.value),InputProps:{startAdornment:e.jsx(Me,{position:"start",children:e.jsx(et,{})})},sx:{width:{xs:"100%",sm:300}}}),e.jsx(Ue,{size:"small",sx:{minWidth:180},children:e.jsxs(Ge,{value:v.category,onChange:t=>H(a=>({...a,category:t.target.value})),displayEmpty:!0,children:[e.jsx(be,{value:"",children:"All Categories"}),_e.map(t=>e.jsx(be,{value:t._id,children:t.title},t._id))]})}),e.jsxs(m,{sx:{ml:"auto",gap:1,display:"flex"},children:[e.jsx(g,{variant:"outlined",startIcon:e.jsx(tt,{}),onClick:$,children:"Refresh"}),e.jsx(g,{variant:"outlined",startIcon:e.jsx(st,{}),onClick:Fe,children:"Export CSV"})]})]})}),e.jsx(ye,{sx:{mt:3},children:e.jsx(at,{sx:{maxHeight:"70vh"},children:e.jsxs(rt,{stickyHeader:!0,children:[e.jsx(it,{children:e.jsxs(T,{sx:{bgcolor:"#f8f9fa"},children:[e.jsx(n,{children:"#"}),e.jsx(n,{children:"Image"}),e.jsx(n,{children:"Cake Name"}),e.jsx(n,{children:"Category"}),e.jsx(n,{children:"Type"}),e.jsx(n,{align:"right",children:"Price"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Actions"})]})}),e.jsxs(nt,{children:[V&&e.jsx(T,{children:e.jsx(n,{colSpan:8,align:"center",children:e.jsx(Oe,{})})}),!V&&B.length===0&&e.jsx(T,{children:e.jsxs(n,{colSpan:8,align:"center",sx:{py:8},children:[e.jsx(r,{variant:"h6",color:"text.secondary",children:f.length===0?"No cake packages created yet":"No packages match your search"}),e.jsx(g,{variant:"contained",sx:{mt:2,bgcolor:"#E91E63"},onClick:()=>window.location.href="/cake/addpackage",children:"Create Your First Cake Package"})]})}),B.map((t,a)=>{var i,c,d,l;return e.jsxs(T,{hover:!0,children:[e.jsx(n,{children:a+1}),e.jsx(n,{children:e.jsx(ze,{src:N(t.thumbnail),alt:t.name,title:t.name})}),e.jsx(n,{children:e.jsx(r,{fontWeight:"medium",children:t.name})}),e.jsx(n,{children:e.jsx(y,{label:((i=t.category)==null?void 0:i.title)||"N/A",size:"small",color:"primary",variant:"outlined"})}),e.jsx(n,{children:e.jsx(y,{label:t.itemType||"N/A",size:"small",color:t.itemType==="Veg"?"success":"error"})}),e.jsxs(n,{align:"right",children:[e.jsxs(r,{fontWeight:"bold",color:"primary",children:["₹",(d=(c=t.priceInfo)==null?void 0:c.unitPrice)==null?void 0:d.toLocaleString()]}),((l=t.priceInfo)==null?void 0:l.discount)>0&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Discount: ₹",t.priceInfo.discount]})]}),e.jsx(n,{children:e.jsx(qe,{checked:t.isActive,onChange:()=>$e(t._id,t.isActive),color:"success"})}),e.jsx(n,{children:e.jsxs(j,{direction:"row",spacing:.5,children:[e.jsx(_,{title:"View Details",children:e.jsx(E,{size:"small",onClick:()=>Ne(t),children:e.jsx(Qe,{fontSize:"small"})})}),e.jsx(_,{title:"Edit Package",children:e.jsx(E,{size:"small",color:"primary",onClick:()=>{window.location.href=`/cake/addpackage?id=${t._id}`},children:e.jsx(ot,{fontSize:"small"})})}),e.jsx(_,{title:"Delete",children:e.jsx(E,{size:"small",color:"error",onClick:()=>{U(t._id),I(!0)},children:e.jsx(Ye,{fontSize:"small"})})})]})})]},t._id)})]})]})})}),e.jsxs(Ce,{open:Pe,onClose:()=>k(!1),maxWidth:"md",fullWidth:!0,scroll:"paper",children:[e.jsxs(Se,{sx:{bgcolor:"#E91E63",color:"white",pr:6},children:[e.jsx(r,{variant:"h6",children:s==null?void 0:s.name}),e.jsxs(r,{variant:"caption",sx:{opacity:.9},children:["ID: ",s==null?void 0:s.cakeId]}),e.jsx(E,{sx:{position:"absolute",right:8,top:8,color:"white"},onClick:()=>k(!1),children:e.jsx(lt,{})})]}),e.jsx(ke,{dividers:!0,sx:{p:0},children:s&&e.jsxs(m,{children:[e.jsxs(m,{sx:{bgcolor:"#1a1a1a",p:2},children:[e.jsx(m,{sx:{display:"flex",justifyContent:"center",mb:2},children:(O=s.images)!=null&&O[S]||s.thumbnail?e.jsx(Ie,{elevation:3,sx:{maxWidth:500},children:e.jsx(ct,{component:"img",height:"300",image:N(((q=s.images)==null?void 0:q[S])||s.thumbnail),alt:s.name,sx:{objectFit:"cover"}})}):e.jsx(m,{sx:{height:300,width:"100%",maxWidth:500,bgcolor:"#333",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:2},children:e.jsx(dt,{sx:{fontSize:80,color:"#666"}})})}),((Q=s.images)==null?void 0:Q.length)>1&&e.jsx(m,{sx:{display:"flex",gap:1,justifyContent:"center",flexWrap:"wrap"},children:s.images.map((t,a)=>e.jsx(F,{variant:"rounded",src:N(t),onClick:()=>G(a),sx:{width:60,height:60,cursor:"pointer",border:S===a?"3px solid #E91E63":"3px solid transparent",opacity:S===a?1:.7,"&:hover":{opacity:1}}},a))})]}),e.jsx(m,{sx:{p:3},children:e.jsxs(p,{container:!0,spacing:3,children:[e.jsxs(p,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"subtitle1",sx:{fontWeight:600,mb:2,color:"#E91E63"},children:"Basic Information"}),e.jsx(x,{icon:e.jsx(xt,{}),label:"Category",value:((Y=s.category)==null?void 0:Y.title)||"None"}),e.jsx(x,{icon:e.jsx(Ae,{}),label:"Sub Categories",value:((J=s.subCategories)==null?void 0:J.map(t=>t.title).join(", "))||"None"}),e.jsx(x,{icon:e.jsx(ht,{}),label:"Item Type",value:s.itemType,chip:!0,success:s.itemType==="Veg",error:s.itemType==="Non-Veg"}),e.jsx(x,{icon:e.jsx(vt,{}),label:"Halal Certified",value:s.isHalal?"Yes":"No",chip:!0,success:s.isHalal}),e.jsx(x,{icon:e.jsx(mt,{}),label:"Available Time",value:`${((K=s.timeSchedule)==null?void 0:K.startTime)||"N/A"} - ${((X=s.timeSchedule)==null?void 0:X.endTime)||"N/A"}`}),e.jsx(x,{icon:e.jsx(pt,{}),label:"Status",value:s.isActive?"Active":"Inactive",chip:!0,success:s.isActive,error:!s.isActive}),e.jsx(x,{icon:e.jsx(ut,{}),label:"Description",value:s.shortDescription})]}),e.jsxs(p,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"subtitle1",sx:{fontWeight:600,mb:2,color:"#E91E63"},children:"Pricing Information"}),e.jsx(x,{icon:e.jsx(we,{}),label:"Unit Price",value:`₹${(ee=(Z=s.priceInfo)==null?void 0:Z.unitPrice)==null?void 0:ee.toLocaleString()}`}),e.jsx(x,{icon:e.jsx(gt,{}),label:"Discount",value:(te=s.priceInfo)!=null&&te.discount?`₹${(ae=(se=s.priceInfo)==null?void 0:se.discount)==null?void 0:ae.toLocaleString()} (${(re=s.priceInfo)==null?void 0:re.discountType})`:"No discount"}),e.jsx(x,{icon:e.jsx(we,{}),label:"Final Price",value:e.jsxs(r,{sx:{color:"#E91E63",fontWeight:"bold"},children:["₹",(((ie=s.priceInfo)==null?void 0:ie.unitPrice)-(((ne=s.priceInfo)==null?void 0:ne.discount)||0)).toLocaleString()]})}),e.jsx(x,{icon:e.jsx(Je,{}),label:"Advance Booking Amount",value:(oe=s.priceInfo)!=null&&oe.advanceBookingAmount?`₹${(le=s.priceInfo)==null?void 0:le.advanceBookingAmount}`:"Not specified"}),e.jsx(x,{icon:e.jsx(Ae,{}),label:"Max Purchase Qty",value:((ce=s.priceInfo)==null?void 0:ce.maxPurchaseQty)||"No limit"})]}),((de=s.variations)==null?void 0:de.length)>0&&e.jsxs(p,{item:!0,xs:12,children:[e.jsx(A,{sx:{my:2}}),e.jsx(r,{variant:"subtitle1",sx:{fontWeight:600,mb:2,color:"#E91E63"},children:"Available Variations"}),e.jsx(j,{direction:"row",spacing:2,flexWrap:"wrap",useFlexGap:!0,children:s.variations.map((t,a)=>{var i;return e.jsxs(Ie,{variant:"outlined",sx:{p:2,minWidth:150},children:[e.jsx(r,{variant:"body2",fontWeight:"bold",children:t.name}),e.jsxs(r,{variant:"h6",color:"primary",children:["₹",(i=t.price)==null?void 0:i.toLocaleString()]})]},a)})})]}),(((xe=s.nutrition)==null?void 0:xe.length)>0||((he=s.allergenIngredients)==null?void 0:he.length)>0)&&e.jsxs(p,{item:!0,xs:12,children:[e.jsx(A,{sx:{my:2}}),e.jsx(r,{variant:"subtitle1",sx:{fontWeight:600,mb:2,color:"#E91E63"},children:"Nutritional Information"}),e.jsxs(p,{container:!0,spacing:2,children:[((me=s.nutrition)==null?void 0:me.length)>0&&e.jsxs(p,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"body2",fontWeight:"bold",gutterBottom:!0,children:"Nutrition:"}),e.jsx(j,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:s.nutrition.map((t,a)=>e.jsx(y,{label:t,size:"small",color:"success",variant:"outlined"},a))})]}),((pe=s.allergenIngredients)==null?void 0:pe.length)>0&&e.jsxs(p,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"body2",fontWeight:"bold",gutterBottom:!0,children:"Allergens:"}),e.jsx(j,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:s.allergenIngredients.map((t,a)=>e.jsx(y,{label:t,size:"small",color:"error",variant:"outlined"},a))})]})]})]}),((ue=s.searchTags)==null?void 0:ue.length)>0&&e.jsxs(p,{item:!0,xs:12,children:[e.jsx(A,{sx:{my:2}}),e.jsx(r,{variant:"subtitle1",sx:{fontWeight:600,mb:2,color:"#E91E63"},children:"Search Tags"}),e.jsx(j,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:s.searchTags.map((t,a)=>e.jsx(y,{label:t,size:"small"},a))})]}),e.jsxs(p,{item:!0,xs:12,children:[e.jsx(A,{sx:{my:2}}),e.jsxs(j,{direction:"row",spacing:4,sx:{color:"text.secondary"},children:[e.jsxs(r,{variant:"caption",children:["Created: ",new Date(s.createdAt).toLocaleString()]}),e.jsxs(r,{variant:"caption",children:["Updated: ",new Date(s.updatedAt).toLocaleString()]})]})]})]})})]})}),e.jsx(Ee,{sx:{p:2},children:e.jsx(g,{variant:"contained",sx:{bgcolor:"#E91E63"},onClick:()=>k(!1),children:"Close"})})]}),e.jsxs(Ce,{open:Le,onClose:()=>I(!1),children:[e.jsx(Se,{children:"Delete Cake Package?"}),e.jsx(ke,{children:e.jsx(jt,{children:"This action cannot be undone. This cake package will be permanently deleted."})}),e.jsxs(Ee,{children:[e.jsx(g,{onClick:()=>I(!1),children:"Cancel"}),e.jsx(g,{color:"error",variant:"contained",onClick:Be,children:"Delete Permanently"})]})]}),e.jsx(Ke,{open:C.open,autoHideDuration:4e3,onClose:()=>u({...C,open:!1}),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(Xe,{severity:C.severity,variant:"filled",children:C.message})})]})}export{Vt as default};
