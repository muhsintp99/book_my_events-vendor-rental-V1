import{a0 as ze,j as t,r as c,d as _e,B as D,c as Pe,W as Le,X as Fe,T as d,e as ge,l as pe,S as u,F as Y,q as Q,M as p,b as A,K as H,a as Ue,$ as We,y as _,J as Ve,V as Me,Y as De,n as He,o as Oe,p as Ke,s as Ge,U as Je,f as P}from"./index-DWTflIjY.js";import{S as qe}from"./Search-De4Zh55r.js";import{T as Xe}from"./TableContainer-Dg3fSJwV.js";import{T as Ye,a as Z,b as o,c as Qe}from"./TableRow-DkkU-GE-.js";import{T as Ze}from"./TableHead-gjmr51IC.js";import{E as et}from"./Edit-BBFuRw7C.js";const tt=ze(t.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}));function lt(){const[ee,O]=c.useState([]),[S,ue]=c.useState([]),[m,xe]=c.useState([]),[fe,K]=c.useState(!0),[te,ye]=c.useState(""),[je,v]=c.useState(!1),[me,x]=c.useState(""),[se,f]=c.useState("success"),[h,L]=c.useState({search:"",category:"",brand:"",type:""}),[y,F]=c.useState({category:"",brand:"",type:""}),[b,G]=c.useState(""),[be,U]=c.useState(!1),[J,re]=c.useState(null),q=_e(),j="https://api.bookmyevent.ae/api",ae=j.replace(/\/api\/?$/,"");console.log("Debug - API_BASE_URL:",j),console.log("Debug - BASE_URL:",ae);const X=localStorage.getItem("moduleId");localStorage.getItem("providerId");const Ce=async()=>{try{if(!X)return;const e=localStorage.getItem("token"),[s,r]=await Promise.all([P.get(`${j}/brands/module/${X}`,{headers:{Authorization:`Bearer ${e}`}}),P.get(`${j}/vehicle-categories`,{headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}})]);ue(Array.isArray(s.data)?s.data:[]);let i=[];r.data.success&&Array.isArray(r.data.data)&&(i=r.data.data.filter(a=>{var l;return((l=a.module)==null?void 0:l._id)===X}).map(a=>({_id:a._id,title:a.title}))),xe(i)}catch(e){console.error("Error fetching options:",e)}},ie=e=>{if(!e)return"N/A";if(typeof e=="object"&&e.title)return e.title;if(typeof e=="string"){const s=m.find(r=>r._id===e);return s?s.title:"N/A"}if(Array.isArray(e)&&e.length>0){const s=e[0];if(typeof s=="object"&&s.title)return s.title;const r=m.find(i=>i._id===(s._id||s));return r?r.title:"N/A"}return"N/A"},oe=e=>{if(!e)return"N/A";if(typeof e=="object"&&e.title)return e.title;if(typeof e=="string"){const s=S.find(r=>r._id===e);return s?s.title:"N/A"}return"N/A"},ne=e=>{if(!e)return"https://placehold.co/100x100?text=No+Image";if(e.startsWith("http"))return e;const s=e.startsWith("/")?e:`/${e}`;return`${ae}${s}`},Ae=e=>{const s=e.target.src,r=new URL(s),i=r.pathname;if(i.includes("/uploads/")&&!e.target.dataset.triedCapital)console.log("Retrying with capital 'Uploads':",s),e.target.src=s.replace("/uploads/","/Uploads/"),e.target.dataset.triedCapital="true";else if(i.includes("/Uploads/")&&!e.target.dataset.triedNoUploads)console.log("Retrying without 'Uploads/' prefix:",s),e.target.src=s.replace("/Uploads/","/"),e.target.dataset.triedNoUploads="true";else if(i.includes("/uploads/")&&!e.target.dataset.triedNoUploads)console.log("Retrying without 'uploads/' prefix:",s),e.target.src=s.replace("/uploads/","/"),e.target.dataset.triedNoUploads="true";else if(!i.startsWith("/api")&&!e.target.dataset.triedApi){console.log("Retrying with '/api' prefix:",s);const a=i.startsWith("/")?`/api${i}`:`/api/${i}`;e.target.src=`${r.origin}${a}`,e.target.dataset.triedApi="true"}else console.error("All image fallbacks failed for:",s),e.target.src="https://placehold.co/600x400?text=No+Image+Found"},Se=async()=>{var e;K(!0);try{const s=localStorage.getItem("token"),r=JSON.parse(localStorage.getItem("user")||"{}"),i=r==null?void 0:r._id;if(!s||!i){console.error("Provider ID or token missing"),x("Provider authentication missing. Please log in again."),f("error"),v(!0),K(!1);return}const a=await P.get(`${j}/vehicles/provider/${i}`,{headers:{Authorization:`Bearer ${s}`}});(e=a.data)!=null&&e.success?(console.log("Fetched vehicles:",a.data.data),console.log("Available categories:",m),console.log("Available brands:",S),console.log("All vehicles data:",a.data.data),a.data.data&&a.data.data.length>0&&(console.log("First vehicle structure:",a.data.data[0]),console.log("First vehicle category:",a.data.data[0].category),console.log("First vehicle brand:",a.data.data[0].brand),console.log("First vehicle featuredImage URL:",ne(a.data.data[0].featuredImage))),O(a.data.data||[])):console.error("Error fetching vehicles:",a.data.message)}catch(s){console.error("Error fetching vehicles:",s),x("Failed to load vehicles "),f("error"),v(!0)}finally{K(!1)}};c.useEffect(()=>{Ce()},[]),c.useEffect(()=>{m.length>0&&S.length>0&&Se()},[m,S]);const ve=()=>{L({...y,search:b})},we=()=>{L(e=>({...e,search:b}))},ke=()=>{G(""),L(e=>({...e,search:""}))},Te=()=>{G(""),F({category:"",brand:"",type:""}),L({search:"",category:"",brand:"",type:""})},Ie=e=>{re(e),U(!0)},Be=()=>{const e=["Sl,Name,Plate,Category,Brand,Seating,Basic Price,Discount,Grand Total,Active"],s=W.map((n,C)=>{var w,k,T,I,B,$,E,N,R,z;const g=((k=(w=n.pricing)==null?void 0:w.basicPackage)==null?void 0:k.price)||((T=n.pricing)==null?void 0:T.hourly)||((I=n.pricing)==null?void 0:I.perDay)||0,V=((B=n.pricing)==null?void 0:B.grandTotal)||g,M=(($=n.capacityAndComfort)==null?void 0:$.seatingCapacity)||n.seatingCapacity||"-";return`${C+1},${n.name||""},${n.licensePlateNumber||""},${ie(n.category)},${oe(n.brand)},${M},${g},${((N=(E=n.pricing)==null?void 0:E.discount)==null?void 0:N.value)||0}${((z=(R=n.pricing)==null?void 0:R.discount)==null?void 0:z.type)==="percentage"?"%":""},${V},${n.isActive?"Active":"Inactive"}`}),r=e.concat(s).join(`
`),i=new Blob([r],{type:"text/csv"}),a=URL.createObjectURL(i),l=document.createElement("a");l.href=a,l.download="vehicles.csv",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(a)},$e=async(e,s,r)=>{var i,a;try{const l=localStorage.getItem("token");(await P.put(`${j}/vehicles/${e}`,{[s]:!r},{headers:{Authorization:`Bearer ${l}`}})).data.success?(O(C=>C.map(g=>g._id===e?{...g,[s]:!r}:g)),x("Vehicle status updated successfully "),f("success")):(x("Failed to update vehicle status "),f("error"))}catch(l){console.error("Error toggling status:",l),x(((a=(i=l.response)==null?void 0:i.data)==null?void 0:a.message)||"Error updating vehicle"),f("error")}finally{v(!0)}},Ee=async()=>{var e,s;if(J)try{const r=localStorage.getItem("token");await P.delete(`${j}/vehicles/${J}`,{headers:{Authorization:`Bearer ${r}`}}),O(i=>i.filter(a=>a._id!==J)),x("Vehicle deleted successfully"),f("success")}catch(r){x(((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to delete vehicle"),f("error")}finally{v(!0),U(!1),re(null)}},Ne=e=>{q(`/vehicle-setup/leads/${e._id}`,{state:{vehicle:e}})},W=ee.filter(e=>{var i,a;let s=((i=e.category)==null?void 0:i._id)||e.category;Array.isArray(e.category)&&e.category.length>0&&(s=e.category[0]._id||e.category[0]);const r=((a=e.brand)==null?void 0:a._id)||e.brand;return(h.brand?r===h.brand:!0)&&(h.category?s===h.category:!0)&&(h.type?e.type===h.type||e.vehicleType===h.type.toLowerCase()||e.bikeType===h.type.toLowerCase():!0)&&(h.search?(e.name||"").toLowerCase().includes(h.search.toLowerCase())||(e.licensePlateNumber||"").toLowerCase().includes(h.search.toLowerCase())||(e.model||"").toLowerCase().includes(h.search.toLowerCase()):!0)}),le=(e,s)=>{s!=="clickaway"&&v(!1)};return fe?t.jsx(D,{sx:{bgcolor:"#fafafa",minHeight:"100vh",p:2,display:"flex",justifyContent:"center",alignItems:"center"},children:t.jsx(Pe,{})}):t.jsxs(D,{sx:{bgcolor:"#fafafa",minHeight:"100vh",p:2},children:[t.jsx(Le,{position:"static",color:"default",elevation:0,children:t.jsx(Fe,{children:t.jsx(d,{variant:"h6",sx:{flexGrow:1,color:"#333"},children:"VEHICLES"})})}),te&&t.jsx(ge,{severity:"error",sx:{mt:2},onClose:()=>ye(""),children:te}),t.jsx(pe,{sx:{p:2,mt:2,borderRadius:"12px",boxShadow:"0 2px 10px rgba(0,0,0,0.05)"},children:t.jsxs(u,{direction:"row",spacing:2,flexWrap:"wrap",alignItems:"center",children:[t.jsx(Y,{sx:{minWidth:200},size:"small",children:t.jsxs(Q,{displayEmpty:!0,value:y.category,onChange:e=>F({...y,category:e.target.value}),sx:{borderRadius:"8px"},children:[t.jsx(p,{value:"",children:"All Categories"}),m.map(e=>t.jsx(p,{value:e._id,children:e.title},e._id))]})}),t.jsx(Y,{sx:{minWidth:200},size:"small",children:t.jsxs(Q,{displayEmpty:!0,value:y.brand,onChange:e=>F({...y,brand:e.target.value}),sx:{borderRadius:"8px"},children:[t.jsx(p,{value:"",children:"All Brands"}),S.map(e=>t.jsx(p,{value:e._id,children:e.title},e._id))]})}),t.jsx(Y,{sx:{minWidth:200},size:"small",children:t.jsxs(Q,{displayEmpty:!0,value:y.type,onChange:e=>F({...y,type:e.target.value}),sx:{borderRadius:"8px"},children:[t.jsx(p,{value:"",children:"All Types"}),t.jsx(p,{value:"Car",children:"Car"}),t.jsx(p,{value:"Bus",children:"Bus"}),t.jsx(p,{value:"Van",children:"Van"}),t.jsx(p,{value:"Bike",children:"Bike"})]})}),t.jsx(A,{variant:"contained",onClick:ve,sx:{bgcolor:"#E15B65","&:hover":{bgcolor:"#d14b55"},borderRadius:"8px",px:3},children:"Filter"}),t.jsx(A,{variant:"outlined",onClick:Te,sx:{color:"#666",borderColor:"#ccc","&:hover":{borderColor:"#999",bgcolor:"#f5f5f5"},borderRadius:"8px"},children:"Reset"})]})}),t.jsxs(pe,{sx:{p:2,mt:2},children:[t.jsxs(u,{direction:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",spacing:2,mb:2,children:[t.jsxs(d,{variant:"h6",sx:{fontWeight:600},children:["Total Vehicles"," ",t.jsx(H,{label:W.length,color:"success",size:"small",sx:{ml:1}})]}),t.jsxs(u,{direction:"row",spacing:1,flexWrap:"wrap",children:[t.jsx(Ue,{size:"small",placeholder:"Search by vehicle name",value:b,onChange:e=>G(e.target.value),InputProps:{endAdornment:t.jsxs(We,{position:"end",children:[t.jsx(_,{onClick:we,size:"small",disabled:!b,sx:{color:b?"inherit":"action"},children:t.jsx(qe,{fontSize:"small"})}),b&&t.jsx(_,{onClick:ke,size:"small",children:t.jsx(tt,{fontSize:"small"})})]})}}),t.jsx(A,{variant:"outlined",color:"#E15B65",sx:{color:"#E15B65",borderRadius:"8px"},onClick:Be,children:"Export"}),t.jsx(A,{variant:"contained",sx:{bgcolor:"#E15B65"},onClick:()=>q("/vehicle-setup/leads"),children:"New Vehicle"})]})]}),t.jsx(Xe,{children:t.jsxs(Ye,{children:[t.jsx(Ze,{sx:{bgcolor:"#f9fafb"},children:t.jsxs(Z,{children:[t.jsx(o,{children:"Sl"}),t.jsx(o,{children:"Vehicle Info"}),t.jsx(o,{children:"Category"}),t.jsx(o,{children:"Brand"}),t.jsx(o,{children:"Type"}),t.jsx(o,{children:"Trip Fare"}),t.jsx(o,{children:"Details"}),t.jsx(o,{children:"Status"}),t.jsx(o,{children:"Action"})]})}),t.jsxs(Qe,{children:[W.map((e,s)=>{var C,g,V,M,w,k,T,I,B,$,E,N,R,z,ce,de,he;const r=((g=(C=e.pricing)==null?void 0:C.basicPackage)==null?void 0:g.price)||((V=e.pricing)==null?void 0:V.hourly)||((M=e.pricing)==null?void 0:M.perDay)||((w=e.pricing)==null?void 0:w.distanceWise),i=(k=e.pricing)==null?void 0:k.grandTotal,a=((T=e.capacityAndComfort)==null?void 0:T.seatingCapacity)||e.seatingCapacity,l=((I=e.engineCharacteristics)==null?void 0:I.fuelType)||e.fuelType,n=(($=(B=e.engineCharacteristics)==null?void 0:B.transmissionType)==null?void 0:$.value)||((E=e.engineCharacteristics)==null?void 0:E.transmissionType)||e.transmissionType;return t.jsxs(Z,{sx:{"&:hover":{bgcolor:"#fbfbfb"}},children:[t.jsx(o,{children:s+1}),t.jsx(o,{children:t.jsxs(u,{direction:"row",spacing:2,alignItems:"center",children:[t.jsx(D,{component:"img",src:ne(e.featuredImage),sx:{width:50,height:50,borderRadius:"8px",objectFit:"cover",border:"1px solid #eee"},onLoad:Re=>console.log("Successfully loaded image:",Re.target.src),onError:Ae}),t.jsxs(D,{children:[t.jsx(d,{variant:"body2",sx:{fontWeight:700,color:"#2563eb"},children:e.name||"N/A"}),t.jsxs(d,{variant:"caption",color:"text.secondary",display:"block",children:["Plate: ",e.licensePlateNumber||"N/A"]}),t.jsxs(d,{variant:"caption",color:"text.secondary",children:["Model: ",e.model||"N/A"]})]})]})}),t.jsx(o,{children:t.jsx(H,{label:ie(e.category),size:"small",variant:"outlined"})}),t.jsx(o,{children:oe(e.brand)}),t.jsx(o,{children:t.jsx(d,{variant:"body2",sx:{fontWeight:500},children:e.type||e.vehicleType||e.bikeType||"N/A"})}),t.jsxs(o,{children:[i?t.jsxs(t.Fragment,{children:[t.jsxs(d,{variant:"subtitle2",sx:{fontWeight:700,color:"#E15B65"},children:["â‚¹",i]}),r&&r!==i&&t.jsxs(d,{variant:"caption",sx:{textDecoration:"line-through",color:"text.secondary"},children:["â‚¹",r]})]}):r?t.jsxs(d,{variant:"subtitle2",sx:{fontWeight:700},children:["â‚¹",r]}):t.jsx(d,{variant:"body2",color:"text.secondary",children:"No pricing"}),((R=(N=e.pricing)==null?void 0:N.basicPackage)==null?void 0:R.includedHours)&&t.jsxs(d,{variant:"caption",display:"block",color:"text.secondary",children:[e.pricing.basicPackage.includedHours," Hrs / ",e.pricing.basicPackage.includedKilometers," KM"]})]}),t.jsx(o,{children:t.jsxs(u,{spacing:.5,children:[t.jsxs(d,{variant:"caption",sx:{display:"flex",alignItems:"center",gap:.5},children:["ðŸª‘ ",t.jsx("strong",{children:"Seats:"})," ",a||"N/A"]}),t.jsxs(d,{variant:"caption",sx:{display:"flex",alignItems:"center",gap:.5},children:["â›½ ",t.jsx("strong",{children:"Fuel:"})," ",l||"N/A"]}),t.jsxs(d,{variant:"caption",sx:{display:"flex",alignItems:"center",gap:.5},children:["âš™ï¸ ",t.jsx("strong",{children:"Trans:"})," ",n||"N/A"]}),t.jsx(u,{direction:"row",spacing:1,children:(((z=e.engineCharacteristics)==null?void 0:z.airConditioning)!==void 0||((ce=e.availability)==null?void 0:ce.acAvailable)!==void 0||e.airCondition!==void 0)&&t.jsx(H,{label:(de=e.engineCharacteristics)!=null&&de.airConditioning||(he=e.availability)!=null&&he.acAvailable||e.airCondition?"AC":"Non-AC",size:"small",sx:{height:20,fontSize:"0.65rem"}})})]})}),t.jsx(o,{children:t.jsxs(u,{spacing:1,alignItems:"center",children:[t.jsx(Ve,{checked:e.isActive!==!1,onChange:()=>$e(e._id,"isActive",e.isActive!==!1),size:"small",sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:"#E15B65"},"& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track":{backgroundColor:"#E15B65"}}}),e.isNew&&t.jsx(H,{label:"New",color:"success",size:"small",sx:{height:20,fontSize:"0.65rem"}})]})}),t.jsx(o,{children:t.jsxs(u,{direction:"row",spacing:1,children:[t.jsx(_,{size:"small",sx:{border:"1px solid #eee",color:"#2563eb",borderRadius:"8px",bgcolor:"#fff"},onClick:()=>q(`/vehicle-setup/listview/${e._id}`),children:t.jsx(Me,{fontSize:"small"})}),t.jsx(_,{size:"small",sx:{border:"1px solid #eee",color:"#065f46",borderRadius:"8px",bgcolor:"#fff"},onClick:()=>Ne(e),children:t.jsx(et,{fontSize:"small"})}),t.jsx(_,{size:"small",sx:{border:"1px solid #eee",color:"#dc2626",borderRadius:"8px",bgcolor:"#fff"},onClick:()=>Ie(e._id),children:t.jsx(De,{fontSize:"small"})})]})})]},e._id)}),W.length===0&&t.jsx(Z,{children:t.jsx(o,{colSpan:10,align:"center",children:ee.length===0?"No vehicles found. Add your first vehicle!":"No vehicles match the current filters"})})]})]})})]}),t.jsxs(He,{open:be,onClose:()=>U(!1),children:[t.jsx(Oe,{children:"Confirm Deletion"}),t.jsx(Ke,{children:t.jsx(d,{children:"Are you sure you want to delete this vehicle? This action cannot be undone."})}),t.jsxs(Ge,{children:[t.jsx(A,{onClick:()=>U(!1),children:"Cancel"}),t.jsx(A,{onClick:Ee,variant:"contained",color:"error",children:"Delete"})]})]}),t.jsx(Je,{open:je,autoHideDuration:3e3,onClose:le,anchorOrigin:{vertical:"top",horizontal:"center"},children:t.jsx(ge,{onClose:le,severity:se,sx:{backgroundColor:se==="success"?"#1976d2":"#d32f2f",color:"white"},children:me})})]})}export{lt as default};
