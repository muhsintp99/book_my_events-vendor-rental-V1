import{r as i,a as U,j as e,B as J,ai as Q,aj as q,T as p,a5 as $,S as m,F as K,a9 as X,Q as j,g as d,ad as Y,s as Z,t as ee,c as B,V as se,ak as te,a6 as ne,a7 as re,a8 as oe,ag as ae,ah as ie}from"./index-D-AUwBgS.js";import{S as le}from"./Search-CeiVr-Tf.js";import{T as ce}from"./TableContainer-CkvQRDYS.js";import{T as de,a as ue,b as S,c as r,d as he}from"./TableRow-Dt1EnZBU.js";import{S as xe}from"./Switch-CRwl92wx.js";import{D as ge}from"./Delete-BMYh7xNU.js";import{D as fe}from"./DialogActions-SxxXCai-.js";function Ae(){const b="https://api.bookmyevent.ae/api",[F,T]=i.useState([]),[v,u]=i.useState(!1),[x,M]=i.useState({seatingArrangement:"",search:""}),[h,w]=i.useState({seatingArrangement:"",search:""}),[R,g]=i.useState(!1),[D,I]=i.useState(null),[z,A]=i.useState(!1),[O,C]=i.useState(""),[V,y]=i.useState("success"),k=U(),t=s=>{if(s==null)return"";try{if(typeof s=="string")return s;if(typeof s.toString=="function"){const n=s.toString();if(typeof n=="string")return n}return JSON.stringify(s)}catch{return"[Invalid Value]"}};i.useEffect(()=>{E()},[]);const E=async()=>{u(!0);try{const s=localStorage.getItem("token"),l=JSON.parse(localStorage.getItem("user")||"{}")._id;if(!s){console.error("No authentication token found"),u(!1);return}const a=await(await fetch(`${b}/venues/provider/${l}`,{headers:{Authorization:`Bearer ${s}`}})).json();if(console.log("Fetched venues:",a),a.success){const o=a.data||[];console.log("Full fetched venues data:",o),T(o)}else console.error("Failed to fetch venues:",a.message)}catch(s){console.error("Error fetching venues:",s)}finally{u(!1)}},N=()=>{M(h)},L=()=>{M({seatingArrangement:"",search:""}),w({seatingArrangement:"",search:""})},_=()=>{const s=["Sl,Name,Address,Seating Arrangement,Max Guests Seated,Status"],n=f.map((o,H)=>`${H+1},${t(o.venueName)},${t(o.venueAddress)},${t(o.seatingArrangement||"-")},${t(o.maxGuestsSeated||"-")},${o.isActive?"Active":"Inactive"}`),l=s.concat(n).join(`
`),c=new Blob([l],{type:"text/csv"}),a=document.createElement("a");a.href=URL.createObjectURL(c),a.download="venues.csv",a.click()},P=async s=>{try{const n=localStorage.getItem("token");if(!n){console.error("No authentication token found");return}const c=await(await fetch(`${b}/venues/${t(s)}/toggle-active`,{method:"PATCH",headers:{Authorization:`Bearer ${n}`}})).json();c.success?T(a=>a.map(o=>t(o._id)===t(s)?{...o,isActive:!o.isActive}:o)):console.error("Failed to toggle venue status:",c.message)}catch(n){console.error("Error toggling venue status:",n)}},W=s=>{I(t(s)),g(!0)},G=async()=>{if(D){u(!0);try{const s=localStorage.getItem("token");if(!s)throw new Error("No authentication token found");const l=await(await fetch(`${b}/venues/${D}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}})).json();l.success?(E(),C("Venue deleted successfully ✅"),y("success")):(C(l.message||"Failed to delete venue ❌"),y("error"))}catch(s){console.error(s),C("Error deleting venue ❌"),y("error")}finally{u(!1),g(!1),I(null),A(!0)}}},f=F.filter(s=>{const n=t(s.venueName).toLowerCase(),l=t(x.search).toLowerCase(),c=t(s.seatingArrangement);return(x.seatingArrangement?c===x.seatingArrangement:!0)&&(x.search?n.includes(l):!0)});return e.jsxs(J,{sx:{bgcolor:"#fafafa",minHeight:"100vh",p:2},children:[e.jsx(Q,{position:"static",color:"default",elevation:0,children:e.jsx(q,{children:e.jsx(p,{variant:"h4",sx:{flexGrow:1,color:"#080303ff"},children:"Venue Management"})})}),e.jsx($,{sx:{p:2,mt:2},children:e.jsxs(m,{direction:"row",spacing:2,flexWrap:"wrap",children:[e.jsx(K,{sx:{minWidth:200},size:"small",children:e.jsxs(X,{displayEmpty:!0,value:h.seatingArrangement,onChange:s=>w({...h,seatingArrangement:s.target.value}),sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"#E15B65"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#E15B65"}},children:[e.jsx(j,{value:"",children:"Select seating arrangement"}),e.jsx(j,{value:"Amphitheater",children:"Amphitheater"}),e.jsx(j,{value:"Balcony auditorium",children:"Balcony auditorium"}),e.jsx(j,{value:"Flat floor auditorium",children:"Flat floor auditorium"})]})}),e.jsx(d,{variant:"outlined",color:"#E15B65",sx:{color:"#E15B65",borderRadius:"8px"},onClick:L,children:"Reset"}),e.jsx(d,{variant:"contained",sx:{bgcolor:"#E15B65",borderRadius:"8px"},onClick:N,children:"Filter"})]})}),e.jsxs($,{sx:{p:2,mt:2},children:[e.jsxs(m,{direction:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",spacing:2,mb:2,children:[e.jsxs(p,{variant:"h6",sx:{fontWeight:600},children:["Total Venues"," ",e.jsx(Y,{label:f.length,color:"success",size:"small",sx:{ml:1}})]}),e.jsxs(m,{direction:"row",spacing:1,flexWrap:"wrap",children:[e.jsx(Z,{size:"small",placeholder:"Search by venue name",variant:"outlined",value:h.search,onChange:s=>w({...h,search:s.target.value}),InputProps:{endAdornment:e.jsx(le,{fontSize:"small"})},sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"#E15B65"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#E15B65"}}}),e.jsx(d,{variant:"outlined",color:"#E15B65",sx:{color:"#E15B65",borderRadius:"8px"},onClick:_,children:"Export"}),e.jsx(d,{variant:"outlined",color:"#E15B65",sx:{color:"#E15B65",borderRadius:"8px"},onClick:E,disabled:v,children:"Refresh"}),e.jsx(d,{variant:"contained",sx:{bgcolor:"#E15B65"},onClick:()=>k("/venue-setup/new"),children:"New Venue"})]})]}),e.jsx(ce,{children:e.jsxs(de,{children:[e.jsx(ue,{sx:{bgcolor:"#f9fafb"},children:e.jsxs(S,{children:[e.jsx(r,{children:"Sl"}),e.jsx(r,{children:"Venue Info"}),e.jsx(r,{children:"Address"}),e.jsx(r,{children:"Seating Arrangement"}),e.jsx(r,{children:"Max Guests Seated"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Action"})]})}),e.jsx(he,{children:v?e.jsx(S,{children:e.jsx(r,{colSpan:7,align:"center",children:e.jsx(ee,{})})}):f.length===0?e.jsx(S,{children:e.jsx(r,{colSpan:7,align:"center",children:"No venues found"})}):f.map((s,n)=>e.jsxs(S,{children:[e.jsx(r,{children:n+1}),e.jsx(r,{children:e.jsx(p,{variant:"body2",sx:{fontWeight:600,color:"#396becff"},children:t(s.venueName)||"-"})}),e.jsx(r,{children:t(s.venueAddress)||"-"}),e.jsx(r,{children:t(s.seatingArrangement)||"-"}),e.jsx(r,{children:t(s.maxGuestsSeated)||"-"}),e.jsx(r,{children:e.jsx(xe,{checked:s.isActive,onChange:()=>P(s._id),disabled:v,sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:"#E15B65"},"& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track":{backgroundColor:"#E15B65"},"& .MuiSwitch-track":{backgroundColor:"#ccc"}}})}),e.jsx(r,{children:e.jsxs(m,{direction:"row",spacing:1,children:[e.jsx(B,{size:"small",sx:{border:"1px solid #d1d5db",color:"#2e79bbff",borderRadius:"8px"},onClick:()=>k(`/venue-setup/listview/${t(s._id)}`),children:e.jsx(se,{fontSize:"small"})}),e.jsx(B,{size:"small",sx:{border:"1px solid #d1d5db",color:"#065f46",borderRadius:"8px"},onClick:()=>k(`/venue-setup/new/${t(s._id)}`),children:e.jsx(te,{fontSize:"small"})}),e.jsx(B,{size:"small",sx:{border:"1px solid #d1d5db",color:"#dc2626",borderRadius:"8px"},onClick:()=>W(s._id),children:e.jsx(ge,{fontSize:"small"})})]})})]},t(s._id)))})]})})]}),e.jsxs(ne,{open:R,onClose:()=>g(!1),children:[e.jsx(re,{children:"Confirm Delete"}),e.jsx(oe,{children:e.jsx(p,{children:"Are you sure you want to delete this venue?"})}),e.jsxs(fe,{children:[e.jsx(d,{onClick:()=>g(!1),color:"primary",children:"Cancel"}),e.jsx(d,{onClick:G,color:"error",variant:"contained",children:"Delete"})]})]}),e.jsx(ae,{open:z,autoHideDuration:4e3,onClose:()=>A(!1),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(ie,{onClose:()=>A(!1),severity:V,sx:{width:"100%"},children:O})})]})}export{Ae as default};
