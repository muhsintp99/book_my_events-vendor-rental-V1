import{r as c,j as e,B as r,o as F,af as be,T as d,a3 as je,s as g,b as S,G as W,Y as J,w as U,z as Se,ag as q,H as ye,a4 as Ie,aJ as ke,aK as De,aL as we,J as ve,e as Ce,_ as R,a as h,Z as y,P as Me,ah as Ae,ai as Ne,F as Fe,I as We,S as Re,M as Pe,ak as Te,c as Be}from"./index-CWJg_lwt.js";import{A as Oe}from"./AccessTime-C415cthz.js";import{S as Le}from"./Spa-B3tFtm5A.js";const I="https://api.bookmyevent.ae";function Ue(){const[i,K]=c.useState(new Date),[m,Z]=c.useState(new Date().getDate()),[Q,C]=c.useState(!1),[P,T]=c.useState([]),[V,M]=c.useState([]),[k,X]=c.useState([]),[Ee,B]=c.useState(!1),[O,x]=c.useState(null),[L,E]=c.useState(!1),[ze,z]=c.useState(null),[s,D]=c.useState({fullName:"",contactNumber:"",emailAddress:"",address:"",numberOfGuests:"",additionalNotes:"",moduleId:"",packageId:"",bookingDate:new Date().toISOString().split("T")[0],timeSlot:[],paymentType:"Cash",bookingType:"Direct"}),b=(()=>{let t=localStorage.getItem("providerId")||localStorage.getItem("userId");if(!t){const o=localStorage.getItem("user");if(o)try{const n=JSON.parse(o);t=n._id||n.id||n.userId}catch(n){console.error("Error parsing user from localStorage:",n)}}return t})();c.useEffect(()=>{b&&(Y(),ee(),te())},[i,b]),c.useEffect(()=>{k.length===1&&!s.moduleId&&D(t=>({...t,moduleId:k[0]._id}))},[k]);const Y=async()=>{if(!b){x("Provider ID is required");return}B(!0),x(null);try{const o=await(await fetch(`${I}/api/bookings/provider/${b}`)).json();if(o.success){const n=(o.data||[]).filter(a=>["florist","florist & stage decoration"].includes(String(a.moduleType||"").toLowerCase()));T(n)}else x(o.message||"Failed to fetch bookings")}catch(t){x("Error connecting to server"),console.error("Fetch error:",t)}finally{B(!1)}},ee=async()=>{try{const o=await(await fetch(`${I}/api/modules`)).json(),a=(o.success?o.data||o.modules||[]:Array.isArray(o)?o:[]).filter(l=>{const N=(l.title||l.name||"").toLowerCase();return N==="florist"||N==="florist & stage decoration"});X(a)}catch(t){console.error("Fetch modules error:",t),x("Failed to fetch modules: "+t.message)}},te=async()=>{try{const o=await(await fetch(`${I}/api/mehandi/vendor/${b}`)).json();o.success?M(o.data||[]):M([])}catch(t){console.error("Fetch mehandi packages error:",t),M([])}},oe=async t=>{if(window.confirm("Are you sure you want to delete this booking?")){z(t),x(null);try{const n=await(await fetch(`${I}/api/bookings/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})).json();n.success?(T(a=>a.filter(l=>l._id!==t)),alert("Booking deleted successfully!")):x(n.message||"Failed to delete booking")}catch(o){x("Error deleting booking: "+o.message)}finally{z(null)}}},A=new Date,se=A.getDate(),re=A.getMonth(),ne=A.getFullYear(),ae=(()=>{const t=i.getFullYear(),o=i.getMonth(),n=new Date(t,o+1,0).getDate(),a={};for(let l=1;l<=n;l++){const H=P.filter(v=>{const f=new Date(v.bookingDate);return f.getDate()===l&&f.getMonth()===o&&f.getFullYear()===t&&v.bookingType==="Direct"}).reduce((v,f)=>v+(Array.isArray(f.timeSlot)?f.timeSlot.length:1),0);H===0?a[l]="free":H>=3?a[l]="booked":a[l]="available"}return a})(),j=P.filter(t=>{const o=new Date(t.bookingDate);return o.getDate()===m&&o.getMonth()===i.getMonth()&&o.getFullYear()===i.getFullYear()&&t.bookingType==="Direct"}),{firstDay:ie,daysInMonth:le}=(()=>{const t=i.getFullYear(),o=i.getMonth();return{firstDay:new Date(t,o,1).getDay(),daysInMonth:new Date(t,o+1,0).getDate()}})(),de=i.toLocaleDateString("en-US",{month:"long",year:"numeric"}),ce=t=>t==="booked"?"#ef5350":t==="available"?"#ffd54f":"#66bb6a",_=t=>{K(new Date(i.getFullYear(),i.getMonth()+t,1))},xe=()=>{const t=[];["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].forEach(o=>t.push(e.jsx(r,{sx:{textAlign:"center",p:{xs:"8px 4px",md:"16px"},color:"#777",fontSize:{xs:"11px",md:"14px"},fontWeight:"600"},children:o},o)));for(let o=0;o<ie;o++)t.push(e.jsx(r,{sx:{display:{xs:"none",md:"block"},bgcolor:"#f9f9f9",borderRadius:"12px"}},`empty-${o}`));for(let o=1;o<=le;o++){const n=ae[o]||"free",a=o===se&&i.getMonth()===re&&i.getFullYear()===ne,l=o===m;t.push(e.jsxs(r,{onClick:()=>Z(o),sx:{position:"relative",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:{xs:"50px",md:"100px"},cursor:"pointer",borderRadius:{xs:"8px",md:"16px"},transition:"all 0.3s",bgcolor:l?"rgba(239, 83, 80, 0.05)":"#fff",border:l?"1px solid #ef5350":"1px solid #f0f0f0","&:hover":{transform:{md:"translateY(-4px)"},boxShadow:"0 6px 16px rgba(0,0,0,0.08)",borderColor:"#ef5350",zIndex:1}},children:[e.jsx(r,{sx:{fontSize:{xs:"14px",md:"22px"},fontWeight:a||l?"600":"400",color:a?"#fff":l?"#ef5350":"#333",width:{xs:"28px",md:"48px"},height:{xs:"28px",md:"48px"},display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",bgcolor:a?"#ef5350":"transparent",mb:{xs:"2px",md:"8px"}},children:o}),e.jsx(r,{sx:{width:{xs:"6px",md:"10px"},height:{xs:"6px",md:"10px"},borderRadius:"50%",bgcolor:ce(n)}})]},o))}return t},p=t=>{const{name:o,value:n}=t.target;D(a=>({...a,[o]:n}))},ue=t=>{D(o=>{const n=o.timeSlot.includes(t)?o.timeSlot.filter(a=>a!==t):[...o.timeSlot,t];return{...o,timeSlot:n}})},pe=async()=>{if(!s.fullName.trim()||!s.contactNumber.trim()||!s.moduleId||!s.packageId||!s.timeSlot.length){x("Please fill all required fields and select at least one time slot");return}E(!0),x(null);try{const t={moduleId:s.moduleId,floristId:s.packageId,fullName:s.fullName,contactNumber:s.contactNumber,emailAddress:s.emailAddress,address:s.address,bookingDate:s.bookingDate,timeSlot:s.timeSlot,paymentType:s.paymentType,numberOfGuests:Number(s.numberOfGuests)||1,additionalNotes:s.additionalNotes,bookingType:"Direct",status:"Accepted",paymentStatus:"Paid"},n=await(await fetch(`${I}/api/bookings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();n.success?(alert("Booking created successfully!"),C(!1),Y(),he()):x(n.message||"Failed to create booking")}catch{x("Error creating booking")}finally{E(!1)}},he=()=>{var t;D({fullName:"",contactNumber:"",emailAddress:"",address:"",numberOfGuests:"",additionalNotes:"",moduleId:((t=k[0])==null?void 0:t._id)||"",packageId:"",bookingDate:new Date().toISOString().split("T")[0],timeSlot:[],paymentType:"Cash",bookingType:"Direct"})},[u,w]=c.useState(0),fe=()=>w(t=>t+1),ge=()=>w(t=>t-1),me=()=>{C(!0),w(0)},$=()=>{C(!1),x(null),w(0)},G=["Customer Info","Service Details","Schedule & Notes"];return e.jsxs(r,{sx:{width:"100%",p:{xs:"8px",md:"40px"},bgcolor:"#fafafa",minHeight:"100vh"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:{xs:"16px",md:"32px"},px:{xs:"4px",md:"20px"}},children:[e.jsx(F,{onClick:()=>_(-1),sx:{bgcolor:"#fff",border:"1px solid #f0f0f0",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:e.jsx(be,{})}),e.jsx(d,{sx:{fontSize:{xs:"20px",md:"32px"},fontWeight:"600"},children:de}),e.jsx(F,{onClick:()=>_(1),sx:{bgcolor:"#fff",border:"1px solid #f0f0f0",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:e.jsx(je,{})})]}),e.jsx(r,{sx:{bgcolor:"#fff",borderRadius:{xs:"16px",md:"24px"},p:{xs:"12px 8px",md:"40px"},mb:{xs:"24px",md:"40px"},border:"1px solid #f0f0f0",boxShadow:"0 10px 30px rgba(0,0,0,0.04)"},children:e.jsx(r,{sx:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:{xs:"4px",md:"16px"}},children:xe()})}),e.jsx(r,{sx:{bgcolor:"#fff",borderRadius:"12px",p:"24px",mb:"32px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)"},children:e.jsxs(g,{direction:"row",justifyContent:"center",spacing:3,flexWrap:"wrap",children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(r,{sx:{width:12,height:12,borderRadius:"50%",bgcolor:"#ef5350"}}),e.jsx(d,{color:"#666",children:"Fully Booked"})]}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(r,{sx:{width:12,height:12,borderRadius:"50%",bgcolor:"#ffd54f"}}),e.jsx(d,{color:"#666",children:"Slots Available"})]}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(r,{sx:{width:12,height:12,borderRadius:"50%",bgcolor:"#66bb6a"}}),e.jsx(d,{color:"#666",children:"Fully Free"})]})]})}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:{xs:2,md:4},bgcolor:"#fff",borderRadius:"24px",p:{xs:"20px",md:"32px"},mb:"32px",border:"1px solid #f0f0f0",boxShadow:"0 4px 20px rgba(0,0,0,0.03)"},children:[e.jsxs(r,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minWidth:{xs:70,md:100},height:{xs:70,md:100},bgcolor:"#ef5350",borderRadius:"20px",color:"#fff",boxShadow:"0 8px 16px rgba(239, 83, 80, 0.2)"},children:[e.jsx(d,{sx:{fontSize:"12px",fontWeight:"600"},children:new Date(i.getFullYear(),i.getMonth(),m).toLocaleDateString("en-US",{weekday:"short"})}),e.jsx(d,{sx:{fontSize:{xs:28,md:40},fontWeight:700},children:m})]}),e.jsxs(r,{sx:{flex:1},children:[e.jsx(d,{variant:"h6",fontWeight:700,color:"#333",children:j.length===0?"No Bookings":`${j.length} Direct Bookings`}),e.jsx(d,{color:"#999",fontSize:"14px",children:j.length===0?"All slots available for manual entry":"Reserved slots for this date"})]}),e.jsx(S,{variant:"contained",onClick:me,sx:{bgcolor:"#ef5350",borderRadius:"12px",px:4,height:48,fontWeight:700,"&:hover":{bgcolor:"#d32f2f"}},children:"Add Booking"})]}),e.jsx(W,{container:!0,spacing:3,children:j.length===0?e.jsx(W,{item:!0,xs:12,children:e.jsx(J,{sx:{p:4,textAlign:"center",borderRadius:"24px",border:"2px dashed #eee"},children:e.jsx(d,{color:"#999",children:"No bookings scheduled for this date."})})}):j.map(t=>e.jsx(W,{item:!0,xs:12,md:6,lg:4,children:e.jsxs(J,{sx:{p:3,borderRadius:"24px",position:"relative",overflow:"hidden",border:"1px solid #f0f0f0",boxShadow:"0 8px 20px rgba(0,0,0,0.02)"},children:[e.jsx(r,{sx:{position:"absolute",top:0,left:0,width:4,height:"100%",bgcolor:"#ef5350"}}),e.jsxs(g,{direction:"row",justifyContent:"space-between",mb:2,children:[e.jsx(U,{label:Array.isArray(t.timeSlot)?t.timeSlot.join(", "):typeof t.timeSlot=="object"?t.timeSlot.label:t.timeSlot,size:"small",icon:e.jsx(Oe,{sx:{fontSize:14}}),sx:{bgcolor:"rgba(239, 83, 80, 0.1)",color:"#ef5350",fontWeight:700}}),e.jsx(F,{size:"small",onClick:()=>oe(t._id),sx:{color:"#ccc","&:hover":{color:"#ef5350"}},children:e.jsx(Se,{fontSize:"small"})})]}),e.jsx(d,{variant:"h6",fontWeight:800,mb:2,children:t.fullName}),e.jsxs(g,{spacing:1,children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5,color:"#666"},children:[e.jsx(q,{sx:{fontSize:16}}),e.jsx(d,{variant:"body2",children:t.contactNumber})]}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5,color:"#666"},children:[e.jsx(Le,{sx:{fontSize:16}}),e.jsx(d,{variant:"body2",children:"Florist"})]})]})]})},t._id))}),e.jsxs(ye,{open:Q,onClose:$,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:"28px",p:1}},children:[e.jsxs(Ie,{children:[e.jsx(d,{variant:"h4",fontWeight:800,sx:{mt:2,textAlign:"center"},children:"Create Manual Booking"}),e.jsx(r,{sx:{width:"80%",mx:"auto",mt:3,mb:1},children:e.jsx(ke,{activeStep:u,alternativeLabel:!0,children:G.map(t=>e.jsx(De,{sx:{"& .MuiStepIcon-root.Mui-active":{color:"#ef5350"},"& .MuiStepIcon-root.Mui-completed":{color:"#ef5350"}},children:e.jsx(we,{children:t})},t))})})]}),e.jsxs(ve,{sx:{px:4,pb:4,pt:2,minHeight:400},children:[O&&e.jsx(Ce,{severity:"error",sx:{mb:3,borderRadius:"14px"},children:O}),e.jsxs(r,{sx:{mt:2},children:[u===0&&e.jsx(R,{in:u===0,children:e.jsxs(g,{spacing:3,children:[e.jsx(h,{fullWidth:!0,label:"Full Name",name:"fullName",value:s.fullName,onChange:p,InputProps:{startAdornment:e.jsx(y,{position:"start",children:e.jsx(Me,{sx:{color:"#ef5350"}})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:"16px"}}}),e.jsx(h,{fullWidth:!0,label:"Contact Number",name:"contactNumber",value:s.contactNumber,onChange:p,InputProps:{startAdornment:e.jsx(y,{position:"start",children:e.jsx(q,{sx:{color:"#ef5350"}})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:"16px"}}}),e.jsx(h,{fullWidth:!0,label:"Email Address",type:"email",name:"emailAddress",value:s.emailAddress,onChange:p,InputProps:{startAdornment:e.jsx(y,{position:"start",children:e.jsx(Ae,{sx:{color:"#ef5350"}})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:"16px"}}}),e.jsx(h,{fullWidth:!0,label:"Home Address",name:"address",value:s.address,onChange:p,InputProps:{startAdornment:e.jsx(y,{position:"start",children:e.jsx(Ne,{sx:{color:"#ef5350"}})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:"16px"}}})]})}),u===1&&e.jsx(R,{in:u===1,children:e.jsxs(g,{spacing:3,children:[e.jsxs(Fe,{fullWidth:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:"16px"}},children:[e.jsx(We,{children:"Select Florist Package"}),e.jsx(Re,{label:"Select Florist Package",name:"packageId",value:s.packageId,onChange:p,children:V.map(t=>e.jsx(Pe,{value:t._id,children:t.packageName},t._id))})]}),e.jsx(h,{fullWidth:!0,label:"Number of Guests",type:"number",name:"numberOfGuests",value:s.numberOfGuests,onChange:p,InputProps:{startAdornment:e.jsx(y,{position:"start",children:e.jsx(Te,{sx:{color:"#ef5350"}})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:"16px"}}}),e.jsxs(r,{children:[e.jsx(d,{variant:"subtitle1",fontWeight:700,color:"text.secondary",sx:{mb:1},children:"Selected Date"}),e.jsx(h,{fullWidth:!0,disabled:!0,value:new Date(i.getFullYear(),i.getMonth(),m).toLocaleDateString("en-US",{dateStyle:"full"}),sx:{"& .MuiOutlinedInput-root":{borderRadius:"16px",bgcolor:"#f8fafc"}}})]})]})}),u===2&&e.jsx(R,{in:u===2,children:e.jsxs(r,{children:[e.jsx(d,{variant:"subtitle1",fontWeight:700,sx:{mb:2,color:"#ef5350"},children:"Preferred Time Slots"}),e.jsx(r,{sx:{display:"flex",flexWrap:"wrap",gap:1.5,mb:4},children:["Morning (9AM-12PM)","Afternoon (12PM-4PM)","Evening (4PM-8PM)","Night (8PM-12AM)"].map(t=>e.jsx(U,{label:t,onClick:()=>ue(t),sx:{borderRadius:"12px",height:45,px:1.5,fontSize:"0.9rem",fontWeight:600,border:"1px solid",borderColor:s.timeSlot.includes(t)?"#ef5350":"rgba(0,0,0,0.1)",bgcolor:s.timeSlot.includes(t)?"#ef5350":"#fff",color:s.timeSlot.includes(t)?"#fff":"#666",transition:"0.3s","&:hover":{bgcolor:s.timeSlot.includes(t)?"#d32f2f":"rgba(239, 83, 80, 0.05)"}}},t))}),e.jsx(h,{fullWidth:!0,multiline:!0,rows:4,label:"Special Instructions / Notes",name:"additionalNotes",value:s.additionalNotes,onChange:p,placeholder:"Type any specific requests here...",sx:{"& .MuiOutlinedInput-root":{borderRadius:"20px"}}})]})})]}),e.jsxs(g,{direction:"row",spacing:2,sx:{mt:6},children:[u>0?e.jsx(S,{fullWidth:!0,onClick:ge,sx:{borderRadius:"16px",fontWeight:700,height:55,border:"2px solid #eee",color:"#666","&:hover":{border:"2px solid #ccc"}},children:"Back"}):e.jsx(S,{fullWidth:!0,onClick:$,sx:{borderRadius:"16px",fontWeight:700,height:55,border:"2px solid #eee",color:"#666","&:hover":{border:"2px solid #ccc"}},children:"Cancel"}),u<G.length-1?e.jsx(S,{fullWidth:!0,variant:"contained",onClick:fe,sx:{borderRadius:"16px",fontWeight:700,height:55,bgcolor:"#ef5350","&:hover":{bgcolor:"#d32f2f"}},children:"Next Step"}):e.jsx(S,{fullWidth:!0,variant:"contained",onClick:pe,disabled:L,sx:{borderRadius:"16px",fontWeight:700,height:55,bgcolor:"#ef5350",boxShadow:"0 8px 16px rgba(239, 83, 80, 0.3)","&:hover":{bgcolor:"#d32f2f"}},children:L?e.jsx(Be,{size:24,color:"inherit"}):"Confirm Booking"})]})]})]})]})}export{Ue as default};
