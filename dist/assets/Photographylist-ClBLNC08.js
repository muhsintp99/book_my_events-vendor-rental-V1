import{Z as Le,j as e,r as o,B as y,J as _e,K as Ve,T as j,b as x,k as ae,S as O,a as m,W as $e,F as We,o as Re,M as re,c as ie,x as E,al as U,s as S,V as Fe,N as Ne,l as oe,m as ne,n as le,G as u,w as ce,z as de,X as he,am as He,an as Oe,E as Ue,H as Me,A as ue}from"./index-De4GTXyc.js";import{A as Ge}from"./Add-nzu5tRBx.js";import{S as Ye}from"./Search-2JTt4qzK.js";import{R as qe,D as Je}from"./Refresh-YWGeWC8C.js";import{T as Ke}from"./TableContainer-DaFT3giR.js";import{T as Xe,a as Ze,b as D,c,d as Qe}from"./TableRow-BnZrCKQk.js";import{S as et}from"./Switch-CTDi0Qy7.js";import{D as tt}from"./Delete--UMz92cn.js";import{C as ge}from"./Close-BqhJje-8.js";import{A as st}from"./Autocomplete-CM2FGr1b.js";import{L as at,S as rt}from"./Skeleton-7rPWEb9U.js";import{D as xe}from"./DialogActions-y29FWvK6.js";import{D as it}from"./DialogContentText-CLzdagWg.js";const ot=Le(e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM8 9h8v10H8zm7.5-5-1-1h-5l-1 1H5v2h14V4z"})),C="#E15B65",z="https://api.bookmyevent.ae/api/photography-packages";function bt(){const[v,w]=o.useState([]),[M,B]=o.useState(!0),[T,g]=o.useState({open:!1,message:"",severity:"success"}),[p,G]=o.useState({search:"",category:""}),[L,me]=o.useState(""),[nt,pe]=o.useState(!1),[je,b]=o.useState(!1),[ve,A]=o.useState(!1),[Y,q]=o.useState(null),[J,K]=o.useState(null),[k,X]=o.useState(!1),[lt,fe]=o.useState(0),[i,h]=o.useState({packageTitle:"",description:"",categories:[],includedServices:[],price:"",advanceBookingAmount:"",cancellationPolicy:"",travelToVenue:!0,isActive:!0,gallery:[]}),[P,_]=o.useState(""),[Z,V]=o.useState(""),[ye,$]=o.useState([]),[Se,W]=o.useState([]),Q=o.useRef(),f=localStorage.getItem("token"),R=JSON.parse(localStorage.getItem("user")||"{}"),F=R==null?void 0:R._id,ee=t=>t?`https://api.bookmyevent.ae/${t.startsWith("/")?t.slice(1):t}`:null,be=({src:t,alt:s,title:r})=>{var I;const[a,n]=o.useState(!1),[l,d]=o.useState(!0);return!t||a?e.jsx(ue,{variant:"rounded",sx:{width:70,height:70,bgcolor:C,fontSize:"1.8rem",fontWeight:"bold",color:"white"},children:((I=r==null?void 0:r[0])==null?void 0:I.toUpperCase())||"P"}):e.jsxs(y,{sx:{position:"relative"},children:[l&&e.jsx(rt,{variant:"rectangular",width:70,height:70,sx:{borderRadius:2}}),e.jsx(ue,{variant:"rounded",src:t,alt:s,sx:{width:70,height:70,borderRadius:2,display:l?"none":"block"},imgProps:{onLoad:()=>d(!1),onError:()=>{n(!0),d(!1)}}})]})},N=o.useCallback(async()=>{if(!F||!f){g({open:!0,message:"Please login again",severity:"error"}),B(!1);return}B(!0);try{const t=await fetch(`${z}/provider/${F}`,{headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to load packages");const s=await t.json();s.success&&w(s.data||[])}catch(t){g({open:!0,message:t.message,severity:"error"})}finally{B(!1)}},[F,f]);o.useEffect(()=>{N()},[N]),o.useEffect(()=>{const t=setTimeout(()=>G(s=>({...s,search:L})),400);return()=>clearTimeout(t)},[L]);const ke=t=>{q(t),fe(0),pe(!0)},Ce=t=>{q(t),h({packageTitle:t.packageTitle||"",description:t.description||"",categories:t.categories||[],includedServices:t.includedServices||[],price:t.price||"",advanceBookingAmount:t.advanceBookingAmount||"",cancellationPolicy:t.cancellationPolicy||"",travelToVenue:t.travelToVenue||!1,isActive:t.isActive||!1,gallery:t.gallery||[]}),$((t.gallery||[]).map(ee)),W([]),_(""),V(""),b(!0)},we=t=>{const s=Array.from(t.target.files);W(r=>[...r,...s]),s.forEach(r=>{const a=new FileReader;a.onloadend=()=>{$(n=>[...n,a.result])},a.readAsDataURL(r)})},Te=t=>{if(t<i.gallery.length)h(s=>({...s,gallery:s.gallery.filter((r,a)=>a!==t)}));else{const s=t-i.gallery.length;W(r=>r.filter((a,n)=>n!==s))}$(s=>s.filter((r,a)=>a!==t))},Ae=()=>{if(!P.trim())return;const t=Z.split(`
`).map(s=>s.trim()).filter(Boolean);h(s=>({...s,includedServices:[...s.includedServices,{title:P,items:t}]})),_(""),V("")},Pe=t=>{h(s=>({...s,includedServices:s.includedServices.filter((r,a)=>a!==t)}))},Ie=async()=>{X(!0);try{const t=new FormData;t.append("packageTitle",i.packageTitle),t.append("description",i.description||""),t.append("price",i.price),t.append("advanceBookingAmount",i.advanceBookingAmount||""),t.append("cancellationPolicy",i.cancellationPolicy||""),t.append("travelToVenue",i.travelToVenue),t.append("isActive",i.isActive),i.categories.forEach((a,n)=>{t.append(`categories[${n}]`,a._id)}),i.includedServices.forEach((a,n)=>{t.append(`includedServices[${n}][title]`,a.title),a.items.forEach((l,d)=>{t.append(`includedServices[${n}][items][${d}]`,l)})}),i.gallery.forEach((a,n)=>{t.append("existingGallery",a)}),Se.forEach(a=>{t.append("gallery",a)});const r=await(await fetch(`${z}/${Y._id}`,{method:"PUT",headers:{Authorization:`Bearer ${f}`},body:t})).json();r.success?(w(a=>a.map(n=>n._id===Y._id?r.data:n)),g({open:!0,message:"Package updated successfully!",severity:"success"}),b(!1)):g({open:!0,message:r.message||"Update failed",severity:"error"})}catch(t){console.error(t),g({open:!0,message:"Failed to update package",severity:"error"})}finally{X(!1)}},Ee=async(t,s)=>{try{(await(await fetch(`${z}/${t}/toggle-active`,{method:"PATCH",headers:{Authorization:`Bearer ${f}`}})).json()).success&&(w(n=>n.map(l=>l._id===t?{...l,isActive:!s}:l)),g({open:!0,message:"Status updated",severity:"success"}))}catch{g({open:!0,message:"Failed to update status",severity:"error"})}},De=async()=>{try{(await(await fetch(`${z}/${J}`,{method:"DELETE",headers:{Authorization:`Bearer ${f}`}})).json()).success&&(w(r=>r.filter(a=>a._id!==J)),g({open:!0,message:"Package deleted",severity:"success"}))}catch{g({open:!0,message:"Delete failed",severity:"error"})}finally{A(!1),K(null)}},H=o.useMemo(()=>v.filter(t=>{var a,n,l;const s=!p.search||((a=t.packageTitle)==null?void 0:a.toLowerCase().includes(p.search.toLowerCase()))||((n=t.description)==null?void 0:n.toLowerCase().includes(p.search.toLowerCase())),r=!p.category||((l=t.categories)==null?void 0:l.some(d=>d._id===p.category));return s&&r}),[v,p]),te=o.useMemo(()=>{const t=new Map;return v.forEach(s=>{var r;return(r=s.categories)==null?void 0:r.forEach(a=>t.set(a._id,a))}),Array.from(t.values())},[v]),ze=()=>{const t=["No","Title","Categories","Price","Advance","Travel","Status"],s=H.map((d,I)=>{var se;return[I+1,d.packageTitle||"",((se=d.categories)==null?void 0:se.map(Be=>Be.title).join(" | "))||"-",d.price||0,d.advanceBookingAmount||"-",d.travelToVenue?"Yes":"No",d.isActive?"Active":"Inactive"]}),r=[t.join(","),...s.map(d=>d.join(","))].join(`
`),a=new Blob([r],{type:"text/csv"}),n=URL.createObjectURL(a),l=document.createElement("a");l.href=n,l.download=`photography_packages_${new Date().toISOString().slice(0,10)}.csv`,l.click()};return e.jsxs(y,{sx:{bgcolor:"#fafafa",minHeight:"100vh",p:3},children:[e.jsx(_e,{position:"static",color:"transparent",elevation:0,children:e.jsxs(Ve,{children:[e.jsxs(j,{variant:"h5",sx:{flexGrow:1,fontWeight:600},children:["My Photography Packages (",v.length,")"]}),e.jsx(x,{variant:"contained",startIcon:e.jsx(Ge,{}),sx:{bgcolor:C,"&:hover":{bgcolor:"#c14a54"}},onClick:()=>window.location.href="/photography/new",children:"Add New Package"})]})}),e.jsx(ae,{sx:{p:2,mt:3},children:e.jsxs(O,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"center",children:[e.jsx(m,{size:"small",placeholder:"Search packages...",value:L,onChange:t=>me(t.target.value),InputProps:{startAdornment:e.jsx($e,{position:"start",children:e.jsx(Ye,{})})},sx:{width:{xs:"100%",sm:300}}}),e.jsx(We,{size:"small",sx:{minWidth:180},children:e.jsxs(Re,{value:p.category,onChange:t=>G(s=>({...s,category:t.target.value})),displayEmpty:!0,children:[e.jsx(re,{value:"",children:"All Categories"}),te.map(t=>e.jsx(re,{value:t._id,children:t.title},t._id))]})}),e.jsxs(y,{sx:{ml:"auto",gap:1,display:"flex"},children:[e.jsx(x,{variant:"outlined",startIcon:e.jsx(qe,{}),onClick:N,children:"Refresh"}),e.jsx(x,{variant:"outlined",startIcon:e.jsx(Je,{}),onClick:ze,children:"Export CSV"})]})]})}),e.jsx(ae,{sx:{mt:3},children:e.jsx(Ke,{sx:{maxHeight:"70vh"},children:e.jsxs(Xe,{stickyHeader:!0,children:[e.jsx(Ze,{children:e.jsxs(D,{sx:{bgcolor:"#f8f9fa"},children:[e.jsx(c,{children:"#"}),e.jsx(c,{children:"Image"}),e.jsx(c,{children:"Title"}),e.jsx(c,{children:"Categories"}),e.jsx(c,{align:"right",children:"Price"}),e.jsx(c,{children:"Travel"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Actions"})]})}),e.jsxs(Qe,{children:[M&&e.jsx(D,{children:e.jsx(c,{colSpan:8,align:"center",children:e.jsx(ie,{})})}),!M&&H.length===0&&e.jsx(D,{children:e.jsxs(c,{colSpan:8,align:"center",sx:{py:8},children:[e.jsx(j,{variant:"h6",color:"text.secondary",children:v.length===0?"No photography packages created yet":"No packages match your search"}),e.jsx(x,{variant:"contained",sx:{mt:2,bgcolor:C},onClick:()=>window.location.href="/photography/new",children:"Create Your First Package"})]})}),H.map((t,s)=>{var r,a,n;return e.jsxs(D,{hover:!0,children:[e.jsx(c,{children:s+1}),e.jsx(c,{children:e.jsx(be,{src:ee((r=t.gallery)==null?void 0:r[0]),alt:t.packageTitle,title:t.packageTitle})}),e.jsx(c,{children:e.jsx(j,{fontWeight:"medium",children:t.packageTitle})}),e.jsx(c,{children:e.jsx(O,{direction:"row",spacing:.5,flexWrap:"wrap",children:((a=t.categories)==null?void 0:a.length)>0?t.categories.map(l=>e.jsx(E,{label:l.title,size:"small",color:"primary",variant:"outlined"},l._id)):e.jsx(E,{label:"No Category",size:"small"})})}),e.jsx(c,{align:"right",children:e.jsxs(j,{fontWeight:"bold",color:"primary",children:["AED ",(n=t.price)==null?void 0:n.toLocaleString()]})}),e.jsx(c,{children:e.jsx(E,{label:t.travelToVenue?"Yes":"No",color:t.travelToVenue?"success":"default",size:"small"})}),e.jsx(c,{children:e.jsx(et,{checked:t.isActive,onChange:()=>Ee(t._id,t.isActive),color:"success"})}),e.jsx(c,{children:e.jsxs(O,{direction:"row",spacing:.5,children:[e.jsx(U,{title:"View Details",children:e.jsx(S,{size:"small",onClick:()=>ke(t),children:e.jsx(Fe,{fontSize:"small"})})}),e.jsx(U,{title:"Edit Package",children:e.jsx(S,{size:"small",color:"primary",onClick:()=>Ce(t),children:e.jsx(Ne,{fontSize:"small"})})}),e.jsx(U,{title:"Delete",children:e.jsx(S,{size:"small",color:"error",onClick:()=>{K(t._id),A(!0)},children:e.jsx(tt,{fontSize:"small"})})})]})})]},t._id)})]})]})})}),e.jsxs(oe,{open:je,onClose:()=>!k&&b(!1),maxWidth:"md",fullWidth:!0,scroll:"paper",children:[e.jsxs(ne,{sx:{bgcolor:C,color:"white"},children:["Edit Photography Package",e.jsx(S,{sx:{position:"absolute",right:8,top:8,color:"white"},onClick:()=>b(!1),disabled:k,children:e.jsx(ge,{})})]}),e.jsx(le,{dividers:!0,children:e.jsxs(u,{container:!0,spacing:3,sx:{mt:1},children:[e.jsx(u,{item:!0,xs:12,children:e.jsx(m,{fullWidth:!0,label:"Package Title",required:!0,value:i.packageTitle,onChange:t=>h({...i,packageTitle:t.target.value})})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(m,{fullWidth:!0,label:"Description",multiline:!0,rows:3,value:i.description,onChange:t=>h({...i,description:t.target.value})})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(st,{multiple:!0,options:te,getOptionLabel:t=>t.title,value:i.categories,onChange:(t,s)=>h({...i,categories:s}),renderInput:t=>e.jsx(m,{...t,label:"Categories"}),renderTags:(t,s)=>t.map((r,a)=>e.jsx(E,{label:r.title,...s({index:a})}))})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{fullWidth:!0,label:"Price (AED)",type:"number",required:!0,value:i.price,onChange:t=>h({...i,price:t.target.value})})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{fullWidth:!0,label:"Advance Booking Amount (e.g. 50% or 5000)",value:i.advanceBookingAmount,onChange:t=>h({...i,advanceBookingAmount:t.target.value})})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(m,{fullWidth:!0,label:"Cancellation Policy",multiline:!0,rows:2,value:i.cancellationPolicy,onChange:t=>h({...i,cancellationPolicy:t.target.value})})}),e.jsxs(u,{item:!0,xs:12,children:[e.jsx(ce,{control:e.jsx(de,{checked:i.travelToVenue,onChange:t=>h({...i,travelToVenue:t.target.checked})}),label:"Travel to Venue"}),e.jsx(ce,{control:e.jsx(de,{checked:i.isActive,onChange:t=>h({...i,isActive:t.target.checked})}),label:"Package is Active (Visible to customers)"})]}),e.jsxs(u,{item:!0,xs:12,children:[e.jsx(he,{sx:{my:2}}),e.jsx(j,{variant:"h6",gutterBottom:!0,children:"Included Services"}),i.includedServices.map((t,s)=>e.jsxs(y,{sx:{mb:2,p:2,border:"1px solid #ddd",borderRadius:2,position:"relative"},children:[e.jsx(j,{fontWeight:"bold",children:t.title}),e.jsx(He,{dense:!0,children:t.items.map((r,a)=>e.jsx(at,{children:e.jsx(Oe,{primary:`â€¢ ${r}`})},a))}),e.jsx(S,{size:"small",sx:{position:"absolute",top:8,right:8},onClick:()=>Pe(s),children:e.jsx(ot,{})})]},s)),e.jsxs(y,{sx:{mt:2,p:2,border:"2px dashed #ccc",borderRadius:2},children:[e.jsx(m,{fullWidth:!0,label:"Service Title (e.g. Photography)",size:"small",value:P,onChange:t=>_(t.target.value),sx:{mb:2}}),e.jsx(m,{fullWidth:!0,label:"Items (one per line)",multiline:!0,rows:4,size:"small",placeholder:`Candid Photography
Traditional Photography
Drone Shots`,value:Z,onChange:t=>V(t.target.value)}),e.jsx(x,{variant:"outlined",sx:{mt:2},onClick:Ae,disabled:!P.trim(),children:"Add Service"})]})]}),e.jsxs(u,{item:!0,xs:12,children:[e.jsx(he,{sx:{my:2}}),e.jsx(j,{variant:"h6",gutterBottom:!0,children:"Gallery Images"}),e.jsx(x,{variant:"contained",onClick:()=>{var t;return(t=Q.current)==null?void 0:t.click()},children:"Upload New Images"}),e.jsx("input",{ref:Q,type:"file",multiple:!0,accept:"image/*",hidden:!0,onChange:we}),e.jsx(u,{container:!0,spacing:2,sx:{mt:2},children:ye.map((t,s)=>e.jsx(u,{item:!0,xs:6,sm:4,md:3,children:e.jsxs(y,{sx:{position:"relative"},children:[e.jsx("img",{src:t,alt:"",style:{width:"100%",height:150,objectFit:"cover",borderRadius:8}}),e.jsx(S,{size:"small",sx:{position:"absolute",top:4,right:4,bgcolor:"rgba(0,0,0,0.5)",color:"white"},onClick:()=>Te(s),children:e.jsx(ge,{})})]})},s))})]})]})}),e.jsxs(xe,{sx:{p:3},children:[e.jsx(x,{onClick:()=>b(!1),disabled:k,children:"Cancel"}),e.jsx(x,{variant:"contained",sx:{bgcolor:C},onClick:Ie,disabled:k,children:k?e.jsx(ie,{size:24}):"Save Changes"})]})]}),e.jsxs(oe,{open:ve,onClose:()=>A(!1),children:[e.jsx(ne,{children:"Delete Package?"}),e.jsx(le,{children:e.jsx(it,{children:"This action cannot be undone."})}),e.jsxs(xe,{children:[e.jsx(x,{onClick:()=>A(!1),children:"Cancel"}),e.jsx(x,{color:"error",variant:"contained",onClick:De,children:"Delete"})]})]}),e.jsx(Ue,{open:T.open,autoHideDuration:4e3,onClose:()=>g({...T,open:!1}),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(Me,{severity:T.severity,variant:"filled",children:T.message})})]})}export{bt as default};
