import{r as i,j as e,B as c,T as r,x as G,a8 as H,s as $,t as J,S as U,aj as y,b as h,V as K,ap as Q,a9 as X,aa as Y,ab as Z,G as S,p as k,M as T,P as ee,ag as se,av as te,ad as ne,g as z,ar as ie,h as B}from"./index-DaiSIVFY.js";import{C as L}from"./Chat-BxLLLM81.js";import{C as le}from"./Close-nUc7dfNC.js";import{E as re}from"./Event-QnFhIpP6.js";import{C as oe}from"./Category-BQq9bSW4.js";import{A as ae}from"./AccessTime-C079Pa2C.js";import{E as ce}from"./EnquiryChatDialog-CHYtGYZo.js";import{T as de}from"./TableContainer-CCxjY6st.js";import{T as ue,a as x,b as t,c as he}from"./TableRow-ChIWNuSP.js";import{T as xe}from"./TableHead-DGuhomhg.js";import"./ChatBubbleOutline-CC5Q4fJ6.js";import"./DoneAll-B_eSXIVJ.js";import"./Send-BHaMEiE8.js";import"./socket-BpXQx-Y7.js";const Ie=()=>{var I;const[d,A]=i.useState(""),[M,j]=i.useState([]),[m,W]=i.useState(!0),[b,f]=i.useState(null),[p,N]=i.useState(null),[v,E]=i.useState(""),[P,D]=i.useState(!1),[l,q]=i.useState(null),[V,g]=i.useState(!1),[_,C]=i.useState(null);i.useEffect(()=>{const s=localStorage.getItem("user");if(s){const n=JSON.parse(s);console.log("Vendor Mongo ID:",n._id),N(n._id)}},[]),i.useEffect(()=>{(async()=>{if(p)try{const n=await B.get(`https://api.bookmyevent.ae/api/enquiries/provider/${p}`);j(n.data.data||[]),f(null)}catch{f("Failed to fetch enquiries"),j([])}finally{W(!1)}})()},[p]);const F=async s=>{if(window.confirm("Are you sure you want to delete this enquiry?"))try{await B.delete(`https://api.bookmyevent.ae/api/enquiries/${s}`),j(o=>o.filter(R=>R._id!==s)),E("Enquiry deleted successfully")}catch{f("Failed to delete enquiry")}},w=M.filter(s=>{var n;return(s.fullName||"").toLowerCase().includes(d.toLowerCase())||(s.email||"").toLowerCase().includes(d.toLowerCase())||(s.contact||"").includes(d)||(((n=s.moduleId)==null?void 0:n.title)||"").toLowerCase().includes(d.toLowerCase())}),O=s=>{q(s),D(!0)},u=()=>{D(!1),q(null)},a=({icon:s,label:n,value:o})=>e.jsxs(c,{display:"flex",alignItems:"center",gap:2,py:1.5,sx:{borderBottom:"1px solid",borderColor:"divider","&:last-child":{borderBottom:"none"}},children:[e.jsx(c,{sx:{width:40,height:40,borderRadius:"50%",bgcolor:"primary.light",color:"primary.main",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s}),e.jsxs(c,{children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:n}),e.jsx(r,{fontWeight:500,children:o||"N/A"})]})]});return e.jsxs(c,{p:2,children:[e.jsx(r,{variant:"h4",gutterBottom:!0,children:"Enquiries"}),b&&e.jsx(G,{severity:"error",sx:{mb:2},children:b}),e.jsxs(H,{sx:{mt:2},children:[e.jsx(c,{p:2,children:e.jsx($,{label:"Search enquiries",size:"small",value:d,onChange:s=>A(s.target.value),fullWidth:!0})}),e.jsx(de,{children:e.jsxs(ue,{children:[e.jsx(xe,{children:e.jsxs(x,{children:[e.jsx(t,{children:"#"}),e.jsx(t,{children:"Customer"}),e.jsx(t,{children:"Module"}),e.jsx(t,{children:"Contact"}),e.jsx(t,{children:"Date"}),e.jsx(t,{align:"center",children:"Actions"})]})}),e.jsxs(he,{children:[m&&e.jsx(x,{children:e.jsx(t,{colSpan:6,align:"center",children:e.jsx(J,{size:28})})}),!m&&w.map((s,n)=>{var o;return e.jsxs(x,{hover:!0,children:[e.jsx(t,{children:n+1}),e.jsxs(t,{children:[e.jsx(r,{fontWeight:600,children:s.fullName}),e.jsx(r,{variant:"caption",color:"text.secondary",children:s.email})]}),e.jsx(t,{children:(o=s.moduleId)==null?void 0:o.title}),e.jsx(t,{children:s.contact}),e.jsx(t,{children:new Date(s.bookingDate).toLocaleDateString()}),e.jsx(t,{align:"center",children:e.jsxs(U,{direction:"row",spacing:1,justifyContent:"center",children:[e.jsx(y,{title:"Chat",children:e.jsx(h,{size:"small",color:"primary",onClick:()=>{C(s),g(!0)},children:e.jsx(L,{fontSize:"small"})})}),e.jsx(y,{title:"View",children:e.jsx(h,{size:"small",color:"info",onClick:()=>O(s),children:e.jsx(K,{fontSize:"small"})})}),e.jsx(y,{title:"Delete",children:e.jsx(h,{size:"small",color:"error",onClick:()=>F(s._id),children:e.jsx(Q,{fontSize:"small"})})})]})})]},s._id)}),!m&&w.length===0&&e.jsx(x,{children:e.jsx(t,{colSpan:6,align:"center",children:"No enquiries found"})})]})]})})]}),e.jsxs(X,{open:P,onClose:u,maxWidth:"md",fullWidth:!0,children:[e.jsx(Y,{sx:{bgcolor:"primary.main",color:"white"},children:e.jsxs(c,{display:"flex",justifyContent:"space-between",children:[e.jsx(r,{fontWeight:600,children:"Enquiry Details"}),e.jsx(h,{onClick:u,sx:{color:"white"},children:e.jsx(le,{})})]})}),e.jsx(Z,{children:l&&e.jsxs(S,{container:!0,spacing:3,mt:1,children:[e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(k,{variant:"outlined",children:e.jsxs(T,{children:[e.jsx(r,{fontWeight:600,mb:2,children:"Customer Information"}),e.jsx(a,{icon:e.jsx(ee,{fontSize:"small"}),label:"Full Name",value:l.fullName}),e.jsx(a,{icon:e.jsx(se,{fontSize:"small"}),label:"Email",value:l.email}),e.jsx(a,{icon:e.jsx(te,{fontSize:"small"}),label:"Contact",value:l.contact})]})})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(k,{variant:"outlined",children:e.jsxs(T,{children:[e.jsx(r,{fontWeight:600,mb:2,children:"Booking Information"}),e.jsx(a,{icon:e.jsx(oe,{fontSize:"small"}),label:"Module",value:(I=l.moduleId)==null?void 0:I.title}),e.jsx(a,{icon:e.jsx(re,{fontSize:"small"}),label:"Booking Date",value:new Date(l.bookingDate).toLocaleDateString()}),e.jsx(a,{icon:e.jsx(ae,{fontSize:"small"}),label:"Created At",value:new Date(l.createdAt).toLocaleString()})]})})})]})}),e.jsxs(ne,{children:[e.jsx(z,{onClick:u,variant:"outlined",children:"Close"}),e.jsx(z,{variant:"contained",startIcon:e.jsx(L,{}),onClick:()=>{u(),C(l),g(!0)},children:"Open Chat"})]})]}),e.jsx(ce,{open:V,onClose:()=>{g(!1),C(null)},enquiry:_}),e.jsx(ie,{open:!!v,autoHideDuration:3e3,onClose:()=>E(""),message:v})]})};export{Ie as default};
