import{p as Me,d as Be,r as i,j as e,B as c,c as he,s as A,t as De,T as j,H as O,k as U,a as h,S as R,F as me,I as xe,o as fe,M as P,x as We,a1 as _e,w as I,z as Fe,b as je,h as w}from"./index-CyX4fgy4.js";import{A as Ne}from"./Add-DwyBTkAb.js";import{S as V}from"./Switch-DdBWsjXK.js";import{C as ve}from"./Close-CXFO8PeR.js";import{C as $e}from"./CloudUpload-J9I_r8B8.js";import{D as ze}from"./Delete-CuKPI1co.js";const f="#E91E63",b="https://api.bookmyevent.ae",be="68e5fc09651cc12c1fc0f9c9",Le=["HD Makeup","Airbrush Makeup","Matte Makeup","Dewy/Glass Makeup","Mineral Makeup","Traditional"],Oe=({section:g,onChange:S,onDelete:m})=>e.jsxs(c,{sx:{position:"relative",border:"1px solid #e5e5e5",borderRadius:2,p:3,mb:3,bgcolor:"white"},children:[e.jsx(A,{onClick:m,sx:{position:"absolute",top:12,right:12,color:f},children:e.jsx(ze,{fontSize:"small"})}),e.jsx(h,{fullWidth:!0,label:e.jsxs("span",{children:["Section Title ",e.jsx("span",{style:{color:"red"},children:"*"})]}),value:g.title||"",onChange:v=>S("title",v.target.value),sx:{mb:2}}),e.jsx(h,{fullWidth:!0,label:e.jsxs("span",{children:["Items (comma separated) ",e.jsx("span",{style:{color:"red"},children:"*"})]}),placeholder:"e.g. Bridal Bun, Curls, Waves",value:Array.isArray(g.items)?g.items.join(", "):"",onChange:v=>S("items",v.target.value),multiline:!0,rows:2,helperText:"Separate items with commas"})]}),qe=()=>{const{id:g}=Me(),S=Be(),m=!!g,[v,G]=i.useState(!0),[H,J]=i.useState(!1),[q,E]=i.useState(""),[K,d]=i.useState(""),[T,Se]=i.useState([]),[ye,Y]=i.useState(!0),[o,Q]=i.useState(null),[M,X]=i.useState(""),[B,Z]=i.useState([]),[D,ee]=i.useState(""),[W,te]=i.useState(""),[ae,se]=i.useState(""),[_,ie]=i.useState(""),[re,le]=i.useState(""),[ne,oe]=i.useState(""),[F,ce]=i.useState(!1),[N,de]=i.useState(!1),[$,ue]=i.useState(!0),[z,y]=i.useState([{id:Date.now(),title:"",items:[]}]),[k,ke]=i.useState({hairStyling:!1,sareeDraping:!1,eyelashExtension:!1,nailPolish:!1}),[C,pe]=i.useState([]),[L,ge]=i.useState([]);i.useEffect(()=>{(()=>{try{const a=localStorage.getItem("vendor")||localStorage.getItem("user")||localStorage.getItem("vendorData");if(a){const s=JSON.parse(a);Q(s),console.log("Loaded vendor:",s)}else{const s=localStorage.getItem("vendorId")||localStorage.getItem("userId");s&&Q({_id:s,id:s})}}catch(a){console.error("Error loading vendor info:",a)}})()},[]),i.useEffect(()=>{(async()=>{try{Y(!0);const a=await w.get(`${b}/api/categories/modules/${be}`);a.data.success&&Array.isArray(a.data.data)?Se(a.data.data):d("No makeup categories found")}catch(a){console.error("Error fetching makeup categories:",a),d("Failed to load categories. Please refresh.")}finally{Y(!1)}})()},[]),i.useEffect(()=>{if(!m){G(!1);return}(async()=>{var a,s,l,u,x;try{const n=(await w.get(`${b}/api/makeup-packages/${g}`)).data.data;X(n.packageTitle||""),Z(((a=n.categories)==null?void 0:a.map(p=>p._id||p))||[]),ee(n.makeupType||""),te(((s=n.basePrice)==null?void 0:s.toString())||""),se(((l=n.offerPrice)==null?void 0:l.toString())||"0"),ie(n.description||""),le(n.cancellationPolicy||""),oe(n.advanceBookingAmount||""),ce(n.trialMakeupIncluded||!1),de(n.travelToVenue||!1),ue(n.isActive??!0),((u=n.includedServices)==null?void 0:u.length)>0&&y(n.includedServices.map(p=>({id:p._id||Date.now(),title:p.title||"",items:Array.isArray(p.items)?p.items:[]}))),((x=n.gallery)==null?void 0:x.length)>0&&ge(n.gallery.map(p=>`${b}${p}`))}catch{d("Failed to load package.")}finally{G(!1)}})()},[g,m]);const Ce=()=>{y(t=>[...t,{id:Date.now(),title:"",items:[]}])},Pe=(t,a,s)=>{y(l=>l.map(u=>{if(u.id===t){if(a==="items"){const x=s.split(",").map(r=>r.trim()).filter(Boolean);return{...u,items:x}}return{...u,[a]:s}}return u}))},Ie=t=>{z.length>1&&y(a=>a.filter(s=>s.id!==t))},we=t=>{const a=Array.from(t.target.files);if(C.length+L.length+a.length>5){alert("Maximum 5 images allowed");return}pe(l=>[...l,...a])},Ae=t=>pe(a=>a.filter((s,l)=>l!==t)),Ee=t=>ge(a=>a.filter((s,l)=>l!==t)),Te=async()=>{var u,x;const t=(o==null?void 0:o._id)||(o==null?void 0:o.id);if(!t){d("Vendor not authenticated. Please login again.");return}if(!M.trim())return d("Package title is required");if(B.length===0)return d("Select at least one category");if(!D)return d("Select makeup type");if(!W)return d("Base price is required");if(!_.trim())return d("Description is required");J(!0),d(""),E("");const a=new FormData;a.append("module",be),a.append("packageTitle",M.trim()),B.forEach(r=>a.append("categories",r)),a.append("makeupType",D),a.append("description",_.trim()),a.append("basePrice",W),a.append("offerPrice",ae||"0"),a.append("cancellationPolicy",re),a.append("advanceBookingAmount",ne),a.append("trialMakeupIncluded",F),a.append("travelToVenue",N),a.append("isActive",$),a.append("providerId",t);const s=z.filter(r=>r.title.trim()&&r.items.length>0).map(r=>({title:r.title.trim(),items:r.items}));a.append("includedServices",JSON.stringify(s));const l=Object.keys(k).filter(r=>k[r]).map(r=>({hairStyling:"Hair Styling",sareeDraping:"Saree Draping",eyelashExtension:"Eyelash Extension",nailPolish:"Nail Polish"})[r]);if(l.length>0){let r=JSON.parse(a.get("includedServices")||"[]");r.push({title:"Basic Add-ons",items:l}),a.set("includedServices",JSON.stringify(r))}C.forEach(r=>a.append("gallery",r));try{m?(await w.put(`${b}/api/makeup-packages/${g}`,a),E("Package updated successfully!")):(await w.post(`${b}/api/makeup-packages`,a),E("Package created successfully!"))}catch(r){d(((x=(u=r.response)==null?void 0:u.data)==null?void 0:x.message)||"Failed to save package")}finally{J(!1),window.scrollTo({top:0,behavior:"smooth"})}};return v||ye?e.jsx(c,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:e.jsx(he,{size:60})}):e.jsxs(c,{sx:{bgcolor:"#f9f9fc",minHeight:"100vh"},children:[e.jsxs(c,{sx:{bgcolor:"white",borderBottom:"1px solid #eee",p:2,px:4,position:"sticky",top:0,zIndex:10},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(A,{onClick:()=>S(-1),children:e.jsx(De,{})}),e.jsxs(j,{variant:"h5",fontWeight:"bold",children:[m?"Edit":"Add"," Makeup Package"]})]}),o&&e.jsxs(j,{variant:"body2",color:"text.secondary",sx:{ml:7},children:["Creating as: ",o.firstName||o.email||o._id]})]}),e.jsxs(c,{sx:{p:{xs:2,md:4}},children:[q&&e.jsx(O,{severity:"success",sx:{mb:3},children:q}),K&&e.jsx(O,{severity:"error",sx:{mb:3},children:K}),!o&&e.jsx(O,{severity:"warning",sx:{mb:3},children:"Vendor information not found. Please login again to create packages."}),e.jsxs(U,{elevation:3,sx:{borderRadius:3,p:{xs:3,md:6}},children:[e.jsx(h,{fullWidth:!0,label:"Package Title *",value:M,onChange:t=>X(t.target.value),sx:{mb:3}}),e.jsxs(R,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsxs(me,{fullWidth:!0,children:[e.jsx(xe,{children:"Category *"}),e.jsx(fe,{multiple:!0,value:B,onChange:t=>Z(t.target.value),renderValue:t=>e.jsx(c,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(a=>{const s=T.find(l=>l._id===a);return e.jsx(We,{label:(s==null?void 0:s.title)||"Unknown",size:"small"},a)})}),children:T.length===0?e.jsx(P,{disabled:!0,children:"No categories available"}):T.map(t=>e.jsx(P,{value:t._id,children:t.title},t._id))})]}),e.jsxs(me,{fullWidth:!0,children:[e.jsx(xe,{children:"Makeup Type *"}),e.jsxs(fe,{value:D,onChange:t=>ee(t.target.value),children:[e.jsx(P,{value:"",disabled:!0,children:"Select Type"}),Le.map(t=>e.jsx(P,{value:t,children:t},t))]})]})]}),e.jsxs(R,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsx(h,{fullWidth:!0,label:"Base Price *",type:"number",value:W,onChange:t=>te(t.target.value)}),e.jsx(h,{fullWidth:!0,label:"Offer Price",type:"number",value:ae,onChange:t=>se(t.target.value),helperText:"Leave empty if no discount"}),e.jsx(h,{fullWidth:!0,label:"Advance Booking Amount",value:ne,onChange:t=>oe(t.target.value)})]}),e.jsx(h,{fullWidth:!0,label:"Description *",multiline:!0,rows:4,value:_,onChange:t=>ie(t.target.value),sx:{mb:4}}),e.jsx(j,{variant:"h6",sx:{mb:2,color:f},children:"Basic Add-ons"}),e.jsx(U,{variant:"outlined",sx:{p:3,mb:4,bgcolor:"#fafafa"},children:e.jsx(_e,{row:!0,children:Object.keys(k).map(t=>e.jsx(I,{control:e.jsx(Fe,{checked:k[t],onChange:a=>ke(s=>({...s,[t]:a.target.checked}))}),label:t==="hairStyling"?"Hair Styling":t==="sareeDraping"?"Saree Draping":t==="eyelashExtension"?"Eyelash Extension":"Nail Polish"},t))})}),e.jsxs(c,{sx:{mb:4},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(j,{variant:"h6",sx:{color:f},children:"Custom Service Sections"}),e.jsx(je,{variant:"contained",startIcon:e.jsx(Ne,{}),sx:{bgcolor:f},onClick:Ce,children:"Add Section"})]}),z.map(t=>e.jsx(Oe,{section:t,onChange:(a,s)=>Pe(t.id,a,s),onDelete:()=>Ie(t.id)},t.id))]}),e.jsx(h,{fullWidth:!0,label:"Cancellation Policy",multiline:!0,rows:3,value:re,onChange:t=>le(t.target.value),sx:{mb:4}}),e.jsxs(R,{direction:"row",spacing:4,sx:{mb:4},children:[e.jsx(I,{control:e.jsx(V,{checked:F,onChange:()=>ce(!F)}),label:"Trial Makeup Included"}),e.jsx(I,{control:e.jsx(V,{checked:N,onChange:()=>de(!N)}),label:"Travel to Venue"}),e.jsx(I,{control:e.jsx(V,{checked:$,onChange:()=>ue(!$)}),label:"Package Active"})]}),e.jsx(j,{variant:"h6",sx:{color:f,mb:2},children:"Gallery (Max 5)"}),e.jsxs(U,{onClick:()=>document.getElementById("gallery-input").click(),sx:{border:"2px dashed #ddd",borderRadius:2,p:4,textAlign:"center",cursor:"pointer",mb:4},children:[e.jsx("input",{id:"gallery-input",type:"file",hidden:!0,multiple:!0,accept:"image/*",onChange:we}),C.length>0||L.length>0?e.jsxs(c,{sx:{display:"flex",flexWrap:"wrap",gap:2},children:[L.map((t,a)=>e.jsxs(c,{sx:{position:"relative"},children:[e.jsx("img",{src:t,alt:"",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(A,{onClick:s=>{s.stopPropagation(),Ee(a)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(ve,{fontSize:"small"})})]},`ex-${a}`)),C.map((t,a)=>e.jsxs(c,{sx:{position:"relative"},children:[e.jsx("img",{src:URL.createObjectURL(t),alt:"",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(A,{onClick:s=>{s.stopPropagation(),Ae(a)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(ve,{fontSize:"small"})})]},`new-${a}`))]}):e.jsxs(e.Fragment,{children:[e.jsx($e,{sx:{fontSize:60,color:"#ccc"}}),e.jsx(j,{sx:{mt:2,color:f,fontWeight:"bold"},children:"Click to Upload Images"})]})]}),e.jsx(je,{fullWidth:!0,variant:"contained",size:"large",onClick:Te,disabled:H||!o,sx:{py:2,bgcolor:f,"&:hover":{bgcolor:"#c2185b"}},children:H?e.jsx(he,{size:28,color:"inherit"}):m?"Update Package":"Create Package"})]})]})]})};export{qe as default};
