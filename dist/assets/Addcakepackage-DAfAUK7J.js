import{w as gt,r as s,j as e,B as g,t as ze,b as A,aj as ht,T as x,x as Re,ad as ae,s as u,S as b,F as _,I as F,af as L,_ as y,C as pt,a6 as mt,a8 as xt,O as ft,f as se,ak as ie,g as Ge,h as S,ar as bt}from"./index-X7Dtcx5r.js";import{A as jt}from"./Add-u-fxo9U-.js";import{C as ne}from"./Close-BYnvPuhq.js";import{C as He}from"./CloudUpload-_QfdWOFE.js";const d="#E91E63",k="https://api.bookmyevent.ae",Je="68e5fc09651cc12c1fc0f9c9",yt=({variation:P,onChange:M,onDelete:C})=>e.jsxs(b,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"center",sx:{mb:2},children:[e.jsx(u,{label:"Variation Name (e.g. Half Kg)",value:P.name||"",onChange:p=>M("name",p.target.value),sx:{flex:1}}),e.jsx(u,{label:"Price (₹)",type:"number",value:P.price||"",onChange:p=>M("price",p.target.value),sx:{width:150}}),e.jsx(A,{onClick:C,color:"error",children:e.jsx(bt,{})})]}),It=()=>{const P=gt(),C=new URLSearchParams(window.location.search).get("id"),p=!!C,[Qe,re]=s.useState(!0),[oe,le]=s.useState(!1),[ce,U]=s.useState(""),[de,m]=s.useState(""),[qe,Ke]=s.useState([]),[ue,N]=s.useState([]),[Xe,Ye]=s.useState(!0),[h,Ze]=s.useState(null),[V,ge]=s.useState(""),[he,pe]=s.useState(""),[B,$]=s.useState(""),[D,O]=s.useState([]),[me,xe]=s.useState("Veg"),[z,fe]=s.useState(""),[R,be]=s.useState(""),[G,je]=s.useState(!0),[ye,Ce]=s.useState("10:00"),[ve,Se]=s.useState("22:00"),[H,ke]=s.useState(""),[J,Ie]=s.useState(""),[we,Te]=s.useState("Amount"),[Q,Ae]=s.useState(""),[q,Pe]=s.useState(""),[K,Ne]=s.useState(""),[X,Be]=s.useState(!0),[Y,De]=s.useState(!1),[Ee,E]=s.useState([{id:Date.now(),name:"",price:""}]),[j,We]=s.useState(null),[Z,et]=s.useState(""),[W,_e]=s.useState([]),[ee,Fe]=s.useState([]);s.useEffect(()=>{try{const t=localStorage.getItem("vendor")||localStorage.getItem("user")||localStorage.getItem("vendorData");t&&Ze(JSON.parse(t))}catch(t){console.error("Vendor load error:",t)}},[]),s.useEffect(()=>{(async()=>{var a;try{const i=localStorage.getItem("token"),c=((a=(await S.get(`${k}/api/categories/parents/${Je}`,{headers:{Authorization:`Bearer ${i}`}})).data)==null?void 0:a.data)||[];Ke(c),console.log("✅ Parent Categories Loaded:",c)}catch(i){console.error("❌ Failed to load parent categories:",i),m("Failed to load categories")}finally{Ye(!1)}})()},[]);const tt=async t=>{var i;const a=t.target.value;if($(a),O([]),N([]),!!a)try{const o=localStorage.getItem("token"),f=((i=(await S.get(`${k}/api/categories/parents/${a}/subcategories`,{headers:{Authorization:`Bearer ${o}`}})).data)==null?void 0:i.data)||[];N(f),console.log("✅ Subcategories Loaded:",f)}catch(o){console.error("❌ Failed to load subcategories:",o),N([])}};s.useEffect(()=>{if(!p){re(!1);return}(async()=>{var a,i,o,c,f,I,w,T,r,l,Le,Me,Ue,Ve,$e,Oe;try{const{data:te}=await S.get(`${k}/api/cakes/${C}`),n=te.data;if(ge(n.name),pe(n.shortDescription),(i=(a=n.category)==null?void 0:a.parentCategory)!=null&&i._id){const v=n.category.parentCategory._id;$(v);const dt=localStorage.getItem("token"),ut=await S.get(`${k}/api/categories/parents/${v}/subcategories`,{headers:{Authorization:`Bearer ${dt}`}});N(((o=ut.data)==null?void 0:o.data)||[]),O([n.category._id])}else(c=n.category)!=null&&c._id&&$(n.category._id);xe(n.itemType),fe(((f=n.nutrition)==null?void 0:f.join(", "))||""),be(((I=n.allergenIngredients)==null?void 0:I.join(", "))||""),je(n.isHalal),Ce(((w=n.timeSchedule)==null?void 0:w.startTime)||"10:00"),Se(((T=n.timeSchedule)==null?void 0:T.endTime)||"22:00"),ke(((r=n.priceInfo)==null?void 0:r.unitPrice)||""),Ie(((l=n.priceInfo)==null?void 0:l.advanceBookingAmount)||""),Te(((Le=n.priceInfo)==null?void 0:Le.discountType)||"Amount"),Ae(((Me=n.priceInfo)==null?void 0:Me.discount)||""),Pe(((Ue=n.priceInfo)==null?void 0:Ue.maxPurchaseQty)||""),Ne(((Ve=n.searchTags)==null?void 0:Ve.join(", "))||""),Be(n.isActive),De(n.isTopPick),(($e=n.variations)==null?void 0:$e.length)>0&&E(n.variations.map(v=>({id:v._id||Date.now(),name:v.name,price:v.price}))),n.thumbnail&&et(n.thumbnail),((Oe=n.images)==null?void 0:Oe.length)>0&&Fe(n.images)}catch(te){console.error("Failed to load cake:",te),m("Failed to load cake details")}finally{re(!1)}})()},[p,C]);const at=()=>{E(t=>[...t,{id:Date.now(),name:"",price:""}])},st=(t,a,i)=>{E(o=>o.map(c=>c.id===t?{...c,[a]:i}:c))},it=t=>{E(a=>a.filter(i=>i.id!==t))},nt=t=>{const a=t.target.files[0];a&&We(a)},rt=t=>{const a=Array.from(t.target.files);if(W.length+ee.length+a.length>10){alert("Maximum 10 gallery images allowed");return}_e(o=>[...o,...a])},ot=t=>_e(a=>a.filter((i,o)=>o!==t)),lt=t=>Fe(a=>a.filter((i,o)=>o!==t)),ct=async()=>{var c,f,I,w,T;const t=(h==null?void 0:h._id)||(h==null?void 0:h.id);if(!t){m("Vendor not authenticated");return}if(!V.trim()){m("Cake name is required");return}if(!B){m("Select a category");return}if(!H){m("Unit price is required");return}if(!j&&!Z){m("Thumbnail image is required");return}const a=new FormData;a.append("name",V),a.append("shortDescription",he),a.append("module",Je),a.append("category",B),a.append("itemType",me),a.append("isHalal",G),a.append("isActive",X),a.append("isTopPick",Y),a.append("provider",t),D.length>0&&a.append("subCategories",JSON.stringify(D)),a.append("timeSchedule",JSON.stringify({startTime:ye,endTime:ve}));const i={unitPrice:Number(H),discountType:we,discount:Q?Number(Q):0,maxPurchaseQty:q?Number(q):void 0};if(J&&(i.advanceBookingAmount=Number(J)),a.append("priceInfo",JSON.stringify(i)),z.trim()){const r=z.split(",").map(l=>l.trim()).filter(Boolean);a.append("nutrition",JSON.stringify(r))}if(R.trim()){const r=R.split(",").map(l=>l.trim()).filter(Boolean);a.append("allergenIngredients",JSON.stringify(r))}if(K.trim()){const r=K.split(",").map(l=>l.trim()).filter(Boolean);a.append("searchTags",JSON.stringify(r))}const o=Ee.filter(r=>r.name&&r.price).map(({name:r,price:l})=>({name:r,price:Number(l)}));o.length>0&&a.append("variations",JSON.stringify(o)),j&&a.append("thumbnail",j),W.forEach(r=>{a.append("images",r)});try{le(!0),m(""),U("");let r;if(p?(r=await S.put(`${k}/api/cakes/${C}`,a,{headers:{"Content-Type":"multipart/form-data"}}),U("Cake updated successfully!")):(r=await S.post(`${k}/api/cakes`,a,{headers:{"Content-Type":"multipart/form-data"}}),U("Cake created successfully!")),r.data.success&&r.data.data){const l=r.data.data;console.log("✅ Cake Package Created/Updated:",{id:l._id,name:l.name,cakeId:l.cakeId,category:(c=l.category)==null?void 0:c.title,provider:(f=l.provider)==null?void 0:f.storeName,thumbnail:l.thumbnail,priceInfo:l.priceInfo,variations:l.variations,module:(I=l.module)==null?void 0:I.title})}}catch(r){console.error("Submit error:",r),m(((T=(w=r.response)==null?void 0:w.data)==null?void 0:T.message)||"Error saving cake")}finally{le(!1),window.scrollTo({top:0,behavior:"smooth"})}};return Qe||Xe?e.jsx(g,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:e.jsx(ze,{size:60,sx:{color:d}})}):e.jsxs(g,{sx:{bgcolor:"#f9f9fc",minHeight:"100vh"},children:[e.jsxs(g,{sx:{bgcolor:"white",borderBottom:"1px solid #eee",p:2,px:4,position:"sticky",top:0,zIndex:10},children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(A,{onClick:()=>P(-1),children:e.jsx(ht,{})}),e.jsxs(x,{variant:"h5",fontWeight:"bold",children:[p?"Edit":"Add"," Cake Package"]})]}),h&&e.jsxs(x,{variant:"body2",color:"text.secondary",sx:{ml:7},children:["Creating as: ",h.firstName," ",h.lastName]})]}),e.jsxs(g,{sx:{p:{xs:2,md:4}},children:[ce&&e.jsx(Re,{severity:"success",sx:{mb:3},children:ce}),de&&e.jsx(Re,{severity:"error",sx:{mb:3},children:de}),e.jsxs(ae,{elevation:3,sx:{borderRadius:3,p:{xs:3,md:6}},children:[e.jsx(u,{fullWidth:!0,label:"Cake Name *",value:V,onChange:t=>ge(t.target.value),sx:{mb:3}}),e.jsx(u,{fullWidth:!0,label:"Short Description *",multiline:!0,rows:2,value:he,onChange:t=>pe(t.target.value),sx:{mb:3}}),e.jsxs(b,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsxs(_,{fullWidth:!0,children:[e.jsx(F,{children:"Parent Category *"}),e.jsxs(L,{value:B,onChange:tt,children:[e.jsx(y,{value:"",children:"Select Parent Category"}),qe.map(t=>e.jsx(y,{value:t._id,children:t.title},t._id))]})]}),e.jsxs(_,{fullWidth:!0,disabled:!B,children:[e.jsx(F,{children:"Sub Categories"}),e.jsx(L,{multiple:!0,value:D,onChange:t=>O(t.target.value),input:e.jsx(ft,{}),renderValue:t=>e.jsx(g,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(a=>{const i=ue.find(o=>o._id===a);return e.jsx(xt,{label:(i==null?void 0:i.title)||a,size:"small"},a)})}),children:ue.map(t=>e.jsxs(y,{value:t._id,children:[e.jsx(pt,{checked:D.includes(t._id)}),e.jsx(mt,{primary:t.title})]},t._id))})]})]}),e.jsxs(b,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3,alignItems:"center"},children:[e.jsxs(_,{fullWidth:!0,children:[e.jsx(F,{children:"Item Type"}),e.jsxs(L,{value:me,onChange:t=>xe(t.target.value),children:[e.jsx(y,{value:"Veg",children:"Veg"}),e.jsx(y,{value:"Non-Veg",children:"Non-Veg"})]})]}),e.jsx(se,{control:e.jsx(ie,{checked:G,onChange:()=>je(!G),sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:d}}}),label:"Halal Certified"})]}),e.jsxs(b,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsx(u,{fullWidth:!0,label:"Nutrition (comma separated)",placeholder:"e.g. Sugar, Milk, Flour",value:z,onChange:t=>fe(t.target.value)}),e.jsx(u,{fullWidth:!0,label:"Allergen Ingredients (comma separated)",placeholder:"e.g. Nuts, Gluten",value:R,onChange:t=>be(t.target.value)})]}),e.jsx(x,{variant:"h6",sx:{mb:2,color:d},children:"Availability Time"}),e.jsxs(b,{direction:{xs:"column",sm:"row"},spacing:3,sx:{mb:4},children:[e.jsx(u,{label:"Start Time",type:"time",value:ye,onChange:t=>Ce(t.target.value),InputLabelProps:{shrink:!0},fullWidth:!0}),e.jsx(u,{label:"End Time",type:"time",value:ve,onChange:t=>Se(t.target.value),InputLabelProps:{shrink:!0},fullWidth:!0})]}),e.jsx(x,{variant:"h6",sx:{mb:2,color:d},children:"Pricing"}),e.jsxs(b,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:2},children:[e.jsx(u,{fullWidth:!0,label:"Base Unit Price (₹) *",type:"number",value:H,onChange:t=>ke(t.target.value)}),e.jsx(u,{fullWidth:!0,label:"Advance Booking Amount (₹)",type:"number",value:J,onChange:t=>Ie(t.target.value),helperText:"Amount to be paid upfront"})]}),e.jsxs(b,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsxs(_,{sx:{minWidth:150},children:[e.jsx(F,{children:"Discount Type"}),e.jsxs(L,{value:we,onChange:t=>Te(t.target.value),children:[e.jsx(y,{value:"Amount",children:"Amount"}),e.jsx(y,{value:"Percentage",children:"Percentage"})]})]}),e.jsx(u,{label:"Discount Value",type:"number",value:Q,onChange:t=>Ae(t.target.value),fullWidth:!0}),e.jsx(u,{label:"Max Purchase Qty",type:"number",value:q,onChange:t=>Pe(t.target.value),fullWidth:!0})]}),e.jsxs(g,{sx:{mb:4},children:[e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(x,{variant:"h6",sx:{color:d},children:"Variations (Size/Weight)"}),e.jsx(Ge,{variant:"contained",startIcon:e.jsx(jt,{}),sx:{bgcolor:d,"&:hover":{bgcolor:"#c2185b"}},onClick:at,children:"Add Variation"})]}),Ee.map(t=>e.jsx(yt,{variation:t,onChange:(a,i)=>st(t.id,a,i),onDelete:()=>it(t.id)},t.id))]}),e.jsx(u,{fullWidth:!0,label:"Search Tags (comma separated)",placeholder:"e.g. chocolate, birthday, wedding",value:K,onChange:t=>Ne(t.target.value),sx:{mb:4}}),e.jsxs(b,{direction:"row",spacing:4,sx:{mb:4},children:[e.jsx(se,{control:e.jsx(ie,{checked:X,onChange:()=>Be(!X),sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:d}}}),label:"Active"}),e.jsx(se,{control:e.jsx(ie,{checked:Y,onChange:()=>De(!Y),sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:d}}}),label:"Top Pick"})]}),e.jsx(x,{variant:"h6",sx:{color:d,mb:2},children:"Thumbnail Image *"}),e.jsxs(ae,{onClick:()=>document.getElementById("thumbnail-input").click(),sx:{border:"2px dashed #ddd",borderRadius:2,p:4,textAlign:"center",cursor:"pointer",mb:4},children:[e.jsx("input",{id:"thumbnail-input",type:"file",hidden:!0,accept:"image/*",onChange:nt}),j||Z?e.jsxs(g,{sx:{position:"relative",display:"inline-block"},children:[e.jsx("img",{src:j?URL.createObjectURL(j):Z,alt:"Thumbnail",style:{width:200,height:200,objectFit:"cover",borderRadius:8}}),j&&e.jsx(A,{onClick:t=>{t.stopPropagation(),We(null)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(ne,{})})]}):e.jsxs(e.Fragment,{children:[e.jsx(He,{sx:{fontSize:60,color:"#ccc"}}),e.jsx(x,{sx:{mt:2,color:d,fontWeight:"bold"},children:"Click to Upload Thumbnail"})]})]}),e.jsx(x,{variant:"h6",sx:{color:d,mb:2},children:"Gallery Images (Max 10)"}),e.jsxs(ae,{onClick:()=>document.getElementById("gallery-input").click(),sx:{border:"2px dashed #ddd",borderRadius:2,p:4,textAlign:"center",cursor:"pointer",mb:4},children:[e.jsx("input",{id:"gallery-input",type:"file",hidden:!0,multiple:!0,accept:"image/*",onChange:rt}),W.length>0||ee.length>0?e.jsxs(g,{sx:{display:"flex",flexWrap:"wrap",gap:2,justifyContent:"center"},children:[ee.map((t,a)=>e.jsxs(g,{sx:{position:"relative"},children:[e.jsx("img",{src:t,alt:"",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(A,{onClick:i=>{i.stopPropagation(),lt(a)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(ne,{fontSize:"small"})})]},`ex-${a}`)),W.map((t,a)=>e.jsxs(g,{sx:{position:"relative"},children:[e.jsx("img",{src:URL.createObjectURL(t),alt:"",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(A,{onClick:i=>{i.stopPropagation(),ot(a)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(ne,{fontSize:"small"})})]},`new-${a}`))]}):e.jsxs(e.Fragment,{children:[e.jsx(He,{sx:{fontSize:60,color:"#ccc"}}),e.jsx(x,{sx:{mt:2,color:d,fontWeight:"bold"},children:"Click to Upload Gallery Images"})]})]}),e.jsx(Ge,{fullWidth:!0,variant:"contained",size:"large",onClick:ct,disabled:oe||!h,sx:{py:2,bgcolor:d,"&:hover":{bgcolor:"#c2185b"}},children:oe?e.jsx(ze,{size:28,color:"inherit"}):p?"Update Cake Package":"Create Cake Package"})]})]})]})};export{It as default};
