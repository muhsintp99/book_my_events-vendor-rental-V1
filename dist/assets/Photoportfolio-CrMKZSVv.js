import{r as l,h as et,j as e,B as d,t as tt,ag as st,ah as it,p as Ie,T as C,F as rt,a9 as ot,Q as ke,K as A,s as f,ad as T,g as L,G as P,c as m,a5 as Se,a6 as at,a8 as lt}from"./index-Cq19nQvN.js";import{T as nt,a as Te}from"./Tabs-D2Vq0giP.js";import{C as Le}from"./CloudUpload-CUbnba38.js";import{C as J}from"./Close-n7idMwYI.js";import{T as De}from"./TableContainer-MbQQWX9h.js";import{T as Me,a as Ve,b as w,c as a,d as Ae}from"./TableRow-DPhzdEOu.js";import{D as Pe}from"./Delete-BqgYStT1.js";import{L as Re,V as dt,C as ct,a as ht}from"./VideoLibrary-BxqDg6fB.js";const U="https://api.bookmyevent.ae",R=et.create({baseURL:U}),I="68e5fb0fa4b2718b6cbf64e9";function yt({providerId:Ue}){var ve,be;const[F,Fe]=l.useState(0),[_e,j]=l.useState(!1),[D,K]=l.useState({open:!1,message:"",severity:"success"}),[q,We]=l.useState([]),[k,M]=l.useState(I),[Oe,Q]=l.useState(!1),[c,Ee]=l.useState([]),[v,_]=l.useState(0),[$e,ze]=l.useState(!1),S=(()=>{var t;return Ue||((t=JSON.parse(localStorage.getItem("user")||"{}"))==null?void 0:t._id)||localStorage.getItem("userId")})(),[X,Z]=l.useState(""),[ee,te]=l.useState(""),[se,W]=l.useState([]),[ie,re]=l.useState(""),[O,E]=l.useState([]),[oe,Be]=l.useState([]),[ae,le]=l.useState(""),[ne,de]=l.useState(""),[ce,$]=l.useState([]),[he,ue]=l.useState(""),[z,B]=l.useState([]),[H,N]=l.useState([]),[Y,pe]=l.useState(""),[xe,He]=l.useState([]);l.useEffect(()=>{(async()=>{try{const s=await R.get("/api/modules");if(Array.isArray(s.data)){We(s.data);const r=s.data.find(n=>{var o;return n._id===I||((o=n.title)==null?void 0:o.toLowerCase().includes("photo"))}),i=(r==null?void 0:r._id)||I;M(i),localStorage.setItem("moduleId",i)}else M(I)}catch{M(I)}})()},[]),l.useEffect(()=>{S&&k&&G()},[S,k]);const G=async()=>{try{j(!0);const t=await R.get(`/api/portfolio/provider/${S}`);if(!t.data.success)return;const r=(t.data.data||[]).filter(o=>o.module===k),i=r.map(o=>({...o,imageMedia:o.media.filter(h=>h.type==="image").flatMap(h=>h.images||[])})).filter(o=>o.imageMedia.length>0);Be(i.map(o=>({id:o._id,title:o.workTitle||"Untitled",description:o.description||"",tags:Array.isArray(o.tags)?o.tags:[],media:o.imageMedia})));const n=r.map(o=>({...o,videoMedia:o.media.reduce((h,u)=>{if(u.type==="video"){const g=(u.videos||[]).map(b=>({type:"video",url:b}));return[...h,...g]}if(u.type==="videoLink"){const g=[];return Array.isArray(u.videoLinks)&&u.videoLinks.forEach(b=>g.push({type:"videoLink",url:b})),typeof u.url=="string"&&g.push({type:"videoLink",url:u.url}),[...h,...g]}return h},[])})).filter(o=>o.videoMedia.length>0);He(n.map(o=>({id:o._id,title:o.workTitle||"Untitled",description:o.description||"",tags:Array.isArray(o.tags)?o.tags:[],media:o.videoMedia})))}catch{x("Failed to load portfolio","error")}finally{j(!1)}},x=(t,s="success")=>K({open:!0,message:t,severity:s}),Ne=t=>{var s,r;if(!t)return t;if(t.includes("youtube.com")||t.includes("youtu.be")){if(t.includes("watch?v="))return t.replace("watch?v=","embed/");if(t.includes("youtu.be/"))return`https://www.youtube.com/embed/${(s=t.split("youtu.be/")[1])==null?void 0:s.split("?")[0]}`}return t.includes("vimeo.com")?`https://player.vimeo.com/video/${(r=t.split("/").pop())==null?void 0:r.split("?")[0]}`:t},V=(t,s=0,r=!1)=>{const i=t.map(n=>typeof n=="string"?`${U}/${n}`:n.type==="videoLink"?Ne(n.url):`${U}/${n.url}`);Ee(i),_(s),ze(r),Q(!0)},ge=()=>Q(!1),Ye=()=>_(t=>t===0?c.length-1:t-1),Ge=()=>_(t=>t===c.length-1?0:t+1),fe=(t,s,r)=>{t.trim()&&(r(i=>[...i,t.trim()]),s(""))},Je=t=>{const r=Array.from(t.target.files).map(i=>({file:i,preview:URL.createObjectURL(i)}));E(i=>[...i,...r])},Ke=t=>{var s;URL.revokeObjectURL((s=O[t])==null?void 0:s.preview),E(r=>r.filter((i,n)=>n!==t))},qe=t=>{const r=Array.from(t.target.files).map(i=>({file:i,preview:URL.createObjectURL(i)}));B(i=>[...i,...r])},Qe=t=>{var s;URL.revokeObjectURL((s=z[t])==null?void 0:s.preview),B(r=>r.filter((i,n)=>n!==t))},Xe=()=>{Y.trim()&&(N(t=>[...t,Y.trim()]),pe(""))},Ze=t=>N(s=>s.filter((r,i)=>i!==t)),me=async(t,s,r,i,n,o,h,u,g,b,ye=!1)=>{var Ce,we;if(!t.trim()||i.length===0&&n.length===0)return x("Title and media required","warning");if(!S)return x("Login required","error");const p=new FormData;p.append("providerId",S),p.append("module",k),p.append("workTitle",t),p.append("description",s),p.append("tags",JSON.stringify(r)),ye?(i.forEach(y=>p.append("videos",y.file)),n.length>0&&p.append("videoLinks",JSON.stringify(n))):i.forEach(y=>p.append("images",y.file));try{j(!0),(await R.post("/api/portfolio",p,{headers:{"Content-Type":"multipart/form-data"}})).data.success&&(x(`${ye?"Video":"Images"} added!`,"success"),G(),o(""),h(""),u([]),g([]),b&&b([]))}catch(y){x(((we=(Ce=y.response)==null?void 0:Ce.data)==null?void 0:we.message)||"Upload failed","error")}finally{j(!1)}},je=async t=>{if(window.confirm("Delete permanently?"))try{j(!0),await R.delete(`/api/portfolio/${t}`),x("Deleted!","success"),G()}catch{x("Delete failed","error")}finally{j(!1)}};return e.jsxs(d,{sx:{p:3},children:[_e&&e.jsx(d,{sx:{position:"fixed",inset:0,bgcolor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:e.jsx(tt,{size:60})}),e.jsx(st,{open:D.open,autoHideDuration:4e3,onClose:()=>K({...D,open:!1}),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(it,{severity:D.severity,children:D.message})}),e.jsxs(Ie,{sx:{p:2,mb:3},children:[e.jsx(C,{variant:"h6",children:"Module"}),e.jsx(rt,{fullWidth:!0,children:e.jsx(ot,{value:k,onChange:t=>{const s=t.target.value;M(s),localStorage.setItem("moduleId",s)},children:q.length===0?e.jsx(ke,{value:I,children:"Photography"}):q.map(t=>e.jsx(ke,{value:t._id,children:t.title},t._id))})})]}),e.jsxs(Ie,{children:[e.jsxs(nt,{value:F,onChange:(t,s)=>Fe(s),children:[e.jsx(Te,{label:"Images"}),e.jsx(Te,{label:"Videos"})]}),F===0&&e.jsxs(e.Fragment,{children:[e.jsxs(A,{children:[e.jsx(C,{variant:"h6",children:"Add Images"}),e.jsx(f,{fullWidth:!0,label:"Title",value:X,onChange:t=>Z(t.target.value),sx:{mb:3}}),e.jsx(f,{fullWidth:!0,multiline:!0,rows:3,label:"Description",value:ee,onChange:t=>te(t.target.value),sx:{mb:3}}),e.jsx(d,{sx:{mb:2},children:se.map((t,s)=>e.jsx(T,{label:t,onDelete:()=>W(r=>r.filter((i,n)=>n!==s)),sx:{mr:1}},s))}),e.jsx(f,{fullWidth:!0,label:"Add Tag (Enter)",value:ie,onChange:t=>re(t.target.value),onKeyDown:t=>t.key==="Enter"&&(t.preventDefault(),fe(ie,re,W)),sx:{mb:3}}),e.jsxs(L,{variant:"contained",component:"label",startIcon:e.jsx(Le,{}),children:["Upload Images",e.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:"image/*",onChange:Je})]}),e.jsx(P,{container:!0,spacing:2,sx:{mt:2},children:O.map((t,s)=>e.jsx(P,{item:!0,xs:6,sm:4,md:3,children:e.jsxs(d,{sx:{position:"relative"},children:[e.jsx("img",{src:t.preview,alt:"",style:{width:"100%",height:150,objectFit:"cover",borderRadius:8}}),e.jsx(m,{size:"small",onClick:()=>Ke(s),sx:{position:"absolute",top:4,right:4,bgcolor:"rgba(0,0,0,0.6)",color:"white"},children:e.jsx(J,{})})]})},s))}),e.jsx(L,{fullWidth:!0,variant:"contained",sx:{mt:4},onClick:()=>me(X,ee,se,O,[],Z,te,W,E,null,!1),children:"Add Images"})]}),e.jsxs(A,{children:[e.jsx(C,{variant:"h6",children:"Portfolio Images"}),e.jsx(De,{component:Se,children:e.jsxs(Me,{children:[e.jsx(Ve,{children:e.jsxs(w,{children:[e.jsx(a,{children:"SI"}),e.jsx(a,{children:"Title"}),e.jsx(a,{children:"Preview"}),e.jsx(a,{children:"Count"}),e.jsx(a,{children:"Tags"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(Ae,{children:oe.length===0?e.jsx(w,{children:e.jsx(a,{colSpan:6,align:"center",children:"No images yet"})}):oe.map((t,s)=>e.jsxs(w,{children:[e.jsx(a,{children:s+1}),e.jsx(a,{children:t.title}),e.jsx(a,{children:e.jsxs(d,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[t.media.slice(0,3).map((r,i)=>e.jsx("img",{src:`${U}/${r}`,alt:"",onClick:()=>V(t.media,i,!1),style:{width:70,height:60,objectFit:"cover",borderRadius:4,cursor:"pointer"}},i)),t.media.length>3&&e.jsxs(d,{onClick:()=>V(t.media,0,!1),sx:{width:70,height:60,bgcolor:"rgba(0,0,0,0.7)",color:"white",borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},children:["+",t.media.length-3]})]})}),e.jsx(a,{children:t.media.length}),e.jsx(a,{children:t.tags.map((r,i)=>e.jsx(T,{label:r,size:"small",sx:{mr:.5}},i))}),e.jsx(a,{children:e.jsx(m,{color:"error",onClick:()=>je(t.id),children:e.jsx(Pe,{})})})]},t.id))})]})})]})]}),F===1&&e.jsxs(e.Fragment,{children:[e.jsxs(A,{children:[e.jsx(C,{variant:"h6",children:"Add Videos"}),e.jsx(f,{fullWidth:!0,label:"Title",value:ae,onChange:t=>le(t.target.value),sx:{mb:3}}),e.jsx(f,{fullWidth:!0,multiline:!0,rows:3,label:"Description",value:ne,onChange:t=>de(t.target.value),sx:{mb:3}}),e.jsx(d,{sx:{mb:2},children:ce.map((t,s)=>e.jsx(T,{label:t,onDelete:()=>$(r=>r.filter((i,n)=>n!==s)),sx:{mr:1}},s))}),e.jsx(f,{fullWidth:!0,label:"Add Tag (Enter)",value:he,onChange:t=>ue(t.target.value),onKeyDown:t=>t.key==="Enter"&&(t.preventDefault(),fe(he,ue,$)),sx:{mb:3}}),e.jsxs(L,{variant:"contained",component:"label",startIcon:e.jsx(Le,{}),children:["Upload Videos",e.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:"video/*",onChange:qe})]}),e.jsx(C,{variant:"body2",sx:{my:2},children:"Or add YouTube/Vimeo links"}),e.jsxs(d,{sx:{display:"flex",gap:1},children:[e.jsx(f,{fullWidth:!0,label:"Video Link",value:Y,onChange:t=>pe(t.target.value)}),e.jsx(L,{variant:"contained",startIcon:e.jsx(Re,{}),onClick:Xe,children:"Add"})]}),H.length>0&&e.jsx(d,{sx:{mt:2},children:H.map((t,s)=>e.jsx(T,{label:t,onDelete:()=>Ze(s),sx:{mr:1,mb:1}},s))}),e.jsx(P,{container:!0,spacing:2,sx:{mt:2},children:z.map((t,s)=>e.jsx(P,{item:!0,xs:6,sm:4,md:3,children:e.jsxs(d,{sx:{position:"relative"},children:[e.jsx("video",{src:t.preview,controls:!0,style:{width:"100%",height:150,borderRadius:8}}),e.jsx(m,{size:"small",onClick:()=>Qe(s),sx:{position:"absolute",top:4,right:4,bgcolor:"rgba(0,0,0,0.6)",color:"white"},children:e.jsx(J,{})})]})},s))}),e.jsx(L,{fullWidth:!0,variant:"contained",sx:{mt:4},onClick:()=>me(ae,ne,ce,z,H,le,de,$,B,N,!0),children:"Add Video"})]}),e.jsxs(A,{children:[e.jsx(C,{variant:"h6",children:"Video List"}),e.jsx(De,{component:Se,children:e.jsxs(Me,{children:[e.jsx(Ve,{children:e.jsxs(w,{children:[e.jsx(a,{children:"SI"}),e.jsx(a,{children:"Title"}),e.jsx(a,{children:"Preview"}),e.jsx(a,{children:"Count"}),e.jsx(a,{children:"Tags"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(Ae,{children:xe.length===0?e.jsx(w,{children:e.jsx(a,{colSpan:6,align:"center",children:"No videos yet"})}):xe.map((t,s)=>e.jsxs(w,{children:[e.jsx(a,{children:s+1}),e.jsx(a,{children:t.title}),e.jsx(a,{children:e.jsxs(d,{sx:{display:"flex",gap:1},children:[t.media.slice(0,3).map((r,i)=>e.jsx(d,{onClick:()=>V(t.media,i,!0),sx:{width:80,height:60,borderRadius:1,cursor:"pointer",border:"2px solid #ddd",bgcolor:r.type==="videoLink"?"#d32f2f":"#000",color:"white",display:"flex",alignItems:"center",justifyContent:"center"},children:r.type==="videoLink"?e.jsx(Re,{}):e.jsx(dt,{})},i)),t.media.length>3&&e.jsxs(d,{onClick:()=>V(t.media,0,!0),sx:{width:80,height:60,bgcolor:"rgba(211,47,47,0.9)",color:"white",borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontWeight:"bold"},children:["+",t.media.length-3]})]})}),e.jsx(a,{children:t.media.length}),e.jsx(a,{children:t.tags.map((r,i)=>e.jsx(T,{size:"small",label:r,sx:{mr:.5}},i))}),e.jsx(a,{children:e.jsx(m,{color:"error",onClick:()=>je(t.id),children:e.jsx(Pe,{})})})]},t.id))})]})})]})]})]}),e.jsx(at,{open:Oe,onClose:ge,maxWidth:"lg",fullWidth:!0,children:e.jsxs(lt,{sx:{bgcolor:"black",position:"relative",minHeight:"80vh",p:0},children:[e.jsx(m,{onClick:ge,sx:{position:"absolute",top:10,right:10,color:"white",zIndex:10},children:e.jsx(J,{})}),e.jsxs(d,{sx:{color:"white",textAlign:"center",py:2},children:[v+1," / ",c.length]}),$e?(ve=c[v])!=null&&ve.includes("embed")||(be=c[v])!=null&&be.includes("player.vimeo")?e.jsx("iframe",{src:c[v],style:{width:"100%",height:"70vh",border:"none"},allow:"autoplay; fullscreen; encrypted-media",allowFullScreen:!0}):e.jsx("video",{src:c[v],controls:!0,style:{maxWidth:"100%",height:"70vh"}}):e.jsx("img",{src:c[v],alt:"",style:{maxWidth:"100%",maxHeight:"70vh",objectFit:"contain"}}),c.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(m,{onClick:Ye,sx:{position:"absolute",left:10,top:"50%",transform:"translateY(-50%)",color:"white",bgcolor:"rgba(0,0,0,0.5)"},children:e.jsx(ct,{fontSize:"large"})}),e.jsx(m,{onClick:Ge,sx:{position:"absolute",right:10,top:"50%",transform:"translateY(-50%)",color:"white",bgcolor:"rgba(0,0,0,0.5)"},children:e.jsx(ht,{fontSize:"large"})})]})]})})]})}export{yt as default};
