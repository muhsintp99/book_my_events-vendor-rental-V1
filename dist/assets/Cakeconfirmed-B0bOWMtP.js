import{r as p,j as e,B as y,t as $,x as z,T as i,a8 as F,S,s as G,g as C,a4 as I,h as A}from"./index-CLsaspxs.js";import{T as O}from"./TableContainer-Dc8cvBKN.js";import{T as R,a as T,b as t,c as H}from"./TableRow-DJQ_74qW.js";import{T as U}from"./TableHead-D8El7ksk.js";const V=()=>{try{const x=localStorage.getItem("user");if(!x)return null;const f=JSON.parse(x);return(f==null?void 0:f._id)||null}catch{return null}},Y=()=>{const[x,f]=p.useState([]),[m,P]=p.useState(""),[E,b]=p.useState(!0),[B,w]=p.useState(null),[K,N]=p.useState(null),k=V();p.useEffect(()=>{if(!k){w("No provider ID found. Please log in."),b(!1);return}(async()=>{var s,h,l;try{b(!0);const r=((s=(await A.get(`https://api.bookmyevent.ae/api/bookings/provider/${k}`)).data)==null?void 0:s.data)||[];console.log("=== MAKEUP CONFIRMED BOOKINGS DEBUG ==="),console.log("Total bookings fetched:",r.length),console.log("Provider ID:",k),r.length>0&&console.log("Sample booking:",r[0]);const u={},c={};r.forEach(d=>{const n=String(d.status||"undefined").toLowerCase(),g=String(d.moduleType||"undefined").toLowerCase();u[n]=(u[n]||0)+1,c[g]=(c[g]||0)+1}),console.log("Bookings by status:",u),console.log("Bookings by module:",c);const v=r.filter(d=>{const n=String(d.status||"").trim().toLowerCase(),g=String(d.moduleType||"").trim().toLowerCase(),D=n==="accepted"||n==="confirmed"||n==="approve"||n==="approved",L=g==="cake"||g==="cakes"||g==="cake service"||g==="cake booking";return console.log(`Booking ${d._id}: status=${n}, module=${g}, isAccepted=${D}, isCake=${L}`),D&&L});console.log("✅ Filtered confirmed makeup bookings:",v.length),console.log("Confirmed bookings:",v),N({total:r.length,accepted:r.filter(d=>{const n=String(d.status||"").toLowerCase();return n==="accepted"||n==="confirmed"||n==="approved"}).length,makeup:r.filter(d=>{const n=String(d.moduleType||"").toLowerCase();return n==="makeup"||n==="makeup artist"||n==="makeupartist"}).length,confirmedMakeup:v.length,statusCounts:u,moduleCounts:c}),f(v),w(null)}catch(a){console.error("❌ Error loading confirmed bookings:",a),w(((l=(h=a.response)==null?void 0:h.data)==null?void 0:l.message)||"Failed to load bookings")}finally{b(!1)}})()},[k]);const j=p.useMemo(()=>{if(!m.trim())return x;const o=m.toLowerCase();return x.filter(s=>{var h,l,a,r;return((h=s._id)==null?void 0:h.toLowerCase().includes(o))||((l=s.fullName)==null?void 0:l.toLowerCase().includes(o))||((a=s.emailAddress)==null?void 0:a.toLowerCase().includes(o))||((r=s.contactNumber)==null?void 0:r.includes(m))})},[m,x]),M=async(o,s)=>{var l,a;if(s.stopPropagation(),!!window.confirm("Are you sure you want to delete this booking? This action cannot be undone."))try{await A.delete(`https://api.bookmyevent.ae/api/bookings/${o}`),f(r=>r.filter(u=>u._id!==o)),alert("✅ Booking Deleted Successfully!")}catch(r){console.error("❌ Delete error:",r),alert(((a=(l=r.response)==null?void 0:l.data)==null?void 0:a.message)||"Failed to delete booking")}},W=(o,s)=>{s.stopPropagation(),console.log("View booking:",o)},_=(o,s)=>{s.stopPropagation(),console.log("Download invoice for:",o._id)};return E?e.jsx(y,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:e.jsx($,{})}):B?e.jsx(y,{p:2,children:e.jsx(z,{severity:"error",children:B})}):e.jsxs(y,{p:2,children:[e.jsx(i,{variant:"h4",gutterBottom:!0,fontWeight:600,children:"Confirmed Makeup Bookings"}),e.jsxs(F,{sx:{mt:2},children:[e.jsxs(S,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"space-between",alignItems:"center",p:2,children:[e.jsx(G,{label:"Search by Booking ID, Name, Email, or Phone",value:m,onChange:o=>P(o.target.value),size:"small",sx:{minWidth:350},placeholder:"Type to search..."}),e.jsx(C,{variant:"contained",color:"primary",children:"Export Data"})]}),e.jsx(O,{children:e.jsxs(R,{stickyHeader:!0,children:[e.jsx(U,{children:e.jsxs(T,{children:[e.jsx(t,{children:e.jsx("strong",{children:"S#"})}),e.jsx(t,{children:e.jsx("strong",{children:"Booking ID"})}),e.jsx(t,{children:e.jsx("strong",{children:"Module"})}),e.jsx(t,{children:e.jsx("strong",{children:"Customer"})}),e.jsx(t,{children:e.jsx("strong",{children:"Email"})}),e.jsx(t,{children:e.jsx("strong",{children:"Guests"})}),e.jsx(t,{children:e.jsx("strong",{children:"Booking Date"})}),e.jsx(t,{children:e.jsx("strong",{children:"Amount"})}),e.jsx(t,{children:e.jsx("strong",{children:"Payment Status"})}),e.jsx(t,{children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(H,{children:j.length>0?j.map((o,s)=>{var h,l,a,r,u;return e.jsxs(T,{hover:!0,sx:{"&:hover":{bgcolor:"#f5f5f5"}},children:[e.jsx(t,{children:s+1}),e.jsx(t,{children:e.jsxs(i,{variant:"body2",fontWeight:600,color:"primary",children:["#",((h=o._id)==null?void 0:h.slice(-8).toUpperCase())||"N/A"]})}),e.jsx(t,{children:e.jsx(I,{label:o.moduleType||"Makeup",size:"small",sx:{bgcolor:"#fef3c7",color:"#92400e",fontWeight:600}})}),e.jsxs(t,{children:[e.jsx(i,{variant:"body2",children:o.fullName||"-"}),e.jsx(i,{variant:"caption",color:"text.secondary",children:o.contactNumber||"-"})]}),e.jsx(t,{children:e.jsx(i,{variant:"body2",sx:{wordBreak:"break-word"},children:o.emailAddress||"-"})}),e.jsx(t,{children:e.jsx(i,{variant:"body2",children:o.numberOfGuests||o.guests||"-"})}),e.jsxs(t,{children:[e.jsx(i,{variant:"body2",children:o.bookingDate?new Date(o.bookingDate).toLocaleDateString("en-GB"):"-"}),e.jsx(i,{variant:"caption",color:"text.secondary",children:((l=o.timeSlot)==null?void 0:l.label)||((a=o.timeSlot)==null?void 0:a.time)||""})]}),e.jsx(t,{children:e.jsxs(i,{variant:"body2",fontWeight:700,color:"success.main",children:["₹",((r=o.finalPrice)==null?void 0:r.toLocaleString())||((u=o.totalAmount)==null?void 0:u.toLocaleString())||0]})}),e.jsx(t,{children:e.jsx(I,{label:o.status||"Accepted",size:"small",sx:{bgcolor:"#dcfce7",color:"#16a34a",fontWeight:600}})}),e.jsx(t,{children:e.jsxs(S,{direction:"row",spacing:1,children:[e.jsx(C,{variant:"outlined",size:"small",color:"primary",onClick:c=>W(o,c),children:"View"}),e.jsx(C,{variant:"outlined",size:"small",color:"info",onClick:c=>_(o,c),children:"Download"}),e.jsx(C,{variant:"outlined",size:"small",color:"error",onClick:c=>M(o._id,c),children:"Delete"})]})})]},o._id)}):e.jsx(T,{children:e.jsx(t,{colSpan:10,align:"center",children:e.jsxs(y,{py:4,children:[e.jsx(i,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:m?"No matching bookings found":"No Confirmed Makeup Bookings"}),e.jsx(i,{variant:"body2",color:"text.secondary",children:m?"Try adjusting your search criteria":"Confirmed makeup bookings will appear here"})]})})})})]})}),j.length>0&&e.jsxs(y,{p:2,bgcolor:"#f9fafb",borderTop:"1px solid #e5e7eb",display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(S,{direction:"row",spacing:4,children:[e.jsxs(i,{variant:"body2",fontWeight:600,children:["Total Bookings: ",e.jsx("strong",{children:j.length})]}),e.jsxs(i,{variant:"body2",fontWeight:600,color:"success.main",children:["Total Revenue:"," ",e.jsxs("strong",{children:["₹",j.reduce((o,s)=>o+(s.finalPrice||s.totalAmount||0),0).toLocaleString()]})]})]}),e.jsxs(i,{variant:"caption",color:"text.secondary",children:["Showing ",j.length," of ",x.length," bookings"]})]})]})]})};export{Y as default};
