import{u as fe,a as ye,ab as ve,r as g,j as e,B as a,c as E,ac as re,T as o,ad as Ce,S as U,g as H,ak as we,ag as ie,ah as ae,s as b,y as ce,b as Se}from"./index-D-AUwBgS.js";import{A as Ie}from"./Autocomplete-BtJjrgQw.js";import{A as ke}from"./Add-DQyDUOHy.js";import{D as Ee}from"./Delete-BMYh7xNU.js";import{C as se}from"./Close-DewXBq0c.js";import{C as oe}from"./CloudUpload-DK4gkATC.js";const ne=ce(a)(({theme:n})=>({border:"2px dashed #e0e0e0",borderRadius:n.shape.borderRadius,padding:n.spacing(3),textAlign:"center",backgroundColor:n.palette.grey[50],cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"150px","&:hover":{borderColor:"#E15B65"},'& input[type="file"]':{display:"none"}})),le=ce(a)({position:"relative",display:"inline-block"}),Te=()=>{var y;let n=localStorage.getItem("providerId");if(!n){const j=localStorage.getItem("user");if(j)try{const m=JSON.parse(j);localStorage.getItem("logRes")?n=((y=m.profile)==null?void 0:y._id)||m._id:n=m.providerId||m._id,n&&localStorage.setItem("providerId",n)}catch(m){console.error("Error parsing user:",m)}}return n},We=()=>{var ee,te;const n=fe(),y=ye(),j=ve(),[m,z]=g.useState("form"),[x,N]=g.useState({packageTitle:"",subtitle:"",description:"",startingPrice:""}),[G,v]=g.useState([{id:Date.now(),heading:"",includes:""}]),[C,w]=g.useState(null),[T,_]=g.useState([]),[S,A]=g.useState(null),[P,B]=g.useState([]),[J,I]=g.useState(!1),[V,R]=g.useState(""),[X,F]=g.useState("success"),[i,q]=g.useState(null),[K,Q]=g.useState(!0),[Ae,L]=g.useState({}),M="https://api.bookmyevent.ae",D=t=>{if(!t)return"/placeholder.jpg";let r=t.toLowerCase().replace(/^uploads/i,"/uploads");return r.startsWith("/")||(r="/"+r),`${M}${r}`},de=()=>localStorage.getItem("token")||sessionStorage.getItem("token");g.useEffect(()=>{(async()=>{try{const r=de(),s=localStorage.getItem("moduleId"),c={Accept:"application/json"};r&&(c.Authorization=`Bearer ${r}`);const d=await fetch(`${M}/api/categories/modules/${s}`,{headers:c});if(!d.ok)throw new Error(`HTTP error! Status: ${d.status}`);const f=d.headers.get("content-type");if(!f||!f.includes("application/json"))throw new Error("Response is not JSON");const l=await d.json();if(l.success&&Array.isArray(l.data)&&l.data.length>0){const k=l.data.map(p=>({value:p._id,label:p.title||p.name}));_(k);const $={};l.data.forEach(p=>{$[p._id]=p.title||p.name}),L($)}else _([]),L({});Q(!1)}catch(r){console.error("Error fetching categories:",r.message),_([]),L({}),Q(!1)}})()},[]),g.useEffect(()=>{var t;if((t=j.state)!=null&&t.editPackage){const r=j.state.editPackage;q(r),Z(r)}},[j.state]),g.useEffect(()=>{var t,r;if(i&&T.length>0&&!C&&((t=i.categories)==null?void 0:t.length)>0){const s=((r=i.categories[0])==null?void 0:r._id)||i.categories[0],c=T.find(d=>d.value===s);c&&w(c)}},[T,i,C]);const O=t=>{const{name:r,value:s}=t.target;N(c=>({...c,[r]:s}))},Y=(t,r,s)=>{v(c=>c.map(d=>d.id===t?{...d,[r]:s}:d))},ge=()=>{v(t=>[...t,{id:Date.now(),heading:"",includes:""}])},ue=t=>{v(r=>r.filter(s=>s.id!==t))},pe=t=>{const r=t.target.files[0];r&&A(r)},he=t=>{const r=Array.from(t.target.files);B(s=>[...s,...r])},me=t=>{B(r=>r.filter((s,c)=>c!==t))},xe=()=>{A(null)},W=(t,r)=>{r!=="clickaway"&&I(!1)},Z=t=>{var s,c;N({packageTitle:t.title||"",subtitle:t.subtitle||"",description:t.description||"",startingPrice:((s=t.price)==null?void 0:s.toString())||""}),v((t.includes||[]).map((d,f)=>{var l;return{id:Date.now()+f,heading:d.title||"",includes:((l=d.items)==null?void 0:l.join(", "))||""}}));const r=(c=t.categories)==null?void 0:c[0];w(r?{value:r._id||r,label:r.title||r.name||""}:null),A(null),B([])},be=()=>{i&&Z(i),z("form")},je=async t=>{t.preventDefault();const r=localStorage.getItem("token");if(!r){R("No authentication token found. Please log in."),F("error"),I(!0);return}const s=Te(),c=localStorage.getItem("moduleId");if(!s){R("Provider ID is missing. Please log in again."),F("error"),I(!0);return}console.log("Using providerId:",s);const d=G.filter(u=>u.includes.trim()).map(u=>({title:u.heading.trim()||"Menu Item",items:u.includes.split(",").map(h=>h.trim()).filter(h=>h)})),f=parseFloat(x.startingPrice)||0,l=new FormData;l.append("providerId",s),l.append("module",c||""),l.append("title",x.packageTitle||"Custom Package"),l.append("subtitle",x.subtitle||""),l.append("description",x.description||""),l.append("cateringType","custom"),l.append("includes",JSON.stringify(d)),C?l.append("categories",JSON.stringify([C.value])):l.append("categories",JSON.stringify([])),l.append("price",f.toString()),S&&l.append("thumbnail",S),P.forEach(u=>{l.append("images",u)});const k=!!(i!=null&&i._id),$=k?`${M}/api/catering/${i._id}`:`${M}/api/catering`,p=k?"PUT":"POST";try{const u=await fetch($,{method:p,body:l,headers:{Authorization:`Bearer ${r}`}});let h;try{h=await u.json()}catch{throw new Error("Invalid response from server")}if(u.ok)N({packageTitle:"",subtitle:"",description:"",startingPrice:""}),v([{id:Date.now(),heading:"",includes:""}]),w(null),A(null),B([]),q(h.data),z("preview"),R(h.message||`Catering ${k?"updated":"created"} successfully!`),F("success"),I(!0);else throw new Error(h.error||h.message||"Failed to save catering")}catch(u){console.error("Error submitting form:",u),R(`Error saving catering: ${u.message}`),F("error"),I(!0)}};return m==="preview"&&i?e.jsx(a,{sx:{p:3,backgroundColor:n.palette.grey[100],minHeight:"100vh",width:"100%"},children:e.jsxs(a,{sx:{width:"100%",margin:"auto",backgroundColor:"white",borderRadius:n.shape.borderRadius,boxShadow:n.shadows[1],p:3,overflowX:"hidden"},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx(E,{onClick:()=>y(-1),color:"primary",children:e.jsx(re,{})}),e.jsx(o,{variant:"h5",component:"h1",children:"Package Preview"})]}),e.jsxs(a,{sx:{position:"relative",mb:3},children:[e.jsx("img",{src:D(i.thumbnail),alt:i.title,style:{width:"100%",height:200,objectFit:"cover",borderRadius:8},onError:t=>{t.target.onerror=null,t.target.src="/placeholder.jpg"}}),e.jsxs(a,{sx:{position:"absolute",bottom:0,left:0,right:0,background:"linear-gradient(transparent, rgba(0,0,0,0.7))",color:"white",p:2},children:[e.jsx(o,{variant:"h6",sx:{mb:.5},children:i.title||"Untitled Package"}),e.jsx(o,{variant:"body2",children:i.subtitle||"Traditional Style"})]})]}),e.jsx(o,{variant:"body1",sx:{mb:3,textAlign:"justify"},children:i.description||"No description available."}),i.categories&&i.categories.length>0&&e.jsxs(a,{sx:{mb:3},children:[e.jsx(o,{variant:"h6",sx:{mb:1},children:"Category"}),e.jsx(Ce,{label:((ee=i.categories[0])==null?void 0:ee.title)||i.categories[0]||"Uncategorized",variant:"outlined",color:"primary"})]}),e.jsx(o,{variant:"h6",sx:{mb:2},children:"Includes"}),(i.includes||[]).map((t,r)=>{var s;return e.jsxs(a,{sx:{mb:2},children:[e.jsx(o,{variant:"subtitle1",sx:{mb:1,fontWeight:"medium"},children:t.title||"Untitled Section"}),e.jsx(U,{component:"ul",spacing:.5,sx:{pl:2,mb:0},children:((s=t.items)==null?void 0:s.map((c,d)=>e.jsx(o,{variant:"body2",component:"li",children:c},d)))||e.jsx(o,{variant:"body2",color:"text.secondary",children:"No items"})})]},r)}),e.jsxs(a,{sx:{textAlign:"center",mb:3},children:[e.jsx(o,{variant:"h6",sx:{mb:.5},children:"Starting Price"}),e.jsxs(o,{variant:"h4",color:"primary",children:["₹",i.price||0," Per Head"]})]}),e.jsxs(a,{sx:{mb:3},children:[e.jsx(o,{variant:"subtitle1",sx:{mb:1},children:"Gallery"}),e.jsxs(U,{direction:"row",spacing:2,sx:{flexWrap:"wrap",justifyContent:"center"},children:[(i.images||[]).slice(0,6).map((t,r)=>e.jsx(a,{sx:{position:"relative"},children:e.jsx("img",{src:D(t),alt:`Gallery image ${r+1}`,style:{width:150,height:150,objectFit:"cover",borderRadius:8},onError:s=>{s.target.onerror=null,s.target.src="/placeholder.jpg"}})},r)),(!i.images||i.images.length===0)&&e.jsx(o,{variant:"body2",color:"text.secondary",children:"No images"})]})]}),e.jsx(a,{sx:{display:"flex",gap:2,justifyContent:"center"},children:e.jsx(H,{variant:"outlined",startIcon:e.jsx(we,{}),onClick:be,sx:{color:"#E15B65",borderColor:"#E15B65"},children:"Edit Menu"})}),e.jsx(ie,{open:J,autoHideDuration:6e3,onClose:W,anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(ae,{onClose:W,severity:X,sx:{width:"100%"},children:V})})]})}):e.jsx(a,{sx:{p:3,backgroundColor:n.palette.grey[100],minHeight:"100vh",width:"100%"},children:e.jsxs(a,{sx:{width:"100%",margin:"auto",backgroundColor:"white",borderRadius:n.shape.borderRadius,boxShadow:n.shadows[1],p:3,overflowX:"hidden"},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[i&&e.jsx(E,{onClick:()=>y(-1),color:"primary",children:e.jsx(re,{})}),e.jsx(o,{variant:"h5",component:"h1",children:i?"Edit Menu":"Add New Menu"})]}),e.jsxs(a,{component:"form",onSubmit:je,children:[e.jsx(b,{fullWidth:!0,label:"Package Title",name:"packageTitle",value:x.packageTitle,onChange:O,placeholder:"Type package title",sx:{mb:2},variant:"outlined"}),e.jsx(b,{fullWidth:!0,label:"Subtitle",name:"subtitle",value:x.subtitle,onChange:O,placeholder:"Type subtitle",sx:{mb:2},variant:"outlined"}),e.jsx(b,{fullWidth:!0,label:"Description",name:"description",value:x.description,onChange:O,placeholder:"Type description",multiline:!0,rows:3,sx:{mb:2},variant:"outlined"}),e.jsx(Ie,{fullWidth:!0,options:T,getOptionLabel:t=>t.label,isOptionEqualToValue:(t,r)=>t.value===(r==null?void 0:r.value),value:C,onChange:(t,r)=>w(r),renderInput:t=>e.jsx(b,{...t,label:"Category",placeholder:K?"Loading categories...":"Select a category",sx:{mb:2},variant:"outlined",disabled:K})}),e.jsxs(a,{sx:{mb:3},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(o,{variant:"subtitle1",children:"Menu List"}),e.jsx(H,{variant:"contained",size:"small",onClick:ge,startIcon:e.jsx(ke,{}),sx:{backgroundColor:"#E15B65",color:"white"},children:"Add"})]}),G.map(t=>e.jsxs(a,{sx:{border:`1px solid ${n.palette.grey[300]}`,borderRadius:1,p:2,mb:2},children:[e.jsx(b,{fullWidth:!0,label:"Add heading here",value:t.heading,onChange:r=>Y(t.id,"heading",r.target.value),sx:{mb:2},variant:"outlined"}),e.jsxs(a,{sx:{display:"flex",gap:1,alignItems:"flex-end"},children:[e.jsx(b,{fullWidth:!0,label:"Includes",value:t.includes,onChange:r=>Y(t.id,"includes",r.target.value),multiline:!0,rows:3,sx:{flex:1},variant:"outlined",placeholder:"Enter items separated by commas"}),e.jsx(E,{onClick:()=>ue(t.id),color:"error",sx:{alignSelf:"flex-end"},children:e.jsx(Ee,{})})]})]},t.id))]}),e.jsxs(a,{sx:{display:"flex",gap:3,mb:3},children:[e.jsxs(a,{sx:{flex:1},children:[e.jsx(o,{variant:"subtitle2",gutterBottom:!0,children:"Thumbnail Image"}),e.jsxs(ne,{onClick:()=>document.getElementById("thumbnail-upload").click(),children:[S?e.jsxs(a,{sx:{textAlign:"center"},children:[e.jsxs(le,{children:[e.jsx("img",{src:URL.createObjectURL(S),alt:"Thumbnail preview",style:{maxWidth:"100%",maxHeight:100,objectFit:"contain",marginBottom:n.spacing(1)}}),e.jsx(E,{onClick:xe,size:"small",sx:{position:"absolute",top:-8,right:-8,backgroundColor:"white",color:"error",boxShadow:n.shadows[2]},children:e.jsx(se,{fontSize:"small"})})]}),e.jsx(o,{variant:"body2",color:"text.secondary",children:S.name})]}):i!=null&&i.thumbnail?e.jsxs(a,{sx:{textAlign:"center"},children:[e.jsx("img",{src:D(i.thumbnail),alt:"Current thumbnail",style:{maxWidth:"100%",maxHeight:100,objectFit:"contain",marginBottom:n.spacing(1)},onError:t=>{t.target.onerror=null,t.target.src="/placeholder.jpg"}}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"Current thumbnail. Click to replace."})]}):e.jsxs(a,{children:[e.jsx(oe,{sx:{fontSize:40,color:n.palette.grey[400],mb:1}}),e.jsx(o,{variant:"body2",color:"#E15B65",sx:{mb:.5,fontWeight:"medium"},children:"Click to upload"}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"Or drag and drop"})]}),e.jsx("input",{type:"file",id:"thumbnail-upload",hidden:!0,accept:"image/jpeg,image/png,image/jpg",onChange:pe})]})]}),e.jsxs(a,{sx:{flex:1},children:[e.jsx(o,{variant:"subtitle2",gutterBottom:!0,children:"Gallery Images"}),e.jsxs(ne,{onClick:()=>document.getElementById("gallery-upload").click(),children:[P.length>0?e.jsxs(a,{sx:{textAlign:"center"},children:[e.jsx(U,{direction:"row",flexWrap:"wrap",spacing:1,sx:{justifyContent:"center",mb:1},children:P.map((t,r)=>e.jsxs(le,{children:[e.jsx("img",{src:URL.createObjectURL(t),alt:`Gallery preview ${r+1}`,style:{width:100,height:100,objectFit:"cover",borderRadius:4}}),e.jsx(E,{onClick:()=>me(r),size:"small",sx:{position:"absolute",top:-8,right:-8,backgroundColor:"white",color:"error",boxShadow:n.shadows[2]},children:e.jsx(se,{fontSize:"small"})})]},r))}),e.jsxs(o,{variant:"body2",color:"text.secondary",children:[P.length," image(s) selected"]})]}):e.jsxs(a,{children:[e.jsx(oe,{sx:{fontSize:40,color:n.palette.grey[400],mb:1}}),e.jsx(o,{variant:"body2",color:"#E15B65",sx:{mb:.5,fontWeight:"medium"},children:"Click to upload"}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"Or drag and drop"})]}),e.jsx("input",{type:"file",id:"gallery-upload",hidden:!0,accept:"image/jpeg,image/png,image/jpg",multiple:!0,onChange:he})]}),((te=i==null?void 0:i.images)==null?void 0:te.length)>0&&e.jsxs(a,{sx:{mt:2},children:[e.jsx(o,{variant:"subtitle2",gutterBottom:!0,color:"text.secondary",children:"Existing Images"}),e.jsx(U,{direction:"row",flexWrap:"wrap",spacing:1,children:i.images.map((t,r)=>e.jsx(a,{sx:{position:"relative"},children:e.jsx("img",{src:D(t),alt:`Existing gallery ${r+1}`,style:{width:100,height:100,objectFit:"cover",borderRadius:4},onError:s=>{s.target.onerror=null,s.target.src="/placeholder.jpg"}})},r))})]})]})]}),e.jsx(a,{sx:{mb:3},children:e.jsx(b,{fullWidth:!0,label:"₹ Price (Starting From)",name:"startingPrice",value:x.startingPrice,onChange:O,type:"number",inputProps:{min:0},InputProps:{endAdornment:e.jsx(Se,{position:"end",children:e.jsx(o,{variant:"body2",color:"text.secondary",children:"Per Head"})})},variant:"outlined"})}),e.jsx(H,{type:"submit",variant:"contained",fullWidth:!0,sx:{backgroundColor:"#E15B65",color:"white",py:1.5},children:i?"Update Menu":"Create Menu"})]}),e.jsx(ie,{open:J,autoHideDuration:6e3,onClose:W,anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(ae,{onClose:W,severity:X,sx:{width:"100%"},children:V})})]})})};export{We as default};
