import{c as ce,j as s,r as d,w as de,B as W,t as he,ap as ue,aq as ge,T as l,x as U,ad as pe,S as B,a9 as Y,s as xe,a as fe,b,g as w,al as ye,V as je,ar as me,ab as be,ac as Ae,ao as Se,h as A}from"./index-BfZ8VyPu.js";import{S as Ce}from"./Search-BnKl_L3D.js";import{T as ke}from"./TableContainer-CUnCDVo9.js";import{T as we,a as Ne,b as E,c as n,d as Te}from"./TableRow-UHe53Q3E.js";import{E as Ie}from"./Edit-DZx7vyOG.js";import{D as ve}from"./DialogTitle-C4Exy3-5.js";import{D as $e}from"./DialogActions-Br8kaP6E.js";const Be=ce(s.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}));function De(){const[z,N]=d.useState([]),[S,q]=d.useState([]),[f,G]=d.useState([]),[J,T]=d.useState(!0),[_,K]=d.useState(""),[Q,y]=d.useState(!1),[X,u]=d.useState(""),[F,g]=d.useState("success"),[h,R]=d.useState({search:""}),[j,L]=d.useState(""),[Z,C]=d.useState(!1),[I,V]=d.useState(null),v=de(),m="https://api.bookmyevent.ae/api",$=localStorage.getItem("moduleId");localStorage.getItem("providerId");const ee=async()=>{try{if(!$)return;const e=localStorage.getItem("token"),[t,r]=await Promise.all([A.get(`${m}/brands/module/${$}`,{headers:{Authorization:`Bearer ${e}`}}),A.get(`${m}/vehicle-categories`,{headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}})]);q(Array.isArray(t.data)?t.data:[]);let i=[];r.data.success&&Array.isArray(r.data.data)&&(i=r.data.data.filter(o=>{var a;return((a=o.module)==null?void 0:a._id)===$}).map(o=>({_id:o._id,title:o.title}))),G(i)}catch(e){console.error("Error fetching options:",e)}},D=e=>{if(console.log("getCategoryTitle called with:",e),console.log("Type:",typeof e),console.log("Is Array:",Array.isArray(e)),!e)return console.log("Category data is null/undefined"),"N/A";if(Array.isArray(e)){if(console.log("Category is array, length:",e.length),e.length===0)return"N/A";const t=e[0];if(console.log("First category element:",t),console.log("First category type:",typeof t),typeof t=="object"&&t!==null&&t.title)return console.log("Returning title from object:",t.title),t.title;if(typeof t=="string"){const r=f.find(i=>i._id===t);return console.log("Looking up category by ID:",t,"Found:",r),r?r.title:"N/A"}}if(typeof e=="object"&&e!==null&&e.title)return console.log("Returning title from single object:",e.title),e.title;if(typeof e=="string"){const t=f.find(r=>r._id===e);return console.log("Looking up single category by ID:",e,"Found:",t),t?t.title:"N/A"}return console.log("No match found, returning N/A"),"N/A"},P=e=>{if(!e)return"N/A";if(typeof e=="object"&&e.title)return e.title;if(typeof e=="string"){const t=S.find(r=>r._id===e);return t?t.title:"N/A"}return"N/A"},se=async()=>{var e;T(!0);try{const t=localStorage.getItem("token"),r=JSON.parse(localStorage.getItem("user")||"{}"),i=r==null?void 0:r._id;if(!t||!i){console.error("Provider ID or token missing"),u("Provider authentication missing. Please log in again."),g("error"),y(!0),T(!1);return}const o=await A.get(`${m}/vehicles/provider/${i}`,{headers:{Authorization:`Bearer ${t}`}});(e=o.data)!=null&&e.success?(console.log("Fetched vehicles:",o.data.data),console.log("Available categories:",f),console.log("Available brands:",S),o.data.data&&o.data.data.length>0&&(console.log("First vehicle structure:",o.data.data[0]),console.log("First vehicle category:",o.data.data[0].category),console.log("First vehicle brand:",o.data.data[0].brand)),N(o.data.data||[])):console.error("Error fetching vehicles:",o.data.message)}catch(t){console.error("Error fetching vehicles:",t),u("Failed to load vehicles "),g("error"),y(!0)}finally{T(!1)}};d.useEffect(()=>{ee()},[]),d.useEffect(()=>{f.length>0&&S.length>0&&se()},[f,S]);const te=()=>{R(e=>({...e,search:j}))},re=()=>{L(""),R(e=>({...e,search:""}))},oe=e=>{V(e),C(!0)},ie=()=>{const e=["Sl,Name,Code,Category,Brand,Type,Hourly,Distance,Daily,New,Active"],t=k.map((c,p)=>{var x,H,O;return`${p+1},${c.name||""},${c.vinNumber||""},${D(c.category)},${P(c.brand)},${c.type||""},${((x=c.pricing)==null?void 0:x.hourly)||"-"},
        ${((H=c.pricing)==null?void 0:H.distance)||"-"},${((O=c.pricing)==null?void 0:O.perDay)||"-"},${c.isNew?"Yes":"No"},${c.isActive?"Active":"Inactive"}`}),r=e.concat(t).join(`
`),i=new Blob([r],{type:"text/csv"}),o=URL.createObjectURL(i),a=document.createElement("a");a.href=o,a.download="vehicles.csv",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o)},ne=async(e,t,r)=>{var i,o;try{const a=localStorage.getItem("token");(await A.put(`${m}/vehicles/${e}`,{[t]:!r},{headers:{Authorization:`Bearer ${a}`}})).data.success?(N(p=>p.map(x=>x._id===e?{...x,[t]:!r}:x)),u("Vehicle status updated successfully "),g("success")):(u("Failed to update vehicle status "),g("error"))}catch(a){console.error("Error toggling status:",a),u(((o=(i=a.response)==null?void 0:i.data)==null?void 0:o.message)||"Error updating vehicle"),g("error")}finally{y(!0)}},ae=async()=>{var e,t;if(I)try{const r=localStorage.getItem("token");await A.delete(`${m}/vehicles/${I}`,{headers:{Authorization:`Bearer ${r}`}}),N(i=>i.filter(o=>o._id!==I)),u("Vehicle deleted successfully"),g("success")}catch(r){u(((t=(e=r.response)==null?void 0:e.data)==null?void 0:t.message)||"Failed to delete vehicle"),g("error")}finally{y(!0),C(!1),V(null)}},le=e=>{v(`/vehicle-setup/leads/${e._id}`,{state:{vehicle:e}})},k=z.filter(e=>{var i;let t=null;Array.isArray(e.category)&&e.category.length>0?t=e.category[0]._id||e.category[0]:e.category&&(t=e.category._id||e.category);const r=((i=e.brand)==null?void 0:i._id)||e.brand;return(h.brand?r===h.brand:!0)&&(h.category?t===h.category:!0)&&(h.type?e.type===h.type:!0)&&(h.search?(e.name||"").toLowerCase().includes(h.search.toLowerCase()):!0)}),M=(e,t)=>{t!=="clickaway"&&y(!1)};return J?s.jsx(W,{sx:{bgcolor:"#fafafa",minHeight:"100vh",p:2,display:"flex",justifyContent:"center",alignItems:"center"},children:s.jsx(he,{})}):s.jsxs(W,{sx:{bgcolor:"#fafafa",minHeight:"100vh",p:2},children:[s.jsx(ue,{position:"static",color:"default",elevation:0,children:s.jsx(ge,{children:s.jsx(l,{variant:"h6",sx:{flexGrow:1,color:"#333"},children:"VEHICLES"})})}),_&&s.jsx(U,{severity:"error",sx:{mt:2},onClose:()=>K(""),children:_}),s.jsxs(pe,{sx:{p:2,mt:2},children:[s.jsxs(B,{direction:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",spacing:2,mb:2,children:[s.jsxs(l,{variant:"h6",sx:{fontWeight:600},children:["Total Vehicles"," ",s.jsx(Y,{label:k.length,color:"success",size:"small",sx:{ml:1}})]}),s.jsxs(B,{direction:"row",spacing:1,flexWrap:"wrap",children:[s.jsx(xe,{size:"small",placeholder:"Search by vehicle name",value:j,onChange:e=>L(e.target.value),InputProps:{endAdornment:s.jsxs(fe,{position:"end",children:[s.jsx(b,{onClick:te,size:"small",disabled:!j,sx:{color:j?"inherit":"action"},children:s.jsx(Ce,{fontSize:"small"})}),j&&s.jsx(b,{onClick:re,size:"small",children:s.jsx(Be,{fontSize:"small"})})]})}}),s.jsx(w,{variant:"outlined",color:"#E15B65",sx:{color:"#E15B65",borderRadius:"8px"},onClick:ie,children:"Export"}),s.jsx(w,{variant:"contained",sx:{bgcolor:"#E15B65"},onClick:()=>v("/vehicle-setup/leads"),children:"New Vehicle"})]})]}),s.jsx(ke,{children:s.jsxs(we,{children:[s.jsx(Ne,{sx:{bgcolor:"#f9fafb"},children:s.jsxs(E,{children:[s.jsx(n,{children:"Sl"}),s.jsx(n,{children:"Vehicle Info"}),s.jsx(n,{children:"Category"}),s.jsx(n,{children:"Brand"}),s.jsx(n,{children:"Type"}),s.jsx(n,{children:"Trip Fare"}),s.jsx(n,{children:"Details"}),s.jsx(n,{children:"Status"}),s.jsx(n,{children:"Action"})]})}),s.jsxs(Te,{children:[k.map((e,t)=>{var r,i,o,a,c,p;return s.jsxs(E,{children:[s.jsx(n,{children:t+1}),s.jsxs(n,{children:[s.jsx(l,{variant:"body2",sx:{fontWeight:600,color:"#2563eb"},children:e.name||"N/A"}),s.jsxs(l,{variant:"caption",color:"text.secondary",display:"block",children:["License: ",e.licensePlateNumber||"N/A"]})]}),s.jsx(n,{children:D(e.category)}),s.jsx(n,{children:P(e.brand)}),s.jsx(n,{children:e.type||"N/A"}),s.jsxs(n,{children:[((r=e.pricing)==null?void 0:r.hourly)&&s.jsxs(l,{variant:"body2",children:["Hourly: ₹",e.pricing.hourly]}),((i=e.pricing)==null?void 0:i.distanceWise)&&s.jsxs(l,{variant:"body2",children:["Distance: ₹",e.pricing.distanceWise,"/km"]}),((o=e.pricing)==null?void 0:o.perDay)&&s.jsxs(l,{variant:"body2",children:["Daily: ₹",e.pricing.perDay]}),!((a=e.pricing)!=null&&a.hourly)&&!((c=e.pricing)!=null&&c.distanceWise)&&!((p=e.pricing)!=null&&p.perDay)&&s.jsx(l,{variant:"body2",color:"text.secondary",children:"No pricing set"}),e.discount&&s.jsxs(l,{variant:"body2",color:"success.main",children:["Discount: ",e.discount,"%"]})]}),s.jsxs(n,{children:[s.jsxs(l,{variant:"body2",children:["Engine: ",e.engineCapacity||"N/A","cc, ",e.enginePower||"N/A","hp"]}),s.jsxs(l,{variant:"body2",children:["Seats: ",e.seatingCapacity||"N/A"]}),s.jsxs(l,{variant:"body2",children:["Fuel: ",e.fuelType||"N/A"]}),s.jsxs(l,{variant:"body2",children:["Transmission: ",e.transmissionType||"N/A"]}),s.jsxs(l,{variant:"body2",children:["A/C: ",e.airCondition?"Yes":"No"]})]}),s.jsxs(n,{children:[s.jsx(ye,{checked:e.isActive!==!1,onChange:()=>ne(e._id,"isActive",e.isActive!==!1),sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:"#E15B65"},"& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track":{backgroundColor:"#E15B65"},"& .MuiSwitch-track":{backgroundColor:"#ccc"}}}),e.isNew&&s.jsx(Y,{label:"New",color:"primary",size:"small"})]}),s.jsx(n,{children:s.jsxs(B,{direction:"row",spacing:1,children:[s.jsx(b,{size:"small",sx:{border:"1px solid #d1d5db",color:"#2563eb",borderRadius:"8px"},onClick:()=>v(`/vehicle-setup/listview/${e._id}`),children:s.jsx(je,{fontSize:"small"})}),s.jsx(b,{size:"small",sx:{border:"1px solid #d1d5db",color:"#065f46",borderRadius:"8px"},onClick:()=>le(e),children:s.jsx(Ie,{fontSize:"small"})}),s.jsx(b,{size:"small",sx:{border:"1px solid #d1d5db",color:"#dc2626",borderRadius:"8px"},onClick:()=>oe(e._id),children:s.jsx(me,{fontSize:"small"})})]})})]},e._id)}),k.length===0&&s.jsx(E,{children:s.jsx(n,{colSpan:10,align:"center",children:z.length===0?"No vehicles found. Add your first vehicle!":"No vehicles match the current filters"})})]})]})})]}),s.jsxs(be,{open:Z,onClose:()=>C(!1),children:[s.jsx(ve,{children:"Confirm Deletion"}),s.jsx(Ae,{children:s.jsx(l,{children:"Are you sure you want to delete this vehicle? This action cannot be undone."})}),s.jsxs($e,{children:[s.jsx(w,{onClick:()=>C(!1),children:"Cancel"}),s.jsx(w,{onClick:ae,variant:"contained",color:"error",children:"Delete"})]})]}),s.jsx(Se,{open:Q,autoHideDuration:3e3,onClose:M,anchorOrigin:{vertical:"top",horizontal:"center"},children:s.jsx(U,{onClose:M,severity:F,sx:{backgroundColor:F==="success"?"#1976d2":"#d32f2f",color:"white"},children:X})})]})}export{De as default};
