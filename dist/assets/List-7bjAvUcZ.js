import{Z as je,j as t,r as a,d as fe,B as K,c as me,J as be,K as Ce,T as c,H as Z,k as q,S as B,F as M,o as W,M as h,b as m,x as Q,a as Se,W as ve,s as A,V as Ae,N as ke,l as we,m as Ee,n as Ne,E as Te,h as k}from"./index-CyX4fgy4.js";import{S as Be}from"./Search-BGHCO8-H.js";import{T as Ie}from"./TableContainer-mrzCzfLp.js";import{T as $e,a as ze,b as V,c as n,d as _e}from"./TableRow-L6X5KmFO.js";import{S as Fe}from"./Switch-DdBWsjXK.js";import{D as Re}from"./Delete-CuKPI1co.js";import{D as Me}from"./DialogActions-BOoXC3_g.js";const We=je(t.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}));function Je(){const[L,I]=a.useState([]),[b,X]=a.useState([]),[y,ee]=a.useState([]),[te,$]=a.useState(!0),[O,se]=a.useState(""),[re,C]=a.useState(!1),[ie,p]=a.useState(""),[P,x]=a.useState("success"),[u,w]=a.useState({brand:"",category:"",type:"",search:""}),[g,E]=a.useState({brand:"",category:"",type:"",search:""}),[S,z]=a.useState(""),[oe,N]=a.useState(!1),[_,D]=a.useState(null),F=fe(),v="https://api.bookmyevent.ae/api",R=localStorage.getItem("moduleId");localStorage.getItem("providerId");const ne=async()=>{try{if(!R)return;const e=localStorage.getItem("token"),[s,r]=await Promise.all([k.get(`${v}/brands/module/${R}`,{headers:{Authorization:`Bearer ${e}`}}),k.get(`${v}/vehicle-categories`,{headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}})]);X(Array.isArray(s.data)?s.data:[]);let o=[];r.data.success&&Array.isArray(r.data.data)&&(o=r.data.data.filter(i=>{var l;return((l=i.module)==null?void 0:l._id)===R}).map(i=>({_id:i._id,title:i.title}))),ee(o)}catch(e){console.error("Error fetching options:",e)}},H=e=>{if(console.log("getCategoryTitle called with:",e),console.log("Type:",typeof e),console.log("Is Array:",Array.isArray(e)),!e)return console.log("Category data is null/undefined"),"N/A";if(Array.isArray(e)){if(console.log("Category is array, length:",e.length),e.length===0)return"N/A";const s=e[0];if(console.log("First category element:",s),console.log("First category type:",typeof s),typeof s=="object"&&s!==null&&s.title)return console.log("Returning title from object:",s.title),s.title;if(typeof s=="string"){const r=y.find(o=>o._id===s);return console.log("Looking up category by ID:",s,"Found:",r),r?r.title:"N/A"}}if(typeof e=="object"&&e!==null&&e.title)return console.log("Returning title from single object:",e.title),e.title;if(typeof e=="string"){const s=y.find(r=>r._id===e);return console.log("Looking up single category by ID:",e,"Found:",s),s?s.title:"N/A"}return console.log("No match found, returning N/A"),"N/A"},U=e=>{if(!e)return"N/A";if(typeof e=="object"&&e.title)return e.title;if(typeof e=="string"){const s=b.find(r=>r._id===e);return s?s.title:"N/A"}return"N/A"},le=async()=>{var e;$(!0);try{const s=localStorage.getItem("token"),r=JSON.parse(localStorage.getItem("user")||"{}"),o=r==null?void 0:r._id;if(!s||!o){console.error("Provider ID or token missing"),p("Provider authentication missing. Please log in again."),x("error"),C(!0),$(!1);return}const i=await k.get(`${v}/vehicles/provider/${o}`,{headers:{Authorization:`Bearer ${s}`}});(e=i.data)!=null&&e.success?(console.log("Fetched vehicles:",i.data.data),console.log("Available categories:",y),console.log("Available brands:",b),i.data.data&&i.data.data.length>0&&(console.log("First vehicle structure:",i.data.data[0]),console.log("First vehicle category:",i.data.data[0].category),console.log("First vehicle brand:",i.data.data[0].brand)),I(i.data.data||[])):console.error("Error fetching vehicles:",i.data.message)}catch(s){console.error("Error fetching vehicles:",s),p("Failed to load vehicles "),x("error"),C(!0)}finally{$(!1)}};a.useEffect(()=>{ne()},[]),a.useEffect(()=>{y.length>0&&b.length>0&&le()},[y,b]);const ae=()=>{w({...u,brand:g.brand,category:g.category,type:g.type})},ce=()=>{w({brand:"",category:"",type:"",search:""}),E({brand:"",category:"",type:"",search:""}),z("")},de=()=>{w(e=>({...e,search:S}))},he=()=>{z(""),w(e=>({...e,search:""}))},ue=e=>{D(e),N(!0)},ge=()=>{const e=["Sl,Name,Code,Category,Brand,Type,Hourly,Distance,Daily,New,Active"],s=T.map((d,j)=>{var f,Y,G;return`${j+1},${d.name||""},${d.vinNumber||""},${H(d.category)},${U(d.brand)},${d.type||""},${((f=d.pricing)==null?void 0:f.hourly)||"-"},
        ${((Y=d.pricing)==null?void 0:Y.distance)||"-"},${((G=d.pricing)==null?void 0:G.perDay)||"-"},${d.isNew?"Yes":"No"},${d.isActive?"Active":"Inactive"}`}),r=e.concat(s).join(`
`),o=new Blob([r],{type:"text/csv"}),i=URL.createObjectURL(o),l=document.createElement("a");l.href=i,l.download="vehicles.csv",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(i)},pe=async(e,s,r)=>{var o,i;try{const l=localStorage.getItem("token");(await k.put(`${v}/vehicles/${e}`,{[s]:!r},{headers:{Authorization:`Bearer ${l}`}})).data.success?(I(j=>j.map(f=>f._id===e?{...f,[s]:!r}:f)),p("Vehicle status updated successfully "),x("success")):(p("Failed to update vehicle status "),x("error"))}catch(l){console.error("Error toggling status:",l),p(((i=(o=l.response)==null?void 0:o.data)==null?void 0:i.message)||"Error updating vehicle"),x("error")}finally{C(!0)}},xe=async()=>{var e,s;if(_)try{const r=localStorage.getItem("token");await k.delete(`${v}/vehicles/${_}`,{headers:{Authorization:`Bearer ${r}`}}),I(o=>o.filter(i=>i._id!==_)),p("Vehicle deleted successfully"),x("success")}catch(r){p(((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to delete vehicle"),x("error")}finally{C(!0),N(!1),D(null)}},ye=e=>{F(`/vehicle-setup/leads/${e._id}`,{state:{vehicle:e}})},T=L.filter(e=>{var o;let s=null;Array.isArray(e.category)&&e.category.length>0?s=e.category[0]._id||e.category[0]:e.category&&(s=e.category._id||e.category);const r=((o=e.brand)==null?void 0:o._id)||e.brand;return(u.brand?r===u.brand:!0)&&(u.category?s===u.category:!0)&&(u.type?e.type===u.type:!0)&&(u.search?(e.name||"").toLowerCase().includes(u.search.toLowerCase()):!0)}),J=(e,s)=>{s!=="clickaway"&&C(!1)};return te?t.jsx(K,{sx:{bgcolor:"#fafafa",minHeight:"100vh",p:2,display:"flex",justifyContent:"center",alignItems:"center"},children:t.jsx(me,{})}):t.jsxs(K,{sx:{bgcolor:"#fafafa",minHeight:"100vh",p:2},children:[t.jsx(be,{position:"static",color:"default",elevation:0,children:t.jsx(Ce,{children:t.jsx(c,{variant:"h6",sx:{flexGrow:1,color:"#333"},children:"VEHICLES"})})}),O&&t.jsx(Z,{severity:"error",sx:{mt:2},onClose:()=>se(""),children:O}),t.jsx(q,{sx:{p:2,mt:2},children:t.jsxs(B,{direction:"row",spacing:2,flexWrap:"wrap",children:[t.jsx(M,{sx:{minWidth:200,"& .MuiOutlinedInput-notchedOutline":{borderColor:"#E15B65",borderWidth:"2px"}},size:"small",children:t.jsxs(W,{displayEmpty:!0,value:g.brand,onChange:e=>E({...g,brand:e.target.value}),children:[t.jsx(h,{value:"",children:"Select vehicle brand"}),b.map(e=>t.jsx(h,{value:e._id,children:e.title},e._id))]})}),t.jsx(M,{sx:{minWidth:200,"& .MuiOutlinedInput-notchedOutline":{borderColor:"#E15B65",borderWidth:"2px"}},size:"small",children:t.jsxs(W,{displayEmpty:!0,value:g.category,onChange:e=>E({...g,category:e.target.value}),children:[t.jsx(h,{value:"",children:"Select vehicle category"}),y.map(e=>t.jsx(h,{value:e._id,children:e.title},e._id))]})}),t.jsx(M,{sx:{minWidth:200,"& .MuiOutlinedInput-notchedOutline":{borderColor:"#E15B65",borderWidth:"2px"}},size:"small",children:t.jsxs(W,{displayEmpty:!0,value:g.type,onChange:e=>E({...g,type:e.target.value}),children:[t.jsx(h,{value:"",children:"Select vehicle type"}),t.jsx(h,{value:"sedan",children:"Sedan"}),t.jsx(h,{value:"suv",children:"SUV"}),t.jsx(h,{value:"hatchback",children:"Hatchback"}),t.jsx(h,{value:"coupe",children:"Coupe"}),t.jsx(h,{value:"convertible",children:"Convertible"}),t.jsx(h,{value:"truck",children:"Truck"}),t.jsx(h,{value:"van",children:"Van"}),t.jsx(h,{value:"motorcycle",children:"Motorcycle"})]})}),t.jsx(m,{variant:"outlined",color:"#E15B65",sx:{color:"#E15B65",bgcolor:"white",borderRadius:"8px"},onClick:ce,children:"Reset"}),t.jsx(m,{variant:"contained",sx:{bgcolor:"#E15B65",borderRadius:"8px"},onClick:ae,children:"Filter"})]})}),t.jsxs(q,{sx:{p:2,mt:2},children:[t.jsxs(B,{direction:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",spacing:2,mb:2,children:[t.jsxs(c,{variant:"h6",sx:{fontWeight:600},children:["Total Vehicles"," ",t.jsx(Q,{label:T.length,color:"success",size:"small",sx:{ml:1}})]}),t.jsxs(B,{direction:"row",spacing:1,flexWrap:"wrap",children:[t.jsx(Se,{size:"small",placeholder:"Search by vehicle name",value:S,onChange:e=>z(e.target.value),InputProps:{endAdornment:t.jsxs(ve,{position:"end",children:[t.jsx(A,{onClick:de,size:"small",disabled:!S,sx:{color:S?"inherit":"action"},children:t.jsx(Be,{fontSize:"small"})}),S&&t.jsx(A,{onClick:he,size:"small",children:t.jsx(We,{fontSize:"small"})})]})}}),t.jsx(m,{variant:"outlined",color:"#E15B65",sx:{color:"#E15B65",borderRadius:"8px"},onClick:ge,children:"Export"}),t.jsx(m,{variant:"contained",sx:{bgcolor:"#E15B65"},onClick:()=>F("/vehicle-setup/leads"),children:"New Vehicle"})]})]}),t.jsx(Ie,{children:t.jsxs($e,{children:[t.jsx(ze,{sx:{bgcolor:"#f9fafb"},children:t.jsxs(V,{children:[t.jsx(n,{children:"Sl"}),t.jsx(n,{children:"Vehicle Info"}),t.jsx(n,{children:"Category"}),t.jsx(n,{children:"Brand"}),t.jsx(n,{children:"Type"}),t.jsx(n,{children:"Trip Fare"}),t.jsx(n,{children:"Details"}),t.jsx(n,{children:"Status"}),t.jsx(n,{children:"Action"})]})}),t.jsxs(_e,{children:[T.map((e,s)=>{var r,o,i,l,d,j;return t.jsxs(V,{children:[t.jsx(n,{children:s+1}),t.jsxs(n,{children:[t.jsx(c,{variant:"body2",sx:{fontWeight:600,color:"#2563eb"},children:e.name||"N/A"}),t.jsxs(c,{variant:"caption",color:"text.secondary",display:"block",children:["License: ",e.licensePlateNumber||"N/A"]})]}),t.jsx(n,{children:H(e.category)}),t.jsx(n,{children:U(e.brand)}),t.jsx(n,{children:e.type||"N/A"}),t.jsxs(n,{children:[((r=e.pricing)==null?void 0:r.hourly)&&t.jsxs(c,{variant:"body2",children:["Hourly: ₹",e.pricing.hourly]}),((o=e.pricing)==null?void 0:o.distanceWise)&&t.jsxs(c,{variant:"body2",children:["Distance: ₹",e.pricing.distanceWise,"/km"]}),((i=e.pricing)==null?void 0:i.perDay)&&t.jsxs(c,{variant:"body2",children:["Daily: ₹",e.pricing.perDay]}),!((l=e.pricing)!=null&&l.hourly)&&!((d=e.pricing)!=null&&d.distanceWise)&&!((j=e.pricing)!=null&&j.perDay)&&t.jsx(c,{variant:"body2",color:"text.secondary",children:"No pricing set"}),e.discount&&t.jsxs(c,{variant:"body2",color:"success.main",children:["Discount: ",e.discount,"%"]})]}),t.jsxs(n,{children:[t.jsxs(c,{variant:"body2",children:["Engine: ",e.engineCapacity||"N/A","cc, ",e.enginePower||"N/A","hp"]}),t.jsxs(c,{variant:"body2",children:["Seats: ",e.seatingCapacity||"N/A"]}),t.jsxs(c,{variant:"body2",children:["Fuel: ",e.fuelType||"N/A"]}),t.jsxs(c,{variant:"body2",children:["Transmission: ",e.transmissionType||"N/A"]}),t.jsxs(c,{variant:"body2",children:["A/C: ",e.airCondition?"Yes":"No"]})]}),t.jsxs(n,{children:[t.jsx(Fe,{checked:e.isActive!==!1,onChange:()=>pe(e._id,"isActive",e.isActive!==!1),sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:"#E15B65"},"& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track":{backgroundColor:"#E15B65"},"& .MuiSwitch-track":{backgroundColor:"#ccc"}}}),e.isNew&&t.jsx(Q,{label:"New",color:"primary",size:"small"})]}),t.jsx(n,{children:t.jsxs(B,{direction:"row",spacing:1,children:[t.jsx(A,{size:"small",sx:{border:"1px solid #d1d5db",color:"#2563eb",borderRadius:"8px"},onClick:()=>F(`/vehicle-setup/listview/${e._id}`),children:t.jsx(Ae,{fontSize:"small"})}),t.jsx(A,{size:"small",sx:{border:"1px solid #d1d5db",color:"#065f46",borderRadius:"8px"},onClick:()=>ye(e),children:t.jsx(ke,{fontSize:"small"})}),t.jsx(A,{size:"small",sx:{border:"1px solid #d1d5db",color:"#dc2626",borderRadius:"8px"},onClick:()=>ue(e._id),children:t.jsx(Re,{fontSize:"small"})})]})})]},e._id)}),T.length===0&&t.jsx(V,{children:t.jsx(n,{colSpan:10,align:"center",children:L.length===0?"No vehicles found. Add your first vehicle!":"No vehicles match the current filters"})})]})]})})]}),t.jsxs(we,{open:oe,onClose:()=>N(!1),children:[t.jsx(Ee,{children:"Confirm Deletion"}),t.jsx(Ne,{children:t.jsx(c,{children:"Are you sure you want to delete this vehicle? This action cannot be undone."})}),t.jsxs(Me,{children:[t.jsx(m,{onClick:()=>N(!1),children:"Cancel"}),t.jsx(m,{onClick:xe,variant:"contained",color:"error",children:"Delete"})]})]}),t.jsx(Te,{open:re,autoHideDuration:3e3,onClose:J,anchorOrigin:{vertical:"top",horizontal:"center"},children:t.jsx(Z,{onClose:J,severity:P,sx:{backgroundColor:P==="success"?"#1976d2":"#d32f2f",color:"white"},children:ie})})]})}export{Je as default};
