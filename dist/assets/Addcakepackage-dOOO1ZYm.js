import{w as Xe,r as s,j as e,B as d,t as Ae,b as A,ak as Ye,T as f,x as Te,ad as Z,s as h,S as y,F as B,I as $,ag as F,$ as j,C as Ze,a7 as et,a9 as tt,O as at,g as Ee,f as st,al as rt,h as S,ar as it}from"./index-BADBtUzL.js";import{A as nt}from"./Add-C3UqOoP3.js";import{C as ee}from"./Close-byF3z-oK.js";import{C as Ne}from"./CloudUpload-CobADRYp.js";const g="#E91E63",k="https://api.bookmyevent.ae",De="68e5fc09651cc12c1fc0f9c9",ot=({variation:T,onChange:U,onDelete:C})=>e.jsxs(y,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"center",sx:{mb:2},children:[e.jsx(h,{label:"Variation Name (e.g. Half Kg)",value:T.name||"",onChange:p=>U("name",p.target.value),sx:{flex:1}}),e.jsx(h,{label:"Price (₹)",type:"number",value:T.price||"",onChange:p=>U("price",p.target.value),sx:{width:150}}),e.jsx(A,{onClick:C,color:"error",children:e.jsx(it,{})})]}),gt=()=>{const T=Xe(),C=new URLSearchParams(window.location.search).get("id"),p=!!C,[We,te]=s.useState(!0),[ae,se]=s.useState(!1),[re,L]=s.useState(""),[ie,m]=s.useState(""),[_e,Be]=s.useState([]),[ne,E]=s.useState([]),[$e,Fe]=s.useState(!0),[u,Ue]=s.useState(null),[z,oe]=s.useState(""),[le,ce]=s.useState(""),[N,O]=s.useState(""),[D,R]=s.useState([]),[de,ue]=s.useState("Eggless"),[M,ge]=s.useState(""),[V,he]=s.useState(""),[G,pe]=s.useState(""),[me,xe]=s.useState("Amount"),[J,fe]=s.useState(""),[Q,be]=s.useState(""),[q,je]=s.useState(""),[H,ye]=s.useState(!0),[Ce,W]=s.useState([{id:Date.now(),name:"",price:""}]),[b,ve]=s.useState(null),[K,Le]=s.useState(""),[_,Se]=s.useState([]),[X,ke]=s.useState([]);s.useEffect(()=>{try{const t=localStorage.getItem("vendor")||localStorage.getItem("user")||localStorage.getItem("vendorData");t&&Ue(JSON.parse(t))}catch(t){console.error("Vendor load error:",t)}},[]),s.useEffect(()=>{(async()=>{var a;try{const r=localStorage.getItem("token"),c=((a=(await S.get(`${k}/api/categories/parents/${De}`,{headers:{Authorization:`Bearer ${r}`}})).data)==null?void 0:a.data)||[];Be(c),console.log("✅ Parent Categories Loaded:",c)}catch(r){console.error("❌ Failed to load parent categories:",r),m("Failed to load categories")}finally{Fe(!1)}})()},[]);const ze=async t=>{var r;const a=t.target.value;if(O(a),R([]),E([]),!!a)try{const o=localStorage.getItem("token"),x=((r=(await S.get(`${k}/api/categories/parents/${a}/subcategories`,{headers:{Authorization:`Bearer ${o}`}})).data)==null?void 0:r.data)||[];E(x),console.log("✅ Subcategories Loaded:",x)}catch(o){console.error("❌ Failed to load subcategories:",o),E([])}};s.useEffect(()=>{if(!p){te(!1);return}(async()=>{var a,r,o,c,x,I,w,P,i,l,Ie,we,Pe;try{const{data:Y}=await S.get(`${k}/api/cakes/${C}`),n=Y.data;if(oe(n.name),ce(n.shortDescription),(r=(a=n.category)==null?void 0:a.parentCategory)!=null&&r._id){const v=n.category.parentCategory._id;O(v);const He=localStorage.getItem("token"),Ke=await S.get(`${k}/api/categories/parents/${v}/subcategories`,{headers:{Authorization:`Bearer ${He}`}});E(((o=Ke.data)==null?void 0:o.data)||[]),R([n.category._id])}else(c=n.category)!=null&&c._id&&O(n.category._id);ue(n.itemType),ge(((x=n.nutrition)==null?void 0:x.join(", "))||""),he(((I=n.allergenIngredients)==null?void 0:I.join(", "))||""),pe(((w=n.priceInfo)==null?void 0:w.unitPrice)||""),xe(((P=n.priceInfo)==null?void 0:P.discountType)||"Amount"),fe(((i=n.priceInfo)==null?void 0:i.discount)||""),be(((l=n.priceInfo)==null?void 0:l.maxPurchaseQty)||""),je(((Ie=n.searchTags)==null?void 0:Ie.join(", "))||""),ye(n.isActive),((we=n.variations)==null?void 0:we.length)>0&&W(n.variations.map(v=>({id:v._id||Date.now(),name:v.name,price:v.price}))),n.thumbnail&&Le(n.thumbnail),((Pe=n.images)==null?void 0:Pe.length)>0&&ke(n.images)}catch(Y){console.error("Failed to load cake:",Y),m("Failed to load cake details")}finally{te(!1)}})()},[p,C]);const Oe=()=>{W(t=>[...t,{id:Date.now(),name:"",price:""}])},Re=(t,a,r)=>{W(o=>o.map(c=>c.id===t?{...c,[a]:r}:c))},Me=t=>{W(a=>a.filter(r=>r.id!==t))},Ve=t=>{const a=t.target.files[0];a&&ve(a)},Ge=t=>{const a=Array.from(t.target.files);if(_.length+X.length+a.length>10){alert("Maximum 10 gallery images allowed");return}Se(o=>[...o,...a])},Je=t=>Se(a=>a.filter((r,o)=>o!==t)),Qe=t=>ke(a=>a.filter((r,o)=>o!==t)),qe=async()=>{var c,x,I,w,P;const t=(u==null?void 0:u._id)||(u==null?void 0:u.id);if(!t){m("Vendor not authenticated");return}if(!z.trim()){m("Cake name is required");return}if(!N){m("Select a category");return}if(!G){m("Unit price is required");return}if(!b&&!K){m("Thumbnail image is required");return}const a=new FormData;a.append("name",z),a.append("shortDescription",le),a.append("module",De),a.append("category",N),a.append("itemType",de),a.append("isActive",H),a.append("provider",t),D.length>0&&a.append("subCategories",JSON.stringify(D));const r={unitPrice:Number(G),discountType:me,discount:J?Number(J):0,maxPurchaseQty:Q?Number(Q):void 0};if(a.append("priceInfo",JSON.stringify(r)),M.trim()){const i=M.split(",").map(l=>l.trim()).filter(Boolean);a.append("nutrition",JSON.stringify(i))}if(V.trim()){const i=V.split(",").map(l=>l.trim()).filter(Boolean);a.append("allergenIngredients",JSON.stringify(i))}if(q.trim()){const i=q.split(",").map(l=>l.trim()).filter(Boolean);a.append("searchTags",JSON.stringify(i))}const o=Ce.filter(i=>i.name&&i.price).map(({name:i,price:l})=>({name:i,price:Number(l)}));o.length>0&&a.append("variations",JSON.stringify(o)),b&&a.append("thumbnail",b),_.forEach(i=>{a.append("images",i)});try{se(!0),m(""),L("");let i;if(p?(i=await S.put(`${k}/api/cakes/${C}`,a,{headers:{"Content-Type":"multipart/form-data"}}),L("Cake updated successfully!")):(i=await S.post(`${k}/api/cakes`,a,{headers:{"Content-Type":"multipart/form-data"}}),L("Cake created successfully!")),i.data.success&&i.data.data){const l=i.data.data;console.log("✅ Cake Package Created/Updated:",{id:l._id,name:l.name,cakeId:l.cakeId,category:(c=l.category)==null?void 0:c.title,provider:(x=l.provider)==null?void 0:x.storeName,thumbnail:l.thumbnail,priceInfo:l.priceInfo,variations:l.variations,module:(I=l.module)==null?void 0:I.title})}}catch(i){console.error("Submit error:",i),m(((P=(w=i.response)==null?void 0:w.data)==null?void 0:P.message)||"Error saving cake")}finally{se(!1),window.scrollTo({top:0,behavior:"smooth"})}};return We||$e?e.jsx(d,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:e.jsx(Ae,{size:60,sx:{color:g}})}):e.jsxs(d,{sx:{bgcolor:"#f9f9fc",minHeight:"100vh"},children:[e.jsxs(d,{sx:{bgcolor:"white",borderBottom:"1px solid #eee",p:2,px:4,position:"sticky",top:0,zIndex:10},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(A,{onClick:()=>T(-1),children:e.jsx(Ye,{})}),e.jsxs(f,{variant:"h5",fontWeight:"bold",children:[p?"Edit":"Add"," Cake Package"]})]}),u&&e.jsxs(f,{variant:"body2",color:"text.secondary",sx:{ml:7},children:["Creating as: ",u.firstName," ",u.lastName]})]}),e.jsxs(d,{sx:{p:{xs:2,md:4}},children:[re&&e.jsx(Te,{severity:"success",sx:{mb:3},children:re}),ie&&e.jsx(Te,{severity:"error",sx:{mb:3},children:ie}),e.jsxs(Z,{elevation:3,sx:{borderRadius:3,p:{xs:3,md:6}},children:[e.jsx(h,{fullWidth:!0,label:"Cake Name *",value:z,onChange:t=>oe(t.target.value),sx:{mb:3}}),e.jsx(h,{fullWidth:!0,label:"Short Description *",multiline:!0,rows:2,value:le,onChange:t=>ce(t.target.value),sx:{mb:3}}),e.jsxs(y,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsxs(B,{fullWidth:!0,children:[e.jsx($,{children:"Parent Category *"}),e.jsxs(F,{value:N,onChange:ze,children:[e.jsx(j,{value:"",children:"Select Parent Category"}),_e.map(t=>e.jsx(j,{value:t._id,children:t.title},t._id))]})]}),e.jsxs(B,{fullWidth:!0,disabled:!N,children:[e.jsx($,{children:"Sub Categories"}),e.jsx(F,{multiple:!0,value:D,onChange:t=>R(t.target.value),input:e.jsx(at,{}),renderValue:t=>e.jsx(d,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(a=>{const r=ne.find(o=>o._id===a);return e.jsx(tt,{label:(r==null?void 0:r.title)||a,size:"small"},a)})}),children:ne.map(t=>e.jsxs(j,{value:t._id,children:[e.jsx(Ze,{checked:D.includes(t._id)}),e.jsx(et,{primary:t.title})]},t._id))})]})]}),e.jsx(y,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3,alignItems:"center"},children:e.jsxs(B,{fullWidth:!0,children:[e.jsx($,{children:"Item Type"}),e.jsxs(F,{value:de,onChange:t=>ue(t.target.value),children:[e.jsx(j,{value:"Eggless",children:"Eggless"}),e.jsx(j,{value:"Egg",children:"Egg"})]})]})}),e.jsxs(y,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsx(h,{fullWidth:!0,label:"Nutrition (comma separated)",placeholder:"e.g. Sugar, Milk, Flour",value:M,onChange:t=>ge(t.target.value)}),e.jsx(h,{fullWidth:!0,label:"Allergen Ingredients (comma separated)",placeholder:"e.g. Nuts, Gluten",value:V,onChange:t=>he(t.target.value)})]}),e.jsx(f,{variant:"h6",sx:{mb:2,color:g},children:"Pricing"}),e.jsx(y,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:2},children:e.jsx(h,{fullWidth:!0,label:"Base Unit Price (₹) *",type:"number",value:G,onChange:t=>pe(t.target.value)})}),e.jsxs(y,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsxs(B,{sx:{minWidth:150},children:[e.jsx($,{children:"Discount Type"}),e.jsxs(F,{value:me,onChange:t=>xe(t.target.value),children:[e.jsx(j,{value:"Amount",children:"Amount"}),e.jsx(j,{value:"Percentage",children:"Percentage"})]})]}),e.jsx(h,{label:"Discount Value",type:"number",value:J,onChange:t=>fe(t.target.value),fullWidth:!0}),e.jsx(h,{label:"Max Purchase Qty",type:"number",value:Q,onChange:t=>be(t.target.value),fullWidth:!0})]}),e.jsxs(d,{sx:{mb:4},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(f,{variant:"h6",sx:{color:g},children:"Variations (Size/Weight)"}),e.jsx(Ee,{variant:"contained",startIcon:e.jsx(nt,{}),sx:{bgcolor:g,"&:hover":{bgcolor:"#c2185b"}},onClick:Oe,children:"Add Variation"})]}),Ce.map(t=>e.jsx(ot,{variation:t,onChange:(a,r)=>Re(t.id,a,r),onDelete:()=>Me(t.id)},t.id))]}),e.jsx(h,{fullWidth:!0,label:"Search Tags (comma separated)",placeholder:"e.g. chocolate, birthday, wedding",value:q,onChange:t=>je(t.target.value),sx:{mb:4}}),e.jsx(y,{direction:"row",spacing:4,sx:{mb:4},children:e.jsx(st,{control:e.jsx(rt,{checked:H,onChange:()=>ye(!H),sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:g}}}),label:"Active"})}),e.jsx(f,{variant:"h6",sx:{color:g,mb:2},children:"Thumbnail Image *"}),e.jsxs(Z,{onClick:()=>document.getElementById("thumbnail-input").click(),sx:{border:"2px dashed #ddd",borderRadius:2,p:4,textAlign:"center",cursor:"pointer",mb:4},children:[e.jsx("input",{id:"thumbnail-input",type:"file",hidden:!0,accept:"image/*",onChange:Ve}),b||K?e.jsxs(d,{sx:{position:"relative",display:"inline-block"},children:[e.jsx("img",{src:b?URL.createObjectURL(b):K,alt:"Thumbnail",style:{width:200,height:200,objectFit:"cover",borderRadius:8}}),b&&e.jsx(A,{onClick:t=>{t.stopPropagation(),ve(null)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(ee,{})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{sx:{fontSize:60,color:"#ccc"}}),e.jsx(f,{sx:{mt:2,color:g,fontWeight:"bold"},children:"Click to Upload Thumbnail"})]})]}),e.jsx(f,{variant:"h6",sx:{color:g,mb:2},children:"Gallery Images (Max 10)"}),e.jsxs(Z,{onClick:()=>document.getElementById("gallery-input").click(),sx:{border:"2px dashed #ddd",borderRadius:2,p:4,textAlign:"center",cursor:"pointer",mb:4},children:[e.jsx("input",{id:"gallery-input",type:"file",hidden:!0,multiple:!0,accept:"image/*",onChange:Ge}),_.length>0||X.length>0?e.jsxs(d,{sx:{display:"flex",flexWrap:"wrap",gap:2,justifyContent:"center"},children:[X.map((t,a)=>e.jsxs(d,{sx:{position:"relative"},children:[e.jsx("img",{src:t,alt:"",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(A,{onClick:r=>{r.stopPropagation(),Qe(a)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(ee,{fontSize:"small"})})]},`ex-${a}`)),_.map((t,a)=>e.jsxs(d,{sx:{position:"relative"},children:[e.jsx("img",{src:URL.createObjectURL(t),alt:"",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(A,{onClick:r=>{r.stopPropagation(),Je(a)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(ee,{fontSize:"small"})})]},`new-${a}`))]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{sx:{fontSize:60,color:"#ccc"}}),e.jsx(f,{sx:{mt:2,color:g,fontWeight:"bold"},children:"Click to Upload Gallery Images"})]})]}),e.jsx(Ee,{fullWidth:!0,variant:"contained",size:"large",onClick:qe,disabled:ae||!u,sx:{py:2,bgcolor:g,"&:hover":{bgcolor:"#c2185b"}},children:ae?e.jsx(Ae,{size:28,color:"inherit"}):p?"Update Cake Package":"Create Cake Package"})]})]})]})};export{gt as default};
