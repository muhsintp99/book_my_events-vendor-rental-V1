import{d as M,r,j as e,B as i,U as K,s as b,T as a,b as c,C as I,q as $,a as Q,Z,c as X,az as z,G as h,V as ee,o as A,a1 as se,z as te,v as ae,H as B,a4 as E,J as R,a2 as re,K as _,N as ne}from"./index-CWJg_lwt.js";import{A as ie}from"./Add-GGc6Xt8k.js";import{S as oe}from"./Search-WfmjaGyn.js";import{C as ce}from"./CardMedia-UFdY_0kj.js";import{C as le}from"./Close-D09zOr9j.js";const P="https://api.bookmyevent.ae/api/mehandi";function ge(){const u=M(),[p,y]=r.useState([]),[F,v]=r.useState(!0),[g,o]=r.useState({open:!1,message:"",severity:"success"}),[m,V]=r.useState(""),[H,j]=r.useState(!1),[O,f]=r.useState(!1),[t,U]=r.useState(null),[D,N]=r.useState(null),l=localStorage.getItem("token"),C=JSON.parse(localStorage.getItem("user")||"{}"),k=C==null?void 0:C._id,L=s=>s?`https://api.bookmyevent.ae/${s.startsWith("/")?s.slice(1):s}`:null,w=s=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(s||0),T=r.useCallback(async()=>{if(!k||!l){o({open:!0,message:"Please login again",severity:"error"}),v(!1);return}v(!0);try{const s=await fetch(`${P}/vendor/${k}`,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}});if(!s.ok)throw new Error("Failed to load packages");const n=await s.json();n.success&&y(n.data||[])}catch(s){o({open:!0,message:s.message,severity:"error"})}finally{v(!1)}},[k,l]);r.useEffect(()=>{T()},[T]);const Y=s=>{U(s),j(!0)},q=async(s,n)=>{try{(await(await fetch(`${P}/${s}/toggle-active`,{method:"PATCH",headers:{Authorization:`Bearer ${l}`}})).json()).success&&(y(J=>J.map(S=>S._id===s?{...S,isActive:!n}:S)),o({open:!0,message:"Status updated",severity:"success"}))}catch{o({open:!0,message:"Failed to update status",severity:"error"})}},G=async()=>{try{(await(await fetch(`${P}/${D}`,{method:"DELETE",headers:{Authorization:`Bearer ${l}`}})).json()).success&&(y(d=>d.filter(x=>x._id!==D)),o({open:!0,message:"Package deleted",severity:"success"}))}catch{o({open:!0,message:"Delete failed",severity:"error"})}finally{f(!1),N(null)}},W=r.useMemo(()=>p.filter(s=>{var d,x;if(!m)return!0;const n=m.toLowerCase();return((d=s.packageName)==null?void 0:d.toLowerCase().includes(n))||((x=s.description)==null?void 0:x.toLowerCase().includes(n))}),[p,m]);return e.jsxs(i,{sx:{bgcolor:"#f5f7fa",minHeight:"100vh",pb:4},children:[e.jsx(i,{sx:{background:"linear-gradient(135deg, #673ab7 0%, #4527a0 100%)",color:"white",py:4,px:3,borderRadius:"0 0 24px 24px",boxShadow:"0 4px 20px rgba(103, 58, 183, 0.3)"},children:e.jsx(K,{maxWidth:"xl",children:e.jsxs(b,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(i,{children:[e.jsx(a,{variant:"h4",sx:{fontWeight:700,mb:.5},children:"Light & Sound Packages"}),e.jsxs(a,{variant:"body2",sx:{opacity:.9},children:[p.length," total packages â€¢ ",p.filter(s=>s.isActive).length," active"]})]}),e.jsx(c,{variant:"contained",size:"large",startIcon:e.jsx(ie,{}),onClick:()=>u("/light/addpackage"),sx:{bgcolor:"white",color:"#673ab7",fontWeight:600,px:3,"&:hover":{bgcolor:"#f5f5f5",transform:"translateY(-2px)"},transition:"all 0.3s",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:"Add New Package"})]})})}),e.jsxs(i,{sx:{width:"100%",px:2,mt:4},children:[e.jsx(I,{sx:{mb:3,borderRadius:3,boxShadow:"0 2px 12px rgba(0,0,0,0.08)"},children:e.jsx($,{children:e.jsx(Q,{fullWidth:!0,placeholder:"Search by package name or description...",value:m,onChange:s=>V(s.target.value),InputProps:{startAdornment:e.jsx(Z,{position:"start",children:e.jsx(oe,{sx:{color:"#673ab7",fontSize:28}})}),sx:{borderRadius:2}}})})}),F?e.jsx(i,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(X,{size:60,sx:{color:"#673ab7"}})}):W.length===0?e.jsxs(I,{sx:{textAlign:"center",py:8},children:[e.jsx(z,{sx:{fontSize:80,color:"#ddd",mb:2}}),e.jsx(a,{variant:"h5",color:"text.secondary",children:"No packages found"}),e.jsx(c,{variant:"contained",sx:{mt:3,bgcolor:"#673ab7"},onClick:()=>u("/light/addpackage"),children:"Create Your First Package"})]}):e.jsx(h,{container:!0,spacing:3,children:W.map(s=>e.jsx(h,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsxs(I,{sx:{height:"100%",borderRadius:3,transition:"0.3s","&:hover":{transform:"translateY(-8px)"}},children:[e.jsx(i,{sx:{position:"relative",pt:"75%",bgcolor:"#f5f5f5"},children:s.image?e.jsx(ce,{component:"img",image:L(s.image),alt:s.packageName,sx:{position:"absolute",top:0,width:"100%",height:"100%",objectFit:"cover"}}):e.jsx(i,{sx:{position:"absolute",top:0,width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(z,{sx:{fontSize:60,color:"#ccc"}})})}),e.jsxs($,{sx:{p:2.5},children:[e.jsx(a,{variant:"h6",sx:{fontWeight:700,mb:1},noWrap:!0,children:s.packageName}),e.jsx(a,{variant:"h5",sx:{fontWeight:700,color:"#673ab7",mb:2},children:w(s.packagePrice)}),e.jsxs(b,{direction:"row",spacing:1,children:[e.jsx(c,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(ee,{}),onClick:()=>Y(s),children:"View"}),e.jsx(A,{color:"primary",onClick:()=>u(`/light/edit/${s._id}`),children:e.jsx(se,{})}),e.jsx(A,{color:"error",onClick:()=>{N(s._id),f(!0)},children:e.jsx(te,{})})]}),e.jsxs(i,{sx:{mt:2,pt:2,borderTop:"1px solid #f0f0f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(a,{variant:"body2",fontWeight:500,children:"Status"}),e.jsx(ae,{checked:s.isActive,onChange:()=>q(s._id,s.isActive)})]})]})]})},s._id))})]}),e.jsxs(B,{open:H,onClose:()=>j(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(E,{sx:{bgcolor:"#673ab7",color:"white"},children:e.jsxs(b,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(a,{variant:"h6",children:t==null?void 0:t.packageName}),e.jsx(A,{onClick:()=>j(!1),sx:{color:"white"},children:e.jsx(le,{})})]})}),e.jsx(R,{dividers:!0,children:t&&e.jsxs(h,{container:!0,spacing:3,children:[e.jsx(h,{item:!0,xs:12,md:5,children:t.image&&e.jsx("img",{src:L(t.image),alt:t.packageName,style:{width:"100%",borderRadius:"12px"}})}),e.jsxs(h,{item:!0,xs:12,md:7,children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Description"}),e.jsx(a,{variant:"body1",color:"text.secondary",paragraph:!0,children:t.description}),e.jsx(re,{sx:{my:2}}),e.jsxs(b,{spacing:1,children:[e.jsx(a,{variant:"h6",children:"Pricing"}),e.jsxs(a,{variant:"body1",children:["Full Price: ",e.jsx("b",{children:w(t.packagePrice)})]}),e.jsxs(a,{variant:"body1",children:["Advance: ",e.jsx("b",{children:w(t.advanceBookingAmount)})]})]})]})]})}),e.jsxs(_,{sx:{p:2},children:[e.jsx(c,{onClick:()=>j(!1),children:"Close"}),e.jsx(c,{variant:"contained",sx:{bgcolor:"#673ab7"},onClick:()=>u(`/light/edit/${t==null?void 0:t._id}`),children:"Edit Package"})]})]}),e.jsxs(B,{open:O,onClose:()=>f(!1),children:[e.jsx(E,{children:"Delete Package?"}),e.jsx(R,{children:"This action cannot be undone."}),e.jsxs(_,{children:[e.jsx(c,{onClick:()=>f(!1),children:"Cancel"}),e.jsx(c,{color:"error",variant:"contained",onClick:G,children:"Delete"})]})]}),e.jsx(ne,{open:g.open,autoHideDuration:6e3,onClose:()=>o({...g,open:!1}),children:e.jsx(a,{sx:{bgcolor:g.severity==="success"?"success.main":"error.main",color:"white",p:2,borderRadius:1},children:g.message})})]})}export{ge as default};
