import{c as T,j as e,r,u as _,F as L,I as P,O as W,a as J,b as N,V as q,d as G,e as $,G as t,f as K,C as Q,T as p,L as g,B as E,A as U,g as z,h as B,i as X,k as Y,l as Z,S as ee,D as te,m as se,n as ne,o as re}from"./index-BFQzDa3Y.js";const ae=T([e.jsx("path",{d:"M17 18H7V6h7V1H7c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2v-5h-2z"},"0"),e.jsx("path",{d:"m18 14 5-5-1.41-1.41L19 10.17V3h-2v7.17l-2.59-2.58L13 9z"},"1")]),oe=()=>{const[n,o]=r.useState(!1),[u,i]=r.useState(null);return r.useEffect(()=>{const l=x=>{x.preventDefault(),o(!0),i(x)};return window.addEventListener("beforeinstallprompt",l),()=>window.removeEventListener("beforeinstallprompt",l)},[]),{supportsPWA:n,installPWA:()=>{u&&u.prompt()}}};function ie(){const n=_(),[o,u]=r.useState(!0),[i,j]=r.useState(!1),[l,x]=r.useState(""),[f,H]=r.useState(""),[I,b]=r.useState(""),{supportsPWA:O,installPWA:F}=oe(),M=async a=>{var S,y,v,w,A,C;a.preventDefault(),b("");try{const h=await B.post("https://api.bookmyevent.ae/api/auth/login",{email:l,password:f}),{token:k,user:c,profile:d}=h.data;o?localStorage.setItem("token",k):sessionStorage.setItem("token",k),localStorage.setItem("user",JSON.stringify(c));let m=null;if((S=d==null?void 0:d.module)!=null&&S._id&&(m=d.module._id,localStorage.setItem("moduleId",m),localStorage.setItem("logRes",d.module.title)),c!=null&&c._id&&m)try{const s=(y=(await B.get(`https://api.bookmyevent.ae/api/subscription/status/${c._id}?moduleId=${m}`)).data)==null?void 0:y.subscription;if((s==null?void 0:s.status)==="active"&&(s!=null&&s.isCurrent)){const V=new Date(s.endDate),R=Math.max(0,Math.ceil((V-new Date)/(1e3*60*60*24)));localStorage.setItem("upgrade",JSON.stringify({isSubscribed:!0,status:"active",plan:s.planId,module:s.moduleId,access:{canAccess:!0,isExpired:!1,daysLeft:R}}))}else localStorage.setItem("upgrade",JSON.stringify({isSubscribed:!1,status:"free",access:{canAccess:!1}}))}catch(D){console.error("Subscription fetch failed:",D),localStorage.setItem("upgrade",JSON.stringify({isSubscribed:!1,status:"free",access:{canAccess:!1}}))}window.location.href="/dashboard/default"}catch(h){b(((w=(v=h.response)==null?void 0:v.data)==null?void 0:w.message)||((C=(A=h.response)==null?void 0:A.data)==null?void 0:C.error)||"Invalid email or password")}};return e.jsxs("form",{onSubmit:M,children:[e.jsxs(L,{fullWidth:!0,sx:{...n.typography.customInput,mb:2},children:[e.jsx(P,{children:"Email Address"}),e.jsx(W,{type:"email",value:l,onChange:a=>x(a.target.value),required:!0})]}),e.jsxs(L,{fullWidth:!0,sx:{...n.typography.customInput,mb:2},children:[e.jsx(P,{children:"Password"}),e.jsx(W,{type:i?"text":"password",value:f,onChange:a=>H(a.target.value),endAdornment:e.jsx(J,{position:"end",children:e.jsx(N,{onClick:()=>j(!i),edge:"end",children:i?e.jsx(q,{}):e.jsx(G,{})})}),required:!0})]}),I&&e.jsx($,{error:!0,children:I}),e.jsxs(t,{container:!0,justifyContent:"space-between",alignItems:"center",children:[e.jsx(K,{control:e.jsx(Q,{checked:o,onChange:a=>u(a.target.checked)}),label:"Keep me logged in"}),e.jsx(p,{component:g,to:"/forgot-password",color:"#E15B65",sx:{textDecoration:"none"},children:"Forgot Password?"})]}),e.jsx(E,{sx:{mt:2},children:e.jsx(U,{children:e.jsx(z,{fullWidth:!0,size:"large",type:"submit",variant:"contained",sx:{bgcolor:"#E15B65"},children:"Sign In"})})}),O&&e.jsx(E,{sx:{mt:2},children:e.jsx(z,{fullWidth:!0,size:"large",variant:"outlined",onClick:F,startIcon:e.jsx(ae,{}),sx:{color:n.palette.primary.main,borderColor:n.palette.primary.main},children:"Install App"})})]})}function le(){return e.jsx(g,{to:ne,"aria-label":"theme-logo",children:e.jsx("img",{src:re,alt:"Book Logo",style:{width:160,height:50}})})}function ue(){const n=X(o=>o.breakpoints.down("md"));return e.jsx(Y,{children:e.jsxs(t,{container:!0,direction:"column",sx:{justifyContent:"flex-end",minHeight:"100vh"},children:[e.jsx(t,{size:12,children:e.jsx(t,{container:!0,sx:{justifyContent:"center",alignItems:"center",minHeight:"calc(100vh - 68px)"},children:e.jsx(t,{sx:{m:{xs:1,sm:3},mb:0},children:e.jsx(Z,{children:e.jsxs(t,{container:!0,spacing:2,sx:{alignItems:"center",justifyContent:"center"},children:[e.jsx(t,{sx:{mb:3},children:e.jsx(le,{})}),e.jsx(t,{size:12,children:e.jsx(t,{container:!0,direction:{xs:"column-reverse",md:"row"},sx:{alignItems:"center",justifyContent:"center"},children:e.jsx(t,{children:e.jsxs(ee,{spacing:1,sx:{alignItems:"center",justifyContent:"center"},children:[e.jsx(p,{gutterBottom:!0,variant:n?"h3":"h2",sx:{color:"#E15B65"},children:"Hi, Welcome Back"}),e.jsx(p,{variant:"caption",sx:{fontSize:"16px",textAlign:{xs:"center",md:"inherit"}},children:"Enter your credentials to continue"})]})})})}),e.jsx(t,{size:12,children:e.jsx(ie,{})}),e.jsx(t,{size:12,children:e.jsx(te,{})}),e.jsx(t,{size:12,children:e.jsx(t,{container:!0,direction:"column",sx:{alignItems:"center"},size:12,children:e.jsx(p,{component:g,to:"/register",variant:"subtitle1",sx:{textDecoration:"none"},children:"Don't have an account? Sign up"})})})]})})})})}),e.jsx(t,{sx:{px:3,my:3},size:12,children:e.jsx(se,{})})]})})}export{ue as default};
