import{M as be,j as e,r as i,g as ve,B as v,s as X,v as Z,aj as Ie,o as Se,N as ee,T as W,q as h,f as I,G as oe,b as te,a7 as ye,ag as ke}from"./index-KwbFPzn3.js";import{T as Ce,a as se}from"./Tabs-B9N4HlDz.js";import{C as we}from"./CloudUpload-Br9tPwlt.js";import{C as Te}from"./Close-fboW6Dyw.js";import{V as ae}from"./VideoLibrary-CUBmLqOj.js";import{T as Pe}from"./TableContainer-B_czVzil.js";import{T as Le,a as Ae,b as $,c as r,d as De}from"./TableRow-BrEE-dR8.js";import{D as Re}from"./Delete-CR6ALtDk.js";const Me=be(e.jsx("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"})),le="https://api.bookmyevent.ae",P=ve.create({baseURL:le}),n="#e53935";function $e(){const L=JSON.parse(localStorage.getItem("user")||"{}"),g=L==null?void 0:L._id,x=localStorage.getItem("moduleId"),[f,j]=i.useState(!1),[ie,A]=i.useState(!0),[D,re]=i.useState(0),[ne,S]=i.useState(!1),[B,ce]=i.useState([]),[y,R]=i.useState(""),[M,U]=i.useState(""),[de,H]=i.useState([]),[E,J]=i.useState(""),[k,V]=i.useState([]),[z,q]=i.useState([]),[F,G]=i.useState([]),[O,K]=i.useState(""),[C,Y]=i.useState({open:!1,message:"",severity:"success"});i.useEffect(()=>{(async()=>{var d,b;const s=localStorage.getItem("moduleId"),a=s||x;console.log("ðŸ” ========== PORTFOLIO SUBSCRIPTION CHECK =========="),console.log("ðŸ” providerId:",g),console.log("ðŸ” moduleId (component):",x),console.log("ðŸ” moduleId (fresh):",s),console.log("ðŸ” upgrade localStorage:",localStorage.getItem("upgrade"));const l=()=>{var u;try{const t=JSON.parse(localStorage.getItem("upgrade")||"{}"),m=typeof(t==null?void 0:t.module)=="object"?(u=t==null?void 0:t.module)==null?void 0:u._id:t==null?void 0:t.module;if(console.log("ðŸ” Fallback check:"),console.log("  - upgrade.status:",t==null?void 0:t.status),console.log("  - upgrade.module (upgradeModuleId):",m),console.log("  - effectiveModuleId:",a),console.log("  - Match?",(t==null?void 0:t.status)==="active"&&m===a),(t==null?void 0:t.status)==="active"&&m===a)return console.log("âœ… Premium access granted via localStorage!"),j(!0),!0}catch(t){console.error("localStorage parse error:",t)}return!1};try{if(!g||!a){console.log("âš ï¸ Missing providerId or moduleId, checking fallback..."),l(),j(!1),A(!1);return}console.log("ðŸ“¡ Calling API:",`/api/subscription/status/${g}?moduleId=${a}`);const u=await P.get(`/api/subscription/status/${g}?moduleId=${a}`),t=(d=u.data)==null?void 0:d.subscription;if(console.log("ðŸ“¡ API Response:",u.data),console.log("ðŸ“¡ Subscription:",t),(t==null?void 0:t.status)==="active"&&(t!=null&&t.isCurrent)){console.log("âœ… Premium access granted via API!");const m=typeof t.moduleId=="object"&&((b=t.moduleId)==null?void 0:b._id)||t.moduleId,w=new Date(t.endDate),T=Math.max(0,Math.ceil((w-new Date)/(1e3*60*60*24)));localStorage.setItem("upgrade",JSON.stringify({isSubscribed:!0,status:"active",plan:t.planId,module:m,access:{canAccess:!0,isExpired:!1,daysLeft:T}})),localStorage.setItem("moduleId",m),console.log("âœ… localStorage synced with API data"),j(!0),A(!1);return}console.log("ðŸ”„ No active subscription from API, checking localStorage..."),l()||(console.log("âŒ No Premium access found"),j(!1))}catch(u){console.error("âŒ Subscription API error:",u.message),l()||j(!1)}finally{A(!1)}})()},[g,x]),i.useEffect(()=>{g&&N()},[g]);const N=async()=>{try{S(!0);const o=await P.get(`/api/portfolio/provider/${g}`);ce(o.data.data||[])}catch{c("Failed to load portfolio","error")}finally{S(!1)}},c=(o,s="success")=>Y({open:!0,message:o,severity:s}),ue=o=>{o.key==="Enter"&&E.trim()&&(o.preventDefault(),H(s=>[...s,E.trim()]),J(""))},ge=o=>{const s=Array.from(o.target.files);V(a=>a.concat(s.map(l=>({file:l,preview:URL.createObjectURL(l)}))))},me=o=>{URL.revokeObjectURL(k[o].preview),V(s=>s.filter((a,l)=>l!==o))},fe=o=>{const s=Array.from(o.target.files);q(a=>a.concat(s.map(l=>({file:l,preview:URL.createObjectURL(l)}))))},pe=()=>{O.trim()&&(G(o=>[...o,O.trim()]),K(""))},Q=async o=>{var a,l;if(!f)return c("Upgrade to Premium to add portfolio","warning");if(!y.trim())return c("Title is required","warning");if(!o&&k.length===0)return c("Add at least one image","warning");if(o&&z.length===0&&F.length===0)return c("Add video file or link","warning");if(!x)return c("Module missing. Re-login.","error");const s=new FormData;s.append("providerId",g),s.append("module",x),s.append("workTitle",y),s.append("description",M),s.append("tags",JSON.stringify(de)),o?(z.forEach(d=>s.append("videos",d.file)),F.length>0&&s.append("videoLinks",JSON.stringify(F))):k.forEach(d=>s.append("images",d.file));try{S(!0),await P.post("/api/portfolio",s),c("Portfolio added"),he(),N()}catch(d){c(((l=(a=d.response)==null?void 0:a.data)==null?void 0:l.message)||"Upload failed","error")}finally{S(!1)}},he=()=>{R(""),U(""),H([]),V([]),q([]),G([])},xe=async o=>{if(window.confirm("Delete portfolio?"))try{await P.delete(`/api/portfolio/${o}`),N(),c("Deleted")}catch{c("Delete failed","error")}};return ie?e.jsx(v,{sx:{minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(X,{sx:{color:n}})}):e.jsxs(v,{sx:{p:3},children:[ne&&e.jsx(v,{sx:{position:"fixed",inset:0,bgcolor:"rgba(0,0,0,.4)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(X,{sx:{color:n}})}),!f&&e.jsx(Z,{severity:"warning",sx:{mb:2},children:"You are on a FREE plan. Upgrade to add portfolio."}),e.jsx(Ie,{open:C.open,autoHideDuration:4e3,onClose:()=>Y({...C,open:!1}),children:e.jsx(Z,{severity:C.severity,children:C.message})}),e.jsxs(Se,{children:[e.jsxs(Ce,{value:D,onChange:(o,s)=>re(s),TabIndicatorProps:{style:{backgroundColor:n}},children:[e.jsx(se,{label:"Images"}),e.jsx(se,{label:"Videos"})]}),D===0&&e.jsxs(ee,{children:[e.jsx(W,{variant:"h6",sx:{color:n},children:"Add Portfolio Images"}),e.jsx(h,{fullWidth:!0,label:"Title",value:y,onChange:o=>R(o.target.value),sx:{mb:2}}),e.jsx(h,{fullWidth:!0,multiline:!0,rows:3,label:"Description",value:M,onChange:o=>U(o.target.value),sx:{mb:2}}),e.jsx(h,{fullWidth:!0,label:"Add Tag (Enter)",value:E,onKeyDown:ue,onChange:o=>J(o.target.value),sx:{mb:2}}),e.jsxs(I,{component:"label",variant:"contained",sx:{bgcolor:n},disabled:!f,children:[e.jsx(we,{sx:{mr:1}})," Upload Images",e.jsx("input",{hidden:!0,multiple:!0,type:"file",accept:"image/*",onChange:ge})]}),e.jsx(oe,{container:!0,spacing:2,sx:{mt:2},children:k.map((o,s)=>e.jsx(oe,{item:!0,xs:6,md:3,children:e.jsxs(v,{sx:{position:"relative"},children:[e.jsx("img",{src:o.preview,alt:"",style:{width:"100%",height:120,objectFit:"cover"}}),e.jsx(te,{onClick:()=>me(s),sx:{position:"absolute",top:4,right:4,bgcolor:n,color:"#fff"},children:e.jsx(Te,{})})]})},s))}),e.jsx(I,{fullWidth:!0,sx:{mt:3,bgcolor:n},variant:"contained",disabled:!f,onClick:()=>Q(!1),children:"Add Portfolio"})]}),D===1&&e.jsxs(ee,{children:[e.jsx(W,{variant:"h6",sx:{color:n},children:"Add Portfolio Videos"}),e.jsx(h,{fullWidth:!0,label:"Title",value:y,onChange:o=>R(o.target.value),sx:{mb:2}}),e.jsx(h,{fullWidth:!0,multiline:!0,rows:3,label:"Description",value:M,onChange:o=>U(o.target.value),sx:{mb:2}}),e.jsxs(I,{component:"label",variant:"contained",sx:{bgcolor:n,mb:2},disabled:!f,children:[e.jsx(ae,{sx:{mr:1}})," Upload Videos",e.jsx("input",{hidden:!0,multiple:!0,type:"file",accept:"video/*",onChange:fe})]}),e.jsxs(v,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(h,{fullWidth:!0,label:"Video Link",value:O,onChange:o=>K(o.target.value)}),e.jsx(I,{variant:"contained",sx:{bgcolor:n},onClick:pe,disabled:!f,children:e.jsx(Me,{})})]}),e.jsx(I,{fullWidth:!0,sx:{bgcolor:n},variant:"contained",disabled:!f,onClick:()=>Q(!0),children:"Add Video"})]})]}),e.jsx(W,{sx:{mt:4,mb:1,color:n},variant:"h6",children:"Portfolio List"}),e.jsx(Pe,{component:ye,children:e.jsxs(Le,{children:[e.jsx(Ae,{sx:{bgcolor:"#fdeaea"},children:e.jsxs($,{children:[e.jsx(r,{children:"SI"}),e.jsx(r,{children:"Title"}),e.jsx(r,{children:"Preview"}),e.jsx(r,{children:"Count"}),e.jsx(r,{children:"Tags"}),e.jsx(r,{children:"Actions"})]})}),e.jsx(De,{children:B.length===0?e.jsx($,{children:e.jsx(r,{colSpan:6,align:"center",children:"No portfolio found"})}):B.map((o,s)=>{var b,u,t,m,w,_,T;const a=((u=(b=o.media)==null?void 0:b.find(p=>p.type==="image"))==null?void 0:u.images)||[],l=((m=(t=o.media)==null?void 0:t.find(p=>p.type==="video"))==null?void 0:m.videos)||[],d=((_=(w=o.media)==null?void 0:w.find(p=>p.type==="videoLink"))==null?void 0:_.videoLinks)||[];return e.jsxs($,{children:[e.jsx(r,{children:s+1}),e.jsx(r,{children:o.workTitle}),e.jsx(r,{children:a[0]?e.jsx("img",{src:`${le}/${a[0]}`,style:{width:60,height:50,objectFit:"cover"}}):e.jsx(ae,{color:"action"})}),e.jsx(r,{children:a.length+l.length+d.length}),e.jsx(r,{children:(T=o.tags)==null?void 0:T.map((p,je)=>e.jsx(ke,{size:"small",label:p,sx:{mr:.5}},je))}),e.jsx(r,{children:e.jsx(te,{color:"error",onClick:()=>xe(o._id),children:e.jsx(Re,{})})})]},o._id)})})]})})]})}export{$e as default};
