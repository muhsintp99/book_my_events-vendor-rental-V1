import{a8 as We,w as _e,r as s,h as b,j as e,B as c,t as ue,b as C,aa as Oe,T as x,x as pe,al as Q,s as u,S as V,F as ge,I as he,ab as xe,W as X,a4 as Fe,b2 as $e,f as k,C as Le,g as me,ac as Y,ae as ze}from"./index-BZxhnl_K.js";import{A as Ne}from"./Add-DHuLJ2LG.js";import{C as fe}from"./Close-CAqPM3AS.js";import{C as Re}from"./CloudUpload-35hDwS8I.js";const h="#E91E63",m="https://api.bookmyevent.ae",je="68e5fbc33a5a05dde7500c89",Ue=({section:p,onChange:v,onDelete:g})=>e.jsxs(c,{sx:{position:"relative",border:"1px solid #e5e5e5",borderRadius:2,p:3,mb:3,bgcolor:"white"},children:[e.jsx(C,{onClick:g,sx:{position:"absolute",top:12,right:12,color:h},children:e.jsx(ze,{fontSize:"small"})}),e.jsx(u,{fullWidth:!0,label:e.jsxs("span",{children:["Section Title ",e.jsx("span",{style:{color:"red"},children:"*"})]}),value:p.title||"",onChange:f=>v("title",f.target.value),sx:{mb:2}}),e.jsx(u,{fullWidth:!0,label:e.jsxs("span",{children:["Items (comma separated) ",e.jsx("span",{style:{color:"red"},children:"*"})]}),placeholder:"e.g. Bridal Bun, Curls, Waves",value:p.itemsText,onChange:f=>v("itemsText",f.target.value),multiline:!0,rows:2,helperText:"Separate items with commas"})]}),Ke=()=>{const{id:p}=We(),v=_e(),g=!!p,[f,Z]=s.useState(!0),[ee,te]=s.useState(!1),[ae,y]=s.useState(""),[se,d]=s.useState(""),[ie,be]=s.useState([]),[ve,ye]=s.useState(!0),[Se,le]=s.useState([]),[ke,Ce]=s.useState(!0),[o,ne]=s.useState(null),[P,I]=s.useState(""),[T,w]=s.useState([]),[A,E]=s.useState(""),[B,D]=s.useState(""),[oe,M]=s.useState(""),[W,_]=s.useState(""),[re,O]=s.useState(""),[ce,F]=s.useState(""),[$,L]=s.useState(!1),[z,N]=s.useState(!1),[R,U]=s.useState(!0),[de,j]=s.useState([{id:Date.now(),title:"",itemsText:""}]),[G,q]=s.useState({hairStyling:!1,sareeDraping:!1,eyelashExtension:!1,nailPolish:!1}),[S,H]=s.useState([]),[J,K]=s.useState([]),Pe=()=>{I(""),w([]),E(""),D(""),M(""),_(""),O(""),F(""),L(!1),N(!1),U(!0),j([{id:Date.now(),title:"",itemsText:""}]),q({hairStyling:!1,sareeDraping:!1,eyelashExtension:!1,nailPolish:!1}),H([]),K([]),d("")};s.useEffect(()=>{try{const t=localStorage.getItem("vendor")||localStorage.getItem("user")||localStorage.getItem("vendorData");if(t)ne(JSON.parse(t));else{const a=localStorage.getItem("vendorId")||localStorage.getItem("userId");a&&ne({_id:a})}}catch(t){console.error("Vendor load error:",t)}},[]),s.useEffect(()=>{b.get(`${m}/api/categories/modules/${je}`).then(t=>be(t.data.data||[])).catch(()=>d("Failed to load categories")).finally(()=>ye(!1))},[]),s.useEffect(()=>{b.get(`${m}/api/makeup-types`).then(t=>le(t.data.data||[])).catch(()=>le([])).finally(()=>Ce(!1))},[]),s.useEffect(()=>{if(!g){Z(!1);return}(async()=>{var a,l;try{const{data:r}=await b.get(`${m}/api/makeup-packages/${p}`),i=r.data;I(i.packageTitle),w(i.categories.map(n=>n._id)),E(i.makeupType),D(i.basePrice),M(i.offerPrice),_(i.description),O(i.cancellationPolicy),F(i.advanceBookingAmount),L(i.trialMakeupIncluded),N(i.travelToVenue),U(i.isActive),((a=i.includedServices)==null?void 0:a.length)>0&&j(i.includedServices.map(n=>({id:n._id,title:n.title,itemsText:n.items.join(", ")}))),((l=i.gallery)==null?void 0:l.length)>0&&K(i.gallery.map(n=>`${m}${n}`)),i.basicAddOns&&q({hairStyling:i.basicAddOns.hairStyling||!1,sareeDraping:i.basicAddOns.sareeDraping||!1,eyelashExtension:i.basicAddOns.eyelashExtension||!1,nailPolish:i.basicAddOns.nailPolish||!1})}catch{d("Failed to load package")}finally{Z(!1)}})()},[g,p]);const Ie=()=>{j(t=>[...t,{id:Date.now(),title:"",itemsText:""}])},Te=(t,a,l)=>{j(r=>r.map(i=>i.id===t?{...i,[a]:l}:i))},we=t=>{j(a=>a.filter(l=>l.id!==t))},Ae=t=>{const a=Array.from(t.target.files);if(S.length+J.length+a.length>5){alert("Maximum 5 images allowed");return}H(r=>[...r,...a])},Ee=t=>H(a=>a.filter((l,r)=>r!==t)),Be=t=>K(a=>a.filter((l,r)=>r!==t)),De=async()=>{var r,i;const t=(o==null?void 0:o._id)||(o==null?void 0:o.id);if(!t)return d("Vendor not authenticated");if(!P.trim())return d("Package title required");if(!T.length)return d("Select categories");if(!A)return d("Select makeup type");if(!B)return d("Base price required");if(!W.trim())return d("Description required");const a=new FormData;a.append("module",je),a.append("packageTitle",P),a.append("description",W),a.append("makeupType",A),a.append("basePrice",B),a.append("offerPrice",oe||"0"),a.append("advanceBookingAmount",ce),a.append("cancellationPolicy",re),a.append("isActive",R),a.append("providerId",t),a.append("trialMakeupIncluded",$),a.append("travelToVenue",z),T.forEach(n=>a.append("categories",n)),a.append("basicAddOns",JSON.stringify(G));const l=de.map(n=>({title:n.title,items:n.itemsText.split(",").map(Me=>Me.trim()).filter(Boolean)})).filter(n=>n.title&&n.items.length>0);a.append("includedServices",JSON.stringify(l)),S.forEach(n=>a.append("gallery",n));try{te(!0),d(""),y(""),g?(await b.put(`${m}/api/makeup-packages/${p}`,a),y("Package updated successfully!")):(await b.post(`${m}/api/makeup-packages`,a),y("Package created successfully!"),setTimeout(()=>{Pe(),y("")},2e3))}catch(n){d(((i=(r=n.response)==null?void 0:r.data)==null?void 0:i.message)||"Error saving package")}finally{te(!1),window.scrollTo({top:0,behavior:"smooth"})}};return f||ve||ke?e.jsx(c,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:e.jsx(ue,{size:60})}):e.jsxs(c,{sx:{bgcolor:"#f9f9fc",minHeight:"100vh"},children:[e.jsxs(c,{sx:{bgcolor:"white",borderBottom:"1px solid #eee",p:2,px:4,position:"sticky",top:0,zIndex:10},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(C,{onClick:()=>v(-1),children:e.jsx(Oe,{})}),e.jsxs(x,{variant:"h5",fontWeight:"bold",children:[g?"Edit":"Add"," Makeup Package"]})]}),o&&e.jsxs(x,{variant:"body2",color:"text.secondary",sx:{ml:7},children:["Creating as: ",(o==null?void 0:o.firstName)||(o==null?void 0:o.email)||(o==null?void 0:o._id)]})]}),e.jsxs(c,{sx:{p:{xs:2,md:4}},children:[ae&&e.jsx(pe,{severity:"success",sx:{mb:3},children:ae}),se&&e.jsx(pe,{severity:"error",sx:{mb:3},children:se}),e.jsxs(Q,{elevation:3,sx:{borderRadius:3,p:{xs:3,md:6}},children:[e.jsx(u,{fullWidth:!0,label:"Package Title *",value:P,onChange:t=>I(t.target.value),sx:{mb:3}}),e.jsxs(V,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsxs(ge,{fullWidth:!0,children:[e.jsx(he,{children:"Category *"}),e.jsx(xe,{multiple:!0,value:T,onChange:t=>w(t.target.value),renderValue:t=>e.jsx(c,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(a=>{const l=ie.find(r=>r._id===a);return e.jsx(Fe,{label:l==null?void 0:l.title,size:"small"},a)})}),children:ie.map(t=>e.jsx(X,{value:t._id,children:t.title},t._id))})]}),e.jsxs(ge,{fullWidth:!0,children:[e.jsx(he,{children:"Makeup Type *"}),e.jsxs(xe,{value:A,onChange:t=>E(t.target.value),children:[e.jsx(X,{value:"",disabled:!0,children:"Select Type"}),Se.map(t=>e.jsx(X,{value:t._id,children:t.name},t._id))]})]})]}),e.jsxs(V,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsx(u,{fullWidth:!0,label:"Base Price *",type:"number",value:B,onChange:t=>D(t.target.value)}),e.jsx(u,{fullWidth:!0,label:"Offer Price",type:"number",value:oe,onChange:t=>M(t.target.value),helperText:"Leave empty if no discount"}),e.jsx(u,{fullWidth:!0,label:"Advance Booking Amount",value:ce,onChange:t=>F(t.target.value)})]}),e.jsx(u,{fullWidth:!0,label:"Description *",multiline:!0,rows:4,value:W,onChange:t=>_(t.target.value),sx:{mb:4}}),e.jsx(x,{variant:"h6",sx:{mb:2,color:h},children:"Basic Add-ons"}),e.jsx(Q,{variant:"outlined",sx:{p:3,mb:4,bgcolor:"#fafafa"},children:e.jsx($e,{row:!0,children:Object.keys(G).map(t=>e.jsx(k,{control:e.jsx(Le,{checked:G[t],onChange:a=>q(l=>({...l,[t]:a.target.checked}))}),label:{hairStyling:"Hair Styling",sareeDraping:"Saree Draping",eyelashExtension:"Eyelash Extension",nailPolish:"Nail Polish"}[t]},t))})}),e.jsxs(c,{sx:{mb:4},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(x,{variant:"h6",sx:{color:h},children:"Custom Service Sections"}),e.jsx(me,{variant:"contained",startIcon:e.jsx(Ne,{}),sx:{bgcolor:h},onClick:Ie,children:"Add Section"})]}),de.map(t=>e.jsx(Ue,{section:t,onChange:(a,l)=>Te(t.id,a,l),onDelete:()=>we(t.id)},t.id))]}),e.jsx(u,{fullWidth:!0,label:"Cancellation Policy",multiline:!0,rows:3,value:re,onChange:t=>O(t.target.value),sx:{mb:4}}),e.jsxs(V,{direction:"row",spacing:4,sx:{mb:4},children:[e.jsx(k,{control:e.jsx(Y,{checked:$,onChange:()=>L(!$)}),label:"Trial Makeup Included"}),e.jsx(k,{control:e.jsx(Y,{checked:z,onChange:()=>N(!z)}),label:"Travel to Venue"}),e.jsx(k,{control:e.jsx(Y,{checked:R,onChange:()=>U(!R)}),label:"Package Active"})]}),e.jsx(x,{variant:"h6",sx:{color:h,mb:2},children:"Gallery (Max 5)"}),e.jsxs(Q,{onClick:()=>document.getElementById("gallery-input").click(),sx:{border:"2px dashed #ddd",borderRadius:2,p:4,textAlign:"center",cursor:"pointer",mb:4},children:[e.jsx("input",{id:"gallery-input",type:"file",hidden:!0,multiple:!0,accept:"image/*",onChange:Ae}),S.length>0||J.length>0?e.jsxs(c,{sx:{display:"flex",flexWrap:"wrap",gap:2},children:[J.map((t,a)=>e.jsxs(c,{sx:{position:"relative"},children:[e.jsx("img",{src:t,alt:"",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(C,{onClick:l=>{l.stopPropagation(),Be(a)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(fe,{fontSize:"small"})})]},`ex-${a}`)),S.map((t,a)=>e.jsxs(c,{sx:{position:"relative"},children:[e.jsx("img",{src:URL.createObjectURL(t),alt:"",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(C,{onClick:l=>{l.stopPropagation(),Ee(a)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(fe,{fontSize:"small"})})]},`new-${a}`))]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{sx:{fontSize:60,color:"#ccc"}}),e.jsx(x,{sx:{mt:2,color:h,fontWeight:"bold"},children:"Click to Upload Images"})]})]}),e.jsx(me,{fullWidth:!0,variant:"contained",size:"large",onClick:De,disabled:ee||!o,sx:{py:2,bgcolor:h,"&:hover":{bgcolor:"#c2185b"}},children:ee?e.jsx(ue,{size:28,color:"inherit"}):g?"Update Package":"Create Package"})]})]})]})};export{Ke as default};
