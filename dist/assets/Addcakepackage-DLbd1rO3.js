import{w as et,r as s,j as e,B as d,t as Ne,b as P,aj as tt,T as f,x as Be,ad as ee,s as u,S as y,F as _,I as F,af as U,_ as j,C as at,a6 as st,a8 as rt,O as it,g as De,f as nt,ak as ot,h as S,ar as lt}from"./index-a-VQ6SDG.js";import{A as ct}from"./Add-DdEDVWH_.js";import{C as te}from"./Close-DLT9c981.js";import{C as We}from"./CloudUpload--Blx2Ce_.js";const h="#E91E63",k="https://api.bookmyevent.ae",_e="68e5fc09651cc12c1fc0f9c9",dt=({variation:T,onChange:$,onDelete:C})=>e.jsxs(y,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"center",sx:{mb:2},children:[e.jsx(u,{label:"Variation Name (e.g. Half Kg)",value:T.name||"",onChange:p=>$("name",p.target.value),sx:{flex:1}}),e.jsx(u,{label:"Price (₹)",type:"number",value:T.price||"",onChange:p=>$("price",p.target.value),sx:{width:150}}),e.jsx(P,{onClick:C,color:"error",children:e.jsx(lt,{})})]}),mt=()=>{const T=et(),C=new URLSearchParams(window.location.search).get("id"),p=!!C,[Fe,ae]=s.useState(!0),[se,re]=s.useState(!1),[ie,L]=s.useState(""),[ne,m]=s.useState(""),[Ue,$e]=s.useState([]),[oe,E]=s.useState([]),[Le,ze]=s.useState(!0),[g,Oe]=s.useState(null),[z,le]=s.useState(""),[ce,de]=s.useState(""),[N,O]=s.useState(""),[B,R]=s.useState([]),[ue,ge]=s.useState("Eggless"),[M,he]=s.useState(""),[V,pe]=s.useState(""),[G,me]=s.useState(""),[J,xe]=s.useState(""),[fe,be]=s.useState("Amount"),[Q,je]=s.useState(""),[q,ye]=s.useState(""),[H,Ce]=s.useState(""),[K,ve]=s.useState(!0),[Se,D]=s.useState([{id:Date.now(),name:"",price:""}]),[b,ke]=s.useState(null),[X,Re]=s.useState(""),[W,Ie]=s.useState([]),[Y,we]=s.useState([]);s.useEffect(()=>{try{const t=localStorage.getItem("vendor")||localStorage.getItem("user")||localStorage.getItem("vendorData");t&&Oe(JSON.parse(t))}catch(t){console.error("Vendor load error:",t)}},[]),s.useEffect(()=>{(async()=>{var a;try{const r=localStorage.getItem("token"),c=((a=(await S.get(`${k}/api/categories/parents/${_e}`,{headers:{Authorization:`Bearer ${r}`}})).data)==null?void 0:a.data)||[];$e(c),console.log("✅ Parent Categories Loaded:",c)}catch(r){console.error("❌ Failed to load parent categories:",r),m("Failed to load categories")}finally{ze(!1)}})()},[]);const Me=async t=>{var r;const a=t.target.value;if(O(a),R([]),E([]),!!a)try{const o=localStorage.getItem("token"),x=((r=(await S.get(`${k}/api/categories/parents/${a}/subcategories`,{headers:{Authorization:`Bearer ${o}`}})).data)==null?void 0:r.data)||[];E(x),console.log("✅ Subcategories Loaded:",x)}catch(o){console.error("❌ Failed to load subcategories:",o),E([])}};s.useEffect(()=>{if(!p){ae(!1);return}(async()=>{var a,r,o,c,x,I,w,A,i,l,Ae,Pe,Te,Ee;try{const{data:Z}=await S.get(`${k}/api/cakes/${C}`),n=Z.data;if(le(n.name),de(n.shortDescription),(r=(a=n.category)==null?void 0:a.parentCategory)!=null&&r._id){const v=n.category.parentCategory._id;O(v);const Ye=localStorage.getItem("token"),Ze=await S.get(`${k}/api/categories/parents/${v}/subcategories`,{headers:{Authorization:`Bearer ${Ye}`}});E(((o=Ze.data)==null?void 0:o.data)||[]),R([n.category._id])}else(c=n.category)!=null&&c._id&&O(n.category._id);ge(n.itemType),he(((x=n.nutrition)==null?void 0:x.join(", "))||""),pe(((I=n.allergenIngredients)==null?void 0:I.join(", "))||""),me(((w=n.priceInfo)==null?void 0:w.unitPrice)||""),xe(((A=n.priceInfo)==null?void 0:A.advanceBookingAmount)||""),be(((i=n.priceInfo)==null?void 0:i.discountType)||"Amount"),je(((l=n.priceInfo)==null?void 0:l.discount)||""),ye(((Ae=n.priceInfo)==null?void 0:Ae.maxPurchaseQty)||""),Ce(((Pe=n.searchTags)==null?void 0:Pe.join(", "))||""),ve(n.isActive),((Te=n.variations)==null?void 0:Te.length)>0&&D(n.variations.map(v=>({id:v._id||Date.now(),name:v.name,price:v.price}))),n.thumbnail&&Re(n.thumbnail),((Ee=n.images)==null?void 0:Ee.length)>0&&we(n.images)}catch(Z){console.error("Failed to load cake:",Z),m("Failed to load cake details")}finally{ae(!1)}})()},[p,C]);const Ve=()=>{D(t=>[...t,{id:Date.now(),name:"",price:""}])},Ge=(t,a,r)=>{D(o=>o.map(c=>c.id===t?{...c,[a]:r}:c))},Je=t=>{D(a=>a.filter(r=>r.id!==t))},Qe=t=>{const a=t.target.files[0];a&&ke(a)},qe=t=>{const a=Array.from(t.target.files);if(W.length+Y.length+a.length>10){alert("Maximum 10 gallery images allowed");return}Ie(o=>[...o,...a])},He=t=>Ie(a=>a.filter((r,o)=>o!==t)),Ke=t=>we(a=>a.filter((r,o)=>o!==t)),Xe=async()=>{var c,x,I,w,A;const t=(g==null?void 0:g._id)||(g==null?void 0:g.id);if(!t){m("Vendor not authenticated");return}if(!z.trim()){m("Cake name is required");return}if(!N){m("Select a category");return}if(!G){m("Unit price is required");return}if(!b&&!X){m("Thumbnail image is required");return}const a=new FormData;a.append("name",z),a.append("shortDescription",ce),a.append("module",_e),a.append("category",N),a.append("itemType",ue),a.append("isActive",K),a.append("provider",t),B.length>0&&a.append("subCategories",JSON.stringify(B));const r={unitPrice:Number(G),discountType:fe,discount:Q?Number(Q):0,maxPurchaseQty:q?Number(q):void 0};if(J&&(r.advanceBookingAmount=Number(J)),a.append("priceInfo",JSON.stringify(r)),M.trim()){const i=M.split(",").map(l=>l.trim()).filter(Boolean);a.append("nutrition",JSON.stringify(i))}if(V.trim()){const i=V.split(",").map(l=>l.trim()).filter(Boolean);a.append("allergenIngredients",JSON.stringify(i))}if(H.trim()){const i=H.split(",").map(l=>l.trim()).filter(Boolean);a.append("searchTags",JSON.stringify(i))}const o=Se.filter(i=>i.name&&i.price).map(({name:i,price:l})=>({name:i,price:Number(l)}));o.length>0&&a.append("variations",JSON.stringify(o)),b&&a.append("thumbnail",b),W.forEach(i=>{a.append("images",i)});try{re(!0),m(""),L("");let i;if(p?(i=await S.put(`${k}/api/cakes/${C}`,a,{headers:{"Content-Type":"multipart/form-data"}}),L("Cake updated successfully!")):(i=await S.post(`${k}/api/cakes`,a,{headers:{"Content-Type":"multipart/form-data"}}),L("Cake created successfully!")),i.data.success&&i.data.data){const l=i.data.data;console.log("✅ Cake Package Created/Updated:",{id:l._id,name:l.name,cakeId:l.cakeId,category:(c=l.category)==null?void 0:c.title,provider:(x=l.provider)==null?void 0:x.storeName,thumbnail:l.thumbnail,priceInfo:l.priceInfo,variations:l.variations,module:(I=l.module)==null?void 0:I.title})}}catch(i){console.error("Submit error:",i),m(((A=(w=i.response)==null?void 0:w.data)==null?void 0:A.message)||"Error saving cake")}finally{re(!1),window.scrollTo({top:0,behavior:"smooth"})}};return Fe||Le?e.jsx(d,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:e.jsx(Ne,{size:60,sx:{color:h}})}):e.jsxs(d,{sx:{bgcolor:"#f9f9fc",minHeight:"100vh"},children:[e.jsxs(d,{sx:{bgcolor:"white",borderBottom:"1px solid #eee",p:2,px:4,position:"sticky",top:0,zIndex:10},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(P,{onClick:()=>T(-1),children:e.jsx(tt,{})}),e.jsxs(f,{variant:"h5",fontWeight:"bold",children:[p?"Edit":"Add"," Cake Package"]})]}),g&&e.jsxs(f,{variant:"body2",color:"text.secondary",sx:{ml:7},children:["Creating as: ",g.firstName," ",g.lastName]})]}),e.jsxs(d,{sx:{p:{xs:2,md:4}},children:[ie&&e.jsx(Be,{severity:"success",sx:{mb:3},children:ie}),ne&&e.jsx(Be,{severity:"error",sx:{mb:3},children:ne}),e.jsxs(ee,{elevation:3,sx:{borderRadius:3,p:{xs:3,md:6}},children:[e.jsx(u,{fullWidth:!0,label:"Cake Name *",value:z,onChange:t=>le(t.target.value),sx:{mb:3}}),e.jsx(u,{fullWidth:!0,label:"Short Description *",multiline:!0,rows:2,value:ce,onChange:t=>de(t.target.value),sx:{mb:3}}),e.jsxs(y,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsxs(_,{fullWidth:!0,children:[e.jsx(F,{children:"Parent Category *"}),e.jsxs(U,{value:N,onChange:Me,children:[e.jsx(j,{value:"",children:"Select Parent Category"}),Ue.map(t=>e.jsx(j,{value:t._id,children:t.title},t._id))]})]}),e.jsxs(_,{fullWidth:!0,disabled:!N,children:[e.jsx(F,{children:"Sub Categories"}),e.jsx(U,{multiple:!0,value:B,onChange:t=>R(t.target.value),input:e.jsx(it,{}),renderValue:t=>e.jsx(d,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(a=>{const r=oe.find(o=>o._id===a);return e.jsx(rt,{label:(r==null?void 0:r.title)||a,size:"small"},a)})}),children:oe.map(t=>e.jsxs(j,{value:t._id,children:[e.jsx(at,{checked:B.includes(t._id)}),e.jsx(st,{primary:t.title})]},t._id))})]})]}),e.jsx(y,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3,alignItems:"center"},children:e.jsxs(_,{fullWidth:!0,children:[e.jsx(F,{children:"Item Type"}),e.jsxs(U,{value:ue,onChange:t=>ge(t.target.value),children:[e.jsx(j,{value:"Eggless",children:"Eggless"}),e.jsx(j,{value:"Egg",children:"Egg"})]})]})}),e.jsxs(y,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsx(u,{fullWidth:!0,label:"Nutrition (comma separated)",placeholder:"e.g. Sugar, Milk, Flour",value:M,onChange:t=>he(t.target.value)}),e.jsx(u,{fullWidth:!0,label:"Allergen Ingredients (comma separated)",placeholder:"e.g. Nuts, Gluten",value:V,onChange:t=>pe(t.target.value)})]}),e.jsx(f,{variant:"h6",sx:{mb:2,color:h},children:"Pricing"}),e.jsxs(y,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:2},children:[e.jsx(u,{fullWidth:!0,label:"Base Unit Price (₹) *",type:"number",value:G,onChange:t=>me(t.target.value)}),e.jsx(u,{fullWidth:!0,label:"Advance Booking Amount (₹)",type:"number",value:J,onChange:t=>xe(t.target.value),helperText:"Amount to be paid upfront"})]}),e.jsxs(y,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsxs(_,{sx:{minWidth:150},children:[e.jsx(F,{children:"Discount Type"}),e.jsxs(U,{value:fe,onChange:t=>be(t.target.value),children:[e.jsx(j,{value:"Amount",children:"Amount"}),e.jsx(j,{value:"Percentage",children:"Percentage"})]})]}),e.jsx(u,{label:"Discount Value",type:"number",value:Q,onChange:t=>je(t.target.value),fullWidth:!0}),e.jsx(u,{label:"Max Purchase Qty",type:"number",value:q,onChange:t=>ye(t.target.value),fullWidth:!0})]}),e.jsxs(d,{sx:{mb:4},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(f,{variant:"h6",sx:{color:h},children:"Variations (Size/Weight)"}),e.jsx(De,{variant:"contained",startIcon:e.jsx(ct,{}),sx:{bgcolor:h,"&:hover":{bgcolor:"#c2185b"}},onClick:Ve,children:"Add Variation"})]}),Se.map(t=>e.jsx(dt,{variation:t,onChange:(a,r)=>Ge(t.id,a,r),onDelete:()=>Je(t.id)},t.id))]}),e.jsx(u,{fullWidth:!0,label:"Search Tags (comma separated)",placeholder:"e.g. chocolate, birthday, wedding",value:H,onChange:t=>Ce(t.target.value),sx:{mb:4}}),e.jsx(y,{direction:"row",spacing:4,sx:{mb:4},children:e.jsx(nt,{control:e.jsx(ot,{checked:K,onChange:()=>ve(!K),sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:h}}}),label:"Active"})}),e.jsx(f,{variant:"h6",sx:{color:h,mb:2},children:"Thumbnail Image *"}),e.jsxs(ee,{onClick:()=>document.getElementById("thumbnail-input").click(),sx:{border:"2px dashed #ddd",borderRadius:2,p:4,textAlign:"center",cursor:"pointer",mb:4},children:[e.jsx("input",{id:"thumbnail-input",type:"file",hidden:!0,accept:"image/*",onChange:Qe}),b||X?e.jsxs(d,{sx:{position:"relative",display:"inline-block"},children:[e.jsx("img",{src:b?URL.createObjectURL(b):X,alt:"Thumbnail",style:{width:200,height:200,objectFit:"cover",borderRadius:8}}),b&&e.jsx(P,{onClick:t=>{t.stopPropagation(),ke(null)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(te,{})})]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{sx:{fontSize:60,color:"#ccc"}}),e.jsx(f,{sx:{mt:2,color:h,fontWeight:"bold"},children:"Click to Upload Thumbnail"})]})]}),e.jsx(f,{variant:"h6",sx:{color:h,mb:2},children:"Gallery Images (Max 10)"}),e.jsxs(ee,{onClick:()=>document.getElementById("gallery-input").click(),sx:{border:"2px dashed #ddd",borderRadius:2,p:4,textAlign:"center",cursor:"pointer",mb:4},children:[e.jsx("input",{id:"gallery-input",type:"file",hidden:!0,multiple:!0,accept:"image/*",onChange:qe}),W.length>0||Y.length>0?e.jsxs(d,{sx:{display:"flex",flexWrap:"wrap",gap:2,justifyContent:"center"},children:[Y.map((t,a)=>e.jsxs(d,{sx:{position:"relative"},children:[e.jsx("img",{src:t,alt:"",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(P,{onClick:r=>{r.stopPropagation(),Ke(a)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(te,{fontSize:"small"})})]},`ex-${a}`)),W.map((t,a)=>e.jsxs(d,{sx:{position:"relative"},children:[e.jsx("img",{src:URL.createObjectURL(t),alt:"",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(P,{onClick:r=>{r.stopPropagation(),He(a)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(te,{fontSize:"small"})})]},`new-${a}`))]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{sx:{fontSize:60,color:"#ccc"}}),e.jsx(f,{sx:{mt:2,color:h,fontWeight:"bold"},children:"Click to Upload Gallery Images"})]})]}),e.jsx(De,{fullWidth:!0,variant:"contained",size:"large",onClick:Xe,disabled:se||!g,sx:{py:2,bgcolor:h,"&:hover":{bgcolor:"#c2185b"}},children:se?e.jsx(Ne,{size:28,color:"inherit"}):p?"Update Cake Package":"Create Cake Package"})]})]})]})};export{mt as default};
