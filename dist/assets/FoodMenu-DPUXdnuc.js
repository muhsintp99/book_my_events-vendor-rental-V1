import{u as Te,w as Be,al as $e,r as l,j as e,B as s,b as D,am as se,T as a,S as Fe,g,ap as re,a9 as Re,aa as Ae,ab as Me,ad as _e,ar as ae,x as ne,s as C,H as ue,a as We}from"./index-4okDMdnD.js";import{E as ze}from"./Edit-vjpSXB_n.js";import{D as He}from"./DialogContentText-DtGsA5Mc.js";import{A as le}from"./Add-DR2uXg4F.js";import{C as oe}from"./Close-N5aJrrGi.js";import{C as ce}from"./CloudUpload-BJtXqsDu.js";const de=ue(s)(({theme:o})=>({border:"2px dashed #e0e0e0",borderRadius:o.shape.borderRadius,padding:o.spacing(3),textAlign:"center",backgroundColor:o.palette.grey[50],cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"150px","&:hover":{borderColor:"#E15B65"},'& input[type="file"]':{display:"none"}})),Oe=ue(s)({position:"relative",display:"inline-block"}),Ke=()=>{var te,ie;const o=Te(),O=Be(),G=$e(),w=(te=G.state)==null?void 0:te.selectingForVenue,P=((ie=G.state)==null?void 0:ie.preSelected)||[],[U,j]=l.useState("list"),[n,I]=l.useState(null),[he,pe]=l.useState([]),[k,L]=l.useState([]),[x,T]=l.useState({packageTitle:"",subtitle:"",description:"",startingPrice:""}),[N,J]=l.useState([]),[V,v]=l.useState([{id:Date.now(),heading:"",includes:""}]),[B,S]=l.useState(null),[$,E]=l.useState([]),[q,M]=l.useState(null),[_,W]=l.useState([]),[K,m]=l.useState(!1),[Q,f]=l.useState(""),[X,y]=l.useState("success"),[ge,F]=l.useState(!1),p="https://api.bookmyevent.ae";l.useEffect(()=>{z()},[]),l.useEffect(()=>{P&&P.length>0&&(console.log("Pre-selected packages:",P),L(P))},[]);const z=async()=>{const t=Z();if(!t)return;const i=localStorage.getItem("token");if(i)try{const c=await(await fetch(`${p}/api/packages/provider/${t}`,{headers:{Authorization:`Bearer ${i}`}})).json();pe(c.packages||[])}catch(r){console.error("Error:",r)}},xe=t=>{console.log("Toggling package:",t),L(i=>i.some(r=>r._id===t._id)?i.filter(r=>r._id!==t._id):[...i,t])},me=()=>{console.log("Saving selection:",k),O("/venue-setup/new",{state:{selectedPackages:k},replace:!0})},R=t=>{const{name:i,value:r}=t.target;T(c=>({...c,[i]:r}))},Y=(t,i,r)=>{v(c=>c.map(b=>b.id===t?{...b,[i]:r}:b))},be=()=>{v(t=>[...t,{id:Date.now(),heading:"",includes:""}])},je=t=>{v(i=>i.filter(r=>r.id!==t))},fe=t=>{const i=t.target.files[0];i&&S(i)},ye=t=>{const i=Array.from(t.target.files);E(r=>[...r,...i])},ve=t=>{E(i=>i.filter((r,c)=>c!==t))},Ce=()=>{S(null)},A=(t,i)=>{i!=="clickaway"&&m(!1)},we=t=>{var i;T({packageTitle:t.title||"",subtitle:t.subtitle||"",description:t.description||"",startingPrice:((i=t.price)==null?void 0:i.toString())||""}),J(t.categories||[]),v((t.includes||[]).map((r,c)=>{var b;return{id:Date.now()+c,heading:r.title||"",includes:((b=r.items)==null?void 0:b.join(", "))||""}})),M(t.thumbnail?`${p}/${t.thumbnail}`:null),W((t.images||[]).map(r=>`${p}/${r}`)),S(null),E([])},Z=()=>{try{const t=localStorage.getItem("user");if(!t)return null;const i=JSON.parse(t);return(i==null?void 0:i._id)||null}catch{return null}},ke=()=>{n&&we(n),j("form")},Se=()=>{F(!0)},Ee=async()=>{if(!(n!=null&&n._id))return;const t=localStorage.getItem("token");if(!t){f("No authentication token found. Please log in."),y("error"),m(!0),F(!1);return}try{const i=await fetch(`${p}/api/packages/${n._id}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}}),r=await i.json();if(i.ok)f("Package deleted successfully!"),y("success"),m(!0),z(),j("list"),I(null),T({packageTitle:"",subtitle:"",description:"",startingPrice:""}),v([{id:Date.now(),heading:"",includes:""}]),S(null),E([]),M(null),W([]);else throw new Error(r.message||"Failed to delete package")}catch(i){console.error("Error deleting package:",i),f(`Error deleting package: ${i.message}`),y("error"),m(!0)}finally{F(!1)}},ee=()=>{F(!1)},De=async t=>{t.preventDefault();const i=localStorage.getItem("token");if(!i){f("No authentication token found. Please log in."),y("error"),m(!0);return}const r=Z();if(!r){f("Provider ID is missing. Please log in again."),y("error"),m(!0);return}const c=V.filter(d=>d.includes.trim()).map(d=>({title:d.heading.trim()||"Menu Item",items:d.includes.split(",").map(h=>h.trim()).filter(h=>h)})),b=parseFloat(x.startingPrice)||0,u=new FormData;u.append("providerId",r),u.append("title",x.packageTitle||"Custom Package"),u.append("subtitle",x.subtitle||""),u.append("description",x.description||""),u.append("packageType","custom"),u.append("includes",JSON.stringify(c)),u.append("price",b.toString()),N.length>0&&u.append("categories",JSON.stringify(N)),B&&u.append("thumbnail",B),$.forEach(d=>{u.append("images",d)});const H=!!(n!=null&&n._id),Pe=H?`${p}/api/packages/${n._id}`:`${p}/api/packages`,Ie=H?"PUT":"POST";try{const d=await fetch(Pe,{method:Ie,body:u,headers:{Authorization:`Bearer ${i}`}});let h;try{h=await d.json()}catch{throw new Error("Invalid response from server")}if(d.ok)await z(),I(h.package||h),j("preview"),f(h.message||`Package ${H?"updated":"created"} successfully!`),y("success"),m(!0);else throw new Error(h.error||h.message||"Failed to save package")}catch(d){console.error("Error submitting form:",d),f(`Error saving package: ${d.message}`),y("error"),m(!0)}};return U==="preview"&&n?e.jsxs(s,{sx:{p:3,backgroundColor:o.palette.grey[100],minHeight:"100vh",width:"100%"},children:[e.jsxs(s,{sx:{width:"100%",margin:"auto",backgroundColor:"white",borderRadius:o.shape.borderRadius,boxShadow:o.shadows[1],p:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx(D,{onClick:()=>j("list"),color:"primary",children:e.jsx(se,{})}),e.jsx(a,{variant:"h5",children:"Package Preview"})]}),e.jsxs(s,{sx:{position:"relative",mb:3},children:[e.jsx("img",{src:`${p}/${n.thumbnail||""}`,alt:n.title,style:{width:"100%",height:200,objectFit:"cover",borderRadius:8},onError:t=>{t.target.src="/placeholder.jpg"}}),e.jsxs(s,{sx:{position:"absolute",bottom:0,left:0,right:0,background:"linear-gradient(transparent, rgba(0,0,0,0.7))",color:"white",p:2},children:[e.jsx(a,{variant:"h6",children:n.title}),e.jsx(a,{variant:"body2",children:n.subtitle||"Traditional Style"})]})]}),e.jsx(a,{variant:"body1",sx:{mb:3},children:n.description}),e.jsx(a,{variant:"h6",sx:{mb:2},children:"Includes"}),(n.includes||[]).map((t,i)=>e.jsxs(s,{sx:{mb:2},children:[e.jsx(a,{variant:"subtitle1",sx:{fontWeight:"medium"},children:t.title}),e.jsx(Fe,{component:"ul",spacing:.5,sx:{pl:2},children:t.items.map((r,c)=>e.jsx(a,{variant:"body2",component:"li",children:r},c))})]},i)),e.jsx(a,{variant:"h6",sx:{mb:2},children:"Gallery"}),e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:3},children:(n.images||[]).map((t,i)=>e.jsx("img",{src:`${p}/${t}`,alt:`Gallery ${i+1}`,style:{width:150,height:150,objectFit:"cover",borderRadius:4},onError:r=>{r.target.src="/placeholder.jpg"}},i))}),e.jsxs(s,{sx:{textAlign:"center",mb:3},children:[e.jsx(a,{variant:"h6",children:"Starting Price"}),e.jsxs(a,{variant:"h4",color:"primary",children:["₹",n.price," Per Head"]})]}),e.jsxs(s,{sx:{display:"flex",gap:2,justifyContent:"center"},children:[e.jsx(g,{variant:"outlined",startIcon:e.jsx(ze,{}),onClick:ke,sx:{color:"#E15B65",borderColor:"#E15B65"},children:"Edit Menu"}),e.jsx(g,{variant:"contained",startIcon:e.jsx(re,{}),onClick:Se,sx:{backgroundColor:"#E15B65"},children:"Delete Menu"})]})]}),e.jsxs(Re,{open:ge,onClose:ee,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(Ae,{id:"alert-dialog-title",children:"Confirm Delete"}),e.jsx(Me,{children:e.jsx(He,{id:"alert-dialog-description",children:"Are you sure you want to delete this package? This action cannot be undone."})}),e.jsxs(_e,{children:[e.jsx(g,{onClick:ee,color:"primary",children:"Cancel"}),e.jsx(g,{onClick:Ee,color:"error",autoFocus:!0,children:"Delete"})]})]}),e.jsx(ae,{open:K,autoHideDuration:6e3,onClose:A,anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(ne,{onClose:A,severity:X,children:Q})})]}):U==="list"?e.jsx(s,{sx:{p:3,backgroundColor:o.palette.grey[100],minHeight:"100vh",width:"100%"},children:e.jsxs(s,{sx:{width:"100%",margin:"auto",backgroundColor:"white",borderRadius:o.shape.borderRadius,boxShadow:o.shadows[1],p:3},children:[e.jsx(a,{variant:"h4",sx:{mb:3},children:w?"Select Menu Items":"Food Menu"}),e.jsxs(s,{sx:{display:"flex",flexWrap:"wrap",gap:3},children:[he.map(t=>{const i=k.some(r=>r._id===t._id);return e.jsxs(s,{sx:{width:250,cursor:"pointer",transition:"all 0.2s",border:w&&i?"3px solid #E15B65":"1px solid #e0e0e0",borderRadius:2,p:1,"&:hover":{transform:"scale(1.02)"}},onClick:()=>{w?xe(t):(I(t),j("preview"))},children:[e.jsx(s,{sx:{borderRadius:2,overflow:"hidden",mb:1},children:e.jsx("img",{src:t.thumbnail?`${p}/${t.thumbnail}`:"/placeholder.jpg",alt:t.title,style:{width:"100%",height:200,objectFit:"cover"},onError:r=>{r.target.src="/placeholder.jpg"}})}),e.jsx(a,{variant:"h6",sx:{textAlign:"center"},children:t.title})]},t._id)}),!w&&e.jsxs(g,{variant:"contained",sx:{backgroundColor:"#E15B65",minWidth:200,height:200,borderRadius:2,display:"flex",flexDirection:"column"},onClick:()=>{j("form"),T({packageTitle:"",subtitle:"",description:"",startingPrice:""}),J([]),v([{id:Date.now(),heading:"",includes:""}]),S(null),E([]),M(null),W([]),I(null)},children:[e.jsx(le,{sx:{fontSize:32,mb:.5}}),e.jsx(a,{children:"Add Menu"})]})]}),w&&e.jsxs(s,{sx:{display:"flex",justifyContent:"center",gap:2,mt:3},children:[e.jsx(g,{variant:"outlined",onClick:()=>O(-1),sx:{borderColor:"#E15B65",color:"#E15B65"},children:"Cancel"}),e.jsxs(g,{variant:"contained",onClick:me,disabled:k.length===0,sx:{backgroundColor:"#E15B65"},children:["Done (",k.length," selected)"]})]})]})}):e.jsx(s,{sx:{p:3,backgroundColor:o.palette.grey[100],minHeight:"100vh",width:"100%"},children:e.jsxs(s,{sx:{width:"100%",margin:"auto",backgroundColor:"white",borderRadius:o.shape.borderRadius,boxShadow:o.shadows[1],p:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx(D,{onClick:()=>j("list"),color:"primary",children:e.jsx(se,{})}),e.jsx(a,{variant:"h5",children:n?"Edit Menu":"Add New Menu"})]}),e.jsxs(s,{component:"form",onSubmit:De,children:[e.jsx(C,{fullWidth:!0,label:"Package Title",name:"packageTitle",value:x.packageTitle,onChange:R,sx:{mb:2}}),e.jsx(C,{fullWidth:!0,label:"Subtitle",name:"subtitle",value:x.subtitle,onChange:R,sx:{mb:2}}),e.jsx(C,{fullWidth:!0,label:"Description",name:"description",value:x.description,onChange:R,multiline:!0,rows:3,sx:{mb:3}}),e.jsxs(s,{sx:{mb:3},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsx(a,{variant:"subtitle1",children:"Menu List"}),e.jsx(g,{size:"small",onClick:be,startIcon:e.jsx(le,{}),sx:{backgroundColor:"#E15B65",color:"white"},children:"Add"})]}),V.map(t=>e.jsxs(s,{sx:{border:"1px solid #e0e0e0",borderRadius:1,p:2,mb:2},children:[e.jsx(C,{fullWidth:!0,label:"Heading",value:t.heading,onChange:i=>Y(t.id,"heading",i.target.value),sx:{mb:2}}),e.jsxs(s,{sx:{display:"flex",gap:1},children:[e.jsx(C,{fullWidth:!0,label:"Includes (comma separated)",value:t.includes,onChange:i=>Y(t.id,"includes",i.target.value),multiline:!0,rows:3}),e.jsx(D,{onClick:()=>je(t.id),color:"error",children:e.jsx(re,{})})]})]},t.id))]}),e.jsxs(s,{sx:{display:"flex",gap:3,mb:3},children:[e.jsxs(s,{sx:{flex:1},children:[e.jsx(a,{variant:"subtitle2",gutterBottom:!0,children:"Thumbnail"}),e.jsxs(de,{onClick:()=>document.getElementById("thumbnail-upload").click(),children:[B?e.jsxs(s,{sx:{position:"relative"},children:[e.jsx("img",{src:URL.createObjectURL(B),alt:"Thumbnail",style:{maxWidth:"100%",maxHeight:100,objectFit:"contain"}}),e.jsx(D,{onClick:t=>{t.stopPropagation(),Ce()},size:"small",sx:{position:"absolute",top:0,right:0},children:e.jsx(oe,{})})]}):q?e.jsxs(s,{children:[e.jsx("img",{src:q,alt:"Current Thumbnail",style:{maxWidth:"100%",maxHeight:100,objectFit:"contain"}}),e.jsx(a,{variant:"body2",color:"#E15B65",children:"Click to replace"})]}):e.jsxs(s,{children:[e.jsx(ce,{sx:{fontSize:40,color:"#999",mb:1}}),e.jsx(a,{variant:"body2",color:"#E15B65",children:"Click to upload"})]}),e.jsx("input",{type:"file",id:"thumbnail-upload",hidden:!0,accept:"image/*",onChange:fe})]})]}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(a,{variant:"subtitle2",gutterBottom:!0,children:"Gallery"}),e.jsxs(de,{onClick:()=>document.getElementById("gallery-upload").click(),children:[_.length===0&&$.length===0?e.jsxs(s,{children:[e.jsx(ce,{sx:{fontSize:40,color:"#999",mb:1}}),e.jsx(a,{variant:"body2",color:"#E15B65",children:"Click to upload"})]}):e.jsx(a,{variant:"body2",color:"#E15B65",children:"Click to add more images"}),e.jsx("input",{type:"file",id:"gallery-upload",hidden:!0,accept:"image/*",multiple:!0,onChange:ye})]}),(_.length>0||$.length>0)&&e.jsxs(s,{sx:{mt:2},children:[e.jsx(a,{variant:"subtitle2",children:"Gallery Images"}),e.jsxs(s,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:[_.map((t,i)=>e.jsx(s,{sx:{position:"relative",display:"inline-block"},children:e.jsx("img",{src:t,alt:`Current Gallery ${i+1}`,style:{width:80,height:80,objectFit:"cover",borderRadius:4}})},`existing-${i}`)),$.map((t,i)=>e.jsxs(Oe,{children:[e.jsx("img",{src:URL.createObjectURL(t),alt:`Preview ${i+1}`,style:{width:80,height:80,objectFit:"cover",borderRadius:4}}),e.jsx(D,{size:"small",onClick:()=>ve(i),sx:{position:"absolute",top:0,right:0,backgroundColor:"rgba(0,0,0,0.5)",color:"white"},children:e.jsx(oe,{fontSize:"small"})})]},`new-${i}`))]})]})]})]}),e.jsx(C,{fullWidth:!0,label:"Starting Price (₹)",name:"startingPrice",value:x.startingPrice,onChange:R,type:"number",sx:{mb:3},InputProps:{endAdornment:e.jsx(We,{position:"end",children:"Per Head"})}}),e.jsx(g,{type:"submit",variant:"contained",fullWidth:!0,sx:{backgroundColor:"#E15B65",py:1.5},children:n?"Update Menu":"Create Menu"})]}),e.jsx(ae,{open:K,autoHideDuration:6e3,onClose:A,anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(ne,{onClose:A,severity:X,children:Q})})]})})};export{Ke as default};
