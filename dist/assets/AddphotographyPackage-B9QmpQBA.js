import{p as ye,d as ve,r as o,j as e,B as c,c as ae,s as S,t as Se,T as p,H as ie,k as B,a as x,S as D,F as ke,I as Ce,o as we,M as oe,x as Ae,a1 as Pe,w as M,z as Ie,b as le,h as v}from"./index-De4GTXyc.js";import{A as Ee}from"./Add-nzu5tRBx.js";import{C as re}from"./Close-BqhJje-8.js";import{C as _e}from"./CloudUpload-zl9eIXpj.js";import{D as Te}from"./Delete--UMz92cn.js";import{S as Be}from"./Switch-CTDi0Qy7.js";const d="#E91E63",f="https://api.bookmyevent.ae",ne="68e5fb0fa4b2718b6cbf64e9",De=[{id:"drone_video",label:"Drone Video"},{id:"pre_wedding",label:"Pre-Wedding Shoot"},{id:"candid_photography",label:"Candid Photography"},{id:"traditional_photography",label:"Traditional Photography"},{id:"video_editing",label:"Video Editing"},{id:"photo_album",label:"Photo Album"},{id:"led_wall",label:"LED Wall Display"},{id:"crane_shoot",label:"Crane/Jib Shoot"}],ce=h=>e.jsx(Be,{...h,sx:{"& .MuiSwitch-switchBase":{color:"#fff","&.Mui-checked":{color:d},"&.Mui-checked + .MuiSwitch-track":{backgroundColor:d,opacity:.8}},"& .MuiSwitch-track":{backgroundColor:"#ddd",opacity:.6},"&.Mui-checked .MuiSwitch-thumb":{color:d}}}),Me=({section:h,onChange:b,onDelete:u})=>e.jsxs(c,{sx:{position:"relative",border:"1px solid #e5e5e5",borderRadius:2,p:3,mb:3,bgcolor:"white"},children:[e.jsx(S,{onClick:u,sx:{position:"absolute",top:12,right:12,color:d},children:e.jsx(Te,{fontSize:"small"})}),e.jsx(x,{fullWidth:!0,label:e.jsxs("span",{children:["Section Title ",e.jsx("span",{style:{color:"red"},children:"*"})]}),value:h.title||"",onChange:m=>b("title",m.target.value),sx:{mb:2}}),e.jsx(x,{fullWidth:!0,label:e.jsxs("span",{children:["Items (comma separated) ",e.jsx("span",{style:{color:"red"},children:"*"})]}),placeholder:"e.g. 300 edited photos, Full day coverage",value:Array.isArray(h.items)?h.items.join(", "):"",onChange:m=>b("items",m.target.value),multiline:!0,rows:2,helperText:"Separate items with commas"})]}),Ge=()=>{const{id:h}=ye(),b=ve(),u=!!h,[m,W]=o.useState(!0),[z,F]=o.useState(!1),[N,k]=o.useState(""),[$,g]=o.useState(""),[C,de]=o.useState([]),[he,R]=o.useState(!0),[r,G]=o.useState(null),[w,L]=o.useState(""),[A,O]=o.useState([]),[P,U]=o.useState(""),[I,H]=o.useState(""),[J,q]=o.useState(""),[K,V]=o.useState(""),[Y,Q]=o.useState(!1),[X,Z]=o.useState(!0),[E,ee]=o.useState([]),[_,j]=o.useState([{id:Date.now(),title:"",items:[]}]),[y,te]=o.useState([]),[T,se]=o.useState([]);o.useEffect(()=>{try{const t=localStorage.getItem("vendor")||localStorage.getItem("user")||localStorage.getItem("vendorData");if(t){const s=JSON.parse(t);G(s)}else{const s=localStorage.getItem("vendorId")||localStorage.getItem("userId");s&&G({_id:s,id:s})}}catch(t){console.error("Error loading vendor info:",t)}},[]),o.useEffect(()=>{(async()=>{try{R(!0);const s=await v.get(`${f}/api/categories/modules/${ne}`);de(s.data.data||[])}catch{g("Failed to load categories")}finally{R(!1)}})()},[]),o.useEffect(()=>{if(!u){W(!1);return}(async()=>{var s,a;try{const i=(await v.get(`${f}/api/photography-packages/${h}`)).data.data;L(i.packageTitle),O(i.categories.map(l=>l._id)),U(i.price),H(i.description),q(i.cancellationPolicy),V(i.advanceBookingAmount),Q(i.travelToVenue),Z(i.isActive),i.basicAddons&&Array.isArray(i.basicAddons)&&ee(i.basicAddons),((s=i.includedServices)==null?void 0:s.length)>0&&j(i.includedServices.map(l=>({id:l._id,title:l.title,items:l.items}))),((a=i.gallery)==null?void 0:a.length)>0&&se(i.gallery.map(l=>`${f}${l}`))}catch{g("Failed to load package")}finally{W(!1)}})()},[h,u]);const ge=()=>{j(t=>[...t,{id:Date.now(),title:"",items:[]}])},pe=(t,s,a)=>{j(n=>n.map(i=>i.id===t?{...i,[s]:s==="items"?a.split(",").map(l=>l.trim()).filter(Boolean):a}:i))},ue=t=>{_.length>1&&j(s=>s.filter(a=>a.id!==t))},xe=t=>{ee(s=>s.includes(t)?s.filter(a=>a!==t):[...s,t])},me=t=>{const s=Array.from(t.target.files);if(y.length+T.length+s.length>10)return alert("Maximum 10 images allowed");te(n=>[...n,...s])},fe=t=>te(s=>s.filter((a,n)=>n!==t)),be=t=>se(s=>s.filter((a,n)=>n!==t)),je=async()=>{var n,i;const t=(r==null?void 0:r._id)||(r==null?void 0:r.id);if(!t)return g("Vendor not authenticated");if(!w.trim())return g("Package title required");if(A.length===0)return g("Select at least one category");if(!P)return g("Price required");if(!I.trim())return g("Description required");const s=new FormData;s.append("module",ne),s.append("packageTitle",w.trim()),s.append("description",I.trim()),A.forEach(l=>s.append("categories",l)),s.append("price",P),s.append("cancellationPolicy",J),s.append("advanceBookingAmount",K),s.append("travelToVenue",Y),s.append("isActive",X),s.append("providerId",t),s.append("basicAddons",JSON.stringify(E)),console.log("Selected Add-ons being sent:",E);const a=_.filter(l=>l.title.trim()&&l.items.length>0).map(l=>({title:l.title.trim(),items:l.items}));s.append("includedServices",JSON.stringify(a)),y.forEach(l=>s.append("gallery",l));try{F(!0),g(""),k(""),u?(await v.put(`${f}/api/photography-packages/${h}`,s),k("Package updated successfully!")):(await v.post(`${f}/api/photography-packages`,s),k("Package created successfully!"))}catch(l){g(((i=(n=l.response)==null?void 0:n.data)==null?void 0:i.message)||"Error saving package")}finally{F(!1),window.scrollTo({top:0,behavior:"smooth"})}};return m||he?e.jsx(c,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:e.jsx(ae,{size:60})}):e.jsxs(c,{sx:{bgcolor:"#f9f9fc",minHeight:"100vh"},children:[e.jsxs(c,{sx:{bgcolor:"white",borderBottom:"1px solid #eee",p:2,px:4,position:"sticky",top:0,zIndex:10},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(S,{onClick:()=>b(-1),children:e.jsx(Se,{})}),e.jsxs(p,{variant:"h5",fontWeight:"bold",children:[u?"Edit":"Add"," Photography Package"]})]}),r&&e.jsxs(p,{variant:"body2",color:"text.secondary",sx:{ml:7},children:["Creating as: ",(r==null?void 0:r.firstName)||(r==null?void 0:r.email)||(r==null?void 0:r._id)]})]}),e.jsxs(c,{sx:{p:{xs:2,md:4}},children:[N&&e.jsx(ie,{severity:"success",sx:{mb:3},children:N}),$&&e.jsx(ie,{severity:"error",sx:{mb:3},children:$}),e.jsxs(B,{elevation:3,sx:{borderRadius:3,p:{xs:3,md:6}},children:[e.jsx(x,{fullWidth:!0,label:e.jsxs("span",{children:["Package Title ",e.jsx("span",{style:{color:"red"},children:"*"})]}),value:w,onChange:t=>L(t.target.value),sx:{mb:3}}),e.jsx(D,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:e.jsxs(ke,{fullWidth:!0,children:[e.jsx(Ce,{children:"Categories *"}),e.jsx(we,{multiple:!0,value:A,onChange:t=>O(t.target.value),renderValue:t=>e.jsx(c,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(s=>{const a=C.find(n=>n._id===s);return e.jsx(Ae,{label:(a==null?void 0:a.title)||"Unknown",size:"small"},s)})}),children:C.length===0?e.jsx(oe,{disabled:!0,children:"No categories available"}):C.map(t=>e.jsx(oe,{value:t._id,children:t.title},t._id))})]})}),e.jsxs(D,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsx(x,{fullWidth:!0,label:e.jsxs("span",{children:["Price ",e.jsx("span",{style:{color:"red"},children:"*"})]}),type:"number",value:P,onChange:t=>U(t.target.value)}),e.jsx(x,{fullWidth:!0,label:"Advance Booking Amount (%)",value:K,onChange:t=>V(t.target.value),placeholder:"e.g. 50%"})]}),e.jsx(x,{fullWidth:!0,label:e.jsxs("span",{children:["Description ",e.jsx("span",{style:{color:"red"},children:"*"})]}),multiline:!0,rows:4,value:I,onChange:t=>H(t.target.value),sx:{mb:4}}),e.jsxs(c,{sx:{mb:4},children:[e.jsx(p,{variant:"h6",sx:{color:d,mb:2},children:"Basic Add-ons"}),e.jsx(B,{sx:{border:"1px solid #e5e5e5",borderRadius:2,p:3},children:e.jsx(Pe,{children:e.jsx(c,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr",md:"1fr 1fr 1fr 1fr"},gap:2},children:De.map(t=>e.jsx(M,{control:e.jsx(Ie,{checked:E.includes(t.id),onChange:()=>xe(t.id),sx:{color:d,"&.Mui-checked":{color:d}}}),label:t.label},t.id))})})})]}),e.jsxs(c,{sx:{mb:4},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(p,{variant:"h6",sx:{color:d},children:"Custom Service Sections"}),e.jsx(le,{variant:"contained",startIcon:e.jsx(Ee,{}),sx:{bgcolor:d,"&:hover":{bgcolor:"#c2185b"}},onClick:ge,children:"Add Section"})]}),_.map(t=>e.jsx(Me,{section:t,onChange:(s,a)=>pe(t.id,s,a),onDelete:()=>ue(t.id)},t.id))]}),e.jsx(x,{fullWidth:!0,label:"Cancellation Policy",multiline:!0,rows:3,value:J,onChange:t=>q(t.target.value),sx:{mb:4},placeholder:"e.g. No refund within 48 hours of event"}),e.jsxs(D,{direction:"row",spacing:6,alignItems:"center",sx:{mb:4},children:[e.jsx(M,{control:e.jsx(ce,{checked:Y,onChange:()=>Q(t=>!t)}),label:e.jsx(p,{fontWeight:"medium",children:"Travel to Venue"})}),e.jsx(M,{control:e.jsx(ce,{checked:X,onChange:()=>Z(t=>!t)}),label:e.jsx(p,{fontWeight:"medium",children:"Package Active"})})]}),e.jsx(p,{variant:"h6",sx:{color:d,mb:2},children:"Gallery (Max 10)"}),e.jsxs(B,{onClick:()=>document.getElementById("gallery-input").click(),sx:{border:"2px dashed #ddd",borderRadius:2,p:4,textAlign:"center",cursor:"pointer",mb:4,"&:hover":{borderColor:d}},children:[e.jsx("input",{id:"gallery-input",type:"file",hidden:!0,multiple:!0,accept:"image/*",onChange:me}),y.length>0||T.length>0?e.jsxs(c,{sx:{display:"flex",flexWrap:"wrap",gap:2,justifyContent:"center"},children:[T.map((t,s)=>e.jsxs(c,{sx:{position:"relative"},children:[e.jsx("img",{src:t,alt:"",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(S,{onClick:a=>{a.stopPropagation(),be(s)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white",boxShadow:2},size:"small",children:e.jsx(re,{fontSize:"small"})})]},`ex-${s}`)),y.map((t,s)=>e.jsxs(c,{sx:{position:"relative"},children:[e.jsx("img",{src:URL.createObjectURL(t),alt:"",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(S,{onClick:a=>{a.stopPropagation(),fe(s)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white",boxShadow:2},size:"small",children:e.jsx(re,{fontSize:"small"})})]},`new-${s}`))]}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{sx:{fontSize:60,color:"#ccc"}}),e.jsx(p,{sx:{mt:2,color:d,fontWeight:"bold"},children:"Click to Upload Images"}),e.jsx(p,{variant:"body2",color:"text.secondary",children:"Supports: JPG, PNG, WEBP (Max 10MB each)"})]})]}),e.jsx(le,{fullWidth:!0,variant:"contained",size:"large",onClick:je,disabled:z||!r,sx:{py:2,bgcolor:d,"&:hover":{bgcolor:"#c2185b"},"&:disabled":{bgcolor:"#ccc"}},children:z?e.jsx(ae,{size:28,color:"inherit"}):u?"Update Package":"Create Package"})]})]})]})};export{Ge as default};
