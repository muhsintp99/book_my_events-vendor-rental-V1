import{t as R,r as f,j as r,B as S,s as $,v as D,T as A,g as P}from"./index-vQMKQzEN.js";const w="https://api.bookmyevent.ae";function M(){const[b]=R(),o=b.get("orderId"),d=JSON.parse(localStorage.getItem("user")||"{}"),u=d==null?void 0:d._id,p=localStorage.getItem("moduleId"),[n,i]=f.useState("verifying"),[m,a]=f.useState("Verifying payment...");f.useEffect(()=>{if(!o||!u||!p){i("error"),a("Missing required information");return}let e=0;const c=20;(async()=>{var l,v,x;try{console.log("ðŸ” Verifying payment for orderId:",o);const t=await P.post(`${w}/api/payment/verify-subscription-payment`,{orderId:o});if(console.log("âœ… Verify response:",t.data),t.data.success&&((l=t.data.subscription)==null?void 0:l.status)==="active"){y(t.data.subscription);return}a("Activating subscription...");const g=setInterval(async()=>{var h;if(e++,e>c){clearInterval(g),i("error"),a("Activation timeout. Please refresh the page or contact support.");return}try{console.log(`ðŸ”„ Polling attempt ${e}/${c}`);const s=(h=(await P.get(`${w}/api/subscription/status/${u}?moduleId=${p}`)).data)==null?void 0:h.subscription;(s==null?void 0:s.status)==="active"&&(s!=null&&s.isCurrent)&&(clearInterval(g),console.log("âœ… Subscription activated!"),y(s))}catch(I){console.error("Polling error:",I)}},3e3);return()=>clearInterval(g)}catch(t){console.error("âŒ Payment verification failed:",t),i("error"),a(((x=(v=t.response)==null?void 0:v.data)==null?void 0:x.message)||"Payment verification failed. Please contact support.")}})()},[o,u,p]);const y=e=>{console.log("ðŸ’¾ Updating localStorage and redirecting...");const c=new Date(e.endDate),l=Math.max(0,Math.ceil((c-new Date)/(1e3*60*60*24)));localStorage.setItem("upgrade",JSON.stringify({isSubscribed:!0,status:"active",plan:e.planId,module:e.moduleId,access:{canAccess:!0,isExpired:!1,daysLeft:l}})),i("success"),a("ðŸŽ‰ Subscription activated successfully! Redirecting..."),window.history.replaceState({},"","/payment-success"),setTimeout(()=>{window.location.href="/makeupartist/portfolio"},2e3)};return r.jsxs(S,{sx:{minHeight:"100vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",gap:3,p:3},children:[n==="verifying"&&r.jsx($,{size:60,sx:{color:"#c62828"}}),n==="success"&&r.jsx(S,{sx:{fontSize:60},children:"âœ…"}),n==="error"&&r.jsx(D,{severity:"error",sx:{maxWidth:500},children:m}),r.jsx(A,{variant:"h6",fontWeight:600,textAlign:"center",children:m}),n==="verifying"&&r.jsx(A,{variant:"body2",color:"text.secondary",textAlign:"center",children:"Please do not close this page..."})]})}export{M as default};
