import{r as o,g as fe,j as e,B as r,v as je,o as be,N as ve,T as g,q as f,f as j,b,a7 as ye,a8 as te,D as Ce,s as Te}from"./index-BJj5dOw1.js";import{T as se,a as v}from"./Tabs-C4PVaooA.js";import{C as Se}from"./CloudUpload-7TeyGxZn.js";import{C as we,V as ke}from"./VideoLibrary-8HeK0OKy.js";import{D as ie}from"./Delete-BPy-YEYS.js";import{T as Ie}from"./TableContainer-Y1CAEngc.js";import{T as Le,a as Re,b as $,c as a,d as $e}from"./TableRow-B1k_Ntd2.js";import{C as oe}from"./Close-Dpd_QUj9.js";const n="https://api.bookmyevent.ae",y=fe.create({baseURL:n}),P="#e53935";function Be(){const C=JSON.parse(localStorage.getItem("user")||"{}"),d=C==null?void 0:C._id,h=localStorage.getItem("moduleId"),[U,re]=o.useState(!1),[ae,W]=o.useState(!1),[x,le]=o.useState(0),[T,A]=o.useState(""),[V,D]=o.useState(""),[F,E]=o.useState(""),[m,B]=o.useState(null),[O,_]=o.useState([]),[q,S]=o.useState([]),[w,G]=o.useState(""),[c,ne]=o.useState(0),[N,de]=o.useState([]),[ce,k]=o.useState(!1),[H,ue]=o.useState([]),[J,Y]=o.useState(0),[he,I]=o.useState(!1),[u,xe]=o.useState("");o.useEffect(()=>{!d||!h||y.get(`/api/subscription/status/${d}?moduleId=${h}`).then(t=>{var i;const s=(i=t.data)==null?void 0:i.subscription;re((s==null?void 0:s.status)==="active"&&(s==null?void 0:s.isCurrent))})},[d,h]);const L=async()=>{const t=await y.get(`/api/portfolio/provider/${d}`);de(t.data.data||[])};o.useEffect(()=>{L()},[]);const me=t=>{if(!t)return null;const s=t.match(/(?:youtube\.com\/.*v=|youtu\.be\/)([^&]+)/);return s?`https://img.youtube.com/vi/${s[1]}/hqdefault.jpg`:null},pe=async()=>{if(!U)return alert("Upgrade plan required");if(!T.trim())return alert("Title required");const t=new FormData;if(t.append("providerId",d),t.append("module",h),t.append("workTitle",T),t.append("description",V),t.append("tags",F),x===0){if(!m)return alert("Thumbnail required");t.append("thumbnail",m),O.forEach(s=>t.append("images",s))}else q.forEach(s=>t.append("videos",s)),w&&t.append("videoLinks",JSON.stringify([w]));W(!0),await y.post("/api/portfolio",t),W(!1),A(""),D(""),E(""),B(null),_([]),S([]),G(""),L()},ge=async t=>{window.confirm("Delete portfolio?")&&(await y.delete(`/api/portfolio/${t}`),L())},z=c===0?N.filter(t=>{var s;return(s=t.media)==null?void 0:s.some(i=>i.type==="image")}):N.filter(t=>{var s;return(s=t.media)==null?void 0:s.some(i=>i.type==="video"||i.type==="videoLink")});return e.jsxs(r,{sx:{p:3,maxWidth:1800,mx:"auto"},children:[!U&&e.jsx(je,{severity:"warning",sx:{mb:3},children:"Upgrade to premium to add portfolio works"}),e.jsx(be,{sx:{mb:5,borderRadius:3,width:"100%"},children:e.jsxs(ve,{children:[e.jsx(g,{variant:"h5",fontWeight:700,mb:2,children:"Add Portfolio Work"}),e.jsxs(se,{value:x,onChange:(t,s)=>le(s),sx:{mb:3},children:[e.jsx(v,{label:"Images"}),e.jsx(v,{label:"Videos"})]}),e.jsx(f,{fullWidth:!0,label:"Title",value:T,onChange:t=>A(t.target.value),sx:{mb:3}}),e.jsx(f,{fullWidth:!0,multiline:!0,rows:3,label:"Description",value:V,onChange:t=>D(t.target.value),sx:{mb:3}}),e.jsx(f,{fullWidth:!0,label:"Tags",value:F,onChange:t=>E(t.target.value),sx:{mb:4}}),x===0&&e.jsxs(e.Fragment,{children:[e.jsxs(j,{component:"label",variant:"contained",sx:{bgcolor:P,mb:2},children:[e.jsx(Se,{sx:{mr:1}})," Upload Thumbnail",e.jsx("input",{hidden:!0,type:"file",accept:"image/*",onChange:t=>B(t.target.files[0])})]}),m&&e.jsx(r,{sx:{mb:3},children:e.jsx("img",{src:URL.createObjectURL(m),style:{width:180,height:180,borderRadius:12}})}),e.jsxs(j,{component:"label",variant:"outlined",sx:{mb:2},children:[e.jsx(we,{sx:{mr:1}})," Upload Gallery Images",e.jsx("input",{hidden:!0,multiple:!0,type:"file",accept:"image/*",onChange:t=>_([...t.target.files])})]}),e.jsx(r,{sx:{display:"flex",gap:2,flexWrap:"wrap",mb:4},children:O.map((t,s)=>e.jsx("img",{src:URL.createObjectURL(t),style:{width:100,height:100,borderRadius:10}},s))})]}),x===1&&e.jsxs(e.Fragment,{children:[e.jsxs(j,{component:"label",variant:"contained",sx:{bgcolor:P,mb:2},children:[e.jsx(ke,{sx:{mr:1}})," Upload Videos",e.jsx("input",{hidden:!0,multiple:!0,type:"file",accept:"video/*",onChange:t=>S(Array.from(t.target.files))})]}),q.map((t,s)=>e.jsxs(r,{sx:{mb:2},children:[e.jsx("video",{src:URL.createObjectURL(t),controls:!0,style:{width:260,borderRadius:8}}),e.jsx(b,{color:"error",onClick:()=>S(i=>i.filter((R,p)=>p!==s)),children:e.jsx(ie,{})})]},s)),e.jsx(f,{fullWidth:!0,label:"Video Link (YouTube / Vimeo)",value:w,onChange:t=>G(t.target.value),sx:{mb:3}})]}),e.jsx(j,{fullWidth:!0,variant:"contained",sx:{bgcolor:P,py:1.4},onClick:pe,children:"Add Portfolio"})]})}),e.jsxs(se,{value:c,onChange:(t,s)=>ne(s),sx:{mb:2},children:[e.jsx(v,{label:"Images"}),e.jsx(v,{label:"Videos"})]}),e.jsx(Ie,{component:ye,sx:{borderRadius:3,width:"100%"},children:e.jsxs(Le,{children:[e.jsx(Re,{sx:{bgcolor:"#fdeaea"},children:e.jsxs($,{children:[e.jsx(a,{children:"Work"}),e.jsx(a,{children:"Preview"}),e.jsx(a,{align:"center",children:"Count"}),e.jsx(a,{align:"right",children:"Action"})]})}),e.jsxs($e,{children:[z.length===0&&e.jsx($,{children:e.jsx(a,{colSpan:4,align:"center",children:e.jsx(g,{color:"text.secondary",children:"No portfolio items found"})})}),z.map(t=>{var R,p,K,Q,X,Z;const s=t.media.find(l=>l.type==="image"),i=t.media.find(l=>l.type==="video"||l.type==="videoLink");return e.jsxs($,{hover:!0,children:[e.jsxs(a,{children:[e.jsx(g,{fontWeight:600,children:t.workTitle}),e.jsx(g,{variant:"caption",color:"text.secondary",children:t.description})]}),e.jsxs(a,{children:[c===0&&s&&e.jsx("img",{src:`${n}/${s.thumbnail}`,style:{width:70,height:70,borderRadius:10,cursor:"pointer",objectFit:"cover"},onClick:()=>{ue(s.gallery||[]),Y(0),k(!0)}}),c===1&&i&&e.jsxs(r,{sx:{cursor:"pointer"},onClick:()=>{var M,ee;const l=(M=i.videos)!=null&&M[0]?`${n}/${i.videos[0]}`:(ee=i.videoLinks)==null?void 0:ee[0];xe(l),I(!0)},children:[((R=i.videos)==null?void 0:R[0])&&e.jsx("video",{src:`${n}/${i.videos[0]}`,preload:"metadata",muted:!0,style:{width:80,height:60,objectFit:"cover",borderRadius:6}}),!((p=i.videos)!=null&&p.length)&&((K=i.videoLinks)==null?void 0:K[0])&&e.jsx("img",{src:me(i.videoLinks[0])||"/video-placeholder.png",alt:"video thumbnail",style:{width:80,height:60,objectFit:"cover",borderRadius:6}})]})]}),e.jsx(a,{align:"center",children:c===0?((Q=s==null?void 0:s.gallery)==null?void 0:Q.length)||0:(((X=i==null?void 0:i.videos)==null?void 0:X.length)||0)+(((Z=i==null?void 0:i.videoLinks)==null?void 0:Z.length)||0)}),e.jsx(a,{align:"right",children:e.jsx(b,{color:"error",onClick:()=>ge(t._id),children:e.jsx(ie,{})})})]},t._id)})]})]})}),e.jsx(te,{open:ce,onClose:()=>k(!1),fullScreen:!0,children:e.jsxs(r,{sx:{bgcolor:"#000",height:"100vh",p:2},children:[e.jsx(b,{onClick:()=>k(!1),sx:{color:"#fff"},children:e.jsx(oe,{})}),e.jsx(r,{sx:{textAlign:"center",mt:2},children:e.jsx("img",{src:`${n}/${H[J]}`,style:{maxHeight:"70vh",maxWidth:"100%"}})}),e.jsx(Ce,{sx:{my:2,bgcolor:"#333"}}),e.jsx(r,{sx:{display:"flex",justifyContent:"center",gap:1},children:H.map((t,s)=>e.jsx("img",{src:`${n}/${t}`,onClick:()=>Y(s),style:{width:60,height:60,borderRadius:8,border:J===s?"2px solid #fff":"1px solid #444",cursor:"pointer"}},s))})]})}),e.jsx(te,{open:he,onClose:()=>I(!1),fullScreen:!0,children:e.jsxs(r,{sx:{bgcolor:"#000",height:"100vh",p:2},children:[e.jsx(b,{onClick:()=>I(!1),sx:{color:"#fff"},children:e.jsx(oe,{})}),e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"80%"},children:u!=null&&u.includes("http")?e.jsx("iframe",{src:u,width:"80%",height:"80%",frameBorder:"0",allowFullScreen:!0}):e.jsx("video",{src:u,controls:!0,style:{maxWidth:"80%"}})})]})}),ae&&e.jsx(Te,{})]})}export{Be as default};
