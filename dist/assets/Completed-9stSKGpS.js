import{r as d,j as e,B as S,T as y,a8 as k,S as A,s as W,g as D,a4 as v}from"./index-CxFmThG8.js";import{T as N}from"./TableContainer-MWnyzJ5Y.js";import{T as B,a as h,b as s,c as L}from"./TableRow-BobOFfSn.js";import{T as R}from"./TableHead-DUu2iJwC.js";const F=()=>{const[a,I]=d.useState(""),[T,w]=d.useState([]),c=(()=>{try{const t=localStorage.getItem("user");if(!t)return null;const i=JSON.parse(t);return(i==null?void 0:i._id)||null}catch(t){return console.error("Error parsing user:",t),null}})(),C=`https://api.bookmyevent.ae/api/bookings/provider/${c}`,x=async()=>{if(c)try{const u=((await(await fetch(C)).json()).data||[]).filter(o=>{var l;const r=(l=o.status)==null?void 0:l.toLowerCase();return r==="accepted"||r==="completed"});u.sort((o,r)=>new Date(r.createdAt)-new Date(o.createdAt));const b=u.map(o=>{var l,f,p,g,j;let r="N/A";if(o.timeSlot)if(Array.isArray(o.timeSlot)){const n=o.timeSlot[0];r=typeof n=="object"?(n==null?void 0:n.label)||(n==null?void 0:n.time)||"N/A":n}else typeof o.timeSlot=="object"?r=((l=o.timeSlot)==null?void 0:l.label)||((f=o.timeSlot)==null?void 0:f.time)||"N/A":r=o.timeSlot;return{id:o._id,tripId:o._id.slice(-6).toUpperCase(),bookingDate:new Date(o.bookingDate).toLocaleDateString(),scheduleAt:r,customerInfo:o.fullName||"N/A",vehicleInfo:o.vehicleInfo||((p=o.venueId)==null?void 0:p.venueName)||((g=o.packageId)==null?void 0:g.title)||"N/A",tripType:o.moduleType||"Service",tripAmount:(j=o.finalPrice)==null?void 0:j.toLocaleString("en-IN",{style:"currency",currency:"INR"}),tripStatus:o.status}});w(b)}catch(t){console.log("Error fetching completed bookings:",t)}};d.useEffect(()=>{x()},[c]);const m=T.filter(t=>t.tripId.toString().toLowerCase().includes(a.toLowerCase())||t.customerInfo.toLowerCase().includes(a.toLowerCase()));return e.jsx(S,{p:3,sx:{background:"#f8fafc",minHeight:"100vh"},children:e.jsxs(S,{sx:{maxWidth:"1200px",margin:"0 auto"},children:[e.jsx(y,{variant:"h4",fontWeight:600,gutterBottom:!0,mb:3,children:"Completed / Confirmed Bookings"}),e.jsxs(k,{sx:{width:"100%",borderRadius:3,overflow:"hidden",boxShadow:"0px 4px 20px rgba(0,0,0,0.05)"},children:[e.jsxs(A,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"space-between",alignItems:{xs:"stretch",sm:"center"},p:3,bgcolor:"#fff",children:[e.jsx(W,{label:"Search by ID, customer name",size:"small",variant:"outlined",value:a,onChange:t=>I(t.target.value),sx:{maxWidth:{sm:350},minWidth:250}}),e.jsx(D,{variant:"contained",sx:{bgcolor:"#E15B65",color:"white",borderRadius:2,textTransform:"none",px:3},onClick:x,children:"Refresh List"})]}),e.jsx(N,{sx:{width:"100%",overflowX:"auto"},children:e.jsxs(B,{stickyHeader:!0,children:[e.jsx(R,{children:e.jsxs(h,{sx:{bgcolor:"#f8fafc"},children:[e.jsx(s,{sx:{fontWeight:700,color:"#475569"},children:"S#"}),e.jsx(s,{sx:{fontWeight:700,color:"#475569"},children:"Booking ID"}),e.jsx(s,{sx:{fontWeight:700,color:"#475569"},children:"Booking Date"}),e.jsx(s,{sx:{fontWeight:700,color:"#475569"},children:"Schedule At"}),e.jsx(s,{sx:{fontWeight:700,color:"#475569"},children:"Customer"}),e.jsx(s,{sx:{fontWeight:700,color:"#475569"},children:"Service/Item"}),e.jsx(s,{sx:{fontWeight:700,color:"#475569"},children:"Type"}),e.jsx(s,{sx:{fontWeight:700,color:"#475569"},children:"Amount"}),e.jsx(s,{sx:{fontWeight:700,color:"#475569"},children:"Status"})]})}),e.jsx(L,{children:m.length===0?e.jsx(h,{children:e.jsx(s,{colSpan:9,align:"center",sx:{py:5},children:e.jsx(y,{color:"text.secondary",children:"No bookings found."})})}):m.map((t,i)=>e.jsxs(h,{hover:!0,children:[e.jsx(s,{children:i+1}),e.jsxs(s,{children:["#",t.tripId]}),e.jsx(s,{children:t.bookingDate}),e.jsx(s,{children:t.scheduleAt}),e.jsx(s,{children:t.customerInfo}),e.jsx(s,{children:t.vehicleInfo}),e.jsx(s,{children:e.jsx(v,{label:t.tripType,size:"small",sx:{bgcolor:"#f1f5f9"}})}),e.jsx(s,{sx:{fontWeight:600,color:"#16a34a"},children:t.tripAmount}),e.jsx(s,{children:e.jsx(v,{label:t.tripStatus,size:"small",color:t.tripStatus==="Completed"?"success":"primary",variant:"outlined"})})]},t.id))})]})})]})]})})};export{F as default};
