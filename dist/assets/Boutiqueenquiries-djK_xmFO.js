import{w as F,r as n,j as e,B as c,T as r,x as R,am as V,q as _,t as O,S as G,ap as g,b as x,V as $,af as H,ah as J,as as K,ai as U,G as C,n as D,K as E,p as Q,at as X,au as Y,aj as Z,g as T,h as k}from"./index-C9f5bxSM.js";import{C as z}from"./Chat-NE5nQL69.js";import{C as ee}from"./Close-CNXAIBlS.js";import{E as te}from"./Event-_xhcHfMo.js";import{C as se}from"./Category-CqbTo6Ss.js";import{A as ie}from"./AccessTime-w264MbbM.js";import{T as ne}from"./TableContainer-CmZafl7o.js";import{T as le,a as u,b as s,c as re}from"./TableRow-Drst7JtY.js";import{T as ae}from"./TableHead-DH1wZq8S.js";const pe=()=>{var w;const y=F(),[d,B]=n.useState(""),[L,j]=n.useState([]),[m,b]=n.useState(!0),[S,f]=n.useState(null),[p,A]=n.useState(null),[N,v]=n.useState(!1),[l,I]=n.useState(null),W=async t=>{if(window.confirm("Are you sure you want to delete this enquiry?"))try{await k.delete(`https://api.bookmyevent.ae/api/enquiries/${t}`),j(a=>a.filter(M=>M._id!==t))}catch{alert("Failed to delete enquiry")}};n.useEffect(()=>{const t=localStorage.getItem("user");if(t){const i=JSON.parse(t);A(i.providerId||i._id)}},[]),n.useEffect(()=>{(async()=>{if(!p){f("Provider ID not found"),b(!1);return}try{const i=await k.get(`https://api.bookmyevent.ae/api/enquiries/provider/${p}`);j(i.data.data||[]),f(null)}catch{f("Failed to fetch enquiries"),j([])}finally{b(!1)}})()},[p]);const q=L.filter(t=>{var i;return(t.fullName||"").toLowerCase().includes(d.toLowerCase())||(t.email||"").toLowerCase().includes(d.toLowerCase())||(t.contact||"").includes(d)||(((i=t.moduleId)==null?void 0:i.title)||"").toLowerCase().includes(d.toLowerCase())}),P=t=>{I(t),v(!0)},h=()=>{v(!1),I(null)},o=({icon:t,label:i,value:a})=>e.jsxs(c,{display:"flex",alignItems:"center",gap:2,py:1.5,sx:{borderBottom:"1px solid",borderColor:"divider","&:last-child":{borderBottom:"none"}},children:[e.jsx(c,{sx:{width:40,height:40,borderRadius:"50%",bgcolor:"primary.light",color:"primary.main",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:t}),e.jsxs(c,{children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:i}),e.jsx(r,{fontWeight:500,children:a||"N/A"})]})]});return e.jsxs(c,{p:2,children:[e.jsx(r,{variant:"h4",gutterBottom:!0,children:"Enquiries"}),S&&e.jsx(R,{severity:"error",sx:{mb:2},children:S}),e.jsxs(V,{sx:{mt:2},children:[e.jsx(c,{p:2,children:e.jsx(_,{label:"Search enquiries",size:"small",value:d,onChange:t=>B(t.target.value),fullWidth:!0})}),e.jsx(ne,{children:e.jsxs(le,{children:[e.jsx(ae,{children:e.jsxs(u,{children:[e.jsx(s,{children:"#"}),e.jsx(s,{children:"Customer"}),e.jsx(s,{children:"Module"}),e.jsx(s,{children:"Contact"}),e.jsx(s,{children:"Date"}),e.jsx(s,{align:"center",children:"Actions"})]})}),e.jsxs(re,{children:[m&&e.jsx(u,{children:e.jsx(s,{colSpan:6,align:"center",children:e.jsx(O,{size:28})})}),!m&&q.map((t,i)=>{var a;return e.jsxs(u,{hover:!0,children:[e.jsx(s,{children:i+1}),e.jsxs(s,{children:[e.jsx(r,{fontWeight:600,children:t.fullName}),e.jsx(r,{variant:"caption",color:"text.secondary",children:t.email})]}),e.jsx(s,{children:(a=t.moduleId)==null?void 0:a.title}),e.jsx(s,{children:t.contact}),e.jsx(s,{children:new Date(t.bookingDate).toLocaleDateString()}),e.jsx(s,{align:"center",children:e.jsxs(G,{direction:"row",spacing:1,justifyContent:"center",children:[e.jsx(g,{title:"Chat",children:e.jsx(x,{size:"small",color:"primary",onClick:()=>y("/boutique/enquirychat",{state:t}),children:e.jsx(z,{fontSize:"small"})})}),e.jsx(g,{title:"View",children:e.jsx(x,{size:"small",color:"info",onClick:()=>P(t),children:e.jsx($,{fontSize:"small"})})}),e.jsx(g,{title:"Delete",children:e.jsx(x,{size:"small",color:"error",onClick:()=>W(t._id),children:e.jsx(H,{fontSize:"small"})})})]})})]},t._id)}),!m&&q.length===0&&e.jsx(u,{children:e.jsx(s,{colSpan:6,align:"center",children:"No enquiries found"})})]})]})})]}),e.jsxs(J,{open:N,onClose:h,maxWidth:"md",fullWidth:!0,children:[e.jsx(K,{sx:{bgcolor:"primary.main",color:"white"},children:e.jsxs(c,{display:"flex",justifyContent:"space-between",children:[e.jsx(r,{fontWeight:600,children:"Enquiry Details"}),e.jsx(x,{onClick:h,sx:{color:"white"},children:e.jsx(ee,{})})]})}),e.jsx(U,{children:l&&e.jsxs(C,{container:!0,spacing:3,mt:1,children:[e.jsx(C,{item:!0,xs:12,md:6,children:e.jsx(D,{variant:"outlined",children:e.jsxs(E,{children:[e.jsx(r,{fontWeight:600,mb:2,children:"Customer Information"}),e.jsx(o,{icon:e.jsx(Q,{fontSize:"small"}),label:"Full Name",value:l.fullName}),e.jsx(o,{icon:e.jsx(X,{fontSize:"small"}),label:"Email",value:l.email}),e.jsx(o,{icon:e.jsx(Y,{fontSize:"small"}),label:"Contact",value:l.contact})]})})}),e.jsx(C,{item:!0,xs:12,md:6,children:e.jsx(D,{variant:"outlined",children:e.jsxs(E,{children:[e.jsx(r,{fontWeight:600,mb:2,children:"Booking Information"}),e.jsx(o,{icon:e.jsx(se,{fontSize:"small"}),label:"Module",value:(w=l.moduleId)==null?void 0:w.title}),e.jsx(o,{icon:e.jsx(te,{fontSize:"small"}),label:"Booking Date",value:new Date(l.bookingDate).toLocaleDateString()}),e.jsx(o,{icon:e.jsx(ie,{fontSize:"small"}),label:"Created At",value:new Date(l.createdAt).toLocaleString()})]})})})]})}),e.jsxs(Z,{children:[e.jsx(T,{onClick:h,variant:"outlined",children:"Close"}),e.jsx(T,{variant:"contained",startIcon:e.jsx(z,{}),onClick:()=>{h(),y("/boutique/enquirychat",{state:l})},children:"Open Chat"})]})]})]})};export{pe as default};
