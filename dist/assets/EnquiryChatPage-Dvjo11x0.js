import{r as o,j as e,a9 as b,B as r,T as a,S as v,q as E,b as I,s as w,w as S,al as _,a8 as y}from"./index-DaiSIVFY.js";import{S as k}from"./Send-BHaMEiE8.js";import{C as D}from"./Close-nUc7dfNC.js";import{C as W}from"./ChatBubbleOutline-CC5Q4fJ6.js";import{s as l}from"./socket-BpXQx-Y7.js";const A=({open:f,onClose:n,enquiry:t})=>{var g,m;const[c,d]=o.useState(""),[x,C]=o.useState([]),u=o.useRef(null),i=JSON.parse(localStorage.getItem("user"));if(!t||!i)return null;if(!(t.vendorId===i._id||((g=t.vendorId)==null?void 0:g._id)===i._id))return e.jsx(b,{open:f,onClose:n,children:e.jsx(r,{p:4,textAlign:"center",children:e.jsx(a,{color:"error",fontWeight:600,children:"You are not authorized to view this chat"})})});o.useEffect(()=>{if(t!=null&&t._id)return l.connect(),l.emit("join_enquiry",{enquiryId:t._id,vendorId:i._id}),l.on("receive_message",s=>{C(h=>[...h,s])}),()=>{l.off("receive_message"),l.disconnect()}},[t,i._id]),o.useEffect(()=>{var s;(s=u.current)==null||s.scrollIntoView({behavior:"smooth"})},[x]);const p=()=>{if(!c.trim())return;const s={enquiryId:t._id,senderId:i._id,senderRole:"vendor",text:c,time:new Date().toLocaleTimeString()};l.emit("send_message",s),d("")};return e.jsxs(b,{open:f,onClose:n,fullWidth:!0,maxWidth:"sm",children:[e.jsx(r,{sx:{px:2,py:1.5,bgcolor:"#075E54",color:"#fff"},children:e.jsxs(v,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(E,{sx:{bgcolor:"#25D366"},children:(m=t.fullName)==null?void 0:m.charAt(0)}),e.jsxs(r,{flex:1,children:[e.jsx(a,{fontWeight:600,children:t.fullName}),e.jsx(a,{variant:"caption",sx:{opacity:.8},children:"Vendor Chat"})]}),e.jsx(I,{onClick:n,sx:{color:"#fff"},children:e.jsx(D,{})})]})}),e.jsxs(r,{sx:{height:420,px:2,py:1,overflowY:"auto",bgcolor:"#ECE5DD"},children:[x.map((s,h)=>{const j=s.senderId===i._id;return e.jsx(r,{display:"flex",justifyContent:j?"flex-end":"flex-start",mb:1,children:e.jsxs(r,{sx:{px:2,py:1.2,maxWidth:"75%",borderRadius:2,bgcolor:j?"#DCF8C6":"#fff",boxShadow:"0 1px 1px rgba(0,0,0,0.15)"},children:[e.jsx(a,{variant:"body2",sx:{wordBreak:"break-word"},children:s.text}),e.jsx(a,{variant:"caption",sx:{display:"block",textAlign:"right",opacity:.6,mt:.5,fontSize:"0.7rem"},children:s.time})]})},h)}),e.jsx("div",{ref:u})]}),e.jsx(r,{sx:{p:1.5,bgcolor:"#f7f7f7",borderTop:"1px solid #ddd"},children:e.jsxs(v,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(W,{sx:{color:"#888"}}),e.jsx(w,{fullWidth:!0,size:"small",placeholder:"Type a message",value:c,onChange:s=>d(s.target.value),onKeyDown:s=>s.key==="Enter"&&p(),sx:{bgcolor:"#fff",borderRadius:5}}),e.jsx(I,{onClick:p,sx:{bgcolor:"#25D366",color:"#fff","&:hover":{bgcolor:"#1ebd5a"}},children:e.jsx(k,{})})]})})]})},V=()=>{const f=S(),{state:n}=_(),[t,c]=o.useState(!0),[d,x]=o.useState(null);return o.useEffect(()=>{x(n||{fullName:"John Doe",description:"Need evening makeup service",moduleId:{title:"Makeup Artist"}})},[n]),d?e.jsxs(r,{p:3,children:[e.jsxs(y,{sx:{minHeight:"70vh",bgcolor:"#f5f7fa",p:4,textAlign:"center"},children:[e.jsx(a,{variant:"h5",fontWeight:600,children:"Enquiry Chat"}),e.jsx(a,{color:"text.secondary",children:"Chat with customer"})]}),e.jsx(A,{open:t,enquiry:d,onClose:()=>{c(!1),f("/makeupartist/Enqury")}})]}):null};export{V as default};
