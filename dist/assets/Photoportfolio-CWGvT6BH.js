import{r as n,h as Je,j as e,B as d,t as Ke,ai as Ge,a5 as qe,p as Qe,K as k,T as v,s as p,af as y,g as C,G as S,c as u,a6 as je,a7 as Xe,a9 as Ye}from"./index-DeRtw_oW.js";import{T as Ze,a as be}from"./Tabs-B4lRF-eH.js";import{C as ve}from"./CloudUpload-D-NJs-qD.js";import{C as E}from"./Close-CQ7ERAaH.js";import{T as ye}from"./TableContainer-CQ39ExvE.js";import{T as Ce,a as we,b as j,c as l,d as Te}from"./TableRow-dZ6IWn_H.js";import{D as ke}from"./Delete-BER4c_iz.js";import{L as et,V as tt,C as st,a as ot}from"./VideoLibrary-BmUZyZd1.js";const _="https://api.bookmyevent.ae",O=Je.create({baseURL:_}),a="#e53935";function xt({providerId:Se}){var pe;const[I,Ie]=n.useState(0),[Le,g]=n.useState(!1),[w,z]=n.useState({open:!1,message:"",severity:"success"}),T=Se||((pe=JSON.parse(localStorage.getItem("user")||"{}"))==null?void 0:pe._id)||localStorage.getItem("userId"),[De,$]=n.useState(!1),[b,Ve]=n.useState([]),[B,L]=n.useState(0),[Pe,Ue]=n.useState(!1),[N,H]=n.useState(""),[J,K]=n.useState(""),[G,D]=n.useState([]),[q,Q]=n.useState(""),[V,P]=n.useState([]),[X,Re]=n.useState([]),[Y,Z]=n.useState(""),[ee,te]=n.useState(""),[se,U]=n.useState([]),[oe,ie]=n.useState(""),[R,A]=n.useState([]),[re,F]=n.useState([]),[M,le]=n.useState(""),[ae,Ae]=n.useState([]);n.useEffect(()=>{T&&W()},[T]);const W=async()=>{try{g(!0);const t=await O.get(`/api/portfolio/provider/${T}`);if(!t.data.success)return;const s=t.data.data||[],r=s.filter(i=>{var c;return(c=i.media)==null?void 0:c.some(h=>h.type==="image")});Re(r.map(i=>({id:i._id,title:i.workTitle||"Untitled",description:i.description||"",tags:Array.isArray(i.tags)?i.tags:[],media:i.media.filter(c=>c.type==="image").flatMap(c=>c.images||[])})));const o=s.filter(i=>{var c;return(c=i.media)==null?void 0:c.some(h=>h.type==="video"||h.type==="videoLink")});Ae(o.map(i=>({id:i._id,title:i.workTitle||"Untitled",description:i.description||"",tags:i.tags||[],media:i.media.flatMap(c=>c.type==="video"?(c.videos||[]).map(h=>({type:"video",url:h})):c.type==="videoLink"?(c.videoLinks||[]).map(h=>({type:"videoLink",url:h})):[])})))}catch{m("Unable to load portfolio","error")}finally{g(!1)}},m=(t,s="success")=>{z({open:!0,message:t,severity:s})},ne=(t,s=0,r=!1)=>{const o=t.map(i=>i.type==="videoLink"?Fe(i.url):`${_}/${i.url}`);Ve(o),L(s),Ue(r),$(!0)},Fe=t=>t.includes("youtube.com")?t.replace("watch?v=","embed/"):t.includes("youtu.be")?t.replace("youtu.be/","youtube.com/embed/"):t.includes("vimeo.com")?`https://player.vimeo.com/video/${t.split("/").pop().split("?")[0]}`:t,ce=()=>$(!1),Me=()=>L(t=>t===0?b.length-1:t-1),We=()=>L(t=>t===b.length-1?0:t+1),de=(t,s,r)=>{t.trim()&&(r(o=>[...o,t.trim()]),s(""))},Ee=t=>{const r=Array.from(t.target.files).map(o=>({file:o,preview:URL.createObjectURL(o)}));P(o=>[...o,...r])},Oe=t=>{URL.revokeObjectURL(V[t].preview),P(s=>s.filter((r,o)=>o!==t))},_e=t=>{const r=Array.from(t.target.files).map(o=>({file:o,preview:URL.createObjectURL(o)}));A(o=>[...o,...r])},ze=t=>{URL.revokeObjectURL(R[t].preview),A(s=>s.filter((r,o)=>o!==t))},$e=()=>{M.trim()&&(F(t=>[...t,M.trim()]),le(""))},Be=t=>F(s=>s.filter((r,o)=>o!==t)),he=async(t,s,r,o,i,c,h,Ne,He,ue,ge=!1)=>{var me,fe;if(!t.trim()||o.length===0&&i.length===0)return m("Title and media required","warning");const x=new FormData;x.append("providerId",T),x.append("module","default"),x.append("workTitle",t),x.append("description",s),x.append("tags",JSON.stringify(r)),ge?(o.forEach(f=>x.append("videos",f.file)),i.length>0&&x.append("videoLinks",JSON.stringify(i))):o.forEach(f=>x.append("images",f.file));try{g(!0),(await O.post("/api/portfolio",x,{headers:{"Content-Type":"multipart/form-data"}})).data.success&&(m(`${ge?"Video":"Images"} added!`),W(),c(""),h(""),Ne([]),He([]),ue&&ue([]))}catch(f){m(((fe=(me=f.response)==null?void 0:me.data)==null?void 0:fe.message)||"Upload failed","error")}finally{g(!1)}},xe=async t=>{if(window.confirm("Delete permanently?"))try{g(!0),await O.delete(`/api/portfolio/${t}`),m("Deleted!"),W()}catch{m("Delete failed","error")}finally{g(!1)}};return e.jsxs(d,{sx:{p:3},children:[Le&&e.jsx(d,{sx:{position:"fixed",inset:0,bgcolor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:e.jsx(Ke,{size:60,sx:{color:a}})}),e.jsx(Ge,{open:w.open,autoHideDuration:4e3,onClose:()=>z({...w,open:!1}),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(qe,{severity:w.severity,children:w.message})}),e.jsxs(Qe,{children:[e.jsxs(Ze,{value:I,onChange:(t,s)=>Ie(s),textColor:"inherit",TabIndicatorProps:{style:{backgroundColor:a}},sx:{"& .MuiTab-root.Mui-selected":{color:a,fontWeight:600}},children:[e.jsx(be,{label:"Images"}),e.jsx(be,{label:"Videos"})]}),I===0&&e.jsxs(e.Fragment,{children:[e.jsxs(k,{children:[e.jsx(v,{variant:"h6",sx:{color:a},children:"Add Portfolio Images"}),e.jsx(p,{fullWidth:!0,label:"Title",value:N,onChange:t=>H(t.target.value),sx:{mb:3}}),e.jsx(p,{fullWidth:!0,multiline:!0,rows:3,label:"Description",value:J,onChange:t=>K(t.target.value),sx:{mb:3}}),e.jsx(d,{sx:{mb:2},children:G.map((t,s)=>e.jsx(y,{label:t,onDelete:()=>D(r=>r.filter((o,i)=>i!==s)),sx:{mr:1,bgcolor:a,color:"white"}},s))}),e.jsx(p,{fullWidth:!0,label:"Add Tag (Enter)",value:q,onChange:t=>Q(t.target.value),onKeyDown:t=>t.key==="Enter"&&(t.preventDefault(),de(q,Q,D)),sx:{mb:3}}),e.jsxs(C,{variant:"contained",component:"label",startIcon:e.jsx(ve,{}),sx:{mb:2,bgcolor:a,"&:hover":{bgcolor:"#c62828"}},children:["Upload Images",e.jsx("input",{hidden:!0,type:"file",multiple:!0,accept:"image/*",onChange:Ee})]}),e.jsx(S,{container:!0,spacing:2,children:V.map((t,s)=>e.jsx(S,{item:!0,xs:6,sm:4,md:3,children:e.jsxs(d,{sx:{position:"relative"},children:[e.jsx("img",{src:t.preview,style:{width:"100%",height:150,objectFit:"cover",borderRadius:8}}),e.jsx(u,{size:"small",onClick:()=>Oe(s),sx:{position:"absolute",top:4,right:4,bgcolor:a,color:"white"},children:e.jsx(E,{})})]})},s))}),e.jsx(C,{fullWidth:!0,variant:"contained",sx:{mt:4,bgcolor:a,"&:hover":{bgcolor:"#c62828"}},onClick:()=>he(N,J,G,V,[],H,K,D,P,null,!1),children:"Add Portfolio"})]}),e.jsxs(k,{children:[e.jsx(v,{variant:"h6",sx:{color:a},children:"Portfolio List"}),e.jsx(ye,{component:je,children:e.jsxs(Ce,{children:[e.jsx(we,{sx:{bgcolor:"#ffebee"},children:e.jsxs(j,{children:[e.jsx(l,{children:"SI"}),e.jsx(l,{children:"Title"}),e.jsx(l,{children:"Preview"}),e.jsx(l,{children:"Count"}),e.jsx(l,{children:"Tags"}),e.jsx(l,{children:"Actions"})]})}),e.jsx(Te,{children:X.length===0?e.jsx(j,{children:e.jsx(l,{colSpan:6,align:"center",children:"No images"})}):X.map((t,s)=>e.jsxs(j,{children:[e.jsx(l,{children:s+1}),e.jsx(l,{children:t.title}),e.jsx(l,{children:e.jsx(d,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:t.media.slice(0,3).map((r,o)=>e.jsx("img",{src:`${_}/${r}`,style:{width:70,height:60,objectFit:"cover",borderRadius:4,cursor:"pointer"},onClick:()=>ne(t.media.map(i=>({type:"image",url:i})),o,!1)},o))})}),e.jsx(l,{children:t.media.length}),e.jsx(l,{children:t.tags.map((r,o)=>e.jsx(y,{size:"small",label:r,sx:{mr:.5,bgcolor:a,color:"white"}},o))}),e.jsx(l,{children:e.jsx(u,{onClick:()=>xe(t.id),sx:{color:a},children:e.jsx(ke,{})})})]},t.id))})]})})]})]}),I===1&&e.jsxs(e.Fragment,{children:[e.jsxs(k,{children:[e.jsx(v,{variant:"h6",sx:{color:a},children:"Add Portfolio Videos"}),e.jsx(p,{fullWidth:!0,label:"Title",value:Y,onChange:t=>Z(t.target.value),sx:{mb:3}}),e.jsx(p,{fullWidth:!0,multiline:!0,rows:3,label:"Description",value:ee,onChange:t=>te(t.target.value),sx:{mb:3}}),e.jsx(d,{sx:{mb:2},children:se.map((t,s)=>e.jsx(y,{label:t,onDelete:()=>U(r=>r.filter((o,i)=>i!==s)),sx:{mr:1,bgcolor:a,color:"white"}},s))}),e.jsx(p,{fullWidth:!0,label:"Add Tag (Enter)",value:oe,onChange:t=>ie(t.target.value),onKeyDown:t=>t.key==="Enter"&&(t.preventDefault(),de(oe,ie,U)),sx:{mb:3}}),e.jsxs(C,{variant:"contained",component:"label",startIcon:e.jsx(ve,{}),sx:{mb:2,bgcolor:a,"&:hover":{bgcolor:"#c62828"}},children:["Upload Videos",e.jsx("input",{hidden:!0,type:"file",multiple:!0,accept:"video/*",onChange:_e})]}),e.jsx(v,{sx:{my:2},children:"Or add video links"}),e.jsxs(d,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(p,{fullWidth:!0,label:"Video Link",value:M,onChange:t=>le(t.target.value)}),e.jsx(C,{variant:"contained",sx:{bgcolor:a,"&:hover":{bgcolor:"#c62828"}},onClick:$e,children:"Add"})]}),e.jsx(d,{sx:{mb:2},children:re.map((t,s)=>e.jsx(y,{label:t,onDelete:()=>Be(s),sx:{mr:1,mb:1,bgcolor:a,color:"white"}},s))}),e.jsx(S,{container:!0,spacing:2,children:R.map((t,s)=>e.jsx(S,{item:!0,xs:6,sm:4,md:3,children:e.jsxs(d,{sx:{position:"relative"},children:[e.jsx("video",{src:t.preview,controls:!0,style:{width:"100%",height:150,borderRadius:8}}),e.jsx(u,{size:"small",onClick:()=>ze(s),sx:{position:"absolute",top:4,right:4,bgcolor:a,color:"white"},children:e.jsx(E,{})})]})},s))}),e.jsx(C,{fullWidth:!0,variant:"contained",sx:{mt:4,bgcolor:a,"&:hover":{bgcolor:"#c62828"}},onClick:()=>he(Y,ee,se,R,re,Z,te,U,A,F,!0),children:"Add Video"})]}),e.jsxs(k,{children:[e.jsx(v,{variant:"h6",sx:{color:a},children:"Video List"}),e.jsx(ye,{component:je,children:e.jsxs(Ce,{children:[e.jsx(we,{sx:{bgcolor:"#ffebee"},children:e.jsxs(j,{children:[e.jsx(l,{children:"SI"}),e.jsx(l,{children:"Title"}),e.jsx(l,{children:"Preview"}),e.jsx(l,{children:"Count"}),e.jsx(l,{children:"Tags"}),e.jsx(l,{children:"Actions"})]})}),e.jsx(Te,{children:ae.length===0?e.jsx(j,{children:e.jsx(l,{colSpan:6,align:"center",children:"No videos"})}):ae.map((t,s)=>e.jsxs(j,{children:[e.jsx(l,{children:s+1}),e.jsx(l,{children:t.title}),e.jsx(l,{children:e.jsx(d,{sx:{display:"flex",gap:1},children:t.media.slice(0,3).map((r,o)=>e.jsx(d,{onClick:()=>ne(t.media,o,!0),sx:{width:80,height:60,borderRadius:2,cursor:"pointer",background:a,color:"white",display:"flex",alignItems:"center",justifyContent:"center"},children:r.type==="videoLink"?e.jsx(et,{}):e.jsx(tt,{})},o))})}),e.jsx(l,{children:t.media.length}),e.jsx(l,{children:t.tags.map((r,o)=>e.jsx(y,{size:"small",label:r,sx:{mr:.5,bgcolor:a,color:"white"}},o))}),e.jsx(l,{children:e.jsx(u,{onClick:()=>xe(t.id),sx:{color:a},children:e.jsx(ke,{})})})]},t.id))})]})})]})]})]}),e.jsx(Xe,{open:De,onClose:ce,maxWidth:"lg",fullWidth:!0,children:e.jsxs(Ye,{sx:{bgcolor:"black",position:"relative",minHeight:"80vh",p:0},children:[e.jsx(u,{onClick:ce,sx:{position:"absolute",top:10,right:10,color:a},children:e.jsx(E,{fontSize:"large"})}),Pe?e.jsx("iframe",{src:b[B],style:{width:"100%",height:"75vh",border:"none"},allow:"autoplay; fullscreen",allowFullScreen:!0}):e.jsx("img",{src:b[B],style:{maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",display:"block",margin:"auto"}}),b.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(u,{onClick:Me,sx:{position:"absolute",top:"50%",left:10,color:a,bgcolor:"rgba(255,255,255,0.1)"},children:e.jsx(st,{fontSize:"large"})}),e.jsx(u,{onClick:We,sx:{position:"absolute",top:"50%",right:10,color:a,bgcolor:"rgba(255,255,255,0.1)"},children:e.jsx(ot,{fontSize:"large"})})]})]})})]})}export{xt as default};
