import{w as Ke,r,j as e,B as d,t as ye,b as S,ak as qe,T as b,x as Ce,ad as F,s as m,S as k,F as q,I as Q,ag as X,$ as T,C as Qe,a7 as Xe,a9 as Ye,O as Ze,g as Y,f as ve,al as Se,ar as Ae,h as C}from"./index-DaDWjzIh.js";import{A as ke}from"./Add-3CEcNeq1.js";import{C as Z}from"./Close-CZXdZGG0.js";import{C as Ie}from"./CloudUpload-D8AKtMKQ.js";const g="#E91E63",v="https://api.bookmyevent.ae",we="68e5fc09651cc12c1fc0f9c9",et=({variation:D,onChange:W,onDelete:y})=>e.jsxs(k,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"center",sx:{mb:2},children:[e.jsx(m,{label:"Variation Name (e.g. Half Kg)",value:D.name||"",onChange:u=>W("name",u.target.value),sx:{flex:1}}),e.jsx(m,{label:"Price (₹)",type:"number",value:D.price||"",onChange:u=>W("price",u.target.value),sx:{width:150}}),e.jsx(S,{onClick:y,color:"error",children:e.jsx(Ae,{})})]}),rt=()=>{const D=Ke(),y=new URLSearchParams(window.location.search).get("id"),u=!!y,[ee,I]=r.useState([{id:Date.now(),name:"",price:"",isActive:!0}]),[Ee,te]=r.useState(!0),[ae,se]=r.useState(!1),[ie,L]=r.useState(""),[re,x]=r.useState(""),[Te,De]=r.useState([]),[ne,N]=r.useState([]),[Ne,Pe]=r.useState(!0),[p,_e]=r.useState(null),[R,oe]=r.useState(""),[le,ce]=r.useState(""),[P,z]=r.useState(""),[_,U]=r.useState([]),[de,ge]=r.useState("Eggless"),[M,he]=r.useState(""),[O,pe]=r.useState(""),[V,ue]=r.useState(""),[G,me]=r.useState(!0),[xe,B]=r.useState([{id:Date.now(),name:"",price:""}]),[j,fe]=r.useState(null),[J,Be]=r.useState(""),[$,be]=r.useState([]),[H,je]=r.useState([]);r.useEffect(()=>{try{const t=localStorage.getItem("vendor")||localStorage.getItem("user")||localStorage.getItem("vendorData");t&&_e(JSON.parse(t))}catch(t){console.error("Vendor load error:",t)}},[]),r.useEffect(()=>{(async()=>{var a;try{const s=localStorage.getItem("token"),c=((a=(await C.get(`${v}/api/categories/parents/${we}`,{headers:{Authorization:`Bearer ${s}`}})).data)==null?void 0:a.data)||[];De(c),console.log("✅ Parent Categories Loaded:",c)}catch(s){console.error("❌ Failed to load parent categories:",s),x("Failed to load categories")}finally{Pe(!1)}})()},[]);const $e=async t=>{var s;const a=t.target.value;if(z(a),U([]),N([]),!!a)try{const l=localStorage.getItem("token"),f=((s=(await C.get(`${v}/api/categories/parents/${a}/subcategories`,{headers:{Authorization:`Bearer ${l}`}})).data)==null?void 0:s.data)||[];N(f),console.log("✅ Subcategories Loaded:",f)}catch(l){console.error("❌ Failed to load subcategories:",l),N([])}};r.useEffect(()=>{if(!u){te(!1);return}(async()=>{var a,s,l,c,f,w,A,E,i;try{const{data:n}=await C.get(`${v}/api/cakes/${y}`),o=n.data;if(oe(o.name),ce(o.shortDescription),(s=(a=o.category)==null?void 0:a.parentCategory)!=null&&s._id){const h=o.category.parentCategory._id;z(h);const Je=localStorage.getItem("token"),He=await C.get(`${v}/api/categories/parents/${h}/subcategories`,{headers:{Authorization:`Bearer ${Je}`}});N(((l=He.data)==null?void 0:l.data)||[]),U([o.category._id])}else(c=o.category)!=null&&c._id&&z(o.category._id);ge(o.itemType),he(((f=o.nutrition)==null?void 0:f.join(", "))||""),pe(((w=o.allergenIngredients)==null?void 0:w.join(", "))||""),ue(((A=o.searchTags)==null?void 0:A.join(", "))||""),me(o.isActive),((E=o.variations)==null?void 0:E.length)>0&&B(o.variations.map(h=>({id:h._id||Date.now(),name:h.name,price:h.price}))),o.addons&&o.addons.length>0?I(o.addons.map(h=>({id:h._id||Date.now(),name:h.name,price:h.price,isActive:h.isActive!==!1}))):I([{id:Date.now(),name:"",price:"",isActive:!0}]),o.thumbnail&&Be(o.thumbnail),((i=o.images)==null?void 0:i.length)>0&&je(o.images)}catch(n){console.error("Failed to load cake:",n),x("Failed to load cake details")}finally{te(!1)}})()},[u,y]);const Fe=()=>{B(t=>[...t,{id:Date.now(),name:"",price:""}])},We=(t,a,s)=>{B(l=>l.map(c=>c.id===t?{...c,[a]:s}:c))},Le=t=>{B(a=>a.filter(s=>s.id!==t))},Re=t=>{const a=t.target.files[0];a&&fe(a)},ze=()=>{I(t=>[...t,{id:Date.now(),name:"",price:"",isActive:!0}])},K=(t,a,s)=>{I(l=>l.map(c=>c.id===t?{...c,[a]:s}:c))},Ue=t=>{I(a=>a.filter(s=>s.id!==t))},Me=t=>{const a=Array.from(t.target.files);if($.length+H.length+a.length>10){alert("Maximum 10 gallery images allowed");return}be(l=>[...l,...a])},Oe=t=>be(a=>a.filter((s,l)=>l!==t)),Ve=t=>je(a=>a.filter((s,l)=>l!==t)),Ge=async()=>{var c,f,w,A,E;const t=(p==null?void 0:p._id)||(p==null?void 0:p.id);if(!t){x("Vendor not authenticated");return}if(!R.trim()){x("Cake name is required");return}if(!P){x("Select a category");return}if(!j&&!J){x("Thumbnail image is required");return}const a=new FormData;if(a.append("name",R),a.append("shortDescription",le),a.append("module",we),a.append("category",P),a.append("itemType",de),a.append("isActive",G),a.append("provider",t),_.length>0&&a.append("subCategories",JSON.stringify(_)),M.trim()){const i=M.split(",").map(n=>n.trim()).filter(Boolean);a.append("nutrition",JSON.stringify(i))}if(O.trim()){const i=O.split(",").map(n=>n.trim()).filter(Boolean);a.append("allergenIngredients",JSON.stringify(i))}if(V.trim()){const i=V.split(",").map(n=>n.trim()).filter(Boolean);a.append("searchTags",JSON.stringify(i))}const s=ee.filter(i=>i.name&&i.price).map(({name:i,price:n,isActive:o})=>({name:i,price:Number(n),isActive:o}));Array.isArray(s)&&s.length>0&&a.append("addons",JSON.stringify(s));const l=xe.filter(i=>i.name&&i.price).map(({name:i,price:n})=>({name:i,price:Number(n)}));l.length>0&&a.append("variations",JSON.stringify(l)),j&&a.append("thumbnail",j),$.forEach(i=>{a.append("images",i)});try{se(!0),x(""),L("");let i;if(u?(i=await C.put(`${v}/api/cakes/${y}`,a,{headers:{"Content-Type":"multipart/form-data"}}),L("Cake updated successfully!")):(i=await C.post(`${v}/api/cakes`,a,{headers:{"Content-Type":"multipart/form-data"}}),L("Cake created successfully!")),i.data.success&&i.data.data){const n=i.data.data;console.log("✅ Cake Package Created/Updated:",{id:n._id,name:n.name,cakeId:n.cakeId,category:(c=n.category)==null?void 0:c.title,provider:(f=n.provider)==null?void 0:f.storeName,thumbnail:n.thumbnail,priceInfo:n.priceInfo,variations:n.variations,module:(w=n.module)==null?void 0:w.title})}}catch(i){console.error("Submit error:",i),x(((E=(A=i.response)==null?void 0:A.data)==null?void 0:E.message)||"Error saving cake")}finally{se(!1),window.scrollTo({top:0,behavior:"smooth"})}};return Ee||Ne?e.jsx(d,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:e.jsx(ye,{size:60,sx:{color:g}})}):e.jsxs(d,{sx:{bgcolor:"#f9f9fc",minHeight:"100vh"},children:[e.jsxs(d,{sx:{bgcolor:"white",borderBottom:"1px solid #eee",p:2,px:4,position:"sticky",top:0,zIndex:10},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(S,{onClick:()=>D(-1),children:e.jsx(qe,{})}),e.jsxs(b,{variant:"h5",fontWeight:"bold",children:[u?"Edit":"Add"," Cake Package"]})]}),p&&e.jsxs(b,{variant:"body2",color:"text.secondary",sx:{ml:7},children:["Creating as: ",p.firstName," ",p.lastName]})]}),e.jsxs(d,{sx:{p:{xs:2,md:4}},children:[ie&&e.jsx(Ce,{severity:"success",sx:{mb:3},children:ie}),re&&e.jsx(Ce,{severity:"error",sx:{mb:3},children:re}),e.jsxs(F,{elevation:3,sx:{borderRadius:3,p:{xs:3,md:6}},children:[e.jsx(m,{fullWidth:!0,label:"Cake Name *",value:R,onChange:t=>oe(t.target.value),sx:{mb:3}}),e.jsx(m,{fullWidth:!0,label:"Short Description *",multiline:!0,rows:2,value:le,onChange:t=>ce(t.target.value),sx:{mb:3}}),e.jsxs(k,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsxs(q,{fullWidth:!0,children:[e.jsx(Q,{children:"Parent Category *"}),e.jsxs(X,{value:P,onChange:$e,children:[e.jsx(T,{value:"",children:"Select Parent Category"}),Te.map(t=>e.jsx(T,{value:t._id,children:t.title},t._id))]})]}),e.jsxs(q,{fullWidth:!0,disabled:!P,children:[e.jsx(Q,{children:"Sub Categories"}),e.jsx(X,{multiple:!0,value:_,onChange:t=>U(t.target.value),input:e.jsx(Ze,{}),renderValue:t=>e.jsx(d,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(a=>{const s=ne.find(l=>l._id===a);return e.jsx(Ye,{label:(s==null?void 0:s.title)||a,size:"small"},a)})}),children:ne.map(t=>e.jsxs(T,{value:t._id,children:[e.jsx(Qe,{checked:_.includes(t._id)}),e.jsx(Xe,{primary:t.title})]},t._id))})]})]}),e.jsx(k,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3,alignItems:"center"},children:e.jsxs(q,{fullWidth:!0,children:[e.jsx(Q,{children:"Item Type"}),e.jsxs(X,{value:de,onChange:t=>ge(t.target.value),children:[e.jsx(T,{value:"Eggless",children:"Eggless"}),e.jsx(T,{value:"Egg",children:"Egg"})]})]})}),e.jsxs(k,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsx(m,{fullWidth:!0,label:"Nutrition (comma separated)",placeholder:"e.g. Sugar, Milk, Flour",value:M,onChange:t=>he(t.target.value)}),e.jsx(m,{fullWidth:!0,label:"Allergen Ingredients (comma separated)",placeholder:"e.g. Nuts, Gluten",value:O,onChange:t=>pe(t.target.value)})]}),e.jsxs(d,{sx:{mb:4},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(b,{variant:"h6",sx:{color:g},children:"Variations (Size/Weight)"}),e.jsx(Y,{variant:"contained",startIcon:e.jsx(ke,{}),sx:{bgcolor:g,"&:hover":{bgcolor:"#c2185b"}},onClick:Fe,children:"Add Variation"})]}),xe.map(t=>e.jsx(et,{variation:t,onChange:(a,s)=>We(t.id,a,s),onDelete:()=>Le(t.id)},t.id))]}),e.jsxs(d,{sx:{mb:4},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(b,{variant:"h6",sx:{color:g},children:"Cake Add-ons"}),e.jsx(Y,{variant:"outlined",startIcon:e.jsx(ke,{}),onClick:ze,sx:{borderColor:g,color:g},children:"Add Add-on"})]}),ee.map(t=>e.jsx(F,{sx:{p:2,mb:2,border:"1px solid #eee",borderRadius:2},children:e.jsxs(k,{direction:{xs:"column",md:"row"},spacing:2,alignItems:"center",children:[e.jsx(m,{label:"Add-on Name",placeholder:"e.g. Birthday Candles",value:t.name,onChange:a=>K(t.id,"name",a.target.value),fullWidth:!0}),e.jsx(m,{label:"Price (₹)",type:"number",value:t.price,onChange:a=>K(t.id,"price",a.target.value),sx:{width:160}}),e.jsx(ve,{control:e.jsx(Se,{checked:t.isActive,onChange:a=>K(t.id,"isActive",a.target.checked),sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:g}}}),label:"Active"}),e.jsx(S,{color:"error",onClick:()=>Ue(t.id),children:e.jsx(Ae,{})})]})},t.id))]}),e.jsx(m,{fullWidth:!0,label:"Search Tags (comma separated)",placeholder:"e.g. chocolate, birthday, wedding",value:V,onChange:t=>ue(t.target.value),sx:{mb:4}}),e.jsx(k,{direction:"row",spacing:4,sx:{mb:4},children:e.jsx(ve,{control:e.jsx(Se,{checked:G,onChange:()=>me(!G),sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:g}}}),label:"Active"})}),e.jsx(b,{variant:"h6",sx:{color:g,mb:2},children:"Thumbnail Image *"}),e.jsxs(F,{onClick:()=>document.getElementById("thumbnail-input").click(),sx:{border:"2px dashed #ddd",borderRadius:2,p:4,textAlign:"center",cursor:"pointer",mb:4},children:[e.jsx("input",{id:"thumbnail-input",type:"file",hidden:!0,accept:"image/*",onChange:Re}),j||J?e.jsxs(d,{sx:{position:"relative",display:"inline-block"},children:[e.jsx("img",{src:j?URL.createObjectURL(j):J,alt:"Thumbnail",style:{width:200,height:200,objectFit:"cover",borderRadius:8}}),j&&e.jsx(S,{onClick:t=>{t.stopPropagation(),fe(null)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(Z,{})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{sx:{fontSize:60,color:"#ccc"}}),e.jsx(b,{sx:{mt:2,color:g,fontWeight:"bold"},children:"Click to Upload Thumbnail"})]})]}),e.jsx(b,{variant:"h6",sx:{color:g,mb:2},children:"Gallery Images (Max 10)"}),e.jsxs(F,{onClick:()=>document.getElementById("gallery-input").click(),sx:{border:"2px dashed #ddd",borderRadius:2,p:4,textAlign:"center",cursor:"pointer",mb:4},children:[e.jsx("input",{id:"gallery-input",type:"file",hidden:!0,multiple:!0,accept:"image/*",onChange:Me}),$.length>0||H.length>0?e.jsxs(d,{sx:{display:"flex",flexWrap:"wrap",gap:2,justifyContent:"center"},children:[H.map((t,a)=>e.jsxs(d,{sx:{position:"relative"},children:[e.jsx("img",{src:t,alt:"",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(S,{onClick:s=>{s.stopPropagation(),Ve(a)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(Z,{fontSize:"small"})})]},`ex-${a}`)),$.map((t,a)=>e.jsxs(d,{sx:{position:"relative"},children:[e.jsx("img",{src:URL.createObjectURL(t),alt:"",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(S,{onClick:s=>{s.stopPropagation(),Oe(a)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(Z,{fontSize:"small"})})]},`new-${a}`))]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{sx:{fontSize:60,color:"#ccc"}}),e.jsx(b,{sx:{mt:2,color:g,fontWeight:"bold"},children:"Click to Upload Gallery Images"})]})]}),e.jsx(Y,{fullWidth:!0,variant:"contained",size:"large",onClick:Ge,disabled:ae||!p,sx:{py:2,bgcolor:g,"&:hover":{bgcolor:"#c2185b"}},children:ae?e.jsx(ye,{size:28,color:"inherit"}):u?"Update Cake Package":"Create Cake Package"})]})]})]})};export{rt as default};
