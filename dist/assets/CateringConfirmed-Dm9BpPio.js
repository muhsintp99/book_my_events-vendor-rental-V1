import{r as d,j as e,B as g,s as A,v as E,T as n,a7 as I,S as N,q as W,f as b,ag as S,g as B}from"./index-DGIydyV2.js";import{T as _}from"./TableContainer-j5SqZxhh.js";import{T as z,a as G,b as y,c as s,d as H}from"./TableRow-BvOv-VL8.js";const R=()=>{try{const l=localStorage.getItem("user");if(!l)return null;const c=JSON.parse(l);return(c==null?void 0:c._id)||null}catch{return null}},$=()=>{const[l,c]=d.useState([]),[h,w]=d.useState(""),[T,j]=d.useState(!0),[C,f]=d.useState(null),m=R();d.useEffect(()=>{if(!m){f("No provider ID found. Please login again."),j(!1);return}(async()=>{var t,o,a;try{j(!0);const D=(((t=(await B.get(`https://api.bookmyevent.ae/api/bookings/provider/${m}`)).data)==null?void 0:t.data)||[]).filter(v=>{const p=String(v.status||"").toLowerCase().trim(),L=p==="confirmed"||p==="accepted"||p==="approved",P=String(v.moduleType||"").toLowerCase().trim()==="catering";return L&&P});c(D),f(null)}catch(i){console.error("Error loading catering confirmed bookings:",i),f(((a=(o=i.response)==null?void 0:o.data)==null?void 0:a.message)||"Failed to load bookings")}finally{j(!1)}})()},[m]);const x=d.useMemo(()=>{if(!h.trim())return l;const r=h.toLowerCase();return l.filter(t=>{var o,a,i,u;return((o=t._id)==null?void 0:o.toLowerCase().includes(r))||((a=t.fullName)==null?void 0:a.toLowerCase().includes(r))||((i=t.emailAddress)==null?void 0:i.toLowerCase().includes(r))||((u=t.contactNumber)==null?void 0:u.includes(h))})},[h,l]),k=async(r,t)=>{var o,a;if(t.stopPropagation(),!!window.confirm("Are you sure you want to delete this booking?"))try{await B.delete(`https://api.bookmyevent.ae/api/bookings/${r}`),c(i=>i.filter(u=>u._id!==r)),alert("Booking deleted successfully")}catch(i){alert(((a=(o=i.response)==null?void 0:o.data)==null?void 0:a.message)||"Delete failed")}};return T?e.jsx(g,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:e.jsx(A,{})}):C?e.jsx(g,{p:2,children:e.jsx(E,{severity:"error",children:C})}):e.jsxs(g,{p:2,children:[e.jsx(n,{variant:"h4",gutterBottom:!0,fontWeight:600,children:"Confirmed Catering Bookings"}),e.jsxs(I,{sx:{mt:2},children:[e.jsxs(N,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"space-between",alignItems:"center",p:2,children:[e.jsx(W,{label:"Search by Booking ID, Name, Email, or Phone",value:h,onChange:r=>w(r.target.value),size:"small",sx:{minWidth:350},placeholder:"Type to search..."}),e.jsx(b,{variant:"contained",color:"primary",children:"Export Data"})]}),e.jsx(_,{children:e.jsxs(z,{stickyHeader:!0,children:[e.jsx(G,{children:e.jsxs(y,{children:[e.jsx(s,{children:e.jsx("strong",{children:"S#"})}),e.jsx(s,{children:e.jsx("strong",{children:"Booking ID"})}),e.jsx(s,{children:e.jsx("strong",{children:"Module"})}),e.jsx(s,{children:e.jsx("strong",{children:"Customer"})}),e.jsx(s,{children:e.jsx("strong",{children:"Email"})}),e.jsx(s,{children:e.jsx("strong",{children:"Guests"})}),e.jsx(s,{children:e.jsx("strong",{children:"Booking Date"})}),e.jsx(s,{children:e.jsx("strong",{children:"Amount"})}),e.jsx(s,{children:e.jsx("strong",{children:"Payment Status"})}),e.jsx(s,{children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(H,{children:x.length>0?x.map((r,t)=>e.jsxs(y,{hover:!0,sx:{"&:hover":{bgcolor:"#f5f5f5"}},children:[e.jsx(s,{children:t+1}),e.jsx(s,{children:e.jsxs(n,{variant:"body2",fontWeight:600,color:"primary",children:["#",r._id.slice(-8).toUpperCase()]})}),e.jsx(s,{children:e.jsx(S,{label:"Catering",size:"small",sx:{bgcolor:"#fef3c7",color:"#92400e",fontWeight:600}})}),e.jsxs(s,{children:[e.jsx(n,{variant:"body2",children:r.fullName||"-"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:r.contactNumber||"-"})]}),e.jsx(s,{children:e.jsx(n,{variant:"body2",sx:{wordBreak:"break-word"},children:r.emailAddress||"-"})}),e.jsx(s,{children:e.jsx(n,{variant:"body2",children:r.numberOfGuests||r.guests||"-"})}),e.jsxs(s,{children:[e.jsx(n,{variant:"body2",children:r.bookingDate?new Date(r.bookingDate).toLocaleDateString("en-GB"):"-"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:r.timeSlot||""})]}),e.jsx(s,{children:e.jsxs(n,{variant:"body2",fontWeight:700,color:"success.main",children:["₹",(r.finalPrice||r.totalAmount||0).toLocaleString()]})}),e.jsx(s,{children:e.jsx(S,{label:"Confirmed",size:"small",sx:{bgcolor:"#dcfce7",color:"#16a34a",fontWeight:600}})}),e.jsx(s,{children:e.jsx(b,{variant:"outlined",size:"small",color:"error",onClick:o=>k(r._id,o),children:"Delete"})})]},r._id)):e.jsx(y,{children:e.jsx(s,{colSpan:10,align:"center",children:e.jsx(n,{variant:"h6",color:"text.secondary",children:"No Confirmed Catering Bookings"})})})})]})}),x.length>0&&e.jsxs(g,{p:2,bgcolor:"#f9fafb",borderTop:"1px solid #e5e7eb",display:"flex",justifyContent:"space-between",children:[e.jsxs(n,{fontWeight:600,children:["Total Bookings: ",x.length]}),e.jsxs(n,{fontWeight:600,color:"success.main",children:["Total Revenue: ₹",x.reduce((r,t)=>r+(t.finalPrice||t.totalAmount||0),0).toLocaleString()]})]})]})]})};export{$ as default};
