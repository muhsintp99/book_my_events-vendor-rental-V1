import{r as o,j as e,B as p,t as I,T as a,a5 as y,G as j,p as E,K as R,af as k,D as _,S as W,g as b,ai as G,h as f}from"./index-OVaJuQpY.js";import{C as S}from"./CheckCircle-CGeFBz3l.js";import{W as J}from"./WorkspacePremium-gqv8nmv3.js";const U=120,v=3;function q(){var w;const[A,T]=o.useState([]),[D,L]=o.useState(!0),[N,P]=o.useState(null),[z,F]=o.useState(null),[H,B]=o.useState(null),[h,c]=o.useState({open:!1,message:""}),[l,C]=o.useState(null),[M,g]=o.useState(!0),m=localStorage.getItem("moduleId"),x=JSON.parse(localStorage.getItem("user")),u=x==null?void 0:x._id;o.useEffect(()=>{const r=new URLSearchParams(window.location.search).get("order_id");if(!r)return;(async()=>{try{if(c({open:!0,message:"Verifying payment, please wait..."}),(await f.post("https://api.bookmyevent.ae/api/subscription/verify",{orderId:r})).data.success){c({open:!0,message:"ðŸŽ‰ Premium Plan Activated Successfully!"}),g(!0);const t=await f.get(`https://api.bookmyevent.ae/api/subscription/status/${u}`);t.data.success&&C(t.data.subscription),window.history.replaceState({},document.title,window.location.pathname)}}catch{c({open:!0,message:"Payment verification failed"})}finally{g(!1),localStorage.removeItem("pendingUpgrade")}})()},[u]),o.useEffect(()=>{(async()=>{var r;if(!u||!m){g(!1);return}try{const i=await f.get(`https://api.bookmyevent.ae/api/subscription/status/${u}`);if(i.data.success&&i.data.subscription){const n=i.data.subscription;((r=n.moduleId)==null?void 0:r._id)===m&&n.status==="active"&&C(n)}}catch{console.log("No active subscription found")}finally{g(!1)}})()},[u,m]),o.useEffect(()=>{m&&(async()=>{try{const r=await f.get(`https://api.bookmyevent.ae/api/subscription/plan/module/${m}`);T(r.data.plans||[])}catch{c({open:!0,message:"Failed to load plans"})}finally{L(!1)}})()},[m]);const $=async s=>{var r,i,n,t;if(!u||!m){c({open:!0,message:"User or module missing"});return}try{P(s._id),console.log("ðŸš€ Creating payment session..."),console.log("Plan:",s.name,"Price:",s.price);const d=await f.post("https://api.bookmyevent.ae/api/payment/create-subscription-payment",{providerId:u,planId:s._id,amount:s.price,customerEmail:x.email,customerPhone:x.mobile||x.phone||"9999999999"});if(console.log("âœ… Payment response:",d.data),(i=(r=d.data)==null?void 0:r.payment_links)!=null&&i.web)localStorage.setItem("pendingUpgrade",JSON.stringify({userId:u,moduleId:m,planId:s._id,planName:s.name,amount:s.price})),c({open:!0,message:"Redirecting to payment page..."}),setTimeout(()=>{window.location.href=d.data.payment_links.web},1e3);else throw new Error("Payment link not available")}catch(d){console.error("âŒ Payment error:",d),c({open:!0,message:((t=(n=d.response)==null?void 0:n.data)==null?void 0:t.message)||d.message||"Payment initiation failed"}),P(null)}};if(D||M)return e.jsx(p,{sx:{minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(I,{sx:{color:"#c62828"}})});const O=s=>{var r;return((r=l==null?void 0:l.planId)==null?void 0:r._id)===s};return e.jsxs(p,{sx:{minHeight:"100vh",bgcolor:"#f9fafc",py:6},children:[e.jsxs(p,{maxWidth:"md",mx:"auto",px:2,children:[e.jsx(a,{variant:"h4",fontWeight:800,textAlign:"center",children:l?"Manage Your Plan":"Upgrade Your Plan"}),e.jsx(a,{textAlign:"center",color:"text.secondary",mb:3,children:"Choose the best plan for your business"}),l?e.jsxs(y,{severity:"success",sx:{mb:4,border:"1px solid #4caf50"},children:["Current Plan: ",e.jsx("b",{children:((w=l.planId)==null?void 0:w.name)||"PREMIUM"})," - ","Expires on: ",e.jsx("b",{children:new Date(l.endDate).toLocaleDateString()})]}):e.jsxs(y,{severity:"info",sx:{mb:4,border:"1px solid #2196f3"},children:["Current Plan: ",e.jsx("b",{children:"FREE"})," - Upgrade to unlock premium features"]}),e.jsxs(j,{container:!0,spacing:3,justifyContent:"center",children:[!l&&e.jsx(j,{item:!0,xs:12,md:6,children:e.jsx(E,{sx:{height:"100%",borderRadius:4,border:"2px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:e.jsxs(R,{children:[e.jsx(k,{label:"CURRENT PLAN",sx:{bgcolor:"#9e9e9e",color:"#fff",mb:2}}),e.jsx(a,{variant:"h6",fontWeight:800,children:"FREE"}),e.jsx(a,{color:"text.secondary",sx:{minHeight:48},children:"Basic access to get started on the platform"}),e.jsx(a,{variant:"h4",fontWeight:900,color:"#9e9e9e",mt:2,children:"â‚¹0"}),e.jsx(_,{sx:{my:2}}),e.jsx(W,{spacing:1,children:["Limited listings","Basic visibility","Standard support"].map(s=>e.jsxs(p,{display:"flex",alignItems:"center",children:[e.jsx(S,{sx:{color:"#9e9e9e",mr:1,fontSize:20}}),e.jsx(a,{variant:"body2",children:s})]},s))}),e.jsx(b,{fullWidth:!0,disabled:!0,sx:{mt:3,bgcolor:"#e0e0e0",color:"#757575",fontWeight:700,borderRadius:2,textTransform:"none"},children:"Current Plan"})]})})}),A.map(s=>{const r=z===s._id,i=H===s._id,n=N===s._id,t=O(s._id);return e.jsx(j,{item:!0,xs:12,md:6,children:e.jsx(E,{sx:{height:"100%",borderRadius:4,border:t?"3px solid #4caf50":"3px solid #c62828",boxShadow:t?"0 4px 20px rgba(76, 175, 80, 0.2)":"0 4px 20px rgba(198, 40, 40, 0.2)",position:"relative",overflow:"visible"},children:e.jsxs(R,{children:[e.jsx(k,{icon:t?e.jsx(S,{}):e.jsx(J,{}),label:t?"CURRENT PLAN":"BEST VALUE",sx:{bgcolor:t?"#4caf50":"#c62828",color:"#fff",mb:2,fontWeight:700}}),e.jsx(a,{variant:"h6",fontWeight:800,color:t?"#4caf50":"#c62828",children:s.name}),s.description&&s.description.length>U?e.jsxs(a,{color:"text.secondary",sx:{minHeight:48},children:[r?s.description:`${s.description.slice(0,U)}...`,e.jsx(b,{size:"small",onClick:()=>F(r?null:s._id),sx:{textTransform:"none",fontWeight:600,color:t?"#4caf50":"#c62828",p:0,minWidth:"auto",ml:.5},children:r?"Read less":"Read more"})]}):e.jsx(a,{color:"text.secondary",sx:{minHeight:48},children:s.description}),e.jsxs(a,{variant:"h4",fontWeight:900,color:t?"#4caf50":"#c62828",mt:2,children:["â‚¹",s.price,e.jsx(a,{component:"span",sx:{fontSize:14,fontWeight:400,color:"text.secondary",ml:1},children:"/ year"})]}),e.jsx(_,{sx:{my:2}}),e.jsx(W,{spacing:1,children:(i?s.features:s.features.slice(0,v)).map((d,Y)=>e.jsxs(p,{display:"flex",alignItems:"flex-start",children:[e.jsx(S,{sx:{color:t?"#4caf50":"#c62828",mr:1,mt:.3,fontSize:20}}),e.jsx(a,{variant:"body2",children:d})]},Y))}),s.features.length>v&&e.jsx(b,{size:"small",onClick:()=>B(i?null:s._id),sx:{mt:1,textTransform:"none",fontWeight:600,color:t?"#4caf50":"#c62828",p:0},children:i?"Show less":`+${s.features.length-v} more features`}),e.jsx(b,{fullWidth:!0,disabled:n||t,onClick:()=>$(s),sx:{mt:3,bgcolor:t?"#e0e0e0":"#c62828",color:t?"#757575":"#fff",fontWeight:800,borderRadius:2,py:1.5,textTransform:"none",fontSize:16,"&:hover":{bgcolor:t?"#e0e0e0":"#b71c1c"},"&:disabled":{bgcolor:"#e0e0e0"}},children:t?"Current Plan":n?e.jsxs(p,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(I,{size:20,sx:{color:"#fff"}}),"Redirecting..."]}):l?"Switch Plan":"Upgrade To Premium"})]})})},s._id)})]}),e.jsx(p,{sx:{mt:4,p:2,bgcolor:"#fff3e0",borderRadius:2,border:"1px solid #ffb74d"},children:e.jsxs(a,{variant:"body2",color:"text.secondary",textAlign:"center",children:["ðŸ’¡ ",e.jsx("strong",{children:"Note:"}),` After clicking "Upgrade To Premium", you'll be redirected to a secure payment page. Your subscription will be activated immediately after successful payment.`]})})]}),e.jsx(G,{open:h.open,autoHideDuration:4e3,onClose:()=>c({open:!1,message:""}),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(y,{onClose:()=>c({open:!1,message:""}),severity:h.message.includes("Failed")||h.message.includes("failed")?"error":"info",sx:{width:"100%"},children:h.message})})]})}export{q as default};
