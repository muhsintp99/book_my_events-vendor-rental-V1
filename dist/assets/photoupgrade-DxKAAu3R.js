import{r as l,j as e,B as f,t as U,T as i,x as E,G as R,p as M,W as T,a9 as A,D as L,S as $,g as w,ao as ee,h as P}from"./index-JeqeEWAc.js";import{C as k}from"./CheckCircle-CdK5FAyB.js";import{W as se}from"./WorkspacePremium-NUG3_qGA.js";const N=120,_=3,y="https://api.bookmyevent.ae";function ne(){var D;const[z,F]=l.useState([]),[B,H]=l.useState(!0),[O,W]=l.useState(null),[J,V]=l.useState(null),[G,Y]=l.useState(null),[I,d]=l.useState({open:!1,message:"",severity:"info"}),[g,C]=l.useState(null),[X,S]=l.useState(!0),p=localStorage.getItem("moduleId"),h=JSON.parse(localStorage.getItem("user")||"{}"),u=h==null?void 0:h._id;l.useEffect(()=>{const n=new URLSearchParams(window.location.search).get("orderId");if(!n){S(!1);return}(async()=>{var m,o,a,s;try{d({open:!0,message:"Verifying payment...",severity:"info"});const r=await P.post(`${y}/api/payment/verify-subscription-payment`,{orderId:n});if(console.log("âœ… Verify response:",r.data),r.data.success){d({open:!0,message:"ðŸŽ‰ Premium Plan Activated!",severity:"success"});const v=typeof r.data.subscription.moduleId=="object"&&((m=r.data.subscription.moduleId)==null?void 0:m._id)||r.data.subscription.moduleId,b=await P.get(`${y}/api/subscription/status/${u}?moduleId=${v}`);if(console.log("âœ… Subscription response:",b.data),b.data.success&&b.data.subscription){const x=b.data.subscription,j=typeof x.moduleId=="object"&&((o=x.moduleId)==null?void 0:o._id)||x.moduleId;localStorage.setItem("moduleId",j);const Q=new Date(x.endDate),Z=Math.max(0,Math.ceil((Q-new Date)/(1e3*60*60*24)));localStorage.setItem("upgrade",JSON.stringify({isSubscribed:!0,status:"active",plan:x.planId,module:j,access:{canAccess:!0,isExpired:!1,daysLeft:Z}})),console.log("âœ… LocalStorage updated - moduleId:",j),C(x),window.history.replaceState({},"",window.location.pathname),setTimeout(()=>{window.location.replace("/makeupartist/portfolio")},2e3)}}else d({open:!0,message:r.data.message||"Payment verification failed",severity:"error"})}catch(r){console.error("âŒ Payment verification error:",r),d({open:!0,message:((s=(a=r.response)==null?void 0:a.data)==null?void 0:s.message)||"Payment verification failed",severity:"error"})}finally{S(!1)}})()},[u,p]),l.useEffect(()=>{if(new URLSearchParams(window.location.search).get("orderId"))return;const n=localStorage.getItem("moduleId");console.log("ðŸ” ========== SUBSCRIPTION CHECK DEBUG =========="),console.log("ðŸ” userId:",u),console.log("ðŸ” moduleId (component):",p),console.log("ðŸ” moduleId (fresh from localStorage):",n),console.log("ðŸ” upgrade localStorage:",localStorage.getItem("upgrade"));const c=o=>{var a;try{const s=JSON.parse(localStorage.getItem("upgrade")||"{}"),r=typeof(s==null?void 0:s.module)=="object"?(a=s==null?void 0:s.module)==null?void 0:a._id:s==null?void 0:s.module;if(console.log("ðŸ” Fallback check:"),console.log("  - upgrade.status:",s==null?void 0:s.status),console.log("  - upgrade.module (upgradeModuleId):",r),console.log("  - checkModuleId:",o),console.log("  - Match?",(s==null?void 0:s.status)==="active"&&r===o),(s==null?void 0:s.status)==="active"&&r===o)return console.log("âœ… Premium detected via localStorage!"),C({status:"active",isCurrent:!0,planId:s==null?void 0:s.plan,moduleId:r}),!0}catch(s){console.error("localStorage parse error:",s)}return!1};(async()=>{var a;const o=n||p;if(!u||!o){console.log("âš ï¸ Missing userId or moduleId, trying fallback..."),c(o),S(!1);return}try{console.log("ðŸ“¡ Calling API:",`${y}/api/subscription/status/${u}?moduleId=${o}`);const s=await P.get(`${y}/api/subscription/status/${u}?moduleId=${o}`);if(console.log("ðŸ“¡ API Response:",s.data),s.data.success&&s.data.subscription){const r=s.data.subscription;if(console.log("ðŸ“¡ Subscription object:",r),console.log("ðŸ“¡ sub.status:",r.status),console.log("ðŸ“¡ sub.isCurrent:",r.isCurrent),r.status==="active"&&r.isCurrent){console.log("âœ… Premium ACTIVE from API!");const v=typeof r.moduleId=="object"&&((a=r.moduleId)==null?void 0:a._id)||r.moduleId,b=new Date(r.endDate),j=Math.max(0,Math.ceil((b-new Date)/(1e3*60*60*24)));localStorage.setItem("upgrade",JSON.stringify({isSubscribed:!0,status:"active",plan:r.planId,module:v,access:{canAccess:!0,isExpired:!1,daysLeft:j}})),localStorage.setItem("moduleId",v),console.log("âœ… localStorage synced with API data"),C(r),S(!1);return}else console.log("âš ï¸ Subscription exists but not active/current:",r.status,r.isCurrent)}else console.log("âš ï¸ No subscription in API response or success=false"),console.log("âš ï¸ Full response:",JSON.stringify(s.data));console.log("ðŸ”„ Checking localStorage fallback..."),c(o)}catch(s){console.error("âŒ API error:",s.message),c(o)}finally{S(!1)}})()},[u,p]),l.useEffect(()=>{p&&(async()=>{try{const n=await P.get(`${y}/api/subscription/plan/module/${p}`);F(n.data.plans||[])}catch{d({open:!0,message:"Failed to load plans",severity:"error"})}finally{H(!1)}})()},[p]);const K=async t=>{var n,c,m,o;if(!u||!p){d({open:!0,message:"User or module missing",severity:"warning"});return}try{W(t._id),console.log("ðŸš€ Creating payment session..."),console.log("Plan:",t.name,"Price:",t.price);const a=await P.post(`${y}/api/payment/create-subscription-payment`,{providerId:u,planId:t._id,amount:t.price,customerEmail:h.email,customerPhone:h.mobile||h.phone||"9999999999"});if(console.log("âœ… Payment response:",a.data),(c=(n=a.data)==null?void 0:n.payment_links)!=null&&c.web)d({open:!0,message:"Redirecting to payment page...",severity:"info"}),setTimeout(()=>{window.location.href=a.data.payment_links.web},1e3);else throw new Error("Payment link not available")}catch(a){console.error("âŒ Payment error:",a),d({open:!0,message:((o=(m=a.response)==null?void 0:m.data)==null?void 0:o.message)||a.message||"Payment initiation failed",severity:"error"}),W(null)}};if(B||X)return e.jsx(f,{sx:{minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(U,{sx:{color:"#c62828"}})});const q=t=>{var n;return((n=g==null?void 0:g.planId)==null?void 0:n._id)===t};return e.jsxs(f,{sx:{minHeight:"100vh",bgcolor:"#f9fafc",py:6},children:[e.jsxs(f,{maxWidth:"md",mx:"auto",px:2,children:[e.jsx(i,{variant:"h4",fontWeight:800,textAlign:"center",children:g?"Manage Your Plan":"Upgrade Your Plan"}),e.jsx(i,{textAlign:"center",color:"text.secondary",mb:3,children:"Choose the best plan for your business"}),g?e.jsxs(E,{severity:"success",sx:{mb:4,border:"1px solid #4caf50"},children:["Current Plan: ",e.jsx("b",{children:((D=g.planId)==null?void 0:D.name)||"PREMIUM"})]}):e.jsxs(E,{severity:"info",sx:{mb:4,border:"1px solid #2196f3"},children:["Current Plan: ",e.jsx("b",{children:"FREE"})," - Upgrade to unlock premium features"]}),e.jsxs(R,{container:!0,spacing:3,justifyContent:"center",children:[!g&&e.jsx(R,{item:!0,xs:12,md:6,children:e.jsx(M,{sx:{height:"100%",borderRadius:4,border:"2px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:e.jsxs(T,{children:[e.jsx(A,{label:"CURRENT PLAN",sx:{bgcolor:"#9e9e9e",color:"#fff",mb:2}}),e.jsx(i,{variant:"h6",fontWeight:800,children:"FREE"}),e.jsx(i,{color:"text.secondary",sx:{minHeight:48},children:"Basic access to get started on the platform"}),e.jsx(i,{variant:"h4",fontWeight:900,color:"#9e9e9e",mt:2,children:"â‚¹0"}),e.jsx(L,{sx:{my:2}}),e.jsx($,{spacing:1,children:["Limited listings","Basic visibility","Standard support"].map(t=>e.jsxs(f,{display:"flex",alignItems:"center",children:[e.jsx(k,{sx:{color:"#9e9e9e",mr:1,fontSize:20}}),e.jsx(i,{variant:"body2",children:t})]},t))}),e.jsx(w,{fullWidth:!0,disabled:!0,sx:{mt:3,bgcolor:"#e0e0e0",color:"#757575",fontWeight:700,borderRadius:2,textTransform:"none"},children:"Current Plan"})]})})}),z.map(t=>{const n=J===t._id,c=G===t._id,m=O===t._id,o=q(t._id);return e.jsx(R,{item:!0,xs:12,md:6,children:e.jsx(M,{sx:{height:"100%",borderRadius:4,border:o?"3px solid #4caf50":"3px solid #c62828",boxShadow:o?"0 4px 20px rgba(76, 175, 80, 0.2)":"0 4px 20px rgba(198, 40, 40, 0.2)"},children:e.jsxs(T,{children:[e.jsx(A,{icon:o?e.jsx(k,{}):e.jsx(se,{}),label:o?"CURRENT PLAN":"BEST VALUE",sx:{bgcolor:o?"#4caf50":"#c62828",color:"#fff",mb:2,fontWeight:700}}),e.jsx(i,{variant:"h6",fontWeight:800,color:o?"#4caf50":"#c62828",children:t.name}),t.description&&t.description.length>N?e.jsxs(i,{color:"text.secondary",sx:{minHeight:48},children:[n?t.description:`${t.description.slice(0,N)}...`,e.jsx(w,{size:"small",onClick:()=>V(n?null:t._id),sx:{textTransform:"none",fontWeight:600,color:o?"#4caf50":"#c62828",p:0,minWidth:"auto",ml:.5},children:n?"Read less":"Read more"})]}):e.jsx(i,{color:"text.secondary",sx:{minHeight:48},children:t.description}),e.jsxs(f,{sx:{mt:2},children:[e.jsx(A,{label:"ðŸŽ‰ Pre-Launch Offer",sx:{bgcolor:"#fff3cd",color:"#b45309",fontWeight:700,mb:1}}),e.jsxs(f,{sx:{display:"flex",alignItems:"baseline",gap:2},children:[e.jsx(i,{sx:{textDecoration:"line-through",color:"#9ca3af",fontSize:18,fontWeight:600},children:"â‚¹20,000"}),e.jsxs(i,{sx:{fontSize:32,fontWeight:900,color:o?"#4caf50":"#c62828"},children:["â‚¹",t.price]}),e.jsx(i,{sx:{fontSize:14,color:"text.secondary"},children:"/ year"})]}),e.jsx(i,{sx:{fontSize:13,color:"#6b7280",mt:.5},children:"Limited time launch offer for early partners"})]}),e.jsx(L,{sx:{my:2}}),e.jsx($,{spacing:1,children:(c?t.features:t.features.slice(0,_)).map((a,s)=>e.jsxs(f,{display:"flex",alignItems:"flex-start",children:[e.jsx(k,{sx:{color:o?"#4caf50":"#c62828",mr:1,mt:.3,fontSize:20}}),e.jsx(i,{variant:"body2",children:a})]},s))}),t.features.length>_&&e.jsx(w,{size:"small",onClick:()=>Y(c?null:t._id),sx:{mt:1,textTransform:"none",fontWeight:600,color:o?"#4caf50":"#c62828",p:0},children:c?"Show less":`+${t.features.length-_} more features`}),e.jsx(w,{fullWidth:!0,disabled:m||o,onClick:()=>K(t),sx:{mt:3,bgcolor:o?"#e0e0e0":"#c62828",color:o?"#757575":"#fff",fontWeight:800,borderRadius:2,py:1.5,textTransform:"none",fontSize:16,"&:hover":{bgcolor:o?"#e0e0e0":"#b71c1c"},"&:disabled":{bgcolor:"#e0e0e0"}},children:o?"Current Plan":m?e.jsxs(f,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(U,{size:20,sx:{color:"#fff"}}),"Redirecting..."]}):g?"Switch Plan":"Upgrade To Premium"})]})})},t._id)})]}),e.jsx(f,{sx:{mt:4,p:2,bgcolor:"#fff3e0",borderRadius:2,border:"1px solid #ffb74d"},children:e.jsxs(i,{variant:"body2",color:"text.secondary",textAlign:"center",children:["ðŸ’¡ ",e.jsx("strong",{children:"Note:"}),` After clicking "Upgrade To Premium", you'll be redirected to a secure payment page. Your subscription will be activated immediately after successful payment.`]})})]}),e.jsx(ee,{open:I.open,autoHideDuration:4e3,onClose:()=>d({...I,open:!1}),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(E,{onClose:()=>d({...I,open:!1}),severity:I.severity,sx:{width:"100%"},children:I.message})})]})}export{ne as default};
