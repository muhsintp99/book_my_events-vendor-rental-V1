import{r as l,j as e,B as S,t as M,x as I,T as b,ad as z,S as R,s as W,g as L,a8 as _,h as E}from"./index-BALW9Enk.js";import{T as F}from"./TableContainer-BgUSIq9A.js";import{T as U,a as Y,b as D,c as s,d as $}from"./TableRow-BOcgpIDN.js";const J="68e5fb0fa4b2718b6cbf64e9",q="MOD-2ddeafcd-7660-4177-915d-23b1cfe72981",K=()=>{try{const c=localStorage.getItem("user");if(!c)return null;const d=JSON.parse(c);return(d==null?void 0:d._id)||null}catch{return null}},ee=()=>{const[c,d]=l.useState([]),[g,A]=l.useState(""),[O,f]=l.useState(!0),[P,j]=l.useState(null),[p,H]=l.useState(null),y=K();l.useEffect(()=>{if(!y){j("No provider ID found. Please log in."),f(!1);return}(async()=>{var t,r,i;try{f(!0);const a=((t=(await E.get(`https://api.bookmyevent.ae/api/bookings/provider/${y}`)).data)==null?void 0:t.data)||[],C={},k={};a.forEach(h=>{var m;const u=String(h.status||"undefined").toLowerCase(),x=String(((m=h.module)==null?void 0:m.title)||"undefined").toLowerCase();C[u]=(C[u]||0)+1,k[x]=(k[x]||0)+1});const w=a.filter(h=>{var B,T;const u=String(h.status||"").toLowerCase().trim(),x=u==="accepted"||u==="confirmed"||u==="approved",m=(B=h.module)==null?void 0:B._id,G=(T=h.module)==null?void 0:T.moduleId;return x&&(m===J||G===q)});H({total:a.length,confirmedPhotography:w.length,statusCounts:C,moduleCounts:k}),d(w),j(null)}catch(n){console.error("❌ Error loading photography confirmed bookings:",n),j(((i=(r=n.response)==null?void 0:r.data)==null?void 0:i.message)||"Failed to load bookings")}finally{f(!1)}})()},[y]);const v=l.useMemo(()=>{if(!g.trim())return c;const o=g.toLowerCase();return c.filter(t=>{var r,i,n,a;return((r=t._id)==null?void 0:r.toLowerCase().includes(o))||((i=t.fullName)==null?void 0:i.toLowerCase().includes(o))||((n=t.emailAddress)==null?void 0:n.toLowerCase().includes(o))||((a=t.contactNumber)==null?void 0:a.includes(g))})},[g,c]),N=async(o,t)=>{var r,i;if(t.stopPropagation(),!!window.confirm("Are you sure you want to delete this booking?"))try{await E.delete(`https://api.bookmyevent.ae/api/bookings/${o}`),d(n=>n.filter(a=>a._id!==o)),alert("✅ Booking Deleted Successfully!")}catch(n){alert(((i=(r=n.response)==null?void 0:r.data)==null?void 0:i.message)||"Failed to delete booking")}};return O?e.jsx(S,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:e.jsx(M,{})}):P?e.jsx(S,{p:2,children:e.jsx(I,{severity:"error",children:P})}):e.jsxs(S,{p:2,children:[e.jsx(b,{variant:"h4",gutterBottom:!0,fontWeight:600,children:"Confirmed Photography Bookings"}),p&&e.jsx(I,{severity:"info",sx:{mb:2},children:e.jsxs(b,{variant:"body2",children:["Total: ",p.total," | Photography Confirmed:"," ",e.jsx("strong",{children:p.confirmedPhotography})]})}),e.jsxs(z,{sx:{mt:2},children:[e.jsxs(R,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"space-between",alignItems:"center",p:2,children:[e.jsx(W,{label:"Search by Booking ID, Name, Email, or Phone",value:g,onChange:o=>A(o.target.value),size:"small",sx:{minWidth:350}}),e.jsx(L,{variant:"contained",color:"primary",children:"Export Data"})]}),e.jsx(F,{children:e.jsxs(U,{stickyHeader:!0,children:[e.jsx(Y,{children:e.jsxs(D,{children:[e.jsx(s,{children:e.jsx("strong",{children:"S#"})}),e.jsx(s,{children:e.jsx("strong",{children:"Booking ID"})}),e.jsx(s,{children:e.jsx("strong",{children:"Module"})}),e.jsx(s,{children:e.jsx("strong",{children:"Customer"})}),e.jsx(s,{children:e.jsx("strong",{children:"Email"})}),e.jsx(s,{children:e.jsx("strong",{children:"Guests"})}),e.jsx(s,{children:e.jsx("strong",{children:"Booking Date"})}),e.jsx(s,{children:e.jsx("strong",{children:"Amount"})}),e.jsx(s,{children:e.jsx("strong",{children:"Status"})}),e.jsx(s,{children:e.jsx("strong",{children:"Action"})})]})}),e.jsx($,{children:v.length>0?v.map((o,t)=>e.jsxs(D,{hover:!0,children:[e.jsx(s,{children:t+1}),e.jsx(s,{children:e.jsxs(b,{fontWeight:600,color:"primary",children:["#",o._id.slice(-8).toUpperCase()]})}),e.jsx(s,{children:e.jsx(_,{label:"Photography",size:"small",sx:{bgcolor:"#e0f2fe",color:"#0369a1",fontWeight:600}})}),e.jsx(s,{children:o.fullName||"-"}),e.jsx(s,{children:o.emailAddress||"-"}),e.jsx(s,{children:o.numberOfGuests||"-"}),e.jsx(s,{children:o.bookingDate?new Date(o.bookingDate).toLocaleDateString("en-GB"):"-"}),e.jsxs(s,{children:["₹",(o.finalPrice||o.totalAmount||0).toLocaleString()]}),e.jsx(s,{children:e.jsx(_,{label:"Confirmed",size:"small",color:"success"})}),e.jsx(s,{children:e.jsx(L,{variant:"outlined",size:"small",color:"error",onClick:r=>N(o._id,r),children:"Delete"})})]},o._id)):e.jsx(D,{children:e.jsx(s,{colSpan:10,align:"center",children:"No Confirmed Photography Bookings"})})})]})})]})]})};export{ee as default};
