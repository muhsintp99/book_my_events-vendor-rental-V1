import{u as J,r as h,j as e,B as n,t as Q,T as d,s as Y,g as D,W as Z,X as P,x as ee,a5 as S,a9 as se,R as re,b as te,af as oe}from"./index-CB4dr-cP.js";import{A as ie}from"./ArrowDropDown-CQY863y7.js";import{S as ae}from"./Search-WoPN9G3B.js";import{D as N}from"./DirectionsCar-DEjd8_ah.js";import{S as z,K as ne,a as le}from"./SubdirectoryArrowRight-C6QaQlFZ.js";import{T as ce}from"./TableContainer--esebx51.js";import{T as F,a as U,b as x,c as o,d as H}from"./TableRow-BQ_p1vAz.js";const pe=()=>{const p=J(),[j,K]=h.useState(""),[E,O]=h.useState([]),[g,b]=h.useState([]),[v,M]=h.useState({}),[y,I]=h.useState(null),[V,$]=h.useState(!0),[B,R]=h.useState(null),[T,X]=h.useState({}),u="https://api.bookmyevent.ae",f=localStorage.getItem("token"),C=localStorage.getItem("moduleId"),k=(s,t="parent")=>{X(i=>({...i,[`${t}-${s}`]:!0}))};h.useEffect(()=>{(async()=>{$(!0);try{if(!C)throw new Error("Module ID not found. Please login again.");const t=await fetch(`${u}/api/categories/parents/${C}`,{headers:{Accept:"application/json",Authorization:`Bearer ${f}`}});if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);const i=await t.json();if(i.success&&Array.isArray(i.data)){const l=r=>{if(!r)return"";if(r.startsWith("http"))return r;const c=r.startsWith("/")?r:`/${r}`;return`${u}${c}`},a=await Promise.all(i.data.map(async r=>{try{const c=await fetch(`${u}/api/categories/parents/${r._id}/subcategories`,{headers:{Accept:"application/json",Authorization:`Bearer ${f}`}});if(c.ok){const m=await c.json(),w=(m.success?m.data:[]).map(_=>({..._,image:l(_.image)}));return{id:r._id,name:r.title,image:l(r.image),description:r.description||"",subCategories:w}}}catch(c){console.error(`Error fetching subcategories for ${r.title}:`,c)}return{id:r._id,name:r.title,image:l(r.image),description:r.description||"",subCategories:[]}}));O(a),b(a)}else I("No categories found for vehicle module")}catch(t){console.error("Error fetching categories:",t.message),I(`Failed to fetch categories: ${t.message}`)}finally{$(!1)}})()},[u,f,C]);const q=s=>{M(t=>({...t,[s]:!t[s]}))},A=()=>{if(!j.trim()){b(E);return}const s=E.filter(t=>{var a;const i=t.name.toLowerCase().includes(j.toLowerCase()),l=(a=t.subCategories)==null?void 0:a.some(r=>r.title.toLowerCase().includes(j.toLowerCase()));return i||l});b(s)},G=s=>R(s.currentTarget),L=()=>R(null),W=s=>{let t=`SI,Type,Category Name,Parent Category
`,i=1;g.forEach(c=>{var m;t+=`${i++},Parent,${c.name},-
`,(m=c.subCategories)==null||m.forEach(w=>{t+=`${i++},Subcategory,${w.title},${c.name}
`})});const l=new Blob([t],{type:s==="excel"?"application/vnd.ms-excel":"text/csv"}),a=window.URL.createObjectURL(l),r=document.createElement("a");r.href=a,r.download=`vehicle_categories_${new Date().toISOString().slice(0,10)}.${s}`,r.click(),window.URL.revokeObjectURL(a),L()};return V?e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},children:e.jsx(Q,{sx:{color:"#E15B65"}})}):e.jsx(n,{sx:{p:3,backgroundColor:p.palette.grey[100],minHeight:"100vh"},children:e.jsxs(n,{sx:{maxWidth:"lg",margin:"auto",backgroundColor:"white",borderRadius:p.shape.borderRadius,boxShadow:p.shadows[1],p:3},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(n,{children:[e.jsx(d,{variant:"h5",component:"h1",sx:{fontWeight:600},children:"Vehicle Categories"}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Parent categories and their subcategories"})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Y,{variant:"outlined",placeholder:"Search categories...",value:j,onChange:s=>K(s.target.value),onKeyPress:s=>s.key==="Enter"&&A(),size:"small",sx:{minWidth:250}}),e.jsx(D,{variant:"outlined",startIcon:e.jsx(ae,{}),onClick:A,sx:{color:"#E15B65",borderColor:"#E15B65","&:hover":{borderColor:"#c14a54"}},children:"Search"}),e.jsx(D,{variant:"outlined",endIcon:e.jsx(ie,{}),onClick:G,sx:{color:"#E15B65",borderColor:"#E15B65","&:hover":{borderColor:"#c14a54"}},children:"Export"}),e.jsxs(Z,{anchorEl:B,open:!!B,onClose:L,children:[e.jsx(P,{onClick:()=>W("excel"),children:"Excel"}),e.jsx(P,{onClick:()=>W("csv"),children:"CSV"})]})]})]}),y&&e.jsx(ee,{severity:"error",sx:{mb:2},children:y}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:3},children:[e.jsx(S,{icon:e.jsx(N,{}),label:`${g.length} Parent Categories`,color:"primary",sx:{bgcolor:"#E15B65"}}),e.jsx(S,{icon:e.jsx(z,{}),label:`${g.reduce((s,t)=>{var i;return s+(((i=t.subCategories)==null?void 0:i.length)||0)},0)} Subcategories`,variant:"outlined",sx:{borderColor:"#E15B65",color:"#E15B65"}})]}),e.jsx(ce,{component:se,elevation:0,sx:{border:"1px solid #e0e0e0"},children:e.jsxs(F,{children:[e.jsx(U,{sx:{bgcolor:"#fce4ec"},children:e.jsxs(x,{children:[e.jsx(o,{width:50}),e.jsx(o,{width:50,children:"SI"}),e.jsx(o,{children:"Category Name"}),e.jsx(o,{children:"Image"}),e.jsx(o,{align:"center",children:"Subcategories"})]})}),e.jsx(H,{children:g.length===0?e.jsx(x,{children:e.jsx(o,{colSpan:5,align:"center",sx:{py:8},children:e.jsx(d,{variant:"h6",color:"text.secondary",children:"No categories found"})})}):g.map((s,t)=>{var i,l;return e.jsxs(re.Fragment,{children:[e.jsxs(x,{hover:!0,sx:{"& > *":{borderBottom:"unset"}},children:[e.jsx(o,{children:e.jsx(te,{size:"small",onClick:()=>q(s.id),disabled:!s.subCategories||s.subCategories.length===0,children:v[s.id]?e.jsx(ne,{}):e.jsx(le,{})})}),e.jsx(o,{sx:{fontWeight:600},children:t+1}),e.jsx(o,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(N,{sx:{color:"#E15B65"}}),e.jsxs(n,{children:[e.jsx(d,{fontWeight:600,children:s.name}),s.description&&e.jsx(d,{variant:"caption",color:"text.secondary",children:s.description})]})]})}),e.jsx(o,{children:s.image&&!T[`parent-${s.id}`]?e.jsx("img",{src:s.image,alt:s.name,style:{width:80,height:60,objectFit:"cover",borderRadius:4},onError:()=>k(s.id,"parent")}):e.jsx(n,{sx:{width:80,height:60,bgcolor:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:1},children:e.jsx(d,{variant:"caption",color:"text.secondary",children:"No Image"})})}),e.jsx(o,{align:"center",children:e.jsx(S,{label:((i=s.subCategories)==null?void 0:i.length)||0,size:"small",color:((l=s.subCategories)==null?void 0:l.length)>0?"success":"default"})})]}),e.jsx(x,{children:e.jsx(o,{style:{paddingBottom:0,paddingTop:0},colSpan:5,children:e.jsx(oe,{in:v[s.id],timeout:"auto",unmountOnExit:!0,children:e.jsxs(n,{sx:{margin:2,bgcolor:"#fafafa",borderRadius:1,p:2},children:[e.jsx(d,{variant:"subtitle2",gutterBottom:!0,sx:{color:"#E15B65",fontWeight:600},children:"Subcategories"}),s.subCategories&&s.subCategories.length>0?e.jsxs(F,{size:"small",children:[e.jsx(U,{children:e.jsxs(x,{children:[e.jsx(o,{children:"SI"}),e.jsx(o,{children:"Subcategory Name"}),e.jsx(o,{children:"Image"})]})}),e.jsx(H,{children:s.subCategories.map((a,r)=>e.jsxs(x,{children:[e.jsx(o,{children:r+1}),e.jsx(o,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(z,{sx:{fontSize:18,color:"#E15B65"}}),e.jsx(d,{children:a.title})]})}),e.jsx(o,{children:a.image&&!T[`sub-${a._id}`]?e.jsx("img",{src:a.image,alt:a.title,style:{width:60,height:45,objectFit:"cover",borderRadius:4},onError:()=>k(a._id,"sub")}):e.jsx(n,{sx:{width:60,height:45,bgcolor:"#e0e0e0",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:1},children:e.jsx(d,{variant:"caption",color:"text.secondary",children:"No Image"})})})]},a._id))})]}):e.jsx(d,{variant:"body2",color:"text.secondary",children:"No subcategories available"})]})})})})]},s.id)})})]})})]})})};export{pe as default};
