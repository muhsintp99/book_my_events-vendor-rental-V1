import{r as a,g as ae,j as e,B as l,v as ie,o as oe,N as re,q as x,f as p,G as O,a7 as le,b as N,a8 as ne,s as ce}from"./index-KwbFPzn3.js";import{T as q,a as m}from"./Tabs-B9N4HlDz.js";import{C as de}from"./CloudUpload-Br9tPwlt.js";import{V as xe}from"./VideoLibrary-CUBmLqOj.js";import{T as pe}from"./TableContainer-B_czVzil.js";import{T as me,a as ue,b as H,c as r,d as fe}from"./TableRow-BrEE-dR8.js";import{D as ge}from"./Delete-CR6ALtDk.js";import{C as he}from"./Close-fboW6Dyw.js";const g="https://api.bookmyevent.ae",u=ae.create({baseURL:g}),f="#e53935";function we(){const h=JSON.parse(localStorage.getItem("user")||"{}"),n=h==null?void 0:h._id,c=localStorage.getItem("moduleId"),[S,w]=a.useState(!1),[J,k]=a.useState(!1),[j,M]=a.useState(0),[b,L]=a.useState(""),[P,A]=a.useState(""),[E,F]=a.useState(""),[$,V]=a.useState([]),[z,D]=a.useState([]),[v,W]=a.useState(""),[C,K]=a.useState(0),[Q,X]=a.useState([]),[Y,y]=a.useState(!1),[R,Z]=a.useState([]),[U,B]=a.useState(0);a.useEffect(()=>{!n||!c||u.get(`/api/subscription/status/${n}?moduleId=${c}`).then(s=>{var i;const t=(i=s.data)==null?void 0:i.subscription;w((t==null?void 0:t.status)==="active"&&(t==null?void 0:t.isCurrent))}).catch(()=>w(!1))},[n,c]),a.useEffect(()=>{T()},[]);const T=async()=>{const s=await u.get(`/api/portfolio/provider/${n}`);X(s.data.data||[])},ee=s=>{const t=Array.from(s.target.files);V(i=>i.concat(t.map(o=>({file:o,preview:URL.createObjectURL(o)}))))},_=async s=>{if(!S)return alert("Upgrade to premium");if(!b.trim())return alert("Title required");const t=new FormData;t.append("providerId",n),t.append("module",c),t.append("workTitle",b),t.append("description",P),t.append("tags",E),s?(z.forEach(i=>t.append("videos",i)),v&&t.append("videoLinks",JSON.stringify([v]))):$.forEach(i=>t.append("images",i.file)),k(!0),await u.post("/api/portfolio",t),k(!1),L(""),A(""),F(""),V([]),D([]),W(""),T()},te=async s=>{window.confirm("Delete portfolio?")&&(await u.delete(`/api/portfolio/${s}`),T())},G=(s,t)=>{Z(s),B(t),y(!0)},se=Q.filter(s=>{var t,i;return C===0?(t=s.media)==null?void 0:t.some(o=>o.type==="image"):C===1?(i=s.media)==null?void 0:i.some(o=>o.type==="video"||o.type==="videoLink"):!1});return e.jsxs(l,{sx:{p:3},children:[!S&&e.jsx(ie,{severity:"warning",children:"FREE PLAN"}),e.jsxs(oe,{sx:{mb:4},children:[e.jsxs(q,{value:j,onChange:(s,t)=>M(t),children:[e.jsx(m,{label:"Images"}),e.jsx(m,{label:"Videos"})]}),e.jsxs(re,{children:[e.jsx(x,{fullWidth:!0,label:"Title",value:b,onChange:s=>L(s.target.value),sx:{mb:2}}),e.jsx(x,{fullWidth:!0,multiline:!0,rows:3,label:"Description",value:P,onChange:s=>A(s.target.value),sx:{mb:2}}),e.jsx(x,{fullWidth:!0,label:"Tags (comma separated)",value:E,onChange:s=>F(s.target.value),sx:{mb:2}}),j===0&&e.jsxs(e.Fragment,{children:[e.jsxs(p,{component:"label",variant:"contained",sx:{bgcolor:f},children:[e.jsx(de,{sx:{mr:1}})," Upload Images",e.jsx("input",{hidden:!0,multiple:!0,type:"file",accept:"image/*",onChange:ee})]}),e.jsx(O,{container:!0,spacing:2,sx:{mt:2},children:$.map((s,t)=>e.jsx(O,{item:!0,xs:3,children:e.jsx("img",{src:s.preview,style:{width:"100%",height:120,objectFit:"cover"}})},t))}),e.jsx(p,{fullWidth:!0,sx:{mt:3,bgcolor:f},variant:"contained",onClick:()=>_(!1),children:"Add Portfolio"})]}),j===1&&e.jsxs(e.Fragment,{children:[e.jsxs(p,{component:"label",variant:"contained",sx:{bgcolor:f},children:[e.jsx(xe,{sx:{mr:1}})," Upload Videos",e.jsx("input",{hidden:!0,multiple:!0,type:"file",accept:"video/*",onChange:s=>D([...s.target.files])})]}),e.jsx(x,{fullWidth:!0,label:"Video Link",value:v,onChange:s=>W(s.target.value),sx:{mt:2}}),e.jsx(p,{fullWidth:!0,sx:{mt:3,bgcolor:f},variant:"contained",onClick:()=>_(!0),children:"Add Video"})]})]})]}),e.jsxs(q,{value:C,onChange:(s,t)=>K(t),sx:{mb:2},children:[e.jsx(m,{label:"Images"}),e.jsx(m,{label:"Videos"})]}),e.jsx(pe,{component:le,children:e.jsxs(me,{children:[e.jsx(ue,{sx:{bgcolor:"#fdeaea"},children:e.jsxs(H,{children:[e.jsx(r,{children:"Title"}),e.jsx(r,{children:"Preview"}),e.jsx(r,{children:"Count"}),e.jsx(r,{children:"Actions"})]})}),e.jsx(fe,{children:se.map(s=>{var i,o;const t=((o=(i=s.media)==null?void 0:i.find(I=>I.type==="image"))==null?void 0:o.images)||[];return e.jsxs(H,{children:[e.jsx(r,{children:s.workTitle}),e.jsx(r,{children:e.jsx(l,{sx:{display:"flex",gap:1},children:t.slice(0,2).map((I,d)=>e.jsxs(l,{sx:{position:"relative"},children:[e.jsx("img",{src:`${g}/${I}`,style:{width:50,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>G(t,d)}),d===1&&t.length>2&&e.jsxs(l,{onClick:()=>G(t,d),sx:{position:"absolute",inset:0,bgcolor:"rgba(0,0,0,.6)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700},children:["+",t.length-2]})]},d))})}),e.jsx(r,{children:t.length}),e.jsx(r,{children:e.jsx(N,{color:"error",onClick:()=>te(s._id),children:e.jsx(ge,{})})})]},s._id)})})]})}),e.jsx(ne,{open:Y,onClose:()=>y(!1),fullScreen:!0,children:e.jsxs(l,{sx:{bgcolor:"#000",height:"100vh",color:"#fff",p:2},children:[e.jsx(N,{onClick:()=>y(!1),sx:{color:"#fff"},children:e.jsx(he,{})}),e.jsx(l,{sx:{textAlign:"center",mt:2},children:e.jsx("img",{src:`${g}/${R[U]}`,style:{maxHeight:"70vh",maxWidth:"100%"}})}),e.jsx(l,{sx:{display:"flex",justifyContent:"center",gap:1,mt:2},children:R.map((s,t)=>e.jsx("img",{src:`${g}/${s}`,onClick:()=>B(t),style:{width:60,height:60,objectFit:"cover",border:U===t?"2px solid #fff":"1px solid #444",cursor:"pointer"}},t))})]})}),J&&e.jsx(ce,{})]})}export{we as default};
