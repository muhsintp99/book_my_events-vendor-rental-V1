import{r as l,j as e,B as b,c as M,e as I,T as S,l as z,S as R,a as W,b as L,K as _,f as E}from"./index-h_u9Mcwm.js";import{T as F}from"./TableContainer-Cwa-fL8p.js";import{T as U,a as D,b as o,c as Y}from"./TableRow-CyenUsQJ.js";import{T as $}from"./TableHead-Bms2ssg0.js";const J="68e5fb0fa4b2718b6cbf64e9",K="MOD-2ddeafcd-7660-4177-915d-23b1cfe72981",q=()=>{try{const c=localStorage.getItem("user");if(!c)return null;const d=JSON.parse(c);return(d==null?void 0:d._id)||null}catch{return null}},oe=()=>{const[c,d]=l.useState([]),[g,A]=l.useState(""),[O,f]=l.useState(!0),[P,j]=l.useState(null),[p,H]=l.useState(null),y=q();l.useEffect(()=>{if(!y){j("No provider ID found. Please log in."),f(!1);return}(async()=>{var r,t,i;try{f(!0);const a=((r=(await E.get(`https://api.bookmyevent.ae/api/bookings/provider/${y}`)).data)==null?void 0:r.data)||[],C={},k={};a.forEach(h=>{var x;const u=String(h.status||"undefined").toLowerCase(),m=String(((x=h.module)==null?void 0:x.title)||"undefined").toLowerCase();C[u]=(C[u]||0)+1,k[m]=(k[m]||0)+1});const w=a.filter(h=>{var B,T;const u=String(h.status||"").toLowerCase().trim(),m=u==="accepted"||u==="confirmed"||u==="approved",x=(B=h.module)==null?void 0:B._id,G=(T=h.module)==null?void 0:T.moduleId;return m&&(x===J||G===K)});H({total:a.length,confirmedPhotography:w.length,statusCounts:C,moduleCounts:k}),d(w),j(null)}catch(n){console.error("❌ Error loading photography confirmed bookings:",n),j(((i=(t=n.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to load bookings")}finally{f(!1)}})()},[y]);const v=l.useMemo(()=>{if(!g.trim())return c;const s=g.toLowerCase();return c.filter(r=>{var t,i,n,a;return((t=r._id)==null?void 0:t.toLowerCase().includes(s))||((i=r.fullName)==null?void 0:i.toLowerCase().includes(s))||((n=r.emailAddress)==null?void 0:n.toLowerCase().includes(s))||((a=r.contactNumber)==null?void 0:a.includes(g))})},[g,c]),N=async(s,r)=>{var t,i;if(r.stopPropagation(),!!window.confirm("Are you sure you want to delete this booking?"))try{await E.delete(`https://api.bookmyevent.ae/api/bookings/${s}`),d(n=>n.filter(a=>a._id!==s)),alert("✅ Booking Deleted Successfully!")}catch(n){alert(((i=(t=n.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to delete booking")}};return O?e.jsx(b,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:e.jsx(M,{})}):P?e.jsx(b,{p:2,children:e.jsx(I,{severity:"error",children:P})}):e.jsxs(b,{p:2,children:[e.jsx(S,{variant:"h4",gutterBottom:!0,fontWeight:600,children:"Confirmed Photography Bookings"}),p&&e.jsx(I,{severity:"info",sx:{mb:2},children:e.jsxs(S,{variant:"body2",children:["Total: ",p.total," | Photography Confirmed:"," ",e.jsx("strong",{children:p.confirmedPhotography})]})}),e.jsxs(z,{sx:{mt:2},children:[e.jsxs(R,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"space-between",alignItems:"center",p:2,children:[e.jsx(W,{label:"Search by Booking ID, Name, Email, or Phone",value:g,onChange:s=>A(s.target.value),size:"small",sx:{minWidth:350}}),e.jsx(L,{variant:"contained",color:"primary",children:"Export Data"})]}),e.jsx(F,{children:e.jsxs(U,{stickyHeader:!0,children:[e.jsx($,{children:e.jsxs(D,{children:[e.jsx(o,{children:e.jsx("strong",{children:"S#"})}),e.jsx(o,{children:e.jsx("strong",{children:"Booking ID"})}),e.jsx(o,{children:e.jsx("strong",{children:"Module"})}),e.jsx(o,{children:e.jsx("strong",{children:"Customer"})}),e.jsx(o,{children:e.jsx("strong",{children:"Email"})}),e.jsx(o,{children:e.jsx("strong",{children:"Guests"})}),e.jsx(o,{children:e.jsx("strong",{children:"Booking Date"})}),e.jsx(o,{children:e.jsx("strong",{children:"Amount"})}),e.jsx(o,{children:e.jsx("strong",{children:"Status"})}),e.jsx(o,{children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(Y,{children:v.length>0?v.map((s,r)=>e.jsxs(D,{hover:!0,children:[e.jsx(o,{children:r+1}),e.jsx(o,{children:e.jsxs(S,{fontWeight:600,color:"primary",children:["#",s._id.slice(-8).toUpperCase()]})}),e.jsx(o,{children:e.jsx(_,{label:"Photography",size:"small",sx:{bgcolor:"#e0f2fe",color:"#0369a1",fontWeight:600}})}),e.jsx(o,{children:s.fullName||"-"}),e.jsx(o,{children:s.emailAddress||"-"}),e.jsx(o,{children:s.numberOfGuests||"-"}),e.jsx(o,{children:s.bookingDate?new Date(s.bookingDate).toLocaleDateString("en-GB"):"-"}),e.jsxs(o,{children:["₹",(s.finalPrice||s.totalAmount||0).toLocaleString()]}),e.jsx(o,{children:e.jsx(_,{label:"Confirmed",size:"small",color:"success"})}),e.jsx(o,{children:e.jsx(L,{variant:"outlined",size:"small",color:"error",onClick:t=>N(s._id,t),children:"Delete"})})]},s._id)):e.jsx(D,{children:e.jsx(o,{colSpan:10,align:"center",children:"No Confirmed Photography Bookings"})})})]})})]})]})};export{oe as default};
