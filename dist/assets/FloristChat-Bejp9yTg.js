import{d as De,m as Me,g as Ee,n as Fe,r as n,j as e,B as a,s as b,o as g,p as Le,A as ne,T as x,a7 as ae,c as le,Y as B,X as Re,a as Oe,a2 as ce,aD as Pe,G as de,a5 as Te,_ as Ne,M as z,aE as Ge,f as xe,Q as A,a8 as He,a9 as Ye,aa as $e,ab as Ve}from"./index-DF1Xuk6o.js";import{s as f,S as Qe}from"./socket-CEGULcSF.js";import{O as Ue,M as Je,N as Xe}from"./OpenInNew-BbIyjfC7.js";import{S as D}from"./Search-CB68Tsz3.js";import{C as Ke}from"./Close-CWkVHLel.js";import{C as Ze}from"./Chat-B_xVAEVZ.js";import{A as qe}from"./Add-D7XIlWA7.js";import{E as et}from"./EmojiEmotions-Bozr8lCh.js";import{D as tt}from"./DeleteOutline-BtG3beSD.js";import{F as st}from"./FilterList-iQzEBPYo.js";import{L as rt}from"./ListItem-PRoEfckJ.js";import{L as it}from"./ListItemAvatar-BCdfgyU_.js";const l={primary:"#9C27B0",secondary:"#E91E63",dark:"#1A1A2E"},ot=["ðŸ˜Š","ðŸ˜‚","ðŸ˜","ðŸ‘","ðŸ™","ðŸ”¥","âœ¨","â¤ï¸","ðŸŽ‰","ðŸ‘—","ðŸ‘œ","ðŸ“","ðŸ’¯","ðŸ‘","ðŸ™Œ","â­"],nt="https://api.bookmyevent.ae",at=i=>{if(!i)return"assets/img/default-placeholder.jpg";if(typeof i=="string"&&i.startsWith("http"))return i;typeof i=="string"&&i.startsWith("/var/www/backend/")&&(i=i.replace("/var/www/backend/",""));const m=String(i).replace(/^\//,"");return`${nt}/${m}`},y=i=>{var m;return i?(m=i.userId)!=null&&m.firstName?(i.userId.firstName+" "+(i.userId.lastName||"")).trim():i.fullName||"Customer":"Customer"},he=i=>{if(!i)return"?";const m=i.split(" ");return m.length>=2?(m[0][0]+m[1][0]).toUpperCase():i.substring(0,2).toUpperCase()},wt=()=>{var K,Z,q,ee,te,se;De();const i=Me(),m=Ee(),h=Fe(m.breakpoints.down("md")),pe=localStorage.getItem("user")||"{}",p=JSON.parse(pe),j=(p==null?void 0:p.providerId)||(p==null?void 0:p._id),[M,me]=n.useState([]),[s,E]=n.useState(((K=i.state)==null?void 0:K.enquiry)||null),[C,w]=n.useState([]),[F,v]=n.useState(""),[ue,L]=n.useState(!0),[ge,R]=n.useState(!1),[k,fe]=n.useState(""),[O,P]=n.useState(null),[T,N]=n.useState(null),[G,H]=n.useState(!1),[je,Y]=n.useState(""),[$,V]=n.useState(!!((Z=i.state)!=null&&Z.enquiry)),Q=n.useRef(null),U=n.useRef(null),_=n.useRef(new Set),J=n.useMemo(()=>{var o,r;let t=M;return(r=(o=i.state)==null?void 0:o.product)!=null&&r._id&&(t=t.filter(c=>String(c.packageId)===String(i.state.product._id))),t.filter(c=>y(c).toLowerCase().includes(k.toLowerCase()))},[M,k,(ee=(q=i.state)==null?void 0:q.product)==null?void 0:ee._id]),be=()=>{var t;(t=U.current)==null||t.scrollIntoView({behavior:"smooth"})};n.useEffect(()=>{if(!j)return;(async()=>{try{L(!0);const c=((await xe.get(`https://api.bookmyevent.ae/api/enquiries/provider/${j}`)).data.data||[]).filter(d=>{var re,ie,oe;const u=(d.description||"").toLowerCase(),I=(((re=d.moduleId)==null?void 0:re.moduleType)||"").toLowerCase(),We=(((ie=d.moduleId)==null?void 0:ie.title)||"").toLowerCase(),Be=typeof d.moduleId=="string"?d.moduleId:((oe=d.moduleId)==null?void 0:oe._id)||"",ze=I==="boutique"||We.includes("boutique")||Be==="68e5fd7b8164d482d281c37f",Ae=u.includes("customize")||u.includes("design")||u.includes("boutique");return ze&&Ae});me(c),!s&&c.length>0&&E(c[0])}catch(o){console.error("Failed to fetch enquiries:",o)}finally{L(!1)}})()},[j]),n.useEffect(()=>{if(!(s!=null&&s._id))return;(async()=>{var o;try{R(!0);const r=await xe.get(`https://api.bookmyevent.ae/api/enquiries/${s._id}/messages`);w(((o=r.data)==null?void 0:o.data)||[])}catch(r){console.error("Failed to fetch messages:",r)}finally{R(!1)}})()},[s==null?void 0:s._id]),n.useEffect(()=>{if(!(s!=null&&s._id)||!j)return;f.connected||f.connect(),f.emit("join_enquiry",{enquiryId:s._id,vendorId:j});const t=r=>{if(r.enquiryId&&r.enquiryId!==s._id)return;const c=r._id||r.timestamp;if(_.current.has(c)){_.current.delete(c),w(d=>d.map(u=>u.timestamp===r.timestamp&&String(u.senderId)===String(r.senderId)?{...r,time:r.time||new Date(r.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}:u));return}w(d=>d.some(I=>I._id===r._id||r.timestamp&&I.timestamp===r.timestamp)?d:[...d,{...r,time:r.time||new Date(r.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}])},o=r=>{w(c=>c.filter(d=>d._id!==r.messageId))};return f.on("receive_message",t),f.on("message_deleted",o),()=>{f.off("receive_message",t),f.off("message_deleted",o)}},[s==null?void 0:s._id,j]),n.useEffect(()=>{be()},[C]);const W=(t=F,o="text")=>{var d;if(o==="text"&&!t.trim()||!(s!=null&&s._id))return;const r=new Date().toISOString(),c={enquiryId:s._id,senderId:j,receiverId:((d=s.userId)==null?void 0:d._id)||s.userId,senderName:(p==null?void 0:p.businessName)||(p==null?void 0:p.name)||"Vendor",senderRole:"vendor",text:o==="text"?t:"Sent an image",message:o==="text"?t:"Sent an image",timestamp:r,type:o};_.current.add(r),w(u=>[...u,{...c,_id:"optimistic-"+Date.now(),time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}]),f.emit("send_message",c),o==="text"&&v("")},we=()=>{var t;return(t=Q.current)==null?void 0:t.click()},ye=t=>{const o=t.target.files[0];if(o){const r=new FileReader;r.onload=c=>W(c.target.result,"image"),r.readAsDataURL(o)}},Se=t=>P(t.currentTarget),X=()=>P(null),Ie=t=>{v(o=>o+t),X()},Ce=t=>N(t.currentTarget),S=()=>N(null),ve=()=>{w([]),S()},ke=t=>{E(t),h&&V(!0)},_e=()=>e.jsxs(a,{sx:{width:{xs:"100%",md:350},height:"100%",borderRight:"1px solid #E0E4EC",display:"flex",flexDirection:"column",bgcolor:"white"},children:[e.jsxs(a,{sx:{p:2,bgcolor:"white"},children:[e.jsxs(b,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[e.jsx(x,{variant:"h5",fontWeight:800,color:l.primary,children:"Customization"}),e.jsx(b,{direction:"row",spacing:1,children:e.jsx(g,{size:"small",sx:{bgcolor:A(l.primary,.05)},children:e.jsx(st,{fontSize:"small"})})})]}),e.jsxs(B,{sx:{p:"2px 8px",display:"flex",alignItems:"center",bgcolor:"#F1F5F9",borderRadius:"12px",boxShadow:"none"},children:[e.jsx(D,{sx:{color:"#64748B",ml:1}}),e.jsx(ae,{sx:{ml:1,flex:1,p:1,fontWeight:500},placeholder:"Search customers...",value:k,onChange:t=>fe(t.target.value)})]})]}),e.jsx(He,{sx:{flexGrow:1,overflowY:"auto",py:0},children:ue?e.jsx(a,{sx:{p:4,textAlign:"center"},children:e.jsx(le,{size:30})}):J.length===0?e.jsx(a,{sx:{p:4,textAlign:"center"},children:e.jsx(x,{variant:"body2",color:"text.secondary",children:"No customizations found"})}):J.map(t=>e.jsx(rt,{disablePadding:!0,children:e.jsxs(Ye,{selected:(s==null?void 0:s._id)===t._id,onClick:()=>ke(t),sx:{py:2,px:2,borderLeft:`4px solid ${(s==null?void 0:s._id)===t._id?l.primary:"transparent"}`,"&.Mui-selected":{bgcolor:A(l.primary,.05)}},children:[e.jsx(it,{children:e.jsx($e,{overlap:"circle",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot",color:"success",sx:{"& .MuiBadge-badge":{border:"2px solid white"}},children:e.jsx(ne,{sx:{bgcolor:A(l.primary,.1),color:l.primary,fontWeight:700},children:he(y(t))})})}),e.jsx(Ve,{primary:e.jsxs(b,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(x,{variant:"subtitle1",fontWeight:700,children:y(t)}),e.jsx(x,{variant:"caption",color:"text.secondary",children:new Date(t.createdAt).toLocaleDateString([],{month:"short",day:"numeric"})})]}),secondary:e.jsx(x,{variant:"body2",noWrap:!0,sx:{maxWidth:"180px",color:"#64748B"},children:t.description})})]})},t._id))})]});return e.jsxs(a,{sx:{height:"calc(100vh - 120px)",display:"flex",bgcolor:"white",borderRadius:"24px",overflow:"hidden",boxShadow:"0 20px 50px rgba(0,0,0,0.1)",border:"1px solid rgba(224, 228, 236, 0.5)",m:{xs:1,md:3}},children:[(!h||!$)&&e.jsx(_e,{}),(!h||$)&&e.jsxs(a,{sx:{flexGrow:1,display:"flex",flexDirection:"column",bgcolor:"#F8FAFC"},children:[e.jsx("input",{type:"file",hidden:!0,ref:Q,onChange:ye,accept:"image/*"}),e.jsxs(a,{sx:{p:h?1.5:2,bgcolor:"white",borderBottom:"1px solid #E0E4EC",display:"flex",alignItems:"center",justifyContent:"space-between",zIndex:10},children:[e.jsxs(b,{direction:"row",spacing:2,alignItems:"center",sx:{flexGrow:1},children:[h&&e.jsx(g,{onClick:()=>V(!1),children:e.jsx(Le,{})}),G?e.jsxs(a,{sx:{flex:1,bgcolor:"#f1f5f9",borderRadius:"12px",px:2,py:1,display:"flex",alignItems:"center",animation:"fadeIn 0.3s ease-in-out"},children:[e.jsx(D,{sx:{color:"#64748B",mr:1}}),e.jsx(ae,{fullWidth:!0,placeholder:"Search messages...",value:je,onChange:t=>Y(t.target.value),sx:{fontWeight:500}}),e.jsx(g,{size:"small",onClick:()=>{H(!1),Y("")},children:e.jsx(Ke,{fontSize:"small"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{sx:{width:h?35:45,height:h?35:45,bgcolor:l.primary,fontWeight:800,fontSize:h?"0.9rem":"1.1rem"},children:he(y(s))}),e.jsxs(a,{sx:{minWidth:0},children:[e.jsx(x,{variant:h?"subtitle2":"subtitle1",fontWeight:800,sx:{lineHeight:1.2,noWrap:!0,overflow:"hidden",textOverflow:"ellipsis"},children:y(s)}),e.jsxs(b,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(x,{variant:"caption",sx:{color:l.secondary,fontWeight:700},children:s==null?void 0:s.email}),!h&&e.jsx(a,{sx:{width:4,height:4,borderRadius:"50%",bgcolor:"#CBD5E1"}}),!h&&e.jsx(x,{variant:"caption",sx:{color:"#64748B",fontWeight:600},children:s==null?void 0:s.contact})]})]}),e.jsx(a,{sx:{flexGrow:1}}),(s==null?void 0:s.packageDetails)&&e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1.5,p:"4px 10px",borderRadius:"12px",bgcolor:"rgba(255, 255, 255, 0.85)",backdropFilter:"blur(12px)",border:"1px solid rgba(156, 39, 176, 0.1)",boxShadow:"0 4px 15px rgba(0,0,0,0.05)",maxWidth:{xs:"140px",sm:"260px"},mr:1.5,transition:"all 0.3s ease","&:hover":{boxShadow:"0 6px 20px rgba(156, 39, 176, 0.1)",transform:"translateY(-1px)",bgcolor:"white"}},children:[e.jsx(a,{sx:{width:38,height:38,borderRadius:"8px",overflow:"hidden",flexShrink:0,border:"1.5px solid white",boxShadow:"0 2px 6px rgba(0,0,0,0.06)"},children:e.jsx("img",{src:at(s.packageDetails.thumbnail),alt:"Package",style:{width:"100%",height:"100%",objectFit:"cover"}})}),e.jsxs(a,{sx:{minWidth:0,flexGrow:1},children:[e.jsx(x,{variant:"caption",sx:{display:"block",fontWeight:800,color:l.dark,fontSize:"0.68rem",noWrap:!0,overflow:"hidden",textOverflow:"ellipsis",lineHeight:1.1},children:s.packageDetails.name}),e.jsxs(b,{direction:"row",alignItems:"center",spacing:.5,children:[e.jsxs(x,{variant:"caption",sx:{fontWeight:900,color:l.primary,fontSize:"0.78rem"},children:["â‚¹",((te=s.packageDetails.buyPricing)==null?void 0:te.totalPrice)||((se=s.packageDetails.rentalPricing)==null?void 0:se.totalPrice)||"0"]}),e.jsx(g,{size:"small",component:"a",href:`https://bookmyevent.ae/boutique-details.html?id=${s.packageId}`,target:"_blank",sx:{p:0,color:l.primary,opacity:.6,"&:hover":{opacity:1,bgcolor:"transparent"}},children:e.jsx(Ue,{sx:{fontSize:11}})})]})]})]})]})]}),e.jsxs(b,{direction:"row",spacing:.5,alignItems:"center",children:[!G&&e.jsx(g,{onClick:()=>H(!0),sx:{color:"#64748B"},children:e.jsx(D,{fontSize:"small"})}),e.jsx(g,{onClick:Ce,sx:{color:"#64748B"},children:e.jsx(Je,{fontSize:"small"})})]})]}),e.jsxs(a,{sx:{flexGrow:1,overflowY:"auto",p:h?1.5:3,display:"flex",flexDirection:"column",gap:2,backgroundImage:"radial-gradient(#9C27B010 1px, transparent 1px)",backgroundSize:"20px 20px"},children:[ge?e.jsx(a,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx(le,{size:40})}):C.length===0?e.jsxs(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",opacity:.3},children:[e.jsx(Ze,{sx:{fontSize:60,color:l.primary,mb:1}}),e.jsx(x,{variant:"h6",fontWeight:600,children:"No messages yet"})]}):C.map((t,o)=>{const r=t.senderRole==="vendor";return e.jsxs(a,{sx:{alignSelf:r?"flex-end":"flex-start",maxWidth:{xs:"90%",md:"70%"},display:"flex",flexDirection:"column",alignItems:r?"flex-end":"flex-start"},children:[e.jsx(B,{sx:{p:t.type==="image"?.5:2,borderRadius:r?"20px 20px 4px 20px":"20px 20px 20px 4px",bgcolor:r?l.primary:"white",color:r?"white":l.dark,boxShadow:r?"0 8px 16px rgba(156, 39, 176, 0.2)":"0 4px 12px rgba(0,0,0,0.05)",border:r?"none":"1px solid rgba(224, 228, 236, 0.5)",overflow:"hidden"},children:t.type==="image"?e.jsx(a,{sx:{width:"100%",borderRadius:"16px",overflow:"hidden",display:"flex"},children:e.jsx("img",{src:t.file,alt:"sent",style:{maxWidth:"100%",maxHeight:"400px",objectFit:"cover"}})}):e.jsx(x,{variant:"body1",sx:{fontWeight:500,lineHeight:1.5},children:t.text||t.message})}),e.jsxs(x,{variant:"caption",sx:{mt:.5,px:1,color:"#94A3B8",fontWeight:600},children:[t.time||new Date(t.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})," ",r&&e.jsx(Re,{sx:{fontSize:12,ml:.5,verticalAlign:"middle",color:l.primary}})]})]},t._id||o)}),e.jsx("div",{ref:U})]}),e.jsx(a,{sx:{p:h?1.5:2.5,bgcolor:"white",borderTop:"1px solid #E0E4EC"},children:e.jsxs(B,{component:"form",onSubmit:t=>{t.preventDefault(),W()},sx:{p:"4px 8px",display:"flex",alignItems:"center",borderRadius:"16px",bgcolor:"#F8FAFC",border:"1px solid #E2E8F0",boxShadow:"none"},children:[e.jsx(g,{onClick:we,sx:{color:"#64748B"},children:e.jsx(qe,{})}),e.jsx(Oe,{fullWidth:!0,placeholder:"Type a message...",variant:"standard",value:F,onChange:t=>v(t.target.value),InputProps:{disableUnderline:!0},sx:{ml:1,flex:1,"& .MuiInputBase-input":{fontWeight:500}}}),e.jsx(g,{onClick:Se,sx:{color:"#64748B"},children:e.jsx(et,{})}),e.jsx(ce,{sx:{height:28,mx:1},orientation:"vertical"}),e.jsx(g,{onClick:()=>W(),sx:{p:1.2,color:"white",bgcolor:l.primary,"&:hover":{bgcolor:l.secondary}},children:e.jsx(Qe,{sx:{fontSize:20}})})]})})]}),e.jsx(Pe,{open:!!O,anchorEl:O,onClose:X,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"right"},PaperProps:{sx:{p:1,borderRadius:"16px"}},children:e.jsx(de,{container:!0,spacing:1,sx:{width:"200px",p:1},children:ot.map(t=>e.jsx(de,{item:!0,xs:3,children:e.jsx(g,{onClick:()=>Ie(t),size:"small",sx:{fontSize:"1.2rem"},children:t})},t))})}),e.jsxs(Te,{anchorEl:T,open:!!T,onClose:S,TransitionComponent:Ne,PaperProps:{sx:{borderRadius:"16px",minWidth:180,mt:1.5}},children:[e.jsxs(z,{onClick:S,children:[e.jsx(Ge,{sx:{mr:1.5,color:l.primary}}),e.jsx(x,{variant:"body2",fontWeight:600,children:"View Profile"})]}),e.jsxs(z,{onClick:S,children:[e.jsx(Xe,{sx:{mr:1.5,color:"#64748B"}}),e.jsx(x,{variant:"body2",fontWeight:600,children:"Mute Chat"})]}),e.jsx(ce,{}),e.jsxs(z,{onClick:ve,sx:{color:"#F44336"},children:[e.jsx(tt,{sx:{mr:1.5}}),e.jsx(x,{variant:"body2",fontWeight:600,children:"Clear History"})]})]}),e.jsx("style",{children:"@keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }"})]})};export{wt as default};
