import{u as Q,a as Z,r as l,j as e,B as i,T as a,c as C,ac as ee,ad as te,S as H,g as x,ak as L,ag as M,ah as O,a6 as U,a7 as _,a8 as W,y as k,K as re,p as ae}from"./index-D-AUwBgS.js";import{D as q}from"./Delete-BMYh7xNU.js";import{D as G}from"./DialogContentText-CHVNUQLQ.js";import{D as X}from"./DialogActions-SxxXCai-.js";import{C as oe}from"./CardMedia-slOHpzv5.js";import{A as ie}from"./Add-DQyDUOHy.js";const se=k(ae)(({theme:n})=>({width:280,height:"auto",cursor:"pointer",transition:"transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:n.shadows[4]},position:"relative"})),ne=k(i)({position:"absolute",top:8,right:8,display:"flex",gap:1,backgroundColor:"rgba(255, 255, 255, 0.9)",borderRadius:"50%",padding:"4px",opacity:0,transition:"opacity 0.2s","&:hover":{opacity:1}}),le=k(i)(({theme:n})=>({width:280,height:300,border:"2px dashed #E15B65",borderRadius:n.shape.borderRadius,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"border-color 0.2s","&:hover":{borderColor:n.palette.primary.main,backgroundColor:n.palette.action.hover}})),ue=()=>{var N;const n=Q(),w=Z(),[S,m]=l.useState("list"),[D,K]=l.useState([]),[o,j]=l.useState(null),[V,y]=l.useState(!0),[P,c]=l.useState(!1),[E,d]=l.useState(""),[A,h]=l.useState("success"),[I,T]=l.useState(!1),[b,B]=l.useState(null),f="https://api.bookmyevent.ae",v=t=>{if(!t)return"/placeholder.jpg";let r=t.toLowerCase().replace(/^uploads/i,"/uploads");return r.startsWith("/")||(r="/"+r),`${f}${r}`};l.useEffect(()=>{z()},[]);const z=async()=>{const t=localStorage.getItem("providerId");if(!t){y(!1),d("Provider ID missing. Please log in again."),h("error"),c(!0);return}const r=localStorage.getItem("token");if(!r){y(!1),d("No authentication token. Please log in."),h("error"),c(!0);return}try{const s=await fetch(`${f}/api/catering/provider/${t}`,{headers:{Authorization:`Bearer ${r}`}});if(s.ok){const u=await s.json();console.log("Fetched result:",u),K(u.data||[])}else throw new Error("Failed to fetch packages")}catch(s){console.error("Fetch error:",s),d("Failed to fetch packages"),h("error"),c(!0)}finally{y(!1)}},Y=t=>{j(t),m("preview")},R=t=>{w("/catering/addpackage",{state:{editPackage:t}})},F=t=>{B(t),T(!0)},g=()=>{T(!1),B(null)},$=async()=>{if(!b)return;const t=localStorage.getItem("token");if(!t){d("No authentication token found. Please log in."),h("error"),c(!0),g();return}try{const r=await fetch(`${f}/api/catering/${b}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}}),s=await r.json();if(r.ok)d("Package deleted successfully!"),h("success"),c(!0),z(),(o==null?void 0:o._id)===b&&(m("list"),j(null));else throw new Error(s.message||"Failed to delete package")}catch(r){console.error("Delete error:",r),d(`Error deleting package: ${r.message}`),h("error"),c(!0)}finally{g()}},p=(t,r)=>{r!=="clickaway"&&c(!1)};return V&&S==="list"?e.jsx(i,{sx:{p:3,backgroundColor:n.palette.grey[100],minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(a,{variant:"h6",children:"Loading packages..."})}):S==="preview"&&o?e.jsx(i,{sx:{p:3,backgroundColor:n.palette.grey[100],minHeight:"100vh",width:"100%"},children:e.jsxs(i,{sx:{width:"100%",margin:"auto",backgroundColor:"white",borderRadius:n.shape.borderRadius,boxShadow:n.shadows[1],p:3,overflowX:"hidden"},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx(C,{onClick:()=>{m("list"),j(null)},color:"primary",children:e.jsx(ee,{})}),e.jsx(a,{variant:"h5",component:"h1",children:"Package Preview"})]}),e.jsxs(i,{sx:{position:"relative",mb:3},children:[e.jsx("img",{src:v(o.thumbnail),alt:o.title,style:{width:"100%",height:200,objectFit:"cover",borderRadius:8},onError:t=>{t.target.onerror=null,t.target.src="/placeholder.jpg"}}),e.jsxs(i,{sx:{position:"absolute",bottom:0,left:0,right:0,background:"linear-gradient(transparent, rgba(0,0,0,0.7))",color:"white",p:2},children:[e.jsx(a,{variant:"h6",sx:{mb:.5},children:o.title||"Untitled Package"}),e.jsx(a,{variant:"body2",children:o.subtitle||"Traditional Style"})]})]}),e.jsx(a,{variant:"body1",sx:{mb:3,textAlign:"justify"},children:o.description||"No description available."}),o.categories&&o.categories.length>0&&e.jsxs(i,{sx:{mb:3},children:[e.jsx(a,{variant:"h6",sx:{mb:1},children:"Category"}),e.jsx(te,{label:((N=o.categories[0])==null?void 0:N.title)||"Uncategorized",variant:"outlined",color:"primary"})]}),e.jsx(a,{variant:"h6",sx:{mb:2},children:"Includes"}),(o.includes||[]).map((t,r)=>{var s;return e.jsxs(i,{sx:{mb:2},children:[e.jsx(a,{variant:"subtitle1",sx:{mb:1,fontWeight:"medium"},children:t.title||"Untitled Section"}),e.jsx(H,{component:"ul",spacing:.5,sx:{pl:2,mb:0},children:((s=t.items)==null?void 0:s.map((u,J)=>e.jsx(a,{variant:"body2",component:"li",children:u},J)))||e.jsx(a,{variant:"body2",color:"text.secondary",children:"No items"})})]},r)}),e.jsxs(i,{sx:{textAlign:"center",mb:3},children:[e.jsx(a,{variant:"h6",sx:{mb:.5},children:"Starting Price"}),e.jsxs(a,{variant:"h4",color:"primary",children:["₹",o.price||0," Per Head"]})]}),e.jsxs(i,{sx:{mb:3},children:[e.jsx(a,{variant:"subtitle1",sx:{mb:1},children:"Gallery"}),e.jsxs(H,{direction:"row",spacing:2,sx:{flexWrap:"wrap",justifyContent:"center"},children:[(o.images||[]).slice(0,6).map((t,r)=>e.jsx(i,{sx:{position:"relative"},children:e.jsx("img",{src:v(t),alt:`Gallery image ${r+1}`,style:{width:150,height:150,objectFit:"cover",borderRadius:8},onError:s=>{s.target.onerror=null,s.target.src="/placeholder.jpg"}})},r)),(!o.images||o.images.length===0)&&e.jsx(a,{variant:"body2",color:"text.secondary",children:"No images"})]})]}),e.jsxs(i,{sx:{display:"flex",gap:2,justifyContent:"center"},children:[e.jsx(x,{variant:"outlined",startIcon:e.jsx(L,{}),onClick:()=>R(o),sx:{color:"#E15B65",borderColor:"#E15B65"},children:"Edit Package"}),e.jsx(x,{variant:"contained",startIcon:e.jsx(q,{}),onClick:()=>F(o._id),sx:{backgroundColor:"#E15B65",color:"white"},children:"Delete Package"})]}),e.jsx(M,{open:P,autoHideDuration:6e3,onClose:p,anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(O,{onClose:p,severity:A,sx:{width:"100%"},children:E})}),e.jsxs(U,{open:I,onClose:g,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(_,{id:"alert-dialog-title",children:"Confirm Delete"}),e.jsx(W,{children:e.jsx(G,{id:"alert-dialog-description",children:"Are you sure you want to delete this package? This action cannot be undone."})}),e.jsxs(X,{children:[e.jsx(x,{onClick:g,color:"primary",children:"Cancel"}),e.jsx(x,{onClick:$,color:"error",autoFocus:!0,children:"Delete"})]})]})]})}):e.jsx(i,{sx:{p:3,backgroundColor:n.palette.grey[100],minHeight:"100vh",width:"100%"},children:e.jsxs(i,{sx:{width:"100%",margin:"auto",backgroundColor:"white",borderRadius:n.shape.borderRadius,boxShadow:n.shadows[1],p:3,overflowX:"hidden"},children:[e.jsx(a,{variant:"h4",component:"h1",sx:{mb:3,textAlign:"center"},children:"Catering Packages"}),e.jsxs(i,{sx:{display:"flex",flexWrap:"wrap",gap:3,justifyContent:"center"},children:[D.length>0?D.map(t=>e.jsxs(se,{onClick:()=>Y(t),onMouseEnter:r=>{var s;return(s=r.currentTarget.querySelector(".action-overlay"))==null?void 0:s.style.setProperty("opacity","1")},onMouseLeave:r=>{var s;return(s=r.currentTarget.querySelector(".action-overlay"))==null?void 0:s.style.setProperty("opacity","0")},children:[e.jsxs(i,{sx:{position:"relative"},children:[e.jsx(oe,{component:"img",height:"200",image:v(t.thumbnail),alt:t.title,sx:{objectFit:"cover"},onError:r=>{r.target.onerror=null,r.target.src="/placeholder.jpg"}}),e.jsxs(ne,{className:"action-overlay",children:[e.jsx(C,{size:"small",onClick:r=>{r.stopPropagation(),R(t)},children:e.jsx(L,{fontSize:"small",color:"primary"})}),e.jsx(C,{size:"small",onClick:r=>{r.stopPropagation(),F(t._id)},children:e.jsx(q,{fontSize:"small",color:"error"})})]})]}),e.jsxs(re,{sx:{p:2},children:[e.jsx(a,{variant:"h6",sx:{mb:1,fontWeight:"medium"},children:t.title||"Untitled Package"}),e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:1},children:t.subtitle||"Traditional Style"}),e.jsxs(a,{variant:"h6",color:"primary",children:["₹",t.price||0," Per Head"]})]})]},t._id)):e.jsx(i,{sx:{textAlign:"center",py:4},children:e.jsx(a,{variant:"body1",color:"text.secondary",sx:{mb:2},children:"No packages found. Create your first one!"})}),e.jsxs(le,{onClick:()=>w("/catering/addpackage"),children:[e.jsx(ie,{sx:{fontSize:48,color:"#E15B65",mb:2}}),e.jsx(a,{variant:"h6",color:"#E15B65",children:"Add New Package"})]})]}),e.jsx(M,{open:P,autoHideDuration:6e3,onClose:p,anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(O,{onClose:p,severity:A,sx:{width:"100%"},children:E})}),e.jsxs(U,{open:I,onClose:g,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(_,{id:"alert-dialog-title",children:"Confirm Delete"}),e.jsx(W,{children:e.jsx(G,{id:"alert-dialog-description",children:"Are you sure you want to delete this package? This action cannot be undone."})}),e.jsxs(X,{children:[e.jsx(x,{onClick:g,color:"primary",children:"Cancel"}),e.jsx(x,{onClick:$,color:"error",autoFocus:!0,children:"Delete"})]})]})]})})};export{ue as default};
