import{ah as at,w as st,r as s,h as w,j as e,B as c,t as Ue,b as S,aj as it,T as p,x as Fe,ae as O,s as d,S as f,F as A,I as P,af as E,W as y,C as nt,a2 as rt,a4 as lt,O as ot,f as Q,ak as q,g as Le,aq as ct}from"./index-1PfbYpor.js";import{A as dt}from"./Add-DL5-x7jO.js";import{C as K}from"./Close-DZmEmjvg.js";import{C as Re}from"./CloudUpload-9pYFCimW.js";const m="#E91E63",D="http://localhost:5000",ut="68e5fc09651cc12c1fc0f9c9",ht=({variation:x,onChange:k,onDelete:j})=>e.jsxs(f,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"center",sx:{mb:2},children:[e.jsx(d,{label:"Variation Name (e.g. Half Kg)",value:x.name||"",onChange:C=>k("name",C.target.value),sx:{flex:1}}),e.jsx(d,{label:"Price (AED)",type:"number",value:x.price||"",onChange:C=>k("price",C.target.value),sx:{width:150}}),e.jsx(S,{onClick:j,color:"error",children:e.jsx(ct,{})})]}),jt=()=>{const{id:x}=at(),k=st(),j=!!x,[C,J]=s.useState(!0),[X,Y]=s.useState(!1),[Z,W]=s.useState(""),[ee,g]=s.useState(""),[ze,Me]=s.useState([]),[te,Ge]=s.useState([]),[$e,He]=s.useState(!0),[u,Oe]=s.useState(null),[N,ae]=s.useState(""),[se,ie]=s.useState(""),[V,ne]=s.useState(""),[_,re]=s.useState([]),[le,oe]=s.useState("Veg"),[B,ce]=s.useState(""),[U,de]=s.useState(""),[F,ue]=s.useState(!0),[he,pe]=s.useState("10:00"),[me,ge]=s.useState("22:00"),[L,xe]=s.useState(""),[je,fe]=s.useState("Amount"),[R,be]=s.useState(""),[z,ye]=s.useState(""),[M,Ce]=s.useState(""),[G,ve]=s.useState(!0),[$,Se]=s.useState(!1),[ke,I]=s.useState([{id:Date.now(),name:"",price:""}]),[b,Ie]=s.useState(null),[Te,Qe]=s.useState(""),[T,we]=s.useState([]),[H,Ae]=s.useState([]);s.useEffect(()=>{try{const t=localStorage.getItem("vendor")||localStorage.getItem("user")||localStorage.getItem("vendorData");t&&Oe(JSON.parse(t))}catch(t){console.error("Vendor load error:",t)}},[]),s.useEffect(()=>{w.get(`${D}/api/categories/modules/${ut}`).then(t=>{const a=t.data.data||[];Me(a),Ge([])}).catch(()=>g("Failed to load categories")).finally(()=>He(!1))},[]),s.useEffect(()=>{if(!j){J(!1);return}(async()=>{var a,n,o,h,r,l,Pe,Ee,De,We,Ne,Ve,_e;try{const{data:Be}=await w.get(`${D}/api/cakes/${x}`),i=Be.data;ae(i.name),ie(i.shortDescription),ne(((a=i.category)==null?void 0:a._id)||""),re(((n=i.subCategories)==null?void 0:n.map(v=>v._id))||[]),oe(i.itemType),ce(((o=i.nutrition)==null?void 0:o.join(", "))||""),de(((h=i.allergenIngredients)==null?void 0:h.join(", "))||""),ue(i.isHalal),pe(((r=i.timeSchedule)==null?void 0:r.startTime)||"10:00"),ge(((l=i.timeSchedule)==null?void 0:l.endTime)||"22:00"),xe(((Pe=i.priceInfo)==null?void 0:Pe.unitPrice)||""),fe(((Ee=i.priceInfo)==null?void 0:Ee.discountType)||"Amount"),be(((De=i.priceInfo)==null?void 0:De.discount)||""),ye(((We=i.priceInfo)==null?void 0:We.maxPurchaseQty)||""),Ce(((Ne=i.searchTags)==null?void 0:Ne.join(", "))||""),ve(i.isActive),Se(i.isTopPick),((Ve=i.variations)==null?void 0:Ve.length)>0&&I(i.variations.map(v=>({id:v._id||Date.now(),name:v.name,price:v.price}))),i.thumbnail&&Qe(i.thumbnail),((_e=i.images)==null?void 0:_e.length)>0&&Ae(i.images)}catch{g("Failed to load cake details")}finally{J(!1)}})()},[j,x]);const qe=()=>{I(t=>[...t,{id:Date.now(),name:"",price:""}])},Ke=(t,a,n)=>{I(o=>o.map(h=>h.id===t?{...h,[a]:n}:h))},Je=t=>{I(a=>a.filter(n=>n.id!==t))},Xe=t=>{const a=t.target.files[0];a&&Ie(a)},Ye=t=>{const a=Array.from(t.target.files);if(T.length+H.length+a.length>10){alert("Maximum 10 gallery images allowed");return}we(o=>[...o,...a])},Ze=t=>we(a=>a.filter((n,o)=>o!==t)),et=t=>Ae(a=>a.filter((n,o)=>o!==t)),tt=async()=>{var o,h;const t=(u==null?void 0:u._id)||(u==null?void 0:u.id);if(!t)return g("Vendor not authenticated");if(!N.trim())return g("Cake name is required");if(!V)return g("Select a category");if(!L)return g("Unit price is required");const a=new FormData;a.append("name",N),a.append("shortDescription",se),a.append("category",V),_.forEach(r=>a.append("subCategories",r)),a.append("itemType",le),a.append("isHalal",F),a.append("startTime",he),a.append("endTime",me),a.append("unitPrice",L),a.append("discountType",je),R&&a.append("discount",R),z&&a.append("maxPurchaseQty",z),a.append("isActive",G),a.append("isTopPick",$),a.append("provider",t),B.trim()&&B.split(",").map(l=>l.trim()).filter(Boolean).forEach(l=>a.append("nutrition",l)),U.trim()&&U.split(",").map(l=>l.trim()).filter(Boolean).forEach(l=>a.append("allergenIngredients",l)),M.trim()&&M.split(",").map(l=>l.trim()).filter(Boolean).forEach(l=>a.append("searchTags",l));const n=ke.filter(r=>r.name&&r.price).map(({name:r,price:l})=>({name:r,price:Number(l)}));n.length>0&&a.append("variations",JSON.stringify(n)),b&&a.append("thumbnail",b),T.forEach(r=>a.append("images",r));try{Y(!0),g(""),W(""),j?(await w.put(`${D}/api/cakes/${x}`,a,{headers:{"Content-Type":"multipart/form-data"}}),W("Cake updated successfully!")):(await w.post(`${D}/api/cakes`,a,{headers:{"Content-Type":"multipart/form-data"}}),W("Cake created successfully!"))}catch(r){g(((h=(o=r.response)==null?void 0:o.data)==null?void 0:h.message)||"Error saving cake")}finally{Y(!1),window.scrollTo({top:0,behavior:"smooth"})}};return C||$e?e.jsx(c,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:e.jsx(Ue,{size:60})}):e.jsxs(c,{sx:{bgcolor:"#f9f9fc",minHeight:"100vh"},children:[e.jsxs(c,{sx:{bgcolor:"white",borderBottom:"1px solid #eee",p:2,px:4,position:"sticky",top:0,zIndex:10},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(S,{onClick:()=>k(-1),children:e.jsx(it,{})}),e.jsxs(p,{variant:"h5",fontWeight:"bold",children:[j?"Edit":"Add"," Cake"]})]}),u&&e.jsxs(p,{variant:"body2",color:"text.secondary",sx:{ml:7},children:["Creating as: ",u.firstName," ",u.lastName]})]}),e.jsxs(c,{sx:{p:{xs:2,md:4}},children:[Z&&e.jsx(Fe,{severity:"success",sx:{mb:3},children:Z}),ee&&e.jsx(Fe,{severity:"error",sx:{mb:3},children:ee}),e.jsxs(O,{elevation:3,sx:{borderRadius:3,p:{xs:3,md:6}},children:[e.jsx(d,{fullWidth:!0,label:"Cake Name *",value:N,onChange:t=>ae(t.target.value),sx:{mb:3}}),e.jsx(d,{fullWidth:!0,label:"Short Description",multiline:!0,rows:2,value:se,onChange:t=>ie(t.target.value),sx:{mb:3}}),e.jsxs(f,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsxs(A,{fullWidth:!0,children:[e.jsx(P,{children:"Category *"}),e.jsx(E,{value:V,onChange:t=>ne(t.target.value),children:ze.map(t=>e.jsx(y,{value:t._id,children:t.title},t._id))})]}),e.jsxs(A,{fullWidth:!0,children:[e.jsx(P,{children:"Sub Categories"}),e.jsx(E,{multiple:!0,value:_,onChange:t=>re(t.target.value),input:e.jsx(ot,{}),renderValue:t=>e.jsx(c,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(a=>{const n=te.find(o=>o._id===a);return e.jsx(lt,{label:(n==null?void 0:n.title)||a,size:"small"},a)})}),children:te.map(t=>e.jsxs(y,{value:t._id,children:[e.jsx(nt,{checked:_.includes(t._id)}),e.jsx(rt,{primary:t.title})]},t._id))})]})]}),e.jsxs(f,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsxs(A,{fullWidth:!0,children:[e.jsx(P,{children:"Item Type"}),e.jsxs(E,{value:le,onChange:t=>oe(t.target.value),children:[e.jsx(y,{value:"Veg",children:"Veg"}),e.jsx(y,{value:"Non-Veg",children:"Non-Veg"})]})]}),e.jsx(Q,{control:e.jsx(q,{checked:F,onChange:()=>ue(!F)}),label:"Halal Certified"})]}),e.jsxs(f,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsx(d,{fullWidth:!0,label:"Nutrition (comma separated)",placeholder:"e.g. Sugar, Milk, Flour",value:B,onChange:t=>ce(t.target.value)}),e.jsx(d,{fullWidth:!0,label:"Allergen Ingredients (comma separated)",placeholder:"e.g. Nuts, Gluten",value:U,onChange:t=>de(t.target.value)})]}),e.jsx(p,{variant:"h6",sx:{mb:2,color:m},children:"Availability Time"}),e.jsxs(f,{direction:{xs:"column",sm:"row"},spacing:3,sx:{mb:4},children:[e.jsx(d,{label:"Start Time",type:"time",value:he,onChange:t=>pe(t.target.value),InputLabelProps:{shrink:!0}}),e.jsx(d,{label:"End Time",type:"time",value:me,onChange:t=>ge(t.target.value),InputLabelProps:{shrink:!0}})]}),e.jsx(p,{variant:"h6",sx:{mb:2,color:m},children:"Pricing"}),e.jsxs(f,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsx(d,{fullWidth:!0,label:"Base Unit Price (AED) *",type:"number",value:L,onChange:t=>xe(t.target.value)}),e.jsxs(A,{sx:{minWidth:120},children:[e.jsx(P,{children:"Discount Type"}),e.jsxs(E,{value:je,onChange:t=>fe(t.target.value),children:[e.jsx(y,{value:"Amount",children:"Amount"}),e.jsx(y,{value:"Percentage",children:"Percentage"})]})]}),e.jsx(d,{label:"Discount Value",type:"number",value:R,onChange:t=>be(t.target.value)}),e.jsx(d,{label:"Max Purchase Qty",type:"number",value:z,onChange:t=>ye(t.target.value)})]}),e.jsxs(c,{sx:{mb:4},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(p,{variant:"h6",sx:{color:m},children:"Variations (Size/Weight)"}),e.jsx(Le,{variant:"contained",startIcon:e.jsx(dt,{}),sx:{bgcolor:m},onClick:qe,children:"Add Variation"})]}),ke.map(t=>e.jsx(ht,{variation:t,onChange:(a,n)=>Ke(t.id,a,n),onDelete:()=>Je(t.id)},t.id))]}),e.jsx(d,{fullWidth:!0,label:"Search Tags (comma separated)",placeholder:"e.g. chocolate, birthday, wedding",value:M,onChange:t=>Ce(t.target.value),sx:{mb:4}}),e.jsxs(f,{direction:"row",spacing:4,sx:{mb:4},children:[e.jsx(Q,{control:e.jsx(q,{checked:G,onChange:()=>ve(!G)}),label:"Active"}),e.jsx(Q,{control:e.jsx(q,{checked:$,onChange:()=>Se(!$)}),label:"Top Pick"})]}),e.jsx(p,{variant:"h6",sx:{color:m,mb:2},children:"Thumbnail Image *"}),e.jsxs(O,{onClick:()=>document.getElementById("thumbnail-input").click(),sx:{border:"2px dashed #ddd",borderRadius:2,p:4,textAlign:"center",cursor:"pointer",mb:4},children:[e.jsx("input",{id:"thumbnail-input",type:"file",hidden:!0,accept:"image/*",onChange:Xe}),b||Te?e.jsxs(c,{sx:{position:"relative",display:"inline-block"},children:[e.jsx("img",{src:b?URL.createObjectURL(b):Te,alt:"Thumbnail",style:{width:200,height:200,objectFit:"cover",borderRadius:8}}),b&&e.jsx(S,{onClick:t=>{t.stopPropagation(),Ie(null)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(K,{})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{sx:{fontSize:60,color:"#ccc"}}),e.jsx(p,{sx:{mt:2,color:m,fontWeight:"bold"},children:"Click to Upload Thumbnail"})]})]}),e.jsx(p,{variant:"h6",sx:{color:m,mb:2},children:"Gallery Images (Max 10)"}),e.jsxs(O,{onClick:()=>document.getElementById("gallery-input").click(),sx:{border:"2px dashed #ddd",borderRadius:2,p:4,textAlign:"center",cursor:"pointer",mb:4},children:[e.jsx("input",{id:"gallery-input",type:"file",hidden:!0,multiple:!0,accept:"image/*",onChange:Ye}),T.length>0||H.length>0?e.jsxs(c,{sx:{display:"flex",flexWrap:"wrap",gap:2,justifyContent:"center"},children:[H.map((t,a)=>e.jsxs(c,{sx:{position:"relative"},children:[e.jsx("img",{src:t,alt:"",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(S,{onClick:n=>{n.stopPropagation(),et(a)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(K,{fontSize:"small"})})]},`ex-${a}`)),T.map((t,a)=>e.jsxs(c,{sx:{position:"relative"},children:[e.jsx("img",{src:URL.createObjectURL(t),alt:"",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(S,{onClick:n=>{n.stopPropagation(),Ze(a)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(K,{fontSize:"small"})})]},`new-${a}`))]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{sx:{fontSize:60,color:"#ccc"}}),e.jsx(p,{sx:{mt:2,color:m,fontWeight:"bold"},children:"Click to Upload Gallery Images"})]})]}),e.jsx(Le,{fullWidth:!0,variant:"contained",size:"large",onClick:tt,disabled:X||!u,sx:{py:2,bgcolor:m,"&:hover":{bgcolor:"#c2185b"}},children:X?e.jsx(Ue,{size:28,color:"inherit"}):j?"Update Cake":"Create Cake"})]})]})]})};export{jt as default};
