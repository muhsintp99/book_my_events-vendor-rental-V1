import{r as o,f as Re,j as e,B as r,e as Le,C as $e,q as Ie,T as u,a as L,b as y,y as ce,o as T,z as ue,c as Pe,Y as Ue,a1 as Fe,H as he,a2 as Ve}from"./index-DF1Xuk6o.js";import{T as xe,a as $}from"./Tabs-BndJO_Dp.js";import{C as Ee,V as We}from"./VideoLibrary-zpGJWHPc.js";import{T as Ae}from"./TableContainer-CIS_VKxp.js";import{T as Oe,a as z,b as a,c as Be}from"./TableRow-BWQVUeyW.js";import{T as _e}from"./TableHead-CRBXVJ-u.js";import{C as me}from"./Close-CWkVHLel.js";const n="https://api.bookmyevent.ae",C=Re.create({baseURL:n}),l="#0f172a";function He(){const I=JSON.parse(localStorage.getItem("user")||"{}"),p=I==null?void 0:I._id,k=localStorage.getItem("moduleId"),[N,pe]=o.useState(!1),[Y,H]=o.useState(!1),[b,w]=o.useState(0),[P,U]=o.useState(""),[J,F]=o.useState(""),[K,V]=o.useState(""),[Q,X]=o.useState(null),E=!!Q,[W,Z]=o.useState(null),[be,ee]=o.useState([]),[h,A]=o.useState(null),[te,O]=o.useState([]),[B,S]=o.useState([]),[R,_]=o.useState(""),[g,D]=o.useState(null),[f,ge]=o.useState(0),[ie,fe]=o.useState([]),[je,G]=o.useState(!1),[se,ve]=o.useState([]),[oe,re]=o.useState(0),[ye,M]=o.useState(!1),[j,Te]=o.useState("");o.useEffect(()=>{!p||!k||C.get(`/api/subscription/status/${p}?moduleId=${k}`).then(t=>{var s;const i=(s=t.data)==null?void 0:s.subscription;pe((i==null?void 0:i.status)==="active"&&(i==null?void 0:i.isCurrent))})},[p,k]);const q=async()=>{const t=await C.get(`/api/portfolio/provider/${p}`);fe(t.data.data||[])};o.useEffect(()=>{q()},[]);const Ce=t=>{if(!t)return null;const i=t.match(/(?:youtube\.com\/.*v=|youtu\.be\/)([^&]+)/);return i?`https://img.youtube.com/vi/${i[1]}/hqdefault.jpg`:null},ke=async()=>{if(!N)return alert("Upgrade plan required");if(!P.trim())return alert("Title required");if(b===1){if(!B.length&&!R)return alert("Please upload a video or add a video link");if(!g)return alert("Video thumbnail is required")}const t=new FormData;if(t.append("providerId",p),t.append("module",k),t.append("workTitle",P),t.append("description",J),t.append("tags",K),b===0){if(!h&&!W)return alert("Thumbnail required");h&&t.append("thumbnail",h),te.forEach(i=>t.append("images",i))}else B.forEach(i=>t.append("videos",i)),R&&t.append("videoLinks",JSON.stringify([R])),g&&t.append("videoThumbnail",g);H(!0);try{E?await C.put(`/api/portfolio/${Q}`,t):await C.post("/api/portfolio",t),U(""),F(""),V(""),A(null),O([]),S([]),_(""),D(null),X(null),w(0),Z(null),ee([]),q()}catch(i){console.error("Portfolio error:",i),alert("Failed to save portfolio")}finally{H(!1)}},we=async t=>{window.confirm("Delete portfolio?")&&(await C.delete(`/api/portfolio/${t}`),q())},Se=t=>{var x,d,v;X(t._id),U(t.workTitle||""),F(t.description||""),V(t.tags||"");const i=(x=t.media)==null?void 0:x.find(c=>c.type==="image"),s=(d=t.media)==null?void 0:d.find(c=>c.type==="video"||c.type==="videoLink");i&&(w(0),Z(i.thumbnail||null),ee(i.gallery||[]),A(null),O([])),s&&(w(1),S([]),_(((v=s.videoLinks)==null?void 0:v[0])||""),D(null)),window.scrollTo({top:0,behavior:"smooth"})},le=f===0?ie.filter(t=>{var i;return(i=t.media)==null?void 0:i.some(s=>s.type==="image")}):ie.filter(t=>{var i;return(i=t.media)==null?void 0:i.some(s=>s.type==="video"||s.type==="videoLink")});return e.jsxs(r,{sx:{p:3,maxWidth:1800,mx:"auto"},children:[!N&&e.jsx(Le,{severity:"warning",sx:{mb:3},children:"Upgrade to premium to add portfolio works"}),e.jsx($e,{sx:{mb:5,borderRadius:3,width:"100%"},children:e.jsxs(Ie,{children:[e.jsx(u,{variant:"h5",fontWeight:700,mb:2,children:E?"Edit Portfolio Work":"Add Portfolio Work"}),e.jsxs(xe,{value:b,onChange:(t,i)=>w(i),sx:{mb:3,"& .MuiTabs-indicator":{backgroundColor:l},"& .MuiTab-root.Mui-selected":{color:l}},children:[e.jsx($,{label:"Images"}),e.jsx($,{label:"Videos"})]}),e.jsx(L,{fullWidth:!0,label:"Title",value:P,onChange:t=>U(t.target.value),sx:{mb:3}}),e.jsx(L,{fullWidth:!0,multiline:!0,rows:3,label:"Description",value:J,onChange:t=>F(t.target.value),sx:{mb:3}}),e.jsx(L,{fullWidth:!0,label:"Tags",value:K,onChange:t=>V(t.target.value),sx:{mb:4}}),b===0&&e.jsxs(e.Fragment,{children:[e.jsxs(y,{component:"label",variant:"contained",sx:{bgcolor:l,mb:2,"&:hover":{bgcolor:"#1e293b"}},children:[e.jsx(ce,{sx:{mr:1}})," Upload Thumbnail",e.jsx("input",{hidden:!0,type:"file",accept:"image/*",onChange:t=>A(t.target.files[0])})]}),W&&!h&&e.jsxs(r,{sx:{mb:3},children:[e.jsx(u,{variant:"caption",sx:{display:"block",mb:1},children:"Current Thumbnail"}),e.jsx("img",{src:`${n}/${W}`,style:{width:180,height:180,borderRadius:12,objectFit:"cover"}})]}),h&&e.jsxs(r,{sx:{mb:3},children:[e.jsx(u,{variant:"caption",sx:{display:"block",mb:1},children:"New Thumbnail"}),e.jsx("img",{src:URL.createObjectURL(h),style:{width:180,height:180,borderRadius:12,objectFit:"cover"}})]}),e.jsxs(y,{component:"label",variant:"outlined",sx:{mb:2,color:l,borderColor:l},children:[e.jsx(Ee,{sx:{mr:1}})," Upload Gallery Images",e.jsx("input",{hidden:!0,multiple:!0,type:"file",accept:"image/*",onChange:t=>O([...t.target.files])})]}),e.jsxs(r,{sx:{display:"flex",gap:2,flexWrap:"wrap",mb:4},children:[be.map((t,i)=>e.jsx("img",{src:`${n}/${t}`,style:{width:100,height:100,borderRadius:10,objectFit:"cover"}},`existing-${i}`)),te.map((t,i)=>e.jsx("img",{src:URL.createObjectURL(t),style:{width:100,height:100,borderRadius:10,border:`2px solid ${l}`,objectFit:"cover"}},`new-${i}`))]})]}),b===1&&e.jsxs(e.Fragment,{children:[e.jsxs(y,{component:"label",variant:"contained",sx:{bgcolor:l,mb:2,"&:hover":{bgcolor:"#1e293b"}},children:[e.jsx(We,{sx:{mr:1}})," Upload Videos",e.jsx("input",{hidden:!0,multiple:!0,type:"file",accept:"video/*",onChange:t=>S(Array.from(t.target.files))})]}),B.map((t,i)=>e.jsxs(r,{sx:{mb:2},children:[e.jsx("video",{src:URL.createObjectURL(t),controls:!0,style:{width:260,borderRadius:8}}),e.jsx(T,{color:"error",onClick:()=>S(s=>s.filter((x,d)=>d!==i)),children:e.jsx(ue,{})})]},i)),e.jsxs(y,{component:"label",variant:"outlined",sx:{mb:2,color:l,borderColor:l},children:[e.jsx(ce,{sx:{mr:1}})," Upload Video Thumbnail",e.jsx("input",{hidden:!0,type:"file",accept:"image/*",onChange:t=>D(t.target.files[0])})]}),g&&e.jsxs(r,{sx:{mb:3},children:[e.jsx(u,{variant:"caption",children:"Video Thumbnail Preview"}),e.jsx("img",{src:URL.createObjectURL(g),style:{width:160,height:100,objectFit:"cover",borderRadius:8,display:"block",marginTop:8}})]}),e.jsx(L,{fullWidth:!0,label:"Video Link (YouTube / Vimeo)",value:R,onChange:t=>_(t.target.value),sx:{mb:3}})]}),e.jsx(y,{fullWidth:!0,variant:"contained",sx:{bgcolor:l,py:1.4,"&:hover":{bgcolor:"#1e293b"}},onClick:ke,disabled:Y,children:Y?e.jsx(Pe,{size:24,sx:{color:"#fff"}}):E?"Update Portfolio":"Add Portfolio"})]})}),e.jsxs(xe,{value:f,onChange:(t,i)=>ge(i),sx:{mb:2,"& .MuiTabs-indicator":{backgroundColor:l},"& .MuiTab-root.Mui-selected":{color:l}},children:[e.jsx($,{label:"Images"}),e.jsx($,{label:"Videos"})]}),e.jsx(Ae,{component:Ue,sx:{borderRadius:3,width:"100%"},children:e.jsxs(Oe,{children:[e.jsx(_e,{sx:{bgcolor:"#f1f5f9"},children:e.jsxs(z,{children:[e.jsx(a,{children:"Work"}),e.jsx(a,{children:"Preview"}),e.jsx(a,{align:"center",children:"Count"}),e.jsx(a,{align:"right",children:"Action"})]})}),e.jsxs(Be,{children:[le.length===0&&e.jsx(z,{children:e.jsx(a,{colSpan:4,align:"center",children:e.jsx(u,{color:"text.secondary",children:"No portfolio items found"})})}),le.map(t=>{var x,d,v,c,ae;const i=t.media.find(m=>m.type==="image"),s=t.media.find(m=>m.type==="video"||m.type==="videoLink");return e.jsxs(z,{hover:!0,children:[e.jsxs(a,{children:[e.jsx(u,{fontWeight:600,children:t.workTitle}),e.jsx(u,{variant:"caption",color:"text.secondary",children:t.description})]}),e.jsxs(a,{children:[f===0&&i&&e.jsx("img",{src:`${n}/${i.thumbnail}`,style:{width:70,height:70,borderRadius:10,cursor:"pointer",objectFit:"cover"},onClick:()=>{ve(i.gallery||[]),re(0),G(!0)}}),f===1&&s&&e.jsxs(r,{sx:{cursor:"pointer"},onClick:()=>{var ne,de;const m=(ne=s.videos)!=null&&ne[0]?`${n}/${s.videos[0]}`:(de=s.videoLinks)==null?void 0:de[0];Te(m),M(!0)},children:[s.thumbnail&&e.jsx("img",{src:`${n}/${s.thumbnail}`,alt:"video thumbnail",style:{width:80,height:60,objectFit:"cover",borderRadius:6}}),!((x=s.videos)!=null&&x.length)&&((d=s.videoLinks)==null?void 0:d[0])&&e.jsx("img",{src:Ce(s.videoLinks[0])||"/video-placeholder.png",alt:"video thumbnail",style:{width:80,height:60,objectFit:"cover",borderRadius:6}})]})]}),e.jsx(a,{align:"center",children:f===0?((v=i==null?void 0:i.gallery)==null?void 0:v.length)||0:(((c=s==null?void 0:s.videos)==null?void 0:c.length)||0)+(((ae=s==null?void 0:s.videoLinks)==null?void 0:ae.length)||0)}),e.jsx(a,{align:"right",children:e.jsxs(r,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[e.jsx(T,{size:"small",sx:{color:l},onClick:()=>Se(t),children:e.jsx(Fe,{})}),e.jsx(T,{size:"small",color:"error",onClick:()=>we(t._id),children:e.jsx(ue,{})})]})})]},t._id)})]})]})}),e.jsx(he,{open:je,onClose:()=>G(!1),fullScreen:!0,children:e.jsxs(r,{sx:{bgcolor:"#000",height:"100vh",p:2},children:[e.jsx(T,{onClick:()=>G(!1),sx:{color:"#fff"},children:e.jsx(me,{})}),e.jsx(r,{sx:{textAlign:"center",mt:2},children:e.jsx("img",{src:`${n}/${se[oe]}`,style:{maxHeight:"70vh",maxWidth:"100%"}})}),e.jsx(Ve,{sx:{my:2,bgcolor:"#333"}}),e.jsx(r,{sx:{display:"flex",justifyContent:"center",gap:1},children:se.map((t,i)=>e.jsx("img",{src:`${n}/${t}`,onClick:()=>re(i),style:{width:60,height:60,borderRadius:8,border:oe===i?"2px solid #fff":"1px solid #444",cursor:"pointer"}},i))})]})}),e.jsx(he,{open:ye,onClose:()=>M(!1),fullScreen:!0,children:e.jsxs(r,{sx:{bgcolor:"#000",height:"100vh",p:2},children:[e.jsx(T,{onClick:()=>M(!1),sx:{color:"#fff"},children:e.jsx(me,{})}),e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"80%"},children:j!=null&&j.includes("http")?e.jsx("iframe",{src:j,width:"80%",height:"80%",frameBorder:"0",allowFullScreen:!0}):e.jsx("video",{src:j,controls:!0,style:{maxWidth:"80%"}})})]})})]})}export{He as default};
