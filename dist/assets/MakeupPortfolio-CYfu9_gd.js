import{r as l,h as Qe,j as e,B as c,t as Ye,ag as Xe,ah as Ze,p as ve,T as v,F as et,a9 as tt,Q as st,K as k,s as p,ad as w,g as I,G as L,c as x,a5 as be,a6 as it,a8 as rt}from"./index-Cq19nQvN.js";import{T as ot,a as ye}from"./Tabs-D2Vq0giP.js";import{C as Ce}from"./CloudUpload-CUbnba38.js";import{C as $}from"./Close-n7idMwYI.js";import{T as we}from"./TableContainer-MbQQWX9h.js";import{T as Ie,a as Se,b,c as a,d as Te}from"./TableRow-DPhzdEOu.js";import{D as ke}from"./Delete-BqgYStT1.js";import{L as Le,V as at,C as lt,a as nt}from"./VideoLibrary-BxqDg6fB.js";const N="https://api.bookmyevent.ae",V=Qe.create({baseURL:N});function jt({providerId:Ve}){const[D,De]=l.useState(0),[Ae,g]=l.useState(!1),[S,H]=l.useState({open:!1,message:"",severity:"success"}),[Me,Pe]=l.useState([]),[m,J]=l.useState(""),[Ue,K]=l.useState(!1),[f,Re]=l.useState([]),[A,M]=l.useState(0),[Fe,We]=l.useState(!1),y=(()=>{var t;return Ve||((t=JSON.parse(localStorage.getItem("user")||"{}"))==null?void 0:t._id)||localStorage.getItem("userId")})(),[G,q]=l.useState(""),[Q,Y]=l.useState(""),[X,P]=l.useState([]),[Z,ee]=l.useState(""),[U,R]=l.useState([]),[te,_e]=l.useState([]),[se,ie]=l.useState(""),[re,oe]=l.useState(""),[ae,F]=l.useState([]),[le,ne]=l.useState(""),[W,_]=l.useState([]),[E,O]=l.useState([]),[z,de]=l.useState(""),[ce,Ee]=l.useState([]);l.useEffect(()=>{(async()=>{var s;try{const r=await V.get("/api/modules");if(!Array.isArray(r.data))return;Pe(r.data);const i=r.data.find(n=>{var d;return(d=n.title)==null?void 0:d.toLowerCase().includes("makeup")}),o=(i==null?void 0:i._id)||((s=r.data[0])==null?void 0:s._id)||"";J(o),localStorage.setItem("moduleId",o)}catch(r){console.error("Failed to load modules",r)}})()},[]),l.useEffect(()=>{y&&m&&B()},[y,m]);const B=async()=>{try{g(!0);const t=await V.get(`/api/portfolio/provider/${y}`);if(!t.data.success)return;const s=(t.data.data||[]).filter(o=>o.module===m),r=s.filter(o=>{var n;return(n=o.media)==null?void 0:n.some(d=>d.type==="image")});_e(r.map(o=>({id:o._id,title:o.workTitle||"Untitled",description:o.description||"",tags:Array.isArray(o.tags)?o.tags:[],media:o.media.filter(n=>n.type==="image").flatMap(n=>n.images||[])})));const i=s.filter(o=>{var n;return(n=o.media)==null?void 0:n.some(d=>d.type==="video"||d.type==="videoLink")});Ee(i.map(o=>({id:o._id,title:o.workTitle||"Untitled",description:o.description||"",tags:Array.isArray(o.tags)?o.tags:[],media:o.media.reduce((n,d)=>d.type==="video"?[...n,...(d.videos||[]).map(C=>({type:"video",url:C}))]:d.type==="videoLink"?[...n,...(d.videoLinks||[]).map(C=>({type:"videoLink",url:C}))]:n,[])})))}catch{u("Unable to load portfolio","error")}finally{g(!1)}},u=(t,s="success")=>{H({open:!0,message:t,severity:s})},T=(t,s=0,r=!1)=>{const i=t.map(o=>o.type==="videoLink"?Oe(o.url):`${N}/${o.url}`);Re(i),M(s),We(r),K(!0)},Oe=t=>t.includes("youtube.com")||t.includes("youtu.be")?t.replace("watch?v=","embed/").split("&")[0]:t.includes("vimeo.com")?`https://player.vimeo.com/video/${t.split("/").pop().split("?")[0]}`:t,he=()=>K(!1),ze=()=>M(t=>t===0?f.length-1:t-1),Be=()=>M(t=>t===f.length-1?0:t+1),ue=(t,s,r)=>{t.trim()&&(r(i=>[...i,t.trim()]),s(""))},$e=t=>{const r=Array.from(t.target.files).map(i=>({file:i,preview:URL.createObjectURL(i)}));R(i=>[...i,...r])},Ne=t=>{URL.revokeObjectURL(U[t].preview),R(s=>s.filter((r,i)=>i!==t))},He=t=>{const r=Array.from(t.target.files).map(i=>({file:i,preview:URL.createObjectURL(i)}));_(i=>[...i,...r])},Je=t=>{URL.revokeObjectURL(W[t].preview),_(s=>s.filter((r,i)=>i!==t))},Ke=()=>{z.trim()&&(O(t=>[...t,z.trim()]),de(""))},Ge=t=>{O(s=>s.filter((r,i)=>i!==t))},pe=async(t,s,r,i,o,n,d,C,qe,ge,me=!1)=>{var fe,je;if(!t.trim()||i.length===0&&o.length===0)return u("Title and media required","warning");if(!y||!m)return u("Missing provider/module","error");const h=new FormData;h.append("providerId",y),h.append("module",m),h.append("workTitle",t),h.append("description",s),h.append("tags",JSON.stringify(r)),me?(i.forEach(j=>h.append("videos",j.file)),o.length>0&&h.append("videoLinks",JSON.stringify(o))):i.forEach(j=>h.append("images",j.file));try{g(!0),(await V.post("/api/portfolio",h,{headers:{"Content-Type":"multipart/form-data"}})).data.success&&(u(`${me?"Video":"Images"} added!`,"success"),B(),n(""),d(""),C([]),qe([]),ge&&ge([]))}catch(j){u(((je=(fe=j.response)==null?void 0:fe.data)==null?void 0:je.message)||"Upload failed","error")}finally{g(!1)}},xe=async t=>{if(window.confirm("Delete permanently?"))try{g(!0),await V.delete(`/api/portfolio/${t}`),u("Deleted!","success"),B()}catch{u("Delete failed","error")}finally{g(!1)}};return e.jsxs(c,{sx:{p:3},children:[Ae&&e.jsx(c,{sx:{position:"fixed",inset:0,bgcolor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:e.jsx(Ye,{size:60})}),e.jsx(Xe,{open:S.open,autoHideDuration:4e3,onClose:()=>H({...S,open:!1}),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(Ze,{severity:S.severity,children:S.message})}),e.jsxs(ve,{sx:{p:2,mb:3},children:[e.jsx(v,{variant:"h6",gutterBottom:!0,children:"Select Module"}),e.jsx(et,{fullWidth:!0,children:e.jsx(tt,{value:m,onChange:t=>{J(t.target.value),localStorage.setItem("moduleId",t.target.value)},children:Me.map(t=>e.jsx(st,{value:t._id,children:t.title},t._id))})})]}),e.jsxs(ve,{children:[e.jsxs(ot,{value:D,onChange:(t,s)=>De(s),children:[e.jsx(ye,{label:"Images"}),e.jsx(ye,{label:"Videos"})]}),D===0&&e.jsxs(e.Fragment,{children:[e.jsxs(k,{children:[e.jsx(v,{variant:"h6",gutterBottom:!0,children:"Add Portfolio Images"}),e.jsx(p,{fullWidth:!0,label:"Title",value:G,onChange:t=>q(t.target.value),sx:{mb:3}}),e.jsx(p,{fullWidth:!0,multiline:!0,rows:3,label:"Description",value:Q,onChange:t=>Y(t.target.value),sx:{mb:3}}),e.jsx(c,{sx:{mb:3},children:X.map((t,s)=>e.jsx(w,{label:t,onDelete:()=>P(r=>r.filter((i,o)=>o!==s)),sx:{mr:1}},s))}),e.jsx(p,{fullWidth:!0,label:"Add Tag (Enter)",value:Z,onChange:t=>ee(t.target.value),onKeyDown:t=>t.key==="Enter"&&(t.preventDefault(),ue(Z,ee,P)),sx:{mb:3}}),e.jsxs(I,{variant:"contained",component:"label",startIcon:e.jsx(Ce,{}),sx:{mb:2},children:["Upload Images",e.jsx("input",{hidden:!0,type:"file",multiple:!0,accept:"image/*",onChange:$e})]}),e.jsx(L,{container:!0,spacing:2,children:U.map((t,s)=>e.jsx(L,{item:!0,xs:6,sm:4,md:3,children:e.jsxs(c,{sx:{position:"relative"},children:[e.jsx("img",{src:t.preview,alt:"",style:{width:"100%",height:150,objectFit:"cover",borderRadius:8}}),e.jsx(x,{size:"small",onClick:()=>Ne(s),sx:{position:"absolute",top:4,right:4,bgcolor:"rgba(0,0,0,0.6)",color:"white"},children:e.jsx($,{})})]})},s))}),e.jsx(I,{fullWidth:!0,variant:"contained",sx:{mt:4},onClick:()=>pe(G,Q,X,U,[],q,Y,P,R,null,!1),children:"Add Portfolio"})]}),e.jsxs(k,{children:[e.jsx(v,{variant:"h6",gutterBottom:!0,children:"Portfolio List"}),e.jsx(we,{component:be,children:e.jsxs(Ie,{children:[e.jsx(Se,{children:e.jsxs(b,{children:[e.jsx(a,{children:"SI"}),e.jsx(a,{children:"Title"}),e.jsx(a,{children:"Preview"}),e.jsx(a,{children:"Count"}),e.jsx(a,{children:"Tags"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(Te,{children:te.length===0?e.jsx(b,{children:e.jsx(a,{colSpan:6,align:"center",children:"No images"})}):te.map((t,s)=>e.jsxs(b,{children:[e.jsx(a,{children:s+1}),e.jsx(a,{children:t.title}),e.jsx(a,{children:e.jsxs(c,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[t.media.slice(0,3).map((r,i)=>e.jsx("img",{src:`${N}/${r}`,style:{width:70,height:60,objectFit:"cover",borderRadius:4,cursor:"pointer"},onClick:()=>T(t.media.map(o=>({type:"image",url:o})),i,!1)},i)),t.media.length>3&&e.jsxs(c,{sx:{width:70,height:60,bgcolor:"rgba(0,0,0,0.6)",color:"white",borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},onClick:()=>T(t.media.map(r=>({type:"image",url:r})),0,!1),children:["+",t.media.length-3]})]})}),e.jsx(a,{children:t.media.length}),e.jsx(a,{children:t.tags.map((r,i)=>e.jsx(w,{size:"small",label:r,sx:{mr:.5}},i))}),e.jsx(a,{children:e.jsx(x,{color:"error",onClick:()=>xe(t.id),children:e.jsx(ke,{})})})]},t.id))})]})})]})]}),D===1&&e.jsxs(e.Fragment,{children:[e.jsxs(k,{children:[e.jsx(v,{variant:"h6",children:"Add Portfolio Videos"}),e.jsx(p,{fullWidth:!0,label:"Title",value:se,onChange:t=>ie(t.target.value),sx:{mb:3}}),e.jsx(p,{fullWidth:!0,multiline:!0,rows:3,label:"Description",value:re,onChange:t=>oe(t.target.value),sx:{mb:3}}),e.jsx(c,{sx:{mb:3},children:ae.map((t,s)=>e.jsx(w,{label:t,onDelete:()=>F(r=>r.filter((i,o)=>o!==s)),sx:{mr:1}},s))}),e.jsx(p,{fullWidth:!0,label:"Add Tag (Enter)",value:le,onChange:t=>ne(t.target.value),onKeyDown:t=>t.key==="Enter"&&(t.preventDefault(),ue(le,ne,F)),sx:{mb:3}}),e.jsxs(I,{variant:"contained",component:"label",startIcon:e.jsx(Ce,{}),sx:{mb:2},children:["Upload Videos",e.jsx("input",{hidden:!0,multiple:!0,type:"file",accept:"video/*",onChange:He})]}),e.jsx(v,{variant:"body2",sx:{my:2},children:"Or add video links (YouTube / Vimeo)"}),e.jsxs(c,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(p,{fullWidth:!0,label:"Video Link",value:z,onChange:t=>de(t.target.value)}),e.jsx(I,{variant:"contained",startIcon:e.jsx(Le,{}),onClick:Ke,children:"Add"})]}),E.length>0&&e.jsx(c,{sx:{mb:2},children:E.map((t,s)=>e.jsx(w,{label:t,onDelete:()=>Ge(s),sx:{mr:1,mb:1}},s))}),e.jsx(L,{container:!0,spacing:2,children:W.map((t,s)=>e.jsx(L,{item:!0,xs:6,sm:4,md:3,children:e.jsxs(c,{sx:{position:"relative"},children:[e.jsx("video",{src:t.preview,controls:!0,style:{width:"100%",height:150,borderRadius:8}}),e.jsx(x,{size:"small",onClick:()=>Je(s),sx:{position:"absolute",top:4,right:4,bgcolor:"rgba(0,0,0,0.6)",color:"white"},children:e.jsx($,{})})]})},s))}),e.jsx(I,{fullWidth:!0,variant:"contained",sx:{mt:4},onClick:()=>pe(se,re,ae,W,E,ie,oe,F,_,O,!0),children:"Add Video"})]}),e.jsxs(k,{children:[e.jsx(v,{variant:"h6",children:"Video List"}),e.jsx(we,{component:be,children:e.jsxs(Ie,{children:[e.jsx(Se,{children:e.jsxs(b,{children:[e.jsx(a,{children:"SI"}),e.jsx(a,{children:"Title"}),e.jsx(a,{children:"Preview"}),e.jsx(a,{children:"Count"}),e.jsx(a,{children:"Tags"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(Te,{children:ce.length===0?e.jsx(b,{children:e.jsx(a,{colSpan:6,align:"center",children:"No videos"})}):ce.map((t,s)=>e.jsxs(b,{children:[e.jsx(a,{children:s+1}),e.jsx(a,{children:t.title}),e.jsx(a,{children:e.jsxs(c,{sx:{display:"flex",gap:1},children:[t.media.slice(0,3).map((r,i)=>e.jsx(c,{onClick:()=>T(t.media,i,!0),sx:{width:80,height:60,borderRadius:1,cursor:"pointer",border:"2px solid #ddd",bgcolor:r.type==="videoLink"?"#d32f2f":"#000",color:"white",display:"flex",alignItems:"center",justifyContent:"center"},children:r.type==="videoLink"?e.jsx(Le,{}):e.jsx(at,{})},i)),t.media.length>3&&e.jsxs(c,{onClick:()=>T(t.media,0,!0),sx:{width:80,height:60,bgcolor:"rgba(211,47,47,0.9)",color:"white",borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontWeight:"bold"},children:["+",t.media.length-3]})]})}),e.jsx(a,{children:t.media.length}),e.jsx(a,{children:t.tags.map((r,i)=>e.jsx(w,{size:"small",label:r,sx:{mr:.5}},i))}),e.jsx(a,{children:e.jsx(x,{color:"error",onClick:()=>xe(t.id),children:e.jsx(ke,{})})})]},t.id))})]})})]})]})]}),e.jsx(it,{open:Ue,onClose:he,maxWidth:"lg",fullWidth:!0,children:e.jsxs(rt,{sx:{bgcolor:"black",position:"relative",minHeight:"80vh",p:0},children:[e.jsx(x,{onClick:he,sx:{position:"absolute",top:10,right:10,color:"white",zIndex:10},children:e.jsx($,{})}),e.jsxs(c,{sx:{textAlign:"center",color:"white",py:2},children:[A+1," / ",f.length]}),Fe?e.jsx("iframe",{src:f[A],style:{width:"100%",height:"70vh",border:"none"},allow:"autoplay; fullscreen",allowFullScreen:!0}):e.jsx("img",{src:f[A],style:{maxWidth:"100%",maxHeight:"70vh",objectFit:"contain"}}),f.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(x,{onClick:ze,sx:{position:"absolute",top:"50%",left:10,color:"white",bgcolor:"rgba(0,0,0,0.5)"},children:e.jsx(lt,{fontSize:"large"})}),e.jsx(x,{onClick:Be,sx:{position:"absolute",top:"50%",right:10,color:"white",bgcolor:"rgba(0,0,0,0.5)"},children:e.jsx(nt,{fontSize:"large"})})]})]})})]})}export{jt as default};
