import{c as Ne,j as s,r as c,w as ze,B as H,t as $e,ap as _e,aq as Pe,T as d,x as de,ad as he,S as p,F as X,ag as Y,$ as x,g as C,a9 as O,s as Re,a as Fe,b as P,al as Le,V as Ve,ar as We,ab as Me,ac as De,ao as He,h as R}from"./index-Btts58oS.js";import{S as Oe}from"./Search-Bvon-5tB.js";import{T as Ue}from"./TableContainer-ME0MMKPX.js";import{T as Ge,a as Ke,b as Z,c as o,d as qe}from"./TableRow-DT8HSS7i.js";import{E as Je}from"./Edit-DOXd-dej.js";import{D as Qe}from"./DialogTitle-sQOvJsSg.js";import{D as Xe}from"./DialogActions-w4tJi46u.js";const Ye=Ne(s.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}));function os(){const[ee,U]=c.useState([]),[A,ge]=c.useState([]),[m,xe]=c.useState([]),[pe,G]=c.useState(!0),[se,ue]=c.useState(""),[fe,S]=c.useState(!1),[je,u]=c.useState(""),[te,f]=c.useState("success"),[h,F]=c.useState({search:"",category:"",brand:"",type:""}),[j,L]=c.useState({category:"",brand:"",type:""}),[y,K]=c.useState(""),[me,V]=c.useState(!1),[q,re]=c.useState(null),J=ze(),v="https://api.bookmyevent.ae/api",Q=localStorage.getItem("moduleId");localStorage.getItem("providerId");const ye=async()=>{try{if(!Q)return;const e=localStorage.getItem("token"),[t,r]=await Promise.all([R.get(`${v}/brands/module/${Q}`,{headers:{Authorization:`Bearer ${e}`}}),R.get(`${v}/vehicle-categories`,{headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}})]);ge(Array.isArray(t.data)?t.data:[]);let a=[];r.data.success&&Array.isArray(r.data.data)&&(a=r.data.data.filter(i=>{var l;return((l=i.module)==null?void 0:l._id)===Q}).map(i=>({_id:i._id,title:i.title}))),xe(a)}catch(e){console.error("Error fetching options:",e)}},ie=e=>{if(!e)return"N/A";if(typeof e=="object"&&e.title)return e.title;if(typeof e=="string"){const t=m.find(r=>r._id===e);return t?t.title:"N/A"}if(Array.isArray(e)&&e.length>0){const t=e[0];if(typeof t=="object"&&t.title)return t.title;const r=m.find(a=>a._id===(t._id||t));return r?r.title:"N/A"}return"N/A"},ae=e=>{if(!e)return"N/A";if(typeof e=="object"&&e.title)return e.title;if(typeof e=="string"){const t=A.find(r=>r._id===e);return t?t.title:"N/A"}return"N/A"},be=async()=>{var e;G(!0);try{const t=localStorage.getItem("token"),r=JSON.parse(localStorage.getItem("user")||"{}"),a=r==null?void 0:r._id;if(!t||!a){console.error("Provider ID or token missing"),u("Provider authentication missing. Please log in again."),f("error"),S(!0),G(!1);return}const i=await R.get(`${v}/vehicles/provider/${a}`,{headers:{Authorization:`Bearer ${t}`}});(e=i.data)!=null&&e.success?(console.log("Fetched vehicles:",i.data.data),console.log("Available categories:",m),console.log("Available brands:",A),i.data.data&&i.data.data.length>0&&(console.log("First vehicle structure:",i.data.data[0]),console.log("First vehicle category:",i.data.data[0].category),console.log("First vehicle brand:",i.data.data[0].brand)),U(i.data.data||[])):console.error("Error fetching vehicles:",i.data.message)}catch(t){console.error("Error fetching vehicles:",t),u("Failed to load vehicles "),f("error"),S(!0)}finally{G(!1)}};c.useEffect(()=>{ye()},[]),c.useEffect(()=>{m.length>0&&A.length>0&&be()},[m,A]);const Ce=()=>{F({...j,search:y})},Ae=()=>{F(e=>({...e,search:y}))},Se=()=>{K(""),F(e=>({...e,search:""}))},ve=()=>{K(""),L({category:"",brand:"",type:""}),F({search:"",category:"",brand:"",type:""})},ke=e=>{re(e),V(!0)},we=()=>{const e=["Sl,Name,Plate,Category,Brand,Seating,Basic Price,Discount,Grand Total,Active"],t=W.map((n,b)=>{var k,w,T,I,B,E,N,z,$,_;const g=((w=(k=n.pricing)==null?void 0:k.basicPackage)==null?void 0:w.price)||((T=n.pricing)==null?void 0:T.hourly)||((I=n.pricing)==null?void 0:I.perDay)||0,M=((B=n.pricing)==null?void 0:B.grandTotal)||g,D=((E=n.capacityAndComfort)==null?void 0:E.seatingCapacity)||n.seatingCapacity||"-";return`${b+1},${n.name||""},${n.licensePlateNumber||""},${ie(n.category)},${ae(n.brand)},${D},${g},${((z=(N=n.pricing)==null?void 0:N.discount)==null?void 0:z.value)||0}${((_=($=n.pricing)==null?void 0:$.discount)==null?void 0:_.type)==="percentage"?"%":""},${M},${n.isActive?"Active":"Inactive"}`}),r=e.concat(t).join(`
`),a=new Blob([r],{type:"text/csv"}),i=URL.createObjectURL(a),l=document.createElement("a");l.href=i,l.download="vehicles.csv",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(i)},Te=async(e,t,r)=>{var a,i;try{const l=localStorage.getItem("token");(await R.put(`${v}/vehicles/${e}`,{[t]:!r},{headers:{Authorization:`Bearer ${l}`}})).data.success?(U(b=>b.map(g=>g._id===e?{...g,[t]:!r}:g)),u("Vehicle status updated successfully "),f("success")):(u("Failed to update vehicle status "),f("error"))}catch(l){console.error("Error toggling status:",l),u(((i=(a=l.response)==null?void 0:a.data)==null?void 0:i.message)||"Error updating vehicle"),f("error")}finally{S(!0)}},Ie=async()=>{var e,t;if(q)try{const r=localStorage.getItem("token");await R.delete(`${v}/vehicles/${q}`,{headers:{Authorization:`Bearer ${r}`}}),U(a=>a.filter(i=>i._id!==q)),u("Vehicle deleted successfully"),f("success")}catch(r){u(((t=(e=r.response)==null?void 0:e.data)==null?void 0:t.message)||"Failed to delete vehicle"),f("error")}finally{S(!0),V(!1),re(null)}},Be=e=>{J(`/vehicle-setup/leads/${e._id}`,{state:{vehicle:e}})},W=ee.filter(e=>{var a,i;let t=((a=e.category)==null?void 0:a._id)||e.category;Array.isArray(e.category)&&e.category.length>0&&(t=e.category[0]._id||e.category[0]);const r=((i=e.brand)==null?void 0:i._id)||e.brand;return(h.brand?r===h.brand:!0)&&(h.category?t===h.category:!0)&&(h.type?e.type===h.type||e.vehicleType===h.type.toLowerCase()||e.bikeType===h.type.toLowerCase():!0)&&(h.search?(e.name||"").toLowerCase().includes(h.search.toLowerCase())||(e.licensePlateNumber||"").toLowerCase().includes(h.search.toLowerCase())||(e.model||"").toLowerCase().includes(h.search.toLowerCase()):!0)}),oe=(e,t)=>{t!=="clickaway"&&S(!1)};return pe?s.jsx(H,{sx:{bgcolor:"#fafafa",minHeight:"100vh",p:2,display:"flex",justifyContent:"center",alignItems:"center"},children:s.jsx($e,{})}):s.jsxs(H,{sx:{bgcolor:"#fafafa",minHeight:"100vh",p:2},children:[s.jsx(_e,{position:"static",color:"default",elevation:0,children:s.jsx(Pe,{children:s.jsx(d,{variant:"h6",sx:{flexGrow:1,color:"#333"},children:"VEHICLES"})})}),se&&s.jsx(de,{severity:"error",sx:{mt:2},onClose:()=>ue(""),children:se}),s.jsx(he,{sx:{p:2,mt:2,borderRadius:"12px",boxShadow:"0 2px 10px rgba(0,0,0,0.05)"},children:s.jsxs(p,{direction:"row",spacing:2,flexWrap:"wrap",alignItems:"center",children:[s.jsx(X,{sx:{minWidth:200},size:"small",children:s.jsxs(Y,{displayEmpty:!0,value:j.category,onChange:e=>L({...j,category:e.target.value}),sx:{borderRadius:"8px"},children:[s.jsx(x,{value:"",children:"All Categories"}),m.map(e=>s.jsx(x,{value:e._id,children:e.title},e._id))]})}),s.jsx(X,{sx:{minWidth:200},size:"small",children:s.jsxs(Y,{displayEmpty:!0,value:j.brand,onChange:e=>L({...j,brand:e.target.value}),sx:{borderRadius:"8px"},children:[s.jsx(x,{value:"",children:"All Brands"}),A.map(e=>s.jsx(x,{value:e._id,children:e.title},e._id))]})}),s.jsx(X,{sx:{minWidth:200},size:"small",children:s.jsxs(Y,{displayEmpty:!0,value:j.type,onChange:e=>L({...j,type:e.target.value}),sx:{borderRadius:"8px"},children:[s.jsx(x,{value:"",children:"All Types"}),s.jsx(x,{value:"Car",children:"Car"}),s.jsx(x,{value:"Bus",children:"Bus"}),s.jsx(x,{value:"Van",children:"Van"}),s.jsx(x,{value:"Bike",children:"Bike"})]})}),s.jsx(C,{variant:"contained",onClick:Ce,sx:{bgcolor:"#E15B65","&:hover":{bgcolor:"#d14b55"},borderRadius:"8px",px:3},children:"Filter"}),s.jsx(C,{variant:"outlined",onClick:ve,sx:{color:"#666",borderColor:"#ccc","&:hover":{borderColor:"#999",bgcolor:"#f5f5f5"},borderRadius:"8px"},children:"Reset"})]})}),s.jsxs(he,{sx:{p:2,mt:2},children:[s.jsxs(p,{direction:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",spacing:2,mb:2,children:[s.jsxs(d,{variant:"h6",sx:{fontWeight:600},children:["Total Vehicles"," ",s.jsx(O,{label:W.length,color:"success",size:"small",sx:{ml:1}})]}),s.jsxs(p,{direction:"row",spacing:1,flexWrap:"wrap",children:[s.jsx(Re,{size:"small",placeholder:"Search by vehicle name",value:y,onChange:e=>K(e.target.value),InputProps:{endAdornment:s.jsxs(Fe,{position:"end",children:[s.jsx(P,{onClick:Ae,size:"small",disabled:!y,sx:{color:y?"inherit":"action"},children:s.jsx(Oe,{fontSize:"small"})}),y&&s.jsx(P,{onClick:Se,size:"small",children:s.jsx(Ye,{fontSize:"small"})})]})}}),s.jsx(C,{variant:"outlined",color:"#E15B65",sx:{color:"#E15B65",borderRadius:"8px"},onClick:we,children:"Export"}),s.jsx(C,{variant:"contained",sx:{bgcolor:"#E15B65"},onClick:()=>J("/vehicle-setup/leads"),children:"New Vehicle"})]})]}),s.jsx(Ue,{children:s.jsxs(Ge,{children:[s.jsx(Ke,{sx:{bgcolor:"#f9fafb"},children:s.jsxs(Z,{children:[s.jsx(o,{children:"Sl"}),s.jsx(o,{children:"Vehicle Info"}),s.jsx(o,{children:"Category"}),s.jsx(o,{children:"Brand"}),s.jsx(o,{children:"Type"}),s.jsx(o,{children:"Trip Fare"}),s.jsx(o,{children:"Details"}),s.jsx(o,{children:"Status"}),s.jsx(o,{children:"Action"})]})}),s.jsxs(qe,{children:[W.map((e,t)=>{var b,g,M,D,k,w,T,I,B,E,N,z,$,_,ne,le,ce;const r=((g=(b=e.pricing)==null?void 0:b.basicPackage)==null?void 0:g.price)||((M=e.pricing)==null?void 0:M.hourly)||((D=e.pricing)==null?void 0:D.perDay)||((k=e.pricing)==null?void 0:k.distanceWise),a=(w=e.pricing)==null?void 0:w.grandTotal,i=((T=e.capacityAndComfort)==null?void 0:T.seatingCapacity)||e.seatingCapacity,l=((I=e.engineCharacteristics)==null?void 0:I.fuelType)||e.fuelType,n=((E=(B=e.engineCharacteristics)==null?void 0:B.transmissionType)==null?void 0:E.value)||((N=e.engineCharacteristics)==null?void 0:N.transmissionType)||e.transmissionType;return s.jsxs(Z,{sx:{"&:hover":{bgcolor:"#fbfbfb"}},children:[s.jsx(o,{children:t+1}),s.jsx(o,{children:s.jsxs(p,{direction:"row",spacing:2,alignItems:"center",children:[s.jsx(H,{component:"img",src:e.featuredImage||"https://via.placeholder.com/100x100?text=No+Image",sx:{width:50,height:50,borderRadius:"8px",objectFit:"cover",border:"1px solid #eee"},onError:Ee=>{Ee.target.src="https://via.placeholder.com/100x100?text=No+Image"}}),s.jsxs(H,{children:[s.jsx(d,{variant:"body2",sx:{fontWeight:700,color:"#2563eb"},children:e.name||"N/A"}),s.jsxs(d,{variant:"caption",color:"text.secondary",display:"block",children:["Plate: ",e.licensePlateNumber||"N/A"]}),s.jsxs(d,{variant:"caption",color:"text.secondary",children:["Model: ",e.model||"N/A"]})]})]})}),s.jsx(o,{children:s.jsx(O,{label:ie(e.category),size:"small",variant:"outlined"})}),s.jsx(o,{children:ae(e.brand)}),s.jsx(o,{children:s.jsx(d,{variant:"body2",sx:{fontWeight:500},children:e.type||e.vehicleType||e.bikeType||"N/A"})}),s.jsxs(o,{children:[a?s.jsxs(s.Fragment,{children:[s.jsxs(d,{variant:"subtitle2",sx:{fontWeight:700,color:"#E15B65"},children:["â‚¹",a]}),r&&r!==a&&s.jsxs(d,{variant:"caption",sx:{textDecoration:"line-through",color:"text.secondary"},children:["â‚¹",r]})]}):r?s.jsxs(d,{variant:"subtitle2",sx:{fontWeight:700},children:["â‚¹",r]}):s.jsx(d,{variant:"body2",color:"text.secondary",children:"No pricing"}),(($=(z=e.pricing)==null?void 0:z.basicPackage)==null?void 0:$.includedHours)&&s.jsxs(d,{variant:"caption",display:"block",color:"text.secondary",children:[e.pricing.basicPackage.includedHours," Hrs / ",e.pricing.basicPackage.includedKilometers," KM"]})]}),s.jsx(o,{children:s.jsxs(p,{spacing:.5,children:[s.jsxs(d,{variant:"caption",sx:{display:"flex",alignItems:"center",gap:.5},children:["ðŸª‘ ",s.jsx("strong",{children:"Seats:"})," ",i||"N/A"]}),s.jsxs(d,{variant:"caption",sx:{display:"flex",alignItems:"center",gap:.5},children:["â›½ ",s.jsx("strong",{children:"Fuel:"})," ",l||"N/A"]}),s.jsxs(d,{variant:"caption",sx:{display:"flex",alignItems:"center",gap:.5},children:["âš™ï¸ ",s.jsx("strong",{children:"Trans:"})," ",n||"N/A"]}),s.jsx(p,{direction:"row",spacing:1,children:(((_=e.engineCharacteristics)==null?void 0:_.airConditioning)!==void 0||((ne=e.availability)==null?void 0:ne.acAvailable)!==void 0||e.airCondition!==void 0)&&s.jsx(O,{label:(le=e.engineCharacteristics)!=null&&le.airConditioning||(ce=e.availability)!=null&&ce.acAvailable||e.airCondition?"AC":"Non-AC",size:"small",sx:{height:20,fontSize:"0.65rem"}})})]})}),s.jsx(o,{children:s.jsxs(p,{spacing:1,alignItems:"center",children:[s.jsx(Le,{checked:e.isActive!==!1,onChange:()=>Te(e._id,"isActive",e.isActive!==!1),size:"small",sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:"#E15B65"},"& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track":{backgroundColor:"#E15B65"}}}),e.isNew&&s.jsx(O,{label:"New",color:"success",size:"small",sx:{height:20,fontSize:"0.65rem"}})]})}),s.jsx(o,{children:s.jsxs(p,{direction:"row",spacing:1,children:[s.jsx(P,{size:"small",sx:{border:"1px solid #eee",color:"#2563eb",borderRadius:"8px",bgcolor:"#fff"},onClick:()=>J(`/vehicle-setup/listview/${e._id}`),children:s.jsx(Ve,{fontSize:"small"})}),s.jsx(P,{size:"small",sx:{border:"1px solid #eee",color:"#065f46",borderRadius:"8px",bgcolor:"#fff"},onClick:()=>Be(e),children:s.jsx(Je,{fontSize:"small"})}),s.jsx(P,{size:"small",sx:{border:"1px solid #eee",color:"#dc2626",borderRadius:"8px",bgcolor:"#fff"},onClick:()=>ke(e._id),children:s.jsx(We,{fontSize:"small"})})]})})]},e._id)}),W.length===0&&s.jsx(Z,{children:s.jsx(o,{colSpan:10,align:"center",children:ee.length===0?"No vehicles found. Add your first vehicle!":"No vehicles match the current filters"})})]})]})})]}),s.jsxs(Me,{open:me,onClose:()=>V(!1),children:[s.jsx(Qe,{children:"Confirm Deletion"}),s.jsx(De,{children:s.jsx(d,{children:"Are you sure you want to delete this vehicle? This action cannot be undone."})}),s.jsxs(Xe,{children:[s.jsx(C,{onClick:()=>V(!1),children:"Cancel"}),s.jsx(C,{onClick:Ie,variant:"contained",color:"error",children:"Delete"})]})]}),s.jsx(He,{open:fe,autoHideDuration:3e3,onClose:oe,anchorOrigin:{vertical:"top",horizontal:"center"},children:s.jsx(de,{onClose:oe,severity:te,sx:{backgroundColor:te==="success"?"#1976d2":"#d32f2f",color:"white"},children:je})})]})}export{os as default};
