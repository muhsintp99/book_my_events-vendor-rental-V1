import{d as Ae,m as De,g as Le,n as Me,r as n,j as e,B as a,s as b,o as f,p as Be,A as ne,T as d,a7 as ae,c as le,Y as z,X as Fe,a as Re,a2 as ce,aD as Ee,G as de,a5 as Oe,_ as Pe,M as A,aE as Te,f as xe,Q as D,a8 as Ne,a9 as Ge,aa as He,ab as Ye}from"./index-DF1Xuk6o.js";import{s as u,S as $e}from"./socket-CEGULcSF.js";import{O as Ve,M as Qe,N as Ue}from"./OpenInNew-BbIyjfC7.js";import{S as L}from"./Search-CB68Tsz3.js";import{C as Je}from"./Close-CWkVHLel.js";import{C as Xe}from"./Chat-B_xVAEVZ.js";import{A as Ke}from"./Add-D7XIlWA7.js";import{E as Ze}from"./EmojiEmotions-Bozr8lCh.js";import{D as qe}from"./DeleteOutline-BtG3beSD.js";import{F as et}from"./FilterList-iQzEBPYo.js";import{L as tt}from"./ListItem-PRoEfckJ.js";import{L as st}from"./ListItemAvatar-BCdfgyU_.js";const l={primary:"#673ab7",secondary:"#4527a0",dark:"#1A1A2E"},rt=["ðŸ˜Š","ðŸ˜‚","ðŸ˜","ðŸ‘","ðŸ™","ðŸ”¥","âœ¨","â¤ï¸","ðŸŽ‰","ðŸ’¡","ðŸŽµ","ðŸ“","ðŸ’¯","ðŸ‘","ðŸ™Œ","â­"],it="https://api.bookmyevent.ae",ot=i=>{if(!i)return"assets/img/default-placeholder.jpg";if(typeof i=="string"&&i.startsWith("http"))return i;typeof i=="string"&&i.startsWith("/var/www/backend/")&&(i=i.replace("/var/www/backend/",""));const g=String(i).replace(/^\//,"");return`${it}/${g}`},S=i=>{var g;return i?(g=i.userId)!=null&&g.firstName?(i.userId.firstName+" "+(i.userId.lastName||"")).trim():i.fullName||"Customer":"Customer"},he=i=>{if(!i)return"?";const g=i.split(" ");return g.length>=2?(g[0][0]+g[1][0]).toUpperCase():i.substring(0,2).toUpperCase()},jt=()=>{var K,Z,q,ee,te,se;Ae();const i=De(),g=Le(),h=Me(g.breakpoints.down("md")),pe=localStorage.getItem("user")||"{}",p=JSON.parse(pe),j=(p==null?void 0:p.providerId)||(p==null?void 0:p._id),[M,me]=n.useState([]),[s,B]=n.useState(((K=i.state)==null?void 0:K.enquiry)||null),[I,w]=n.useState([]),[F,v]=n.useState(""),[ge,R]=n.useState(!0),[fe,E]=n.useState(!1),[k,ue]=n.useState(""),[O,P]=n.useState(null),[T,N]=n.useState(null),[G,H]=n.useState(!1),[je,Y]=n.useState(""),[$,V]=n.useState(!!((Z=i.state)!=null&&Z.enquiry)),Q=n.useRef(null),U=n.useRef(null),_=n.useRef(new Set),J=n.useMemo(()=>{var o,r;let t=M;return(r=(o=i.state)==null?void 0:o.product)!=null&&r._id&&(t=t.filter(c=>String(c.packageId)===String(i.state.product._id))),t.filter(c=>S(c).toLowerCase().includes(k.toLowerCase()))},[M,k,(ee=(q=i.state)==null?void 0:q.product)==null?void 0:ee._id]),be=()=>{var t;(t=U.current)==null||t.scrollIntoView({behavior:"smooth"})};n.useEffect(()=>{if(!j)return;(async()=>{try{R(!0);const c=((await xe.get(`https://api.bookmyevent.ae/api/enquiries/provider/${j}`)).data.data||[]).filter(x=>{var ie,oe;const m=(x.description||"").toLowerCase(),y=(((ie=x.moduleId)==null?void 0:ie.moduleType)||"").toLowerCase(),re=(((oe=x.moduleId)==null?void 0:oe.title)||"").toLowerCase(),We=y.includes("light")||y.includes("sound")||re.includes("light")||re.includes("sound"),ze=m.includes("customize")||m.includes("design")||m.includes("light")||m.includes("sound");return We&&ze});me(c),!s&&c.length>0&&B(c[0])}catch(o){console.error("Failed to fetch enquiries:",o)}finally{R(!1)}})()},[j]),n.useEffect(()=>{if(!(s!=null&&s._id))return;(async()=>{var o;try{E(!0);const r=await xe.get(`https://api.bookmyevent.ae/api/enquiries/${s._id}/messages`);w(((o=r.data)==null?void 0:o.data)||[])}catch(r){console.error("Failed to fetch messages:",r)}finally{E(!1)}})()},[s==null?void 0:s._id]),n.useEffect(()=>{if(!(s!=null&&s._id)||!j)return;u.connected||u.connect(),u.emit("join_enquiry",{enquiryId:s._id,vendorId:j});const t=r=>{if(r.enquiryId&&r.enquiryId!==s._id)return;const c=r._id||r.timestamp;if(_.current.has(c)){_.current.delete(c),w(x=>x.map(m=>m.timestamp===r.timestamp&&String(m.senderId)===String(r.senderId)?{...r,time:r.time||new Date(r.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}:m));return}w(x=>x.some(y=>y._id===r._id||r.timestamp&&y.timestamp===r.timestamp)?x:[...x,{...r,time:r.time||new Date(r.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}])},o=r=>{w(c=>c.filter(x=>x._id!==r.messageId))};return u.on("receive_message",t),u.on("message_deleted",o),()=>{u.off("receive_message",t),u.off("message_deleted",o)}},[s==null?void 0:s._id,j]),n.useEffect(()=>{be()},[I]);const W=(t=F,o="text")=>{var x;if(o==="text"&&!t.trim()||!(s!=null&&s._id))return;const r=new Date().toISOString(),c={enquiryId:s._id,senderId:j,receiverId:((x=s.userId)==null?void 0:x._id)||s.userId,senderName:(p==null?void 0:p.businessName)||(p==null?void 0:p.name)||"Vendor",senderRole:"vendor",text:o==="text"?t:"Sent an image",message:o==="text"?t:"Sent an image",timestamp:r,type:o};_.current.add(r),w(m=>[...m,{...c,_id:"optimistic-"+Date.now(),time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}]),u.emit("send_message",c),o==="text"&&v("")},we=()=>{var t;return(t=Q.current)==null?void 0:t.click()},ye=t=>{const o=t.target.files[0];if(o){const r=new FileReader;r.onload=c=>W(c.target.result,"image"),r.readAsDataURL(o)}},Se=t=>P(t.currentTarget),X=()=>P(null),Ce=t=>{v(o=>o+t),X()},Ie=t=>N(t.currentTarget),C=()=>N(null),ve=()=>{w([]),C()},ke=t=>{B(t),h&&V(!0)},_e=()=>e.jsxs(a,{sx:{width:{xs:"100%",md:350},height:"100%",borderRight:"1px solid #E0E4EC",display:"flex",flexDirection:"column",bgcolor:"white"},children:[e.jsxs(a,{sx:{p:2,bgcolor:"white"},children:[e.jsxs(b,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[e.jsx(d,{variant:"h5",fontWeight:800,color:l.primary,children:"Customization"}),e.jsx(b,{direction:"row",spacing:1,children:e.jsx(f,{size:"small",sx:{bgcolor:D(l.primary,.05)},children:e.jsx(et,{fontSize:"small"})})})]}),e.jsxs(z,{sx:{p:"2px 8px",display:"flex",alignItems:"center",bgcolor:"#F1F5F9",borderRadius:"12px",boxShadow:"none"},children:[e.jsx(L,{sx:{color:"#64748B",ml:1}}),e.jsx(ae,{sx:{ml:1,flex:1,p:1,fontWeight:500},placeholder:"Search customers...",value:k,onChange:t=>ue(t.target.value)})]})]}),e.jsx(Ne,{sx:{flexGrow:1,overflowY:"auto",py:0},children:ge?e.jsx(a,{sx:{p:4,textAlign:"center"},children:e.jsx(le,{size:30})}):J.length===0?e.jsx(a,{sx:{p:4,textAlign:"center"},children:e.jsx(d,{variant:"body2",color:"text.secondary",children:"No customizations found"})}):J.map(t=>e.jsx(tt,{disablePadding:!0,children:e.jsxs(Ge,{selected:(s==null?void 0:s._id)===t._id,onClick:()=>ke(t),sx:{py:2,px:2,borderLeft:`4px solid ${(s==null?void 0:s._id)===t._id?l.primary:"transparent"}`,"&.Mui-selected":{bgcolor:D(l.primary,.05)}},children:[e.jsx(st,{children:e.jsx(He,{overlap:"circle",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot",color:"success",sx:{"& .MuiBadge-badge":{border:"2px solid white"}},children:e.jsx(ne,{sx:{bgcolor:D(l.primary,.1),color:l.primary,fontWeight:700},children:he(S(t))})})}),e.jsx(Ye,{primary:e.jsxs(b,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(d,{variant:"subtitle1",fontWeight:700,children:S(t)}),e.jsx(d,{variant:"caption",color:"text.secondary",children:new Date(t.createdAt).toLocaleDateString([],{month:"short",day:"numeric"})})]}),secondary:e.jsx(d,{variant:"body2",noWrap:!0,sx:{maxWidth:"180px",color:"#64748B"},children:t.description})})]})},t._id))})]});return e.jsxs(a,{sx:{height:"calc(100vh - 120px)",display:"flex",bgcolor:"white",borderRadius:"24px",overflow:"hidden",boxShadow:"0 20px 50px rgba(0,0,0,0.1)",border:"1px solid rgba(224, 228, 236, 0.5)",m:{xs:1,md:3}},children:[(!h||!$)&&e.jsx(_e,{}),(!h||$)&&e.jsxs(a,{sx:{flexGrow:1,display:"flex",flexDirection:"column",bgcolor:"#F8FAFC"},children:[e.jsx("input",{type:"file",hidden:!0,ref:Q,onChange:ye,accept:"image/*"}),e.jsxs(a,{sx:{p:h?1.5:2,bgcolor:"white",borderBottom:"1px solid #E0E4EC",display:"flex",alignItems:"center",justifyContent:"space-between",zIndex:10},children:[e.jsxs(b,{direction:"row",spacing:2,alignItems:"center",sx:{flexGrow:1},children:[h&&e.jsx(f,{onClick:()=>V(!1),children:e.jsx(Be,{})}),G?e.jsxs(a,{sx:{flex:1,bgcolor:"#f1f5f9",borderRadius:"12px",px:2,py:1,display:"flex",alignItems:"center",animation:"fadeIn 0.3s ease-in-out"},children:[e.jsx(L,{sx:{color:"#64748B",mr:1}}),e.jsx(ae,{fullWidth:!0,placeholder:"Search messages...",value:je,onChange:t=>Y(t.target.value),sx:{fontWeight:500}}),e.jsx(f,{size:"small",onClick:()=>{H(!1),Y("")},children:e.jsx(Je,{fontSize:"small"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{sx:{width:h?35:45,height:h?35:45,bgcolor:l.primary,fontWeight:800,fontSize:h?"0.9rem":"1.1rem"},children:he(S(s))}),e.jsxs(a,{sx:{minWidth:0},children:[e.jsx(d,{variant:h?"subtitle2":"subtitle1",fontWeight:800,sx:{lineHeight:1.2,noWrap:!0,overflow:"hidden",textOverflow:"ellipsis"},children:S(s)}),e.jsxs(b,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(d,{variant:"caption",sx:{color:l.secondary,fontWeight:700},children:s==null?void 0:s.email}),!h&&e.jsx(a,{sx:{width:4,height:4,borderRadius:"50%",bgcolor:"#CBD5E1"}}),!h&&e.jsx(d,{variant:"caption",sx:{color:"#64748B",fontWeight:600},children:s==null?void 0:s.contact})]})]}),e.jsx(a,{sx:{flexGrow:1}}),(s==null?void 0:s.packageDetails)&&e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1.5,p:"4px 10px",borderRadius:"12px",bgcolor:"rgba(255, 255, 255, 0.85)",backdropFilter:"blur(12px)",border:"1px solid rgba(103, 58, 183, 0.1)",boxShadow:"0 4px 15px rgba(0,0,0,0.05)",maxWidth:{xs:"140px",sm:"260px"},mr:1.5,transition:"all 0.3s ease","&:hover":{boxShadow:"0 6px 20px rgba(103, 58, 183, 0.1)",transform:"translateY(-1px)",bgcolor:"white"}},children:[e.jsx(a,{sx:{width:38,height:38,borderRadius:"8px",overflow:"hidden",flexShrink:0,border:"1.5px solid white",boxShadow:"0 2px 6px rgba(0,0,0,0.06)"},children:e.jsx("img",{src:ot(s.packageDetails.thumbnail),alt:"Package",style:{width:"100%",height:"100%",objectFit:"cover"}})}),e.jsxs(a,{sx:{minWidth:0,flexGrow:1},children:[e.jsx(d,{variant:"caption",sx:{display:"block",fontWeight:800,color:l.dark,fontSize:"0.68rem",noWrap:!0,overflow:"hidden",textOverflow:"ellipsis",lineHeight:1.1},children:s.packageDetails.name}),e.jsxs(b,{direction:"row",alignItems:"center",spacing:.5,children:[e.jsxs(d,{variant:"caption",sx:{fontWeight:900,color:l.primary,fontSize:"0.78rem"},children:["â‚¹",((te=s.packageDetails.buyPricing)==null?void 0:te.totalPrice)||((se=s.packageDetails.rentalPricing)==null?void 0:se.totalPrice)||"0"]}),e.jsx(f,{size:"small",component:"a",href:`https://bookmyevent.ae/light-details.html?id=${s.packageId}`,target:"_blank",sx:{p:0,color:l.primary,opacity:.6,"&:hover":{opacity:1,bgcolor:"transparent"}},children:e.jsx(Ve,{sx:{fontSize:11}})})]})]})]})]})]}),e.jsxs(b,{direction:"row",spacing:.5,alignItems:"center",children:[!G&&e.jsx(f,{onClick:()=>H(!0),sx:{color:"#64748B"},children:e.jsx(L,{fontSize:"small"})}),e.jsx(f,{onClick:Ie,sx:{color:"#64748B"},children:e.jsx(Qe,{fontSize:"small"})})]})]}),e.jsxs(a,{sx:{flexGrow:1,overflowY:"auto",p:h?1.5:3,display:"flex",flexDirection:"column",gap:2,backgroundImage:"radial-gradient(#673ab710 1px, transparent 1px)",backgroundSize:"20px 20px"},children:[fe?e.jsx(a,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx(le,{size:40})}):I.length===0?e.jsxs(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",opacity:.3},children:[e.jsx(Xe,{sx:{fontSize:60,color:l.primary,mb:1}}),e.jsx(d,{variant:"h6",fontWeight:600,children:"No messages yet"})]}):I.map((t,o)=>{const r=t.senderRole==="vendor";return e.jsxs(a,{sx:{alignSelf:r?"flex-end":"flex-start",maxWidth:{xs:"90%",md:"70%"},display:"flex",flexDirection:"column",alignItems:r?"flex-end":"flex-start"},children:[e.jsx(z,{sx:{p:t.type==="image"?.5:2,borderRadius:r?"20px 20px 4px 20px":"20px 20px 20px 4px",bgcolor:r?l.primary:"white",color:r?"white":l.dark,boxShadow:r?"0 8px 16px rgba(103, 58, 183, 0.2)":"0 4px 12px rgba(0,0,0,0.05)",border:r?"none":"1px solid rgba(224, 228, 236, 0.5)",overflow:"hidden"},children:t.type==="image"?e.jsx(a,{sx:{width:"100%",borderRadius:"16px",overflow:"hidden",display:"flex"},children:e.jsx("img",{src:t.file,alt:"sent",style:{maxWidth:"100%",maxHeight:"400px",objectFit:"cover"}})}):e.jsx(d,{variant:"body1",sx:{fontWeight:500,lineHeight:1.5},children:t.text||t.message})}),e.jsxs(d,{variant:"caption",sx:{mt:.5,px:1,color:"#94A3B8",fontWeight:600},children:[t.time||new Date(t.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})," ",r&&e.jsx(Fe,{sx:{fontSize:12,ml:.5,verticalAlign:"middle",color:l.primary}})]})]},t._id||o)}),e.jsx("div",{ref:U})]}),e.jsx(a,{sx:{p:h?1.5:2.5,bgcolor:"white",borderTop:"1px solid #E0E4EC"},children:e.jsxs(z,{component:"form",onSubmit:t=>{t.preventDefault(),W()},sx:{p:"4px 8px",display:"flex",alignItems:"center",borderRadius:"16px",bgcolor:"#F8FAFC",border:"1px solid #E2E8F0",boxShadow:"none"},children:[e.jsx(f,{onClick:we,sx:{color:"#64748B"},children:e.jsx(Ke,{})}),e.jsx(Re,{fullWidth:!0,placeholder:"Type a message...",variant:"standard",value:F,onChange:t=>v(t.target.value),InputProps:{disableUnderline:!0},sx:{ml:1,flex:1,"& .MuiInputBase-input":{fontWeight:500}}}),e.jsx(f,{onClick:Se,sx:{color:"#64748B"},children:e.jsx(Ze,{})}),e.jsx(ce,{sx:{height:28,mx:1},orientation:"vertical"}),e.jsx(f,{onClick:()=>W(),sx:{p:1.2,color:"white",bgcolor:l.primary,"&:hover":{bgcolor:l.secondary}},children:e.jsx($e,{sx:{fontSize:20}})})]})})]}),e.jsx(Ee,{open:!!O,anchorEl:O,onClose:X,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"right"},PaperProps:{sx:{p:1,borderRadius:"16px"}},children:e.jsx(de,{container:!0,spacing:1,sx:{width:"200px",p:1},children:rt.map(t=>e.jsx(de,{item:!0,xs:3,children:e.jsx(f,{onClick:()=>Ce(t),size:"small",sx:{fontSize:"1.2rem"},children:t})},t))})}),e.jsxs(Oe,{anchorEl:T,open:!!T,onClose:C,TransitionComponent:Pe,PaperProps:{sx:{borderRadius:"16px",minWidth:180,mt:1.5}},children:[e.jsxs(A,{onClick:C,children:[e.jsx(Te,{sx:{mr:1.5,color:l.primary}}),e.jsx(d,{variant:"body2",fontWeight:600,children:"View Profile"})]}),e.jsxs(A,{onClick:C,children:[e.jsx(Ue,{sx:{mr:1.5,color:"#64748B"}}),e.jsx(d,{variant:"body2",fontWeight:600,children:"Mute Chat"})]}),e.jsx(ce,{}),e.jsxs(A,{onClick:ve,sx:{color:"#F44336"},children:[e.jsx(qe,{sx:{mr:1.5}}),e.jsx(d,{variant:"body2",fontWeight:600,children:"Clear History"})]})]}),e.jsx("style",{children:"@keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }"})]})};export{jt as default};
