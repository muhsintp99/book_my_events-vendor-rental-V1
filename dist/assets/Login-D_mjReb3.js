import{u as W,r as o,j as e,F as C,I as A,O as D,a as R,b as T,V as _,c as J,d as M,G as t,e as N,C as V,T as u,L as h,B as q,A as G,f as $,g as B,h as K,i as Q,k as U,S as X,D as Y,l as Z,m as ee,n as te}from"./index-DGIydyV2.js";function se(){const i=W(),[c,E]=o.useState(!0),[x,L]=o.useState(!1),[m,z]=o.useState(""),[g,O]=o.useState(""),[p,j]=o.useState(""),F=async n=>{var f,b,y,S,I,w;n.preventDefault(),j("");try{const l=await B.post("https://api.bookmyevent.ae/api/auth/login",{email:m,password:g}),{token:v,user:r,profile:a}=l.data;c?localStorage.setItem("token",v):sessionStorage.setItem("token",v),localStorage.setItem("user",JSON.stringify(r));let d=null;if((f=a==null?void 0:a.module)!=null&&f._id&&(d=a.module._id,localStorage.setItem("moduleId",d),localStorage.setItem("logRes",a.module.title)),r!=null&&r._id&&d)try{const s=(b=(await B.get(`https://api.bookmyevent.ae/api/subscription/status/${r._id}?moduleId=${d}`)).data)==null?void 0:b.subscription;if((s==null?void 0:s.status)==="active"&&(s!=null&&s.isCurrent)){const H=new Date(s.endDate),P=Math.max(0,Math.ceil((H-new Date)/(1e3*60*60*24)));localStorage.setItem("upgrade",JSON.stringify({isSubscribed:!0,status:"active",plan:s.planId,module:s.moduleId,access:{canAccess:!0,isExpired:!1,daysLeft:P}}))}else localStorage.setItem("upgrade",JSON.stringify({isSubscribed:!1,status:"free",access:{canAccess:!1}}))}catch(k){console.error("Subscription fetch failed:",k),localStorage.setItem("upgrade",JSON.stringify({isSubscribed:!1,status:"free",access:{canAccess:!1}}))}window.location.href="/dashboard/default"}catch(l){j(((S=(y=l.response)==null?void 0:y.data)==null?void 0:S.message)||((w=(I=l.response)==null?void 0:I.data)==null?void 0:w.error)||"Invalid email or password")}};return e.jsxs("form",{onSubmit:F,children:[e.jsxs(C,{fullWidth:!0,sx:{...i.typography.customInput,mb:2},children:[e.jsx(A,{children:"Email Address"}),e.jsx(D,{type:"email",value:m,onChange:n=>z(n.target.value),required:!0})]}),e.jsxs(C,{fullWidth:!0,sx:{...i.typography.customInput,mb:2},children:[e.jsx(A,{children:"Password"}),e.jsx(D,{type:x?"text":"password",value:g,onChange:n=>O(n.target.value),endAdornment:e.jsx(R,{position:"end",children:e.jsx(T,{onClick:()=>L(!x),edge:"end",children:x?e.jsx(_,{}):e.jsx(J,{})})}),required:!0})]}),p&&e.jsx(M,{error:!0,children:p}),e.jsxs(t,{container:!0,justifyContent:"space-between",alignItems:"center",children:[e.jsx(N,{control:e.jsx(V,{checked:c,onChange:n=>E(n.target.checked)}),label:"Keep me logged in"}),e.jsx(u,{component:h,to:"/forgot-password",color:"#E15B65",sx:{textDecoration:"none"},children:"Forgot Password?"})]}),e.jsx(q,{sx:{mt:2},children:e.jsx(G,{children:e.jsx($,{fullWidth:!0,size:"large",type:"submit",variant:"contained",sx:{bgcolor:"#E15B65"},children:"Sign In"})})})]})}function ne(){return e.jsx(h,{to:ee,"aria-label":"theme-logo",children:e.jsx("img",{src:te,alt:"Book Logo",style:{width:160,height:50}})})}function oe(){const i=K(c=>c.breakpoints.down("md"));return e.jsx(Q,{children:e.jsxs(t,{container:!0,direction:"column",sx:{justifyContent:"flex-end",minHeight:"100vh"},children:[e.jsx(t,{size:12,children:e.jsx(t,{container:!0,sx:{justifyContent:"center",alignItems:"center",minHeight:"calc(100vh - 68px)"},children:e.jsx(t,{sx:{m:{xs:1,sm:3},mb:0},children:e.jsx(U,{children:e.jsxs(t,{container:!0,spacing:2,sx:{alignItems:"center",justifyContent:"center"},children:[e.jsx(t,{sx:{mb:3},children:e.jsx(ne,{})}),e.jsx(t,{size:12,children:e.jsx(t,{container:!0,direction:{xs:"column-reverse",md:"row"},sx:{alignItems:"center",justifyContent:"center"},children:e.jsx(t,{children:e.jsxs(X,{spacing:1,sx:{alignItems:"center",justifyContent:"center"},children:[e.jsx(u,{gutterBottom:!0,variant:i?"h3":"h2",sx:{color:"#E15B65"},children:"Hi, Welcome Back"}),e.jsx(u,{variant:"caption",sx:{fontSize:"16px",textAlign:{xs:"center",md:"inherit"}},children:"Enter your credentials to continue"})]})})})}),e.jsx(t,{size:12,children:e.jsx(se,{})}),e.jsx(t,{size:12,children:e.jsx(Y,{})}),e.jsx(t,{size:12,children:e.jsx(t,{container:!0,direction:"column",sx:{alignItems:"center"},size:12,children:e.jsx(u,{component:h,to:"/register",variant:"subtitle1",sx:{textDecoration:"none"},children:"Don't have an account? Sign up"})})})]})})})})}),e.jsx(t,{sx:{px:3,my:3},size:12,children:e.jsx(Z,{})})]})})}export{oe as default};
