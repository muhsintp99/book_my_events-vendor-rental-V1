import{u as J,r as h,j as e,B as i,t as Q,T as d,s as X,g as N,U as Y,W,x as Z,a4 as E,a8 as ee,R as se,b as re,ae as te}from"./index-4okDMdnD.js";import{A as oe}from"./ArrowDropDown-DB-B4hUi.js";import{S as ne}from"./Search-D-saeKmI.js";import{C as D}from"./Category-DCn0A7iv.js";import{S as O,K as ae,a as ie}from"./SubdirectoryArrowRight-D16Yb2c0.js";import{T as le}from"./TableContainer-C0CdaQmp.js";import{T as P,a as x,b as o,c as U}from"./TableRow-C6jbRdCj.js";import{T as z}from"./TableHead-B0pWnYBp.js";const ce="68e5fdf0eb7faab6e94b4f6f",pe=()=>{const b=J(),[j,F]=h.useState(""),[w,H]=h.useState([]),[g,p]=h.useState([]),[S,K]=h.useState({}),[y,v]=h.useState(null),[M,I]=h.useState(!0),[$,R]=h.useState(null),[T,V]=h.useState({}),u="https://api.bookmyevent.ae",f=localStorage.getItem("token"),k=(s,t="parent")=>{V(n=>({...n,[`${t}-${s}`]:!0}))};h.useEffect(()=>{(async()=>{I(!0);try{const t=await fetch(`${u}/api/categories/parents/${ce}`,{headers:{Accept:"application/json",Authorization:`Bearer ${f}`}});if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);const n=await t.json();if(n.success&&Array.isArray(n.data)){const l=r=>{if(!r)return"";if(r.startsWith("http"))return r;const c=r.startsWith("/")?r:`/${r}`;return`${u}${c}`},a=await Promise.all(n.data.map(async r=>{try{const c=await fetch(`${u}/api/categories/parents/${r._id}/subcategories`,{headers:{Accept:"application/json",Authorization:`Bearer ${f}`}});if(c.ok){const m=await c.json(),C=(m.success?m.data:[]).map(L=>({...L,image:l(L.image)}));return{id:r._id,name:r.title,image:l(r.image),description:r.description||"",subCategories:C}}}catch(c){console.error(`Error fetching subcategories for ${r.title}:`,c)}return{id:r._id,name:r.title,image:l(r.image),description:r.description||"",subCategories:[]}}));H(a),p(a)}else v("No categories found for ornaments module")}catch(t){console.error("Error fetching categories:",t.message),v(`Failed to fetch categories: ${t.message}`)}finally{I(!1)}})()},[u,f]);const q=s=>{K(t=>({...t,[s]:!t[s]}))},A=()=>{if(!j.trim()){p(w);return}const s=w.filter(t=>{var a;const n=t.name.toLowerCase().includes(j.toLowerCase()),l=(a=t.subCategories)==null?void 0:a.some(r=>r.title.toLowerCase().includes(j.toLowerCase()));return n||l});p(s)},G=s=>R(s.currentTarget),B=()=>R(null),_=s=>{let t=`SI,Type,Category Name,Parent Category
`,n=1;g.forEach(c=>{var m;t+=`${n++},Parent,${c.name},-
`,(m=c.subCategories)==null||m.forEach(C=>{t+=`${n++},Subcategory,${C.title},${c.name}
`})});const l=new Blob([t],{type:s==="excel"?"application/vnd.ms-excel":"text/csv"}),a=window.URL.createObjectURL(l),r=document.createElement("a");r.href=a,r.download=`ornaments_categories_${new Date().toISOString().slice(0,10)}.${s}`,r.click(),window.URL.revokeObjectURL(a),B()};return M?e.jsx(i,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},children:e.jsx(Q,{sx:{color:"#E91E63"}})}):e.jsx(i,{sx:{p:3,backgroundColor:b.palette.grey[100],minHeight:"100vh"},children:e.jsxs(i,{sx:{maxWidth:"lg",margin:"auto",backgroundColor:"white",borderRadius:b.shape.borderRadius,boxShadow:b.shadows[1],p:3},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(i,{children:[e.jsx(d,{variant:"h5",component:"h1",sx:{fontWeight:600},children:"Ornament Categories"}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Parent categories and their subcategories"})]}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(X,{variant:"outlined",placeholder:"Search categories...",value:j,onChange:s=>F(s.target.value),onKeyPress:s=>s.key==="Enter"&&A(),size:"small",sx:{minWidth:250}}),e.jsx(N,{variant:"outlined",startIcon:e.jsx(ne,{}),onClick:A,sx:{color:"#E91E63",borderColor:"#E91E63","&:hover":{borderColor:"#c2185b"}},children:"Search"}),e.jsx(N,{variant:"outlined",endIcon:e.jsx(oe,{}),onClick:G,sx:{color:"#E91E63",borderColor:"#E91E63","&:hover":{borderColor:"#c2185b"}},children:"Export"}),e.jsxs(Y,{anchorEl:$,open:!!$,onClose:B,children:[e.jsx(W,{onClick:()=>_("excel"),children:"Excel"}),e.jsx(W,{onClick:()=>_("csv"),children:"CSV"})]})]})]}),y&&e.jsx(Z,{severity:"error",sx:{mb:2},children:y}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:3},children:[e.jsx(E,{icon:e.jsx(D,{}),label:`${g.length} Parent Categories`,color:"primary",sx:{bgcolor:"#E91E63"}}),e.jsx(E,{icon:e.jsx(O,{}),label:`${g.reduce((s,t)=>{var n;return s+(((n=t.subCategories)==null?void 0:n.length)||0)},0)} Subcategories`,variant:"outlined",sx:{borderColor:"#E91E63",color:"#E91E63"}})]}),e.jsx(le,{component:ee,elevation:0,sx:{border:"1px solid #e0e0e0"},children:e.jsxs(P,{children:[e.jsx(z,{sx:{bgcolor:"#fce4ec"},children:e.jsxs(x,{children:[e.jsx(o,{width:50}),e.jsx(o,{width:50,children:"SI"}),e.jsx(o,{children:"Category Name"}),e.jsx(o,{children:"Image"}),e.jsx(o,{align:"center",children:"Subcategories"})]})}),e.jsx(U,{children:g.length===0?e.jsx(x,{children:e.jsx(o,{colSpan:6,align:"center",sx:{py:8},children:e.jsx(d,{variant:"h6",color:"text.secondary",children:"No categories found"})})}):g.map((s,t)=>{var n,l;return e.jsxs(se.Fragment,{children:[e.jsxs(x,{hover:!0,sx:{"& > *":{borderBottom:"unset"}},children:[e.jsx(o,{children:e.jsx(re,{size:"small",onClick:()=>q(s.id),disabled:!s.subCategories||s.subCategories.length===0,children:S[s.id]?e.jsx(ae,{}):e.jsx(ie,{})})}),e.jsx(o,{sx:{fontWeight:600},children:t+1}),e.jsx(o,{children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(D,{sx:{color:"#E91E63"}}),e.jsxs(i,{children:[e.jsx(d,{fontWeight:600,children:s.name}),s.description&&e.jsx(d,{variant:"caption",color:"text.secondary",children:s.description})]})]})}),e.jsx(o,{children:s.image&&!T[`parent-${s.id}`]?e.jsx("img",{src:s.image,alt:s.name,style:{width:80,height:60,objectFit:"cover",borderRadius:4},onError:()=>k(s.id,"parent")}):e.jsx(i,{sx:{width:80,height:60,bgcolor:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:1},children:e.jsx(d,{variant:"caption",color:"text.secondary",children:"No Image"})})}),e.jsx(o,{align:"center",children:e.jsx(E,{label:((n=s.subCategories)==null?void 0:n.length)||0,size:"small",color:((l=s.subCategories)==null?void 0:l.length)>0?"success":"default"})})]}),e.jsx(x,{children:e.jsx(o,{style:{paddingBottom:0,paddingTop:0},colSpan:5,children:e.jsx(te,{in:S[s.id],timeout:"auto",unmountOnExit:!0,children:e.jsxs(i,{sx:{margin:2,bgcolor:"#fafafa",borderRadius:1,p:2},children:[e.jsx(d,{variant:"subtitle2",gutterBottom:!0,sx:{color:"#E91E63",fontWeight:600},children:"Subcategories"}),s.subCategories&&s.subCategories.length>0?e.jsxs(P,{size:"small",children:[e.jsx(z,{children:e.jsxs(x,{children:[e.jsx(o,{children:"SI"}),e.jsx(o,{children:"Subcategory Name"}),e.jsx(o,{children:"Image"})]})}),e.jsx(U,{children:s.subCategories.map((a,r)=>e.jsxs(x,{children:[e.jsx(o,{children:r+1}),e.jsx(o,{children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(O,{sx:{fontSize:18,color:"#E91E63"}}),e.jsx(d,{children:a.title})]})}),e.jsx(o,{children:a.image&&!T[`sub-${a._id}`]?e.jsx("img",{src:a.image,alt:a.title,style:{width:60,height:45,objectFit:"cover",borderRadius:4},onError:()=>k(a._id,"sub")}):e.jsx(i,{sx:{width:60,height:45,bgcolor:"#e0e0e0",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:1},children:e.jsx(d,{variant:"caption",color:"text.secondary",children:"No Image"})})})]},a._id))})]}):e.jsx(d,{variant:"body2",color:"text.secondary",children:"No subcategories available"})]})})})})]},s.id)})})]})})]})})};export{pe as default};
