import{u as Pe,a as Te,ab as Be,r as l,j as e,B as r,c as D,ac as ie,T as s,S as $e,g as x,ak as Fe,a6 as Re,a7 as Ae,a8 as Me,ag as ae,ah as re,s as C,y as de,b as We}from"./index-D-AUwBgS.js";import{D as se}from"./Delete-BMYh7xNU.js";import{D as _e}from"./DialogContentText-CHVNUQLQ.js";import{D as ze}from"./DialogActions-SxxXCai-.js";import{A as ne}from"./Add-DQyDUOHy.js";import{C as le}from"./Close-DewXBq0c.js";import{C as oe}from"./CloudUpload-DK4gkATC.js";const ce=de(r)(({theme:o})=>({border:"2px dashed #e0e0e0",borderRadius:o.shape.borderRadius,padding:o.spacing(3),textAlign:"center",backgroundColor:o.palette.grey[50],cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"150px","&:hover":{borderColor:"#E15B65"},'& input[type="file"]':{display:"none"}})),He=de(r)({position:"relative",display:"inline-block"}),Ke=()=>{var ee,te;const o=Pe(),G=Te(),O=Be(),k=(ee=O.state)==null?void 0:ee.selectingForVenue,I=((te=O.state)==null?void 0:te.preSelected)||[],[U,y]=l.useState("list"),[n,P]=l.useState(null),[ue,he]=l.useState([]),[w,L]=l.useState([]),[m,T]=l.useState({packageTitle:"",subtitle:"",description:"",startingPrice:""}),[N,J]=l.useState([]),[V,v]=l.useState([{id:Date.now(),heading:"",includes:""}]),[B,S]=l.useState(null),[$,E]=l.useState([]),[q,M]=l.useState(null),[W,_]=l.useState([]),[K,p]=l.useState(!1),[Q,b]=l.useState(""),[X,j]=l.useState("success"),[pe,F]=l.useState(!1),g="https://api.bookmyevent.ae";l.useEffect(()=>{z()},[]),l.useEffect(()=>{I&&I.length>0&&(console.log("Pre-selected packages:",I),L(I))},[]);const z=async()=>{const t=localStorage.getItem("providerId")||localStorage.getItem("moduleId");if(!t)return;const i=localStorage.getItem("token");if(i)try{const a=await fetch(`${g}/api/packages/provider/${t}`,{headers:{Authorization:`Bearer ${i}`}});if(a.ok){const c=await a.json();he(c.packages||[])}else throw new Error("Failed to fetch packages")}catch(a){console.error("Error fetching packages:",a),b("Failed to fetch packages"),j("error"),p(!0)}},ge=t=>{console.log("Toggling package:",t),L(i=>i.some(a=>a._id===t._id)?i.filter(a=>a._id!==t._id):[...i,t])},xe=()=>{console.log("Saving selection:",w),G("/venue-setup/new",{state:{selectedPackages:w},replace:!0})},R=t=>{const{name:i,value:a}=t.target;T(c=>({...c,[i]:a}))},Y=(t,i,a)=>{v(c=>c.map(f=>f.id===t?{...f,[i]:a}:f))},me=()=>{v(t=>[...t,{id:Date.now(),heading:"",includes:""}])},be=t=>{v(i=>i.filter(a=>a.id!==t))},je=t=>{const i=t.target.files[0];i&&S(i)},fe=t=>{const i=Array.from(t.target.files);E(a=>[...a,...i])},ye=t=>{E(i=>i.filter((a,c)=>c!==t))},ve=()=>{S(null)},A=(t,i)=>{i!=="clickaway"&&p(!1)},Ce=t=>{var i;T({packageTitle:t.title||"",subtitle:t.subtitle||"",description:t.description||"",startingPrice:((i=t.price)==null?void 0:i.toString())||""}),J(t.categories||[]),v((t.includes||[]).map((a,c)=>{var f;return{id:Date.now()+c,heading:a.title||"",includes:((f=a.items)==null?void 0:f.join(", "))||""}})),M(t.thumbnail?`${g}/${t.thumbnail}`:null),_((t.images||[]).map(a=>`${g}/${a}`)),S(null),E([])},ke=()=>{n&&Ce(n),y("form")},we=()=>{F(!0)},Se=async()=>{if(!(n!=null&&n._id))return;const t=localStorage.getItem("token");if(!t){b("No authentication token found. Please log in."),j("error"),p(!0),F(!1);return}try{const i=await fetch(`${g}/api/packages/${n._id}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}}),a=await i.json();if(i.ok)b("Package deleted successfully!"),j("success"),p(!0),z(),y("list"),P(null),T({packageTitle:"",subtitle:"",description:"",startingPrice:""}),v([{id:Date.now(),heading:"",includes:""}]),S(null),E([]),M(null),_([]);else throw new Error(a.message||"Failed to delete package")}catch(i){console.error("Error deleting package:",i),b(`Error deleting package: ${i.message}`),j("error"),p(!0)}finally{F(!1)}},Z=()=>{F(!1)},Ee=async t=>{t.preventDefault();const i=localStorage.getItem("token");if(!i){b("No authentication token found. Please log in."),j("error"),p(!0);return}const a=localStorage.getItem("providerId")||localStorage.getItem("moduleId");if(!a){b("Provider ID is missing. Please log in again."),j("error"),p(!0);return}const c=V.filter(d=>d.includes.trim()).map(d=>({title:d.heading.trim()||"Menu Item",items:d.includes.split(",").map(h=>h.trim()).filter(h=>h)})),f=parseFloat(m.startingPrice)||0,u=new FormData;u.append("providerId",a),u.append("title",m.packageTitle||"Custom Package"),u.append("subtitle",m.subtitle||""),u.append("description",m.description||""),u.append("packageType","custom"),u.append("includes",JSON.stringify(c)),u.append("price",f.toString()),N.length>0&&u.append("categories",JSON.stringify(N)),B&&u.append("thumbnail",B),$.forEach(d=>{u.append("images",d)});const H=!!(n!=null&&n._id),De=H?`${g}/api/packages/${n._id}`:`${g}/api/packages`,Ie=H?"PUT":"POST";try{const d=await fetch(De,{method:Ie,body:u,headers:{Authorization:`Bearer ${i}`}});let h;try{h=await d.json()}catch{throw new Error("Invalid response from server")}if(d.ok)await z(),P(h.package||h),y("preview"),b(h.message||`Package ${H?"updated":"created"} successfully!`),j("success"),p(!0);else throw new Error(h.error||h.message||"Failed to save package")}catch(d){console.error("Error submitting form:",d),b(`Error saving package: ${d.message}`),j("error"),p(!0)}};return U==="preview"&&n?e.jsxs(r,{sx:{p:3,backgroundColor:o.palette.grey[100],minHeight:"100vh",width:"100%"},children:[e.jsxs(r,{sx:{width:"100%",margin:"auto",backgroundColor:"white",borderRadius:o.shape.borderRadius,boxShadow:o.shadows[1],p:3},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx(D,{onClick:()=>y("list"),color:"primary",children:e.jsx(ie,{})}),e.jsx(s,{variant:"h5",children:"Package Preview"})]}),e.jsxs(r,{sx:{position:"relative",mb:3},children:[e.jsx("img",{src:`${g}/${n.thumbnail||""}`,alt:n.title,style:{width:"100%",height:200,objectFit:"cover",borderRadius:8},onError:t=>{t.target.src="/placeholder.jpg"}}),e.jsxs(r,{sx:{position:"absolute",bottom:0,left:0,right:0,background:"linear-gradient(transparent, rgba(0,0,0,0.7))",color:"white",p:2},children:[e.jsx(s,{variant:"h6",children:n.title}),e.jsx(s,{variant:"body2",children:n.subtitle||"Traditional Style"})]})]}),e.jsx(s,{variant:"body1",sx:{mb:3},children:n.description}),e.jsx(s,{variant:"h6",sx:{mb:2},children:"Includes"}),(n.includes||[]).map((t,i)=>e.jsxs(r,{sx:{mb:2},children:[e.jsx(s,{variant:"subtitle1",sx:{fontWeight:"medium"},children:t.title}),e.jsx($e,{component:"ul",spacing:.5,sx:{pl:2},children:t.items.map((a,c)=>e.jsx(s,{variant:"body2",component:"li",children:a},c))})]},i)),e.jsx(s,{variant:"h6",sx:{mb:2},children:"Gallery"}),e.jsx(r,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:3},children:(n.images||[]).map((t,i)=>e.jsx("img",{src:`${g}/${t}`,alt:`Gallery ${i+1}`,style:{width:150,height:150,objectFit:"cover",borderRadius:4},onError:a=>{a.target.src="/placeholder.jpg"}},i))}),e.jsxs(r,{sx:{textAlign:"center",mb:3},children:[e.jsx(s,{variant:"h6",children:"Starting Price"}),e.jsxs(s,{variant:"h4",color:"primary",children:["₹",n.price," Per Head"]})]}),e.jsxs(r,{sx:{display:"flex",gap:2,justifyContent:"center"},children:[e.jsx(x,{variant:"outlined",startIcon:e.jsx(Fe,{}),onClick:ke,sx:{color:"#E15B65",borderColor:"#E15B65"},children:"Edit Menu"}),e.jsx(x,{variant:"contained",startIcon:e.jsx(se,{}),onClick:we,sx:{backgroundColor:"#E15B65"},children:"Delete Menu"})]})]}),e.jsxs(Re,{open:pe,onClose:Z,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(Ae,{id:"alert-dialog-title",children:"Confirm Delete"}),e.jsx(Me,{children:e.jsx(_e,{id:"alert-dialog-description",children:"Are you sure you want to delete this package? This action cannot be undone."})}),e.jsxs(ze,{children:[e.jsx(x,{onClick:Z,color:"primary",children:"Cancel"}),e.jsx(x,{onClick:Se,color:"error",autoFocus:!0,children:"Delete"})]})]}),e.jsx(ae,{open:K,autoHideDuration:6e3,onClose:A,anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(re,{onClose:A,severity:X,children:Q})})]}):U==="list"?e.jsx(r,{sx:{p:3,backgroundColor:o.palette.grey[100],minHeight:"100vh",width:"100%"},children:e.jsxs(r,{sx:{width:"100%",margin:"auto",backgroundColor:"white",borderRadius:o.shape.borderRadius,boxShadow:o.shadows[1],p:3},children:[e.jsx(s,{variant:"h4",sx:{mb:3},children:k?"Select Menu Items":"Food Menu"}),e.jsxs(r,{sx:{display:"flex",flexWrap:"wrap",gap:3},children:[ue.map(t=>{const i=w.some(a=>a._id===t._id);return e.jsxs(r,{sx:{width:250,cursor:"pointer",transition:"all 0.2s",border:k&&i?"3px solid #E15B65":"1px solid #e0e0e0",borderRadius:2,p:1,"&:hover":{transform:"scale(1.02)"}},onClick:()=>{k?ge(t):(P(t),y("preview"))},children:[e.jsx(r,{sx:{borderRadius:2,overflow:"hidden",mb:1},children:e.jsx("img",{src:t.thumbnail?`${g}/${t.thumbnail}`:"/placeholder.jpg",alt:t.title,style:{width:"100%",height:200,objectFit:"cover"},onError:a=>{a.target.src="/placeholder.jpg"}})}),e.jsx(s,{variant:"h6",sx:{textAlign:"center"},children:t.title})]},t._id)}),!k&&e.jsxs(x,{variant:"contained",sx:{backgroundColor:"#E15B65",minWidth:200,height:200,borderRadius:2,display:"flex",flexDirection:"column"},onClick:()=>{y("form"),T({packageTitle:"",subtitle:"",description:"",startingPrice:""}),J([]),v([{id:Date.now(),heading:"",includes:""}]),S(null),E([]),M(null),_([]),P(null)},children:[e.jsx(ne,{sx:{fontSize:32,mb:.5}}),e.jsx(s,{children:"Add Menu"})]})]}),k&&e.jsxs(r,{sx:{display:"flex",justifyContent:"center",gap:2,mt:3},children:[e.jsx(x,{variant:"outlined",onClick:()=>G(-1),sx:{borderColor:"#E15B65",color:"#E15B65"},children:"Cancel"}),e.jsxs(x,{variant:"contained",onClick:xe,disabled:w.length===0,sx:{backgroundColor:"#E15B65"},children:["Done (",w.length," selected)"]})]})]})}):e.jsx(r,{sx:{p:3,backgroundColor:o.palette.grey[100],minHeight:"100vh",width:"100%"},children:e.jsxs(r,{sx:{width:"100%",margin:"auto",backgroundColor:"white",borderRadius:o.shape.borderRadius,boxShadow:o.shadows[1],p:3},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx(D,{onClick:()=>y("list"),color:"primary",children:e.jsx(ie,{})}),e.jsx(s,{variant:"h5",children:n?"Edit Menu":"Add New Menu"})]}),e.jsxs(r,{component:"form",onSubmit:Ee,children:[e.jsx(C,{fullWidth:!0,label:"Package Title",name:"packageTitle",value:m.packageTitle,onChange:R,sx:{mb:2}}),e.jsx(C,{fullWidth:!0,label:"Subtitle",name:"subtitle",value:m.subtitle,onChange:R,sx:{mb:2}}),e.jsx(C,{fullWidth:!0,label:"Description",name:"description",value:m.description,onChange:R,multiline:!0,rows:3,sx:{mb:3}}),e.jsxs(r,{sx:{mb:3},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsx(s,{variant:"subtitle1",children:"Menu List"}),e.jsx(x,{size:"small",onClick:me,startIcon:e.jsx(ne,{}),sx:{backgroundColor:"#E15B65",color:"white"},children:"Add"})]}),V.map(t=>e.jsxs(r,{sx:{border:"1px solid #e0e0e0",borderRadius:1,p:2,mb:2},children:[e.jsx(C,{fullWidth:!0,label:"Heading",value:t.heading,onChange:i=>Y(t.id,"heading",i.target.value),sx:{mb:2}}),e.jsxs(r,{sx:{display:"flex",gap:1},children:[e.jsx(C,{fullWidth:!0,label:"Includes (comma separated)",value:t.includes,onChange:i=>Y(t.id,"includes",i.target.value),multiline:!0,rows:3}),e.jsx(D,{onClick:()=>be(t.id),color:"error",children:e.jsx(se,{})})]})]},t.id))]}),e.jsxs(r,{sx:{display:"flex",gap:3,mb:3},children:[e.jsxs(r,{sx:{flex:1},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Thumbnail"}),e.jsxs(ce,{onClick:()=>document.getElementById("thumbnail-upload").click(),children:[B?e.jsxs(r,{sx:{position:"relative"},children:[e.jsx("img",{src:URL.createObjectURL(B),alt:"Thumbnail",style:{maxWidth:"100%",maxHeight:100,objectFit:"contain"}}),e.jsx(D,{onClick:t=>{t.stopPropagation(),ve()},size:"small",sx:{position:"absolute",top:0,right:0},children:e.jsx(le,{})})]}):q?e.jsxs(r,{children:[e.jsx("img",{src:q,alt:"Current Thumbnail",style:{maxWidth:"100%",maxHeight:100,objectFit:"contain"}}),e.jsx(s,{variant:"body2",color:"#E15B65",children:"Click to replace"})]}):e.jsxs(r,{children:[e.jsx(oe,{sx:{fontSize:40,color:"#999",mb:1}}),e.jsx(s,{variant:"body2",color:"#E15B65",children:"Click to upload"})]}),e.jsx("input",{type:"file",id:"thumbnail-upload",hidden:!0,accept:"image/*",onChange:je})]})]}),e.jsxs(r,{sx:{flex:1},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Gallery"}),e.jsxs(ce,{onClick:()=>document.getElementById("gallery-upload").click(),children:[W.length===0&&$.length===0?e.jsxs(r,{children:[e.jsx(oe,{sx:{fontSize:40,color:"#999",mb:1}}),e.jsx(s,{variant:"body2",color:"#E15B65",children:"Click to upload"})]}):e.jsx(s,{variant:"body2",color:"#E15B65",children:"Click to add more images"}),e.jsx("input",{type:"file",id:"gallery-upload",hidden:!0,accept:"image/*",multiple:!0,onChange:fe})]}),(W.length>0||$.length>0)&&e.jsxs(r,{sx:{mt:2},children:[e.jsx(s,{variant:"subtitle2",children:"Gallery Images"}),e.jsxs(r,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:[W.map((t,i)=>e.jsx(r,{sx:{position:"relative",display:"inline-block"},children:e.jsx("img",{src:t,alt:`Current Gallery ${i+1}`,style:{width:80,height:80,objectFit:"cover",borderRadius:4}})},`existing-${i}`)),$.map((t,i)=>e.jsxs(He,{children:[e.jsx("img",{src:URL.createObjectURL(t),alt:`Preview ${i+1}`,style:{width:80,height:80,objectFit:"cover",borderRadius:4}}),e.jsx(D,{size:"small",onClick:()=>ye(i),sx:{position:"absolute",top:0,right:0,backgroundColor:"rgba(0,0,0,0.5)",color:"white"},children:e.jsx(le,{fontSize:"small"})})]},`new-${i}`))]})]})]})]}),e.jsx(C,{fullWidth:!0,label:"Starting Price (₹)",name:"startingPrice",value:m.startingPrice,onChange:R,type:"number",sx:{mb:3},InputProps:{endAdornment:e.jsx(We,{position:"end",children:"Per Head"})}}),e.jsx(x,{type:"submit",variant:"contained",fullWidth:!0,sx:{backgroundColor:"#E15B65",py:1.5},children:n?"Update Menu":"Create Menu"})]}),e.jsx(ae,{open:K,autoHideDuration:6e3,onClose:A,anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(re,{onClose:A,severity:X,children:Q})})]})})};export{Ke as default};
