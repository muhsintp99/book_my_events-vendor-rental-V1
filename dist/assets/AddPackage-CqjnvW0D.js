import{u as Ce,w as we,al as Se,r as d,j as e,B as n,b as B,am as re,T as s,a4 as ke,S as O,g as _,ar as ie,x as ne,s as m,ap as Ae,H as ue,a as Ie}from"./index-CxFmThG8.js";import{E as Be}from"./Edit-oajbPDo9.js";import{A as Ee}from"./Autocomplete-D4wG0FPz.js";import{A as Te}from"./Add-CdPu-FBP.js";import{C as oe}from"./Close-BuO2MOoh.js";import{C as se}from"./CloudUpload-CL36jpB9.js";const le=ue(n)(({theme:o})=>({border:"2px dashed #e0e0e0",borderRadius:o.shape.borderRadius,padding:o.spacing(3),textAlign:"center",backgroundColor:o.palette.grey[50],cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"150px","&:hover":{borderColor:"#E15B65"},'& input[type="file"]':{display:"none"}})),ce=ue(n)({position:"relative",display:"inline-block"}),E="https://api.bookmyevent.ae",Fe=()=>{try{const o=localStorage.getItem("user");if(!o)return null;const u=JSON.parse(o);return(u==null?void 0:u._id)||null}catch(o){return console.error("getProviderId parse error",o),null}},de=()=>localStorage.getItem("token")||sessionStorage.getItem("token")||null,$=o=>{if(!o)return"/placeholder.jpg";let u=String(o||"").toLowerCase().replace(/^uploads/i,"/uploads");return u.startsWith("/")||(u="/"+u),`${E}${u}`},Pe=(o=[])=>o.map(u=>({value:u._id,label:u.title||u.name||"Untitled"})),Ue=()=>{var ee,te;const o=Ce(),u=we(),U=Se(),[ge,H]=d.useState("form"),[h,z]=d.useState({packageTitle:"",subtitle:"",description:"",startingPrice:"",advanceBookingAmount:""}),[G,v]=d.useState([{id:Date.now(),heading:"",includes:""}]),[T,b]=d.useState(null),[F,L]=d.useState([]),[pe,N]=d.useState({}),[C,P]=d.useState(null),[W,M]=d.useState([]),[J,j]=d.useState(!1),[q,w]=d.useState(""),[V,S]=d.useState("success"),[r,X]=d.useState(null),[K,Q]=d.useState(!0);d.useEffect(()=>{let t=!1;return(async()=>{try{Q(!0);const i=de(),l=localStorage.getItem("moduleId");l||console.warn("No moduleId in localStorage");const g={Accept:"application/json"};i&&(g.Authorization=`Bearer ${i}`);const f=l?`${E}/api/categories/modules/${l}`:`${E}/api/categories`,c=await fetch(f,{headers:g});if(!c.ok)throw new Error(`Failed to load categories: ${c.status}`);const y=await c.json();if(!t)if(y.success&&Array.isArray(y.data)){const A=Pe(y.data);L(A);const D={};(y.data||[]).forEach(I=>{D[I._id]=I.title||I.name||""}),N(D)}else L([]),N({})}catch(i){console.error("fetchCategories error",i),L([]),N({})}finally{t||Q(!1)}})(),()=>{t=!0}},[]),d.useEffect(()=>{var t;if((t=U.state)!=null&&t.editPackage){const a=U.state.editPackage;X(a),Y(a)}},[U.state]),d.useEffect(()=>{var t,a;if(r&&F.length>0&&!T&&((t=r.categories)==null?void 0:t.length)>0){const i=((a=r.categories[0])==null?void 0:a._id)||r.categories[0],l=F.find(g=>g.value===i);b(l||{value:i,label:pe[i]||"Uncategorized"})}},[F,r]);const Y=t=>{var i,l,g;z({packageTitle:t.title||"",subtitle:t.subtitle||"",description:t.description||"",startingPrice:((i=t.price)==null?void 0:i.toString())||"",advanceBookingAmount:((l=t.advanceBookingAmount)==null?void 0:l.toString())||""}),v((t.includes||[]).map((f,c)=>({id:Date.now()+c,heading:f.title||"",includes:(f.items||[]).join(", ")})));const a=(g=t.categories)==null?void 0:g[0];b(a?{value:a._id||a,label:a.title||a.name||""}:null),P(null),M([])},k=t=>{const{name:a,value:i}=t.target;z(l=>({...l,[a]:i}))},Z=(t,a,i)=>{v(l=>l.map(g=>g.id===t?{...g,[a]:i}:g))},he=()=>v(t=>[...t,{id:Date.now(),heading:"",includes:""}]),me=t=>v(a=>a.filter(i=>i.id!==t)),xe=t=>{var i;const a=(i=t.target.files)==null?void 0:i[0];a&&P(a)},be=t=>{const a=Array.from(t.target.files||[]);a.length&&M(i=>[...i,...a])},je=t=>M(a=>a.filter((i,l)=>l!==t)),fe=()=>P(null),R=(t,a)=>{a!=="clickaway"&&j(!1)},ye=()=>{r&&Y(r),H("form")},ve=async t=>{var ae;t.preventDefault();const a=de();if(!a){w("Authentication required"),S("error"),j(!0);return}const i=Fe();if(!i){console.error("Provider ID missing. user:",localStorage.getItem("user")),w("Provider ID missing. Please login as vendor."),S("error"),j(!0);return}const l=localStorage.getItem("moduleId")||((ae=r==null?void 0:r.module)==null?void 0:ae._id)||(r==null?void 0:r.module)||"",g=G.filter(p=>p.includes&&p.includes.trim()).map(p=>({title:p.heading.trim()||"Section",items:p.includes.split(",").map(x=>x.trim()).filter(Boolean)})),f=parseFloat(h.startingPrice)||0,c=new FormData;c.append("providerId",i),l&&c.append("module",l),c.append("title",h.packageTitle||"Custom Package"),c.append("subtitle",h.subtitle||""),c.append("description",h.description||""),c.append("cateringType","custom"),c.append("includes",JSON.stringify(g)),T?c.append("categories",JSON.stringify([T.value])):c.append("categories",JSON.stringify([])),c.append("price",String(f));const y=parseFloat(h.advanceBookingAmount)||0;c.append("advanceBookingAmount",String(y)),C&&c.append("thumbnail",C),W.forEach(p=>c.append("images",p));const A=!!(r!=null&&r._id),D=A?`${E}/api/catering/${r._id}`:`${E}/api/catering`,I=A?"PUT":"POST";try{const p=await fetch(D,{method:I,body:c,headers:{Authorization:`Bearer ${a}`}}),x=await p.json().catch(()=>({success:!1,message:"Invalid JSON response"}));if(!p.ok){console.error("Save failed",x),w(x.error||x.message||"Failed to save"),S("error"),j(!0);return}z({packageTitle:"",subtitle:"",description:"",startingPrice:"",advanceBookingAmount:""}),v([{id:Date.now(),heading:"",includes:""}]),b(null),P(null),M([]),X(x.data||null),H("preview"),w(x.message||`Catering ${A?"updated":"created"} successfully`),S("success"),j(!0)}catch(p){console.error("submit error",p),w("Error saving catering: "+(p.message||p)),S("error"),j(!0)}};return ge==="preview"&&r?e.jsx(n,{sx:{p:3,backgroundColor:o.palette.grey[100],minHeight:"100vh",width:"100%"},children:e.jsxs(n,{sx:{width:"100%",margin:"auto",backgroundColor:"white",borderRadius:o.shape.borderRadius,boxShadow:o.shadows[1],p:3,overflowX:"hidden"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx(B,{onClick:()=>u(-1),color:"primary",children:e.jsx(re,{})}),e.jsx(s,{variant:"h5",children:"Package Preview"})]}),e.jsxs(n,{sx:{position:"relative",mb:3},children:[e.jsx("img",{src:$(r.thumbnail),alt:r.title,style:{width:"100%",height:200,objectFit:"cover",borderRadius:8},onError:t=>{t.target.onerror=null,t.target.src="/placeholder.jpg"}}),e.jsxs(n,{sx:{position:"absolute",bottom:0,left:0,right:0,background:"linear-gradient(transparent, rgba(0,0,0,0.7))",color:"white",p:2},children:[e.jsx(s,{variant:"h6",children:r.title||"Untitled Package"}),e.jsx(s,{variant:"body2",children:r.subtitle||""})]})]}),e.jsx(s,{variant:"body1",sx:{mb:3,textAlign:"justify"},children:r.description||"No description available."}),r.categories&&r.categories.length>0&&e.jsxs(n,{sx:{mb:3},children:[e.jsx(s,{variant:"h6",sx:{mb:1},children:"Category"}),e.jsx(ke,{label:((ee=r.categories[0])==null?void 0:ee.title)||r.categories[0]||"Uncategorized",variant:"outlined",color:"primary"})]}),e.jsx(s,{variant:"h6",sx:{mb:2},children:"Includes"}),(r.includes||[]).map((t,a)=>{var i;return e.jsxs(n,{sx:{mb:2},children:[e.jsx(s,{variant:"subtitle1",sx:{mb:1,fontWeight:"medium"},children:t.title||"Untitled Section"}),e.jsx(O,{component:"ul",spacing:.5,sx:{pl:2,mb:0},children:((i=t.items)==null?void 0:i.map((l,g)=>e.jsx(s,{variant:"body2",component:"li",children:l},g)))||e.jsx(s,{variant:"body2",color:"text.secondary",children:"No items"})})]},a)}),e.jsxs(n,{sx:{textAlign:"center",mb:3},children:[e.jsx(s,{variant:"h6",sx:{mb:.5},children:"Starting Price"}),e.jsxs(s,{variant:"h4",color:"primary",children:["₹",r.price||0," Per Head"]}),r.advanceBookingAmount>0&&e.jsxs(s,{variant:"body2",color:"text.secondary",children:["Advance Booking Amount: ₹",r.advanceBookingAmount]})]}),e.jsxs(n,{sx:{mb:3},children:[e.jsx(s,{variant:"subtitle1",sx:{mb:1},children:"Gallery"}),e.jsx(O,{direction:"row",spacing:2,sx:{flexWrap:"wrap",justifyContent:"center"},children:(r.images||[]).slice(0,6).map((t,a)=>e.jsx(n,{sx:{position:"relative"},children:e.jsx("img",{src:$(t),alt:`Gallery ${a+1}`,style:{width:150,height:150,objectFit:"cover",borderRadius:8},onError:i=>{i.target.onerror=null,i.target.src="/placeholder.jpg"}})},a))})]}),e.jsx(n,{sx:{display:"flex",gap:2,justifyContent:"center"},children:e.jsx(_,{variant:"outlined",startIcon:e.jsx(Be,{}),onClick:ye,sx:{color:"#E15B65",borderColor:"#E15B65"},children:"Edit Menu"})}),e.jsx(ie,{open:J,autoHideDuration:6e3,onClose:R,anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(ne,{onClose:R,severity:V,sx:{width:"100%"},children:q})})]})}):e.jsx(n,{sx:{p:3,backgroundColor:o.palette.grey[100],minHeight:"100vh",width:"100%"},children:e.jsxs(n,{sx:{width:"100%",margin:"auto",backgroundColor:"white",borderRadius:o.shape.borderRadius,boxShadow:o.shadows[1],p:3,overflowX:"hidden"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[r&&e.jsx(B,{onClick:()=>u(-1),color:"primary",children:e.jsx(re,{})}),e.jsx(s,{variant:"h5",children:r?"Edit Menu":"Add New Menu"})]}),e.jsxs(n,{component:"form",onSubmit:ve,children:[e.jsx(m,{fullWidth:!0,label:"Package Title",name:"packageTitle",value:h.packageTitle,onChange:k,placeholder:"Type package title",sx:{mb:2},variant:"outlined"}),e.jsx(m,{fullWidth:!0,label:"Subtitle",name:"subtitle",value:h.subtitle,onChange:k,placeholder:"Type subtitle",sx:{mb:2},variant:"outlined"}),e.jsx(m,{fullWidth:!0,label:"Description",name:"description",value:h.description,onChange:k,placeholder:"Type description",multiline:!0,rows:3,sx:{mb:2},variant:"outlined"}),e.jsx(Ee,{fullWidth:!0,options:F,getOptionLabel:t=>t.label,isOptionEqualToValue:(t,a)=>t.value===(a==null?void 0:a.value),value:T,onChange:(t,a)=>b(a),renderInput:t=>e.jsx(m,{...t,label:"Category",placeholder:K?"Loading categories...":"Select a category",sx:{mb:2},variant:"outlined",disabled:K})}),e.jsxs(n,{sx:{mb:3},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(s,{variant:"subtitle1",children:"Menu List"}),e.jsx(_,{variant:"contained",size:"small",onClick:he,startIcon:e.jsx(Te,{}),sx:{backgroundColor:"#E15B65",color:"white"},children:"Add"})]}),G.map(t=>e.jsxs(n,{sx:{border:`1px solid ${o.palette.grey[300]}`,borderRadius:1,p:2,mb:2},children:[e.jsx(m,{fullWidth:!0,label:"Add heading here",value:t.heading,onChange:a=>Z(t.id,"heading",a.target.value),sx:{mb:2},variant:"outlined"}),e.jsxs(n,{sx:{display:"flex",gap:1,alignItems:"flex-end"},children:[e.jsx(m,{fullWidth:!0,label:"Includes",value:t.includes,onChange:a=>Z(t.id,"includes",a.target.value),multiline:!0,rows:3,sx:{flex:1},variant:"outlined",placeholder:"Enter items separated by commas"}),e.jsx(B,{onClick:()=>me(t.id),color:"error",sx:{alignSelf:"flex-end"},children:e.jsx(Ae,{})})]})]},t.id))]}),e.jsxs(n,{sx:{display:"flex",gap:3,mb:3},children:[e.jsxs(n,{sx:{flex:1},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Thumbnail Image"}),e.jsxs(le,{onClick:()=>document.getElementById("thumbnail-upload").click(),children:[C?e.jsxs(n,{sx:{textAlign:"center"},children:[e.jsxs(ce,{children:[e.jsx("img",{src:URL.createObjectURL(C),alt:"Thumbnail preview",style:{maxWidth:"100%",maxHeight:100,objectFit:"contain",marginBottom:o.spacing(1)}}),e.jsx(B,{onClick:fe,size:"small",sx:{position:"absolute",top:-8,right:-8,backgroundColor:"white",color:"error",boxShadow:o.shadows[2]},children:e.jsx(oe,{fontSize:"small"})})]}),e.jsx(s,{variant:"body2",color:"text.secondary",children:C.name})]}):r!=null&&r.thumbnail?e.jsxs(n,{sx:{textAlign:"center"},children:[e.jsx("img",{src:$(r.thumbnail),alt:"Current thumbnail",style:{maxWidth:"100%",maxHeight:100,objectFit:"contain",marginBottom:o.spacing(1)},onError:t=>{t.target.onerror=null,t.target.src="/placeholder.jpg"}}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Current thumbnail. Click to replace."})]}):e.jsxs(n,{children:[e.jsx(se,{sx:{fontSize:40,color:o.palette.grey[400],mb:1}}),e.jsx(s,{variant:"body2",color:"#E15B65",sx:{mb:.5,fontWeight:"medium"},children:"Click to upload"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Or drag and drop"})]}),e.jsx("input",{type:"file",id:"thumbnail-upload",hidden:!0,accept:"image/jpeg,image/png,image/jpg",onChange:xe})]})]}),e.jsxs(n,{sx:{flex:1},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Gallery Images"}),e.jsxs(le,{onClick:()=>document.getElementById("gallery-upload").click(),children:[W.length>0?e.jsxs(n,{sx:{textAlign:"center"},children:[e.jsx(O,{direction:"row",flexWrap:"wrap",spacing:1,sx:{justifyContent:"center",mb:1},children:W.map((t,a)=>e.jsxs(ce,{children:[e.jsx("img",{src:URL.createObjectURL(t),alt:`Gallery preview ${a+1}`,style:{width:100,height:100,objectFit:"cover",borderRadius:4}}),e.jsx(B,{onClick:()=>je(a),size:"small",sx:{position:"absolute",top:-8,right:-8,backgroundColor:"white",color:"error",boxShadow:o.shadows[2]},children:e.jsx(oe,{fontSize:"small"})})]},a))}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:[W.length," image(s) selected"]})]}):e.jsxs(n,{children:[e.jsx(se,{sx:{fontSize:40,color:o.palette.grey[400],mb:1}}),e.jsx(s,{variant:"body2",color:"#E15B65",sx:{mb:.5,fontWeight:"medium"},children:"Click to upload"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Or drag and drop"})]}),e.jsx("input",{type:"file",id:"gallery-upload",hidden:!0,accept:"image/jpeg,image/png,image/jpg",multiple:!0,onChange:be})]}),((te=r==null?void 0:r.images)==null?void 0:te.length)>0&&e.jsxs(n,{sx:{mt:2},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,color:"text.secondary",children:"Existing Images"}),e.jsx(O,{direction:"row",flexWrap:"wrap",spacing:1,children:r.images.map((t,a)=>e.jsx(n,{sx:{position:"relative"},children:e.jsx("img",{src:$(t),alt:`Existing gallery ${a+1}`,style:{width:100,height:100,objectFit:"cover",borderRadius:4},onError:i=>{i.target.onerror=null,i.target.src="/placeholder.jpg"}})},a))})]})]})]}),e.jsxs(n,{sx:{mb:3,display:"flex",gap:2},children:[e.jsx(m,{fullWidth:!0,label:"₹ Price (Starting From)",name:"startingPrice",value:h.startingPrice,onChange:k,type:"number",inputProps:{min:0},InputProps:{endAdornment:e.jsx(Ie,{position:"end",children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"Per Head"})})},variant:"outlined"}),e.jsx(m,{fullWidth:!0,label:"₹ Advance Booking Amount",name:"advanceBookingAmount",value:h.advanceBookingAmount,onChange:k,type:"number",inputProps:{min:0},variant:"outlined",helperText:"Amount to be paid in advance"})]}),e.jsx(_,{type:"submit",variant:"contained",fullWidth:!0,sx:{backgroundColor:"#E15B65",color:"white",py:1.5},children:r?"Update Menu":"Create Menu"})]}),e.jsx(ie,{open:J,autoHideDuration:6e3,onClose:R,anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(ne,{onClose:R,severity:V,sx:{width:"100%"},children:q})})]})})};export{Ue as default};
