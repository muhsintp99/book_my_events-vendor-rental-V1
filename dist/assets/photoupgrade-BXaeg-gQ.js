import{r as i,j as e,B as x,t as I,T as o,a5 as g,G as b,p as E,K as R,af as w,D as _,S as k,g as p,ai as G,h as y}from"./index-DeRtw_oW.js";import{C as j}from"./CheckCircle-CC-d9aWN.js";import{W as J}from"./WorkspacePremium-DNBJBCYh.js";const W=120,S=3;function q(){var v;const[U,T]=i.useState([]),[A,D]=i.useState(!0),[N,C]=i.useState(null),[z,F]=i.useState(null),[L,H]=i.useState(null),[f,m]=i.useState({open:!1,message:""}),[a,B]=i.useState(null),[M,P]=i.useState(!0),d=localStorage.getItem("moduleId"),u=JSON.parse(localStorage.getItem("user")),h=u==null?void 0:u._id;i.useEffect(()=>{(async()=>{var r;if(!h||!d){P(!1);return}try{const n=await y.get(`https://api.bookmyevent.ae/api/subscription/status/${h}`);if(n.data.success&&n.data.subscription){const c=n.data.subscription;((r=c.moduleId)==null?void 0:r._id)===d&&c.status==="active"&&B(c)}}catch{console.log("No active subscription found")}finally{P(!1)}})()},[h,d]),i.useEffect(()=>{d&&(async()=>{try{const r=await y.get(`https://api.bookmyevent.ae/api/subscription/plan/module/${d}`);T(r.data.plans||[])}catch{m({open:!0,message:"Failed to load plans"})}finally{D(!1)}})()},[d]);const $=async s=>{var r,n,c,t;if(!h||!d){m({open:!0,message:"User or module missing"});return}try{C(s._id),console.log("ðŸš€ Creating payment session..."),console.log("Plan:",s.name,"Price:",s.price);const l=await y.post("https://api.bookmyevent.ae/api/payment/create-subscription-payment",{providerId:h,planId:s._id,amount:s.price,customerEmail:u.email,customerPhone:u.mobile||u.phone||"9999999999"});if(console.log("âœ… Payment response:",l.data),(n=(r=l.data)==null?void 0:r.payment_links)!=null&&n.web)localStorage.setItem("pendingUpgrade",JSON.stringify({userId:h,moduleId:d,planId:s._id,planName:s.name,amount:s.price})),m({open:!0,message:"Redirecting to payment page..."}),setTimeout(()=>{window.location.href=l.data.payment_links.web},1e3);else throw new Error("Payment link not available")}catch(l){console.error("âŒ Payment error:",l),m({open:!0,message:((t=(c=l.response)==null?void 0:c.data)==null?void 0:t.message)||l.message||"Payment initiation failed"}),C(null)}};if(A||M)return e.jsx(x,{sx:{minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(I,{sx:{color:"#c62828"}})});const O=s=>{var r;return((r=a==null?void 0:a.planId)==null?void 0:r._id)===s};return e.jsxs(x,{sx:{minHeight:"100vh",bgcolor:"#f9fafc",py:6},children:[e.jsxs(x,{maxWidth:"md",mx:"auto",px:2,children:[e.jsx(o,{variant:"h4",fontWeight:800,textAlign:"center",children:a?"Manage Your Plan":"Upgrade Your Plan"}),e.jsx(o,{textAlign:"center",color:"text.secondary",mb:3,children:"Choose the best plan for your business"}),a?e.jsxs(g,{severity:"success",sx:{mb:4,border:"1px solid #4caf50"},children:["Current Plan: ",e.jsx("b",{children:((v=a.planId)==null?void 0:v.name)||"PREMIUM"})," - ","Expires on: ",e.jsx("b",{children:new Date(a.endDate).toLocaleDateString()})]}):e.jsxs(g,{severity:"info",sx:{mb:4,border:"1px solid #2196f3"},children:["Current Plan: ",e.jsx("b",{children:"FREE"})," - Upgrade to unlock premium features"]}),e.jsxs(b,{container:!0,spacing:3,justifyContent:"center",children:[!a&&e.jsx(b,{item:!0,xs:12,md:6,children:e.jsx(E,{sx:{height:"100%",borderRadius:4,border:"2px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:e.jsxs(R,{children:[e.jsx(w,{label:"CURRENT PLAN",sx:{bgcolor:"#9e9e9e",color:"#fff",mb:2}}),e.jsx(o,{variant:"h6",fontWeight:800,children:"FREE"}),e.jsx(o,{color:"text.secondary",sx:{minHeight:48},children:"Basic access to get started on the platform"}),e.jsx(o,{variant:"h4",fontWeight:900,color:"#9e9e9e",mt:2,children:"â‚¹0"}),e.jsx(_,{sx:{my:2}}),e.jsx(k,{spacing:1,children:["Limited listings","Basic visibility","Standard support"].map(s=>e.jsxs(x,{display:"flex",alignItems:"center",children:[e.jsx(j,{sx:{color:"#9e9e9e",mr:1,fontSize:20}}),e.jsx(o,{variant:"body2",children:s})]},s))}),e.jsx(p,{fullWidth:!0,disabled:!0,sx:{mt:3,bgcolor:"#e0e0e0",color:"#757575",fontWeight:700,borderRadius:2,textTransform:"none"},children:"Current Plan"})]})})}),U.map(s=>{const r=z===s._id,n=L===s._id,c=N===s._id,t=O(s._id);return e.jsx(b,{item:!0,xs:12,md:6,children:e.jsx(E,{sx:{height:"100%",borderRadius:4,border:t?"3px solid #4caf50":"3px solid #c62828",boxShadow:t?"0 4px 20px rgba(76, 175, 80, 0.2)":"0 4px 20px rgba(198, 40, 40, 0.2)",position:"relative",overflow:"visible"},children:e.jsxs(R,{children:[e.jsx(w,{icon:t?e.jsx(j,{}):e.jsx(J,{}),label:t?"CURRENT PLAN":"BEST VALUE",sx:{bgcolor:t?"#4caf50":"#c62828",color:"#fff",mb:2,fontWeight:700}}),e.jsx(o,{variant:"h6",fontWeight:800,color:t?"#4caf50":"#c62828",children:s.name}),s.description&&s.description.length>W?e.jsxs(o,{color:"text.secondary",sx:{minHeight:48},children:[r?s.description:`${s.description.slice(0,W)}...`,e.jsx(p,{size:"small",onClick:()=>F(r?null:s._id),sx:{textTransform:"none",fontWeight:600,color:t?"#4caf50":"#c62828",p:0,minWidth:"auto",ml:.5},children:r?"Read less":"Read more"})]}):e.jsx(o,{color:"text.secondary",sx:{minHeight:48},children:s.description}),e.jsxs(o,{variant:"h4",fontWeight:900,color:t?"#4caf50":"#c62828",mt:2,children:["â‚¹",s.price,e.jsx(o,{component:"span",sx:{fontSize:14,fontWeight:400,color:"text.secondary",ml:1},children:"/ year"})]}),e.jsx(_,{sx:{my:2}}),e.jsx(k,{spacing:1,children:(n?s.features:s.features.slice(0,S)).map((l,Y)=>e.jsxs(x,{display:"flex",alignItems:"flex-start",children:[e.jsx(j,{sx:{color:t?"#4caf50":"#c62828",mr:1,mt:.3,fontSize:20}}),e.jsx(o,{variant:"body2",children:l})]},Y))}),s.features.length>S&&e.jsx(p,{size:"small",onClick:()=>H(n?null:s._id),sx:{mt:1,textTransform:"none",fontWeight:600,color:t?"#4caf50":"#c62828",p:0},children:n?"Show less":`+${s.features.length-S} more features`}),e.jsx(p,{fullWidth:!0,disabled:c||t,onClick:()=>$(s),sx:{mt:3,bgcolor:t?"#e0e0e0":"#c62828",color:t?"#757575":"#fff",fontWeight:800,borderRadius:2,py:1.5,textTransform:"none",fontSize:16,"&:hover":{bgcolor:t?"#e0e0e0":"#b71c1c"},"&:disabled":{bgcolor:"#e0e0e0"}},children:t?"Current Plan":c?e.jsxs(x,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(I,{size:20,sx:{color:"#fff"}}),"Redirecting..."]}):a?"Switch Plan":"Upgrade To Premium"})]})})},s._id)})]}),e.jsx(x,{sx:{mt:4,p:2,bgcolor:"#fff3e0",borderRadius:2,border:"1px solid #ffb74d"},children:e.jsxs(o,{variant:"body2",color:"text.secondary",textAlign:"center",children:["ðŸ’¡ ",e.jsx("strong",{children:"Note:"}),` After clicking "Upgrade To Premium", you'll be redirected to a secure payment page. Your subscription will be activated immediately after successful payment.`]})})]}),e.jsx(G,{open:f.open,autoHideDuration:4e3,onClose:()=>m({open:!1,message:""}),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(g,{onClose:()=>m({open:!1,message:""}),severity:f.message.includes("Failed")||f.message.includes("failed")?"error":"info",sx:{width:"100%"},children:f.message})})]})}export{q as default};
