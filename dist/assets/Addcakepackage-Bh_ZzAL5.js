import{w as ze,r,j as e,B as d,t as xe,b as w,ak as Re,T as f,x as fe,ad as J,s as b,S as A,F as H,I as K,ag as q,$ as I,C as Ue,a7 as Oe,a9 as Me,O as Ve,g as be,f as Ge,al as Je,h as C,ar as He}from"./index-KspT4AX9.js";import{A as Ke}from"./Add-d-XVp26_.js";import{C as Q}from"./Close-DelpjjRF.js";import{C as je}from"./CloudUpload-D8LwEft6.js";const h="#E91E63",S="https://api.bookmyevent.ae",ye="68e5fc09651cc12c1fc0f9c9",qe=({variation:E,onChange:B,onDelete:j})=>e.jsxs(A,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"center",sx:{mb:2},children:[e.jsx(b,{label:"Variation Name (e.g. Half Kg)",value:E.name||"",onChange:u=>B("name",u.target.value),sx:{flex:1}}),e.jsx(b,{label:"Price (₹)",type:"number",value:E.price||"",onChange:u=>B("price",u.target.value),sx:{width:150}}),e.jsx(w,{onClick:j,color:"error",children:e.jsx(He,{})})]}),et=()=>{const E=ze(),j=new URLSearchParams(window.location.search).get("id"),u=!!j,[Ce,X]=r.useState(!0),[Y,Z]=r.useState(!1),[ee,$]=r.useState(""),[te,p]=r.useState(""),[Se,ve]=r.useState([]),[ae,T]=r.useState([]),[ke,Ie]=r.useState(!0),[g,we]=r.useState(null),[F,se]=r.useState(""),[re,ie]=r.useState(""),[N,W]=r.useState(""),[P,L]=r.useState([]),[ne,oe]=r.useState("Eggless"),[z,le]=r.useState(""),[R,ce]=r.useState(""),[U,de]=r.useState(""),[O,ge]=r.useState(!0),[ue,_]=r.useState([{id:Date.now(),name:"",price:""}]),[x,he]=r.useState(null),[M,Ae]=r.useState(""),[D,pe]=r.useState([]),[V,me]=r.useState([]);r.useEffect(()=>{try{const t=localStorage.getItem("vendor")||localStorage.getItem("user")||localStorage.getItem("vendorData");t&&we(JSON.parse(t))}catch(t){console.error("Vendor load error:",t)}},[]),r.useEffect(()=>{(async()=>{var a;try{const s=localStorage.getItem("token"),c=((a=(await C.get(`${S}/api/categories/parents/${ye}`,{headers:{Authorization:`Bearer ${s}`}})).data)==null?void 0:a.data)||[];ve(c),console.log("✅ Parent Categories Loaded:",c)}catch(s){console.error("❌ Failed to load parent categories:",s),p("Failed to load categories")}finally{Ie(!1)}})()},[]);const Ee=async t=>{var s;const a=t.target.value;if(W(a),L([]),T([]),!!a)try{const n=localStorage.getItem("token"),m=((s=(await C.get(`${S}/api/categories/parents/${a}/subcategories`,{headers:{Authorization:`Bearer ${n}`}})).data)==null?void 0:s.data)||[];T(m),console.log("✅ Subcategories Loaded:",m)}catch(n){console.error("❌ Failed to load subcategories:",n),T([])}};r.useEffect(()=>{if(!u){X(!1);return}(async()=>{var a,s,n,c,m,v,k,i,o;try{const{data:G}=await C.get(`${S}/api/cakes/${j}`),l=G.data;if(se(l.name),ie(l.shortDescription),(s=(a=l.category)==null?void 0:a.parentCategory)!=null&&s._id){const y=l.category.parentCategory._id;W(y);const We=localStorage.getItem("token"),Le=await C.get(`${S}/api/categories/parents/${y}/subcategories`,{headers:{Authorization:`Bearer ${We}`}});T(((n=Le.data)==null?void 0:n.data)||[]),L([l.category._id])}else(c=l.category)!=null&&c._id&&W(l.category._id);oe(l.itemType),le(((m=l.nutrition)==null?void 0:m.join(", "))||""),ce(((v=l.allergenIngredients)==null?void 0:v.join(", "))||""),de(((k=l.searchTags)==null?void 0:k.join(", "))||""),ge(l.isActive),((i=l.variations)==null?void 0:i.length)>0&&_(l.variations.map(y=>({id:y._id||Date.now(),name:y.name,price:y.price}))),l.thumbnail&&Ae(l.thumbnail),((o=l.images)==null?void 0:o.length)>0&&me(l.images)}catch(G){console.error("Failed to load cake:",G),p("Failed to load cake details")}finally{X(!1)}})()},[u,j]);const Te=()=>{_(t=>[...t,{id:Date.now(),name:"",price:""}])},Ne=(t,a,s)=>{_(n=>n.map(c=>c.id===t?{...c,[a]:s}:c))},Pe=t=>{_(a=>a.filter(s=>s.id!==t))},_e=t=>{const a=t.target.files[0];a&&he(a)},De=t=>{const a=Array.from(t.target.files);if(D.length+V.length+a.length>10){alert("Maximum 10 gallery images allowed");return}pe(n=>[...n,...a])},Be=t=>pe(a=>a.filter((s,n)=>n!==t)),$e=t=>me(a=>a.filter((s,n)=>n!==t)),Fe=async()=>{var n,c,m,v,k;const t=(g==null?void 0:g._id)||(g==null?void 0:g.id);if(!t){p("Vendor not authenticated");return}if(!F.trim()){p("Cake name is required");return}if(!N){p("Select a category");return}if(!x&&!M){p("Thumbnail image is required");return}const a=new FormData;if(a.append("name",F),a.append("shortDescription",re),a.append("module",ye),a.append("category",N),a.append("itemType",ne),a.append("isActive",O),a.append("provider",t),P.length>0&&a.append("subCategories",JSON.stringify(P)),z.trim()){const i=z.split(",").map(o=>o.trim()).filter(Boolean);a.append("nutrition",JSON.stringify(i))}if(R.trim()){const i=R.split(",").map(o=>o.trim()).filter(Boolean);a.append("allergenIngredients",JSON.stringify(i))}if(U.trim()){const i=U.split(",").map(o=>o.trim()).filter(Boolean);a.append("searchTags",JSON.stringify(i))}const s=ue.filter(i=>i.name&&i.price).map(({name:i,price:o})=>({name:i,price:Number(o)}));s.length>0&&a.append("variations",JSON.stringify(s)),x&&a.append("thumbnail",x),D.forEach(i=>{a.append("images",i)});try{Z(!0),p(""),$("");let i;if(u?(i=await C.put(`${S}/api/cakes/${j}`,a,{headers:{"Content-Type":"multipart/form-data"}}),$("Cake updated successfully!")):(i=await C.post(`${S}/api/cakes`,a,{headers:{"Content-Type":"multipart/form-data"}}),$("Cake created successfully!")),i.data.success&&i.data.data){const o=i.data.data;console.log("✅ Cake Package Created/Updated:",{id:o._id,name:o.name,cakeId:o.cakeId,category:(n=o.category)==null?void 0:n.title,provider:(c=o.provider)==null?void 0:c.storeName,thumbnail:o.thumbnail,priceInfo:o.priceInfo,variations:o.variations,module:(m=o.module)==null?void 0:m.title})}}catch(i){console.error("Submit error:",i),p(((k=(v=i.response)==null?void 0:v.data)==null?void 0:k.message)||"Error saving cake")}finally{Z(!1),window.scrollTo({top:0,behavior:"smooth"})}};return Ce||ke?e.jsx(d,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:e.jsx(xe,{size:60,sx:{color:h}})}):e.jsxs(d,{sx:{bgcolor:"#f9f9fc",minHeight:"100vh"},children:[e.jsxs(d,{sx:{bgcolor:"white",borderBottom:"1px solid #eee",p:2,px:4,position:"sticky",top:0,zIndex:10},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(w,{onClick:()=>E(-1),children:e.jsx(Re,{})}),e.jsxs(f,{variant:"h5",fontWeight:"bold",children:[u?"Edit":"Add"," Cake Package"]})]}),g&&e.jsxs(f,{variant:"body2",color:"text.secondary",sx:{ml:7},children:["Creating as: ",g.firstName," ",g.lastName]})]}),e.jsxs(d,{sx:{p:{xs:2,md:4}},children:[ee&&e.jsx(fe,{severity:"success",sx:{mb:3},children:ee}),te&&e.jsx(fe,{severity:"error",sx:{mb:3},children:te}),e.jsxs(J,{elevation:3,sx:{borderRadius:3,p:{xs:3,md:6}},children:[e.jsx(b,{fullWidth:!0,label:"Cake Name *",value:F,onChange:t=>se(t.target.value),sx:{mb:3}}),e.jsx(b,{fullWidth:!0,label:"Short Description *",multiline:!0,rows:2,value:re,onChange:t=>ie(t.target.value),sx:{mb:3}}),e.jsxs(A,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsxs(H,{fullWidth:!0,children:[e.jsx(K,{children:"Parent Category *"}),e.jsxs(q,{value:N,onChange:Ee,children:[e.jsx(I,{value:"",children:"Select Parent Category"}),Se.map(t=>e.jsx(I,{value:t._id,children:t.title},t._id))]})]}),e.jsxs(H,{fullWidth:!0,disabled:!N,children:[e.jsx(K,{children:"Sub Categories"}),e.jsx(q,{multiple:!0,value:P,onChange:t=>L(t.target.value),input:e.jsx(Ve,{}),renderValue:t=>e.jsx(d,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(a=>{const s=ae.find(n=>n._id===a);return e.jsx(Me,{label:(s==null?void 0:s.title)||a,size:"small"},a)})}),children:ae.map(t=>e.jsxs(I,{value:t._id,children:[e.jsx(Ue,{checked:P.includes(t._id)}),e.jsx(Oe,{primary:t.title})]},t._id))})]})]}),e.jsx(A,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3,alignItems:"center"},children:e.jsxs(H,{fullWidth:!0,children:[e.jsx(K,{children:"Item Type"}),e.jsxs(q,{value:ne,onChange:t=>oe(t.target.value),children:[e.jsx(I,{value:"Eggless",children:"Eggless"}),e.jsx(I,{value:"Egg",children:"Egg"})]})]})}),e.jsxs(A,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsx(b,{fullWidth:!0,label:"Nutrition (comma separated)",placeholder:"e.g. Sugar, Milk, Flour",value:z,onChange:t=>le(t.target.value)}),e.jsx(b,{fullWidth:!0,label:"Allergen Ingredients (comma separated)",placeholder:"e.g. Nuts, Gluten",value:R,onChange:t=>ce(t.target.value)})]}),e.jsxs(d,{sx:{mb:4},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(f,{variant:"h6",sx:{color:h},children:"Variations (Size/Weight)"}),e.jsx(be,{variant:"contained",startIcon:e.jsx(Ke,{}),sx:{bgcolor:h,"&:hover":{bgcolor:"#c2185b"}},onClick:Te,children:"Add Variation"})]}),ue.map(t=>e.jsx(qe,{variation:t,onChange:(a,s)=>Ne(t.id,a,s),onDelete:()=>Pe(t.id)},t.id))]}),e.jsx(b,{fullWidth:!0,label:"Search Tags (comma separated)",placeholder:"e.g. chocolate, birthday, wedding",value:U,onChange:t=>de(t.target.value),sx:{mb:4}}),e.jsx(A,{direction:"row",spacing:4,sx:{mb:4},children:e.jsx(Ge,{control:e.jsx(Je,{checked:O,onChange:()=>ge(!O),sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:h}}}),label:"Active"})}),e.jsx(f,{variant:"h6",sx:{color:h,mb:2},children:"Thumbnail Image *"}),e.jsxs(J,{onClick:()=>document.getElementById("thumbnail-input").click(),sx:{border:"2px dashed #ddd",borderRadius:2,p:4,textAlign:"center",cursor:"pointer",mb:4},children:[e.jsx("input",{id:"thumbnail-input",type:"file",hidden:!0,accept:"image/*",onChange:_e}),x||M?e.jsxs(d,{sx:{position:"relative",display:"inline-block"},children:[e.jsx("img",{src:x?URL.createObjectURL(x):M,alt:"Thumbnail",style:{width:200,height:200,objectFit:"cover",borderRadius:8}}),x&&e.jsx(w,{onClick:t=>{t.stopPropagation(),he(null)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(Q,{})})]}):e.jsxs(e.Fragment,{children:[e.jsx(je,{sx:{fontSize:60,color:"#ccc"}}),e.jsx(f,{sx:{mt:2,color:h,fontWeight:"bold"},children:"Click to Upload Thumbnail"})]})]}),e.jsx(f,{variant:"h6",sx:{color:h,mb:2},children:"Gallery Images (Max 10)"}),e.jsxs(J,{onClick:()=>document.getElementById("gallery-input").click(),sx:{border:"2px dashed #ddd",borderRadius:2,p:4,textAlign:"center",cursor:"pointer",mb:4},children:[e.jsx("input",{id:"gallery-input",type:"file",hidden:!0,multiple:!0,accept:"image/*",onChange:De}),D.length>0||V.length>0?e.jsxs(d,{sx:{display:"flex",flexWrap:"wrap",gap:2,justifyContent:"center"},children:[V.map((t,a)=>e.jsxs(d,{sx:{position:"relative"},children:[e.jsx("img",{src:t,alt:"",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(w,{onClick:s=>{s.stopPropagation(),$e(a)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(Q,{fontSize:"small"})})]},`ex-${a}`)),D.map((t,a)=>e.jsxs(d,{sx:{position:"relative"},children:[e.jsx("img",{src:URL.createObjectURL(t),alt:"",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(w,{onClick:s=>{s.stopPropagation(),Be(a)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(Q,{fontSize:"small"})})]},`new-${a}`))]}):e.jsxs(e.Fragment,{children:[e.jsx(je,{sx:{fontSize:60,color:"#ccc"}}),e.jsx(f,{sx:{mt:2,color:h,fontWeight:"bold"},children:"Click to Upload Gallery Images"})]})]}),e.jsx(be,{fullWidth:!0,variant:"contained",size:"large",onClick:Fe,disabled:Y||!g,sx:{py:2,bgcolor:h,"&:hover":{bgcolor:"#c2185b"}},children:Y?e.jsx(xe,{size:28,color:"inherit"}):u?"Update Cake Package":"Create Cake Package"})]})]})]})};export{et as default};
