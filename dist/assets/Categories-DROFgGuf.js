import{g as G,r as h,j as e,B as n,c as J,T as d,a as Q,b as W,a5 as X,M as D,e as Z,w as E,Y as ee,ad as se,o as re,af as te}from"./index-BaH8rYCR.js";import{A as oe}from"./ArrowDropDown-BOuLYZbC.js";import{S as ae}from"./Search-Da4ImQWA.js";import{C as N}from"./Category-LAw0RB7J.js";import{S as P,K as ie,a as ne}from"./SubdirectoryArrowRight-BpCSsAA1.js";import{T as ce}from"./TableContainer-Bd6SM3fa.js";import{T as z,a as x,b as o,c as U}from"./TableRow-DlnbilcC.js";import{T as F}from"./TableHead-8Aru5CBK.js";const le="68e5fc09651cc12c1fc0f9c9",be=()=>{const p=G(),[j,K]=h.useState(""),[w,O]=h.useState([]),[g,b]=h.useState([]),[S,H]=h.useState({}),[y,v]=h.useState(null),[M,I]=h.useState(!0),[$,R]=h.useState(null),[k,V]=h.useState({}),u="https://api.bookmyevent.ae",f=localStorage.getItem("token"),T=(s,t="parent")=>{V(a=>({...a,[`${t}-${s}`]:!0}))};h.useEffect(()=>{(async()=>{I(!0);try{const t=await fetch(`${u}/api/categories/parents/${le}`,{headers:{Accept:"application/json",Authorization:`Bearer ${f}`}});if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);const a=await t.json();if(a.success&&Array.isArray(a.data)){const c=r=>{if(!r)return"";if(r.startsWith("http"))return r;const l=r.startsWith("/")?r:`/${r}`;return`${u}${l}`},i=await Promise.all(a.data.map(async r=>{try{const l=await fetch(`${u}/api/categories/parents/${r._id}/subcategories`,{headers:{Accept:"application/json",Authorization:`Bearer ${f}`}});if(l.ok){const m=await l.json(),C=(m.success?m.data:[]).map(L=>({...L,image:c(L.image)}));return{id:r._id,name:r.title,image:c(r.image),description:r.description||"",subCategories:C}}}catch(l){console.error(`Error fetching subcategories for ${r.title}:`,l)}return{id:r._id,name:r.title,image:c(r.image),description:r.description||"",subCategories:[]}}));O(i),b(i)}else v("No categories found for cake module")}catch(t){console.error("Error fetching categories:",t.message),v(`Failed to fetch categories: ${t.message}`)}finally{I(!1)}})()},[u,f]);const Y=s=>{H(t=>({...t,[s]:!t[s]}))},A=()=>{if(!j.trim()){b(w);return}const s=w.filter(t=>{var i;const a=t.name.toLowerCase().includes(j.toLowerCase()),c=(i=t.subCategories)==null?void 0:i.some(r=>r.title.toLowerCase().includes(j.toLowerCase()));return a||c});b(s)},q=s=>R(s.currentTarget),B=()=>R(null),_=s=>{let t=`SI,Type,Category Name,Parent Category
`,a=1;g.forEach(l=>{var m;t+=`${a++},Parent,${l.name},-
`,(m=l.subCategories)==null||m.forEach(C=>{t+=`${a++},Subcategory,${C.title},${l.name}
`})});const c=new Blob([t],{type:s==="excel"?"application/vnd.ms-excel":"text/csv"}),i=window.URL.createObjectURL(c),r=document.createElement("a");r.href=i,r.download=`cake_categories_${new Date().toISOString().slice(0,10)}.${s}`,r.click(),window.URL.revokeObjectURL(i),B()};return M?e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},children:e.jsx(J,{sx:{color:"#E91E63"}})}):e.jsx(n,{sx:{p:3,backgroundColor:p.palette.grey[100],minHeight:"100vh"},children:e.jsxs(n,{sx:{maxWidth:"lg",margin:"auto",backgroundColor:"white",borderRadius:p.shape.borderRadius,boxShadow:p.shadows[1],p:3},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(n,{children:[e.jsx(d,{variant:"h5",component:"h1",sx:{fontWeight:600},children:"Cake Categories"}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Parent categories and their subcategories"})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Q,{variant:"outlined",placeholder:"Search categories...",value:j,onChange:s=>K(s.target.value),onKeyPress:s=>s.key==="Enter"&&A(),size:"small",sx:{minWidth:250}}),e.jsx(W,{variant:"outlined",startIcon:e.jsx(ae,{}),onClick:A,sx:{color:"#E91E63",borderColor:"#E91E63","&:hover":{borderColor:"#c2185b"}},children:"Search"}),e.jsx(W,{variant:"outlined",endIcon:e.jsx(oe,{}),onClick:q,sx:{color:"#E91E63",borderColor:"#E91E63","&:hover":{borderColor:"#c2185b"}},children:"Export"}),e.jsxs(X,{anchorEl:$,open:!!$,onClose:B,children:[e.jsx(D,{onClick:()=>_("excel"),children:"Excel"}),e.jsx(D,{onClick:()=>_("csv"),children:"CSV"})]})]})]}),y&&e.jsx(Z,{severity:"error",sx:{mb:2},children:y}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:3},children:[e.jsx(E,{icon:e.jsx(N,{}),label:`${g.length} Parent Categories`,color:"primary",sx:{bgcolor:"#E91E63"}}),e.jsx(E,{icon:e.jsx(P,{}),label:`${g.reduce((s,t)=>{var a;return s+(((a=t.subCategories)==null?void 0:a.length)||0)},0)} Subcategories`,variant:"outlined",sx:{borderColor:"#E91E63",color:"#E91E63"}})]}),e.jsx(ce,{component:ee,elevation:0,sx:{border:"1px solid #e0e0e0"},children:e.jsxs(z,{children:[e.jsx(F,{sx:{bgcolor:"#fce4ec"},children:e.jsxs(x,{children:[e.jsx(o,{width:50}),e.jsx(o,{width:50,children:"SI"}),e.jsx(o,{children:"Category Name"}),e.jsx(o,{children:"Image"}),e.jsx(o,{align:"center",children:"Subcategories"})]})}),e.jsx(U,{children:g.length===0?e.jsx(x,{children:e.jsx(o,{colSpan:6,align:"center",sx:{py:8},children:e.jsx(d,{variant:"h6",color:"text.secondary",children:"No categories found"})})}):g.map((s,t)=>{var a,c;return e.jsxs(se.Fragment,{children:[e.jsxs(x,{hover:!0,sx:{"& > *":{borderBottom:"unset"}},children:[e.jsx(o,{children:e.jsx(re,{size:"small",onClick:()=>Y(s.id),disabled:!s.subCategories||s.subCategories.length===0,children:S[s.id]?e.jsx(ie,{}):e.jsx(ne,{})})}),e.jsx(o,{sx:{fontWeight:600},children:t+1}),e.jsx(o,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(N,{sx:{color:"#E91E63"}}),e.jsxs(n,{children:[e.jsx(d,{fontWeight:600,children:s.name}),s.description&&e.jsx(d,{variant:"caption",color:"text.secondary",children:s.description})]})]})}),e.jsx(o,{children:s.image&&!k[`parent-${s.id}`]?e.jsx("img",{src:s.image,alt:s.name,style:{width:80,height:60,objectFit:"cover",borderRadius:4},onError:()=>T(s.id,"parent")}):e.jsx(n,{sx:{width:80,height:60,bgcolor:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:1},children:e.jsx(d,{variant:"caption",color:"text.secondary",children:"No Image"})})}),e.jsx(o,{align:"center",children:e.jsx(E,{label:((a=s.subCategories)==null?void 0:a.length)||0,size:"small",color:((c=s.subCategories)==null?void 0:c.length)>0?"success":"default"})})]}),e.jsx(x,{children:e.jsx(o,{style:{paddingBottom:0,paddingTop:0},colSpan:5,children:e.jsx(te,{in:S[s.id],timeout:"auto",unmountOnExit:!0,children:e.jsxs(n,{sx:{margin:2,bgcolor:"#fafafa",borderRadius:1,p:2},children:[e.jsx(d,{variant:"subtitle2",gutterBottom:!0,sx:{color:"#E91E63",fontWeight:600},children:"Subcategories"}),s.subCategories&&s.subCategories.length>0?e.jsxs(z,{size:"small",children:[e.jsx(F,{children:e.jsxs(x,{children:[e.jsx(o,{children:"SI"}),e.jsx(o,{children:"Subcategory Name"}),e.jsx(o,{children:"Image"})]})}),e.jsx(U,{children:s.subCategories.map((i,r)=>e.jsxs(x,{children:[e.jsx(o,{children:r+1}),e.jsx(o,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(P,{sx:{fontSize:18,color:"#E91E63"}}),e.jsx(d,{children:i.title})]})}),e.jsx(o,{children:i.image&&!k[`sub-${i._id}`]?e.jsx("img",{src:i.image,alt:i.title,style:{width:60,height:45,objectFit:"cover",borderRadius:4},onError:()=>T(i._id,"sub")}):e.jsx(n,{sx:{width:60,height:45,bgcolor:"#e0e0e0",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:1},children:e.jsx(d,{variant:"caption",color:"text.secondary",children:"No Image"})})})]},i._id))})]}):e.jsx(d,{variant:"body2",color:"text.secondary",children:"No subcategories available"})]})})})})]},s.id)})})]})})]})})};export{be as default};
