import{d as K,r,j as e,B as c,U as Q,s as y,T as a,b as l,C as I,q as _,a as Z,Z as X,c as ee,G as g,V as te,o as P,a1 as se,z as ae,v as re,H as z,a4 as B,J as R,a2 as ie,K as F,N as ne}from"./index-CWJg_lwt.js";import{A as oe}from"./Add-GGc6Xt8k.js";import{S as ce}from"./Search-WfmjaGyn.js";import{M as L}from"./Mic-BCuMpP30.js";import{C as le}from"./CardMedia-UFdY_0kj.js";import{C as de}from"./Close-D09zOr9j.js";const E="https://api.bookmyevent.ae/api/emcee";function je(){const p=K(),[m,b]=r.useState([]),[H,C]=r.useState(!0),[d,n]=r.useState({open:!1,message:"",severity:"success"}),[j,O]=r.useState(""),[V,f]=r.useState(!1),[M,v]=r.useState(!1),[s,U]=r.useState(null),[D,N]=r.useState(null),x=localStorage.getItem("token"),w=JSON.parse(localStorage.getItem("user")||"{}"),k=w==null?void 0:w._id,T=t=>t?`https://api.bookmyevent.ae/${t.startsWith("/")?t.slice(1):t}`:null,S=t=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(t||0),$=r.useCallback(async()=>{if(!k||!x){n({open:!0,message:"Please login again",severity:"error"}),C(!1);return}C(!0);try{const t=await fetch(`${E}/vendor/${k}`,{headers:{Authorization:`Bearer ${x}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to load packages");const i=await t.json();i.success&&b(i.data||[])}catch(t){n({open:!0,message:t.message,severity:"error"})}finally{C(!1)}},[k,x]);r.useEffect(()=>{$()},[$]);const Y=t=>{U(t),f(!0)},q=async(t,i)=>{try{(await(await fetch(`${E}/${t}/toggle-active`,{method:"PATCH",headers:{Authorization:`Bearer ${x}`}})).json()).success&&(b(J=>J.map(A=>A._id===t?{...A,isActive:!i}:A)),n({open:!0,message:"Status updated",severity:"success"}))}catch{n({open:!0,message:"Failed to update status",severity:"error"})}},G=async()=>{try{(await(await fetch(`${E}/${D}`,{method:"DELETE",headers:{Authorization:`Bearer ${x}`}})).json()).success&&(b(h=>h.filter(u=>u._id!==D)),n({open:!0,message:"Package deleted",severity:"success"}))}catch{n({open:!0,message:"Delete failed",severity:"error"})}finally{v(!1),N(null)}},W=r.useMemo(()=>m.filter(t=>{var h,u;if(!j)return!0;const i=j.toLowerCase();return((h=t.packageName)==null?void 0:h.toLowerCase().includes(i))||((u=t.description)==null?void 0:u.toLowerCase().includes(i))}),[m,j]),o="#dd666eff";return e.jsxs(c,{sx:{bgcolor:"#f5f7fa",minHeight:"100vh",pb:4},children:[e.jsx(c,{sx:{background:`linear-gradient(135deg, ${o} 0%, #A33A43 100%)`,color:"white",py:4,px:3,borderRadius:"0 0 24px 24px",boxShadow:"0 4px 20px rgba(221, 102, 110, 0.3)"},children:e.jsx(Q,{maxWidth:"xl",children:e.jsxs(y,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(c,{children:[e.jsx(a,{variant:"h4",sx:{fontWeight:700,mb:.5},children:"Emcee & Event Host Packages"}),e.jsxs(a,{variant:"body2",sx:{opacity:.9},children:[m.length," total packages â€¢ ",m.filter(t=>t.isActive).length," active"]})]}),e.jsx(l,{variant:"contained",size:"large",startIcon:e.jsx(oe,{}),onClick:()=>p("/emcee/addpackage"),sx:{bgcolor:"white",color:o,fontWeight:600,px:3,"&:hover":{bgcolor:"#f5f5f5",transform:"translateY(-2px)"},transition:"all 0.3s",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:"Add New Package"})]})})}),e.jsxs(c,{sx:{width:"100%",px:2,mt:4},children:[e.jsx(I,{sx:{mb:3,borderRadius:3,boxShadow:"0 2px 12px rgba(0,0,0,0.08)"},children:e.jsx(_,{children:e.jsx(Z,{fullWidth:!0,placeholder:"Search by package name or description...",value:j,onChange:t=>O(t.target.value),InputProps:{startAdornment:e.jsx(X,{position:"start",children:e.jsx(ce,{sx:{color:o,fontSize:28}})}),sx:{borderRadius:2}}})})}),H?e.jsx(c,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(ee,{size:60,sx:{color:o}})}):W.length===0?e.jsxs(I,{sx:{textAlign:"center",py:8},children:[e.jsx(L,{sx:{fontSize:80,color:"#ddd",mb:2}}),e.jsx(a,{variant:"h5",color:"text.secondary",children:"No packages found"}),e.jsx(l,{variant:"contained",sx:{mt:3,bgcolor:o},onClick:()=>p("/emcee/addpackage"),children:"Create Your First Package"})]}):e.jsx(g,{container:!0,spacing:3,children:W.map(t=>e.jsx(g,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsxs(I,{sx:{height:"100%",borderRadius:3,transition:"0.3s","&:hover":{transform:"translateY(-8px)"}},children:[e.jsx(c,{sx:{position:"relative",pt:"75%",bgcolor:"#f5f5f5"},children:t.image?e.jsx(le,{component:"img",image:T(t.image),alt:t.packageName,sx:{position:"absolute",top:0,width:"100%",height:"100%",objectFit:"cover"}}):e.jsx(c,{sx:{position:"absolute",top:0,width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(L,{sx:{fontSize:60,color:"#ccc"}})})}),e.jsxs(_,{sx:{p:2.5},children:[e.jsx(a,{variant:"h6",sx:{fontWeight:700,mb:1},noWrap:!0,children:t.packageName}),e.jsx(a,{variant:"h5",sx:{fontWeight:700,color:o,mb:2},children:S(t.packagePrice)}),e.jsxs(y,{direction:"row",spacing:1,children:[e.jsx(l,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(te,{}),onClick:()=>Y(t),children:"View"}),e.jsx(P,{color:"primary",onClick:()=>p(`/emcee/edit/${t._id}`),children:e.jsx(se,{})}),e.jsx(P,{color:"error",onClick:()=>{N(t._id),v(!0)},children:e.jsx(ae,{})})]}),e.jsxs(c,{sx:{mt:2,pt:2,borderTop:"1px solid #f0f0f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(a,{variant:"body2",fontWeight:500,children:"Status"}),e.jsx(re,{checked:t.isActive,onChange:()=>q(t._id,t.isActive)})]})]})]})},t._id))})]}),e.jsxs(z,{open:V,onClose:()=>f(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(B,{sx:{bgcolor:o,color:"white"},children:e.jsxs(y,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(a,{variant:"h6",children:s==null?void 0:s.packageName}),e.jsx(P,{onClick:()=>f(!1),sx:{color:"white"},children:e.jsx(de,{})})]})}),e.jsx(R,{dividers:!0,children:s&&e.jsxs(g,{container:!0,spacing:3,children:[e.jsx(g,{item:!0,xs:12,md:5,children:s.image&&e.jsx("img",{src:T(s.image),alt:s.packageName,style:{width:"100%",borderRadius:"12px"}})}),e.jsxs(g,{item:!0,xs:12,md:7,children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Description"}),e.jsx(a,{variant:"body1",color:"text.secondary",paragraph:!0,children:s.description}),e.jsx(ie,{sx:{my:2}}),e.jsxs(y,{spacing:1,children:[e.jsx(a,{variant:"h6",children:"Pricing"}),e.jsxs(a,{variant:"body1",children:["Full Price: ",e.jsx("b",{children:S(s.packagePrice)})]}),e.jsxs(a,{variant:"body1",children:["Advance: ",e.jsx("b",{children:S(s.advanceBookingAmount)})]})]})]})]})}),e.jsxs(F,{sx:{p:2},children:[e.jsx(l,{onClick:()=>f(!1),children:"Close"}),e.jsx(l,{variant:"contained",sx:{bgcolor:o},onClick:()=>p(`/emcee/edit/${s==null?void 0:s._id}`),children:"Edit Package"})]})]}),e.jsxs(z,{open:M,onClose:()=>v(!1),children:[e.jsx(B,{children:"Delete Package?"}),e.jsx(R,{children:"This action cannot be undone."}),e.jsxs(F,{children:[e.jsx(l,{onClick:()=>v(!1),children:"Cancel"}),e.jsx(l,{color:"error",variant:"contained",onClick:G,children:"Delete"})]})]}),e.jsx(ne,{open:d.open,autoHideDuration:6e3,onClose:()=>n({...d,open:!1}),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(Alert,{severity:d.severity,variant:"filled",onClose:()=>n({...d,open:!1}),children:d.message})})]})}export{je as default};
