import{r as c,j as e,B as f,s as W,T as a,v as P,G as S,o as _,N as k,ag as A,D as U,S as T,f as v,aj as q,g as y}from"./index-2qmD94Bw.js";import{C as w}from"./CheckCircle-CuO_BN5l.js";import{W as K}from"./WorkspacePremium-DC5Sxua4.js";const $=120,I=3,b="https://api.bookmyevent.ae";function te(){var R;const[D,L]=c.useState([]),[N,z]=c.useState(!0),[B,C]=c.useState(null),[F,H]=c.useState(null),[M,O]=c.useState(null),[h,l]=c.useState({open:!1,message:"",severity:"info"}),[d,E]=c.useState(null),[V,j]=c.useState(!0),u=localStorage.getItem("moduleId"),p=JSON.parse(localStorage.getItem("user")||"{}"),m=p==null?void 0:p._id;c.useEffect(()=>{const o=new URLSearchParams(window.location.search).get("orderId");if(!o){j(!1);return}(async()=>{var i,t;try{l({open:!0,message:"Verifying payment...",severity:"info"});const r=await y.post(`${b}/api/payment/verify-subscription-payment`,{orderId:o});if(console.log("âœ… Verify response:",r.data),r.data.success){l({open:!0,message:"ðŸŽ‰ Premium Plan Activated!",severity:"success"});const x=await y.get(`${b}/api/subscription/status/${m}?moduleId=${r.data.subscription.moduleId}`);if(console.log("âœ… Subscription response:",x.data),x.data.success&&x.data.subscription){const g=x.data.subscription;localStorage.setItem("moduleId",g.moduleId);const J=new Date(g.endDate),X=Math.max(0,Math.ceil((J-new Date)/(1e3*60*60*24)));localStorage.setItem("upgrade",JSON.stringify({isSubscribed:!0,status:"active",plan:g.planId,module:g.moduleId,access:{canAccess:!0,isExpired:!1,daysLeft:X}})),E(g),window.history.replaceState({},"",window.location.pathname),setTimeout(()=>{window.location.href="/makeupartist/portfolio"},2e3)}}else l({open:!0,message:r.data.message||"Payment verification failed",severity:"error"})}catch(r){console.error("âŒ Payment verification error:",r),l({open:!0,message:((t=(i=r.response)==null?void 0:i.data)==null?void 0:t.message)||"Payment verification failed",severity:"error"})}finally{j(!1)}})()},[m,u]),c.useEffect(()=>{if(new URLSearchParams(window.location.search).get("orderId"))return;(async()=>{if(!m||!u){j(!1);return}try{const n=await y.get(`${b}/api/subscription/status/${m}?moduleId=${u}`);if(n.data.success&&n.data.subscription){const i=n.data.subscription;i.status==="active"&&i.isCurrent&&E(i)}}catch{console.log("No active subscription found")}finally{j(!1)}})()},[m,u]),c.useEffect(()=>{u&&(async()=>{try{const o=await y.get(`${b}/api/subscription/plan/module/${u}`);L(o.data.plans||[])}catch{l({open:!0,message:"Failed to load plans",severity:"error"})}finally{z(!1)}})()},[u]);const Y=async s=>{var o,n,i,t;if(!m||!u){l({open:!0,message:"User or module missing",severity:"warning"});return}try{C(s._id),console.log("ðŸš€ Creating payment session..."),console.log("Plan:",s.name,"Price:",s.price);const r=await y.post(`${b}/api/payment/create-subscription-payment`,{providerId:m,planId:s._id,amount:s.price,customerEmail:p.email,customerPhone:p.mobile||p.phone||"9999999999"});if(console.log("âœ… Payment response:",r.data),(n=(o=r.data)==null?void 0:o.payment_links)!=null&&n.web)l({open:!0,message:"Redirecting to payment page...",severity:"info"}),setTimeout(()=>{window.location.href=r.data.payment_links.web},1e3);else throw new Error("Payment link not available")}catch(r){console.error("âŒ Payment error:",r),l({open:!0,message:((t=(i=r.response)==null?void 0:i.data)==null?void 0:t.message)||r.message||"Payment initiation failed",severity:"error"}),C(null)}};if(N||V)return e.jsx(f,{sx:{minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(W,{sx:{color:"#c62828"}})});const G=s=>{var o;return((o=d==null?void 0:d.planId)==null?void 0:o._id)===s};return e.jsxs(f,{sx:{minHeight:"100vh",bgcolor:"#f9fafc",py:6},children:[e.jsxs(f,{maxWidth:"md",mx:"auto",px:2,children:[e.jsx(a,{variant:"h4",fontWeight:800,textAlign:"center",children:d?"Manage Your Plan":"Upgrade Your Plan"}),e.jsx(a,{textAlign:"center",color:"text.secondary",mb:3,children:"Choose the best plan for your business"}),d?e.jsxs(P,{severity:"success",sx:{mb:4,border:"1px solid #4caf50"},children:["Current Plan: ",e.jsx("b",{children:((R=d.planId)==null?void 0:R.name)||"PREMIUM"})]}):e.jsxs(P,{severity:"info",sx:{mb:4,border:"1px solid #2196f3"},children:["Current Plan: ",e.jsx("b",{children:"FREE"})," - Upgrade to unlock premium features"]}),e.jsxs(S,{container:!0,spacing:3,justifyContent:"center",children:[!d&&e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(_,{sx:{height:"100%",borderRadius:4,border:"2px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:e.jsxs(k,{children:[e.jsx(A,{label:"CURRENT PLAN",sx:{bgcolor:"#9e9e9e",color:"#fff",mb:2}}),e.jsx(a,{variant:"h6",fontWeight:800,children:"FREE"}),e.jsx(a,{color:"text.secondary",sx:{minHeight:48},children:"Basic access to get started on the platform"}),e.jsx(a,{variant:"h4",fontWeight:900,color:"#9e9e9e",mt:2,children:"â‚¹0"}),e.jsx(U,{sx:{my:2}}),e.jsx(T,{spacing:1,children:["Limited listings","Basic visibility","Standard support"].map(s=>e.jsxs(f,{display:"flex",alignItems:"center",children:[e.jsx(w,{sx:{color:"#9e9e9e",mr:1,fontSize:20}}),e.jsx(a,{variant:"body2",children:s})]},s))}),e.jsx(v,{fullWidth:!0,disabled:!0,sx:{mt:3,bgcolor:"#e0e0e0",color:"#757575",fontWeight:700,borderRadius:2,textTransform:"none"},children:"Current Plan"})]})})}),D.map(s=>{const o=F===s._id,n=M===s._id,i=B===s._id,t=G(s._id);return e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(_,{sx:{height:"100%",borderRadius:4,border:t?"3px solid #4caf50":"3px solid #c62828",boxShadow:t?"0 4px 20px rgba(76, 175, 80, 0.2)":"0 4px 20px rgba(198, 40, 40, 0.2)"},children:e.jsxs(k,{children:[e.jsx(A,{icon:t?e.jsx(w,{}):e.jsx(K,{}),label:t?"CURRENT PLAN":"BEST VALUE",sx:{bgcolor:t?"#4caf50":"#c62828",color:"#fff",mb:2,fontWeight:700}}),e.jsx(a,{variant:"h6",fontWeight:800,color:t?"#4caf50":"#c62828",children:s.name}),s.description&&s.description.length>$?e.jsxs(a,{color:"text.secondary",sx:{minHeight:48},children:[o?s.description:`${s.description.slice(0,$)}...`,e.jsx(v,{size:"small",onClick:()=>H(o?null:s._id),sx:{textTransform:"none",fontWeight:600,color:t?"#4caf50":"#c62828",p:0,minWidth:"auto",ml:.5},children:o?"Read less":"Read more"})]}):e.jsx(a,{color:"text.secondary",sx:{minHeight:48},children:s.description}),e.jsxs(a,{variant:"h4",fontWeight:900,color:t?"#4caf50":"#c62828",mt:2,children:["â‚¹",s.price,e.jsx(a,{component:"span",sx:{fontSize:14,fontWeight:400,color:"text.secondary",ml:1},children:"/ year"})]}),e.jsx(U,{sx:{my:2}}),e.jsx(T,{spacing:1,children:(n?s.features:s.features.slice(0,I)).map((r,x)=>e.jsxs(f,{display:"flex",alignItems:"flex-start",children:[e.jsx(w,{sx:{color:t?"#4caf50":"#c62828",mr:1,mt:.3,fontSize:20}}),e.jsx(a,{variant:"body2",children:r})]},x))}),s.features.length>I&&e.jsx(v,{size:"small",onClick:()=>O(n?null:s._id),sx:{mt:1,textTransform:"none",fontWeight:600,color:t?"#4caf50":"#c62828",p:0},children:n?"Show less":`+${s.features.length-I} more features`}),e.jsx(v,{fullWidth:!0,disabled:i||t,onClick:()=>Y(s),sx:{mt:3,bgcolor:t?"#e0e0e0":"#c62828",color:t?"#757575":"#fff",fontWeight:800,borderRadius:2,py:1.5,textTransform:"none",fontSize:16,"&:hover":{bgcolor:t?"#e0e0e0":"#b71c1c"},"&:disabled":{bgcolor:"#e0e0e0"}},children:t?"Current Plan":i?e.jsxs(f,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(W,{size:20,sx:{color:"#fff"}}),"Redirecting..."]}):d?"Switch Plan":"Upgrade To Premium"})]})})},s._id)})]}),e.jsx(f,{sx:{mt:4,p:2,bgcolor:"#fff3e0",borderRadius:2,border:"1px solid #ffb74d"},children:e.jsxs(a,{variant:"body2",color:"text.secondary",textAlign:"center",children:["ðŸ’¡ ",e.jsx("strong",{children:"Note:"}),` After clicking "Upgrade To Premium", you'll be redirected to a secure payment page. Your subscription will be activated immediately after successful payment.`]})})]}),e.jsx(q,{open:h.open,autoHideDuration:4e3,onClose:()=>l({...h,open:!1}),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(P,{onClose:()=>l({...h,open:!1}),severity:h.severity,sx:{width:"100%"},children:h.message})})]})}export{te as default};
