import{p as Me,d as De,r as s,j as e,B as c,c as ge,s as C,t as We,T as m,H as he,k as L,a as u,S as z,F as me,I as xe,o as fe,M as j,x as _e,a1 as $e,w as k,z as Fe,b as je,h as v}from"./index-i4VdWCGq.js";import{A as Le}from"./Add-CX0Jg6d1.js";import{S as N}from"./Switch-CDbQDBwk.js";import{C as ve}from"./Close-BGkFvPa6.js";import{C as ze}from"./CloudUpload-Z8FxTU0l.js";import{D as Ne}from"./Delete-BaJ3AfYz.js";const h="#E91E63",x="https://api.bookmyevent.ae",be="68e5fc09651cc12c1fc0f9c9",Ue=({section:p,onChange:b,onDelete:g})=>e.jsxs(c,{sx:{position:"relative",border:"1px solid #e5e5e5",borderRadius:2,p:3,mb:3,bgcolor:"white"},children:[e.jsx(C,{onClick:g,sx:{position:"absolute",top:12,right:12,color:h},children:e.jsx(Ne,{fontSize:"small"})}),e.jsx(u,{fullWidth:!0,label:e.jsxs("span",{children:["Section Title ",e.jsx("span",{style:{color:"red"},children:"*"})]}),value:p.title||"",onChange:f=>b("title",f.target.value),sx:{mb:2}}),e.jsx(u,{fullWidth:!0,label:e.jsxs("span",{children:["Items (comma separated) ",e.jsx("span",{style:{color:"red"},children:"*"})]}),placeholder:"e.g. Bridal Bun, Curls, Waves",value:Array.isArray(p.items)?p.items.join(", "):"",onChange:f=>b("items",f.target.value),multiline:!0,rows:2,helperText:"Separate items with commas"})]}),Ke=()=>{const{id:p}=Me(),b=De(),g=!!p,[f,U]=s.useState(!0),[R,O]=s.useState(!1),[G,P]=s.useState(""),[H,d]=s.useState(""),[I,ye]=s.useState([]),[Se,q]=s.useState(!0),[J,w]=s.useState([]),[ke,K]=s.useState(!0),[o,Q]=s.useState(null),[T,X]=s.useState(""),[A,Y]=s.useState([]),[E,Z]=s.useState(""),[B,V]=s.useState(""),[ee,te]=s.useState(""),[M,ae]=s.useState(""),[se,ie]=s.useState(""),[le,re]=s.useState(""),[D,oe]=s.useState(!1),[W,ne]=s.useState(!1),[_,ce]=s.useState(!0),[$,y]=s.useState([{id:Date.now(),title:"",items:[]}]),[de,Ce]=s.useState({hairStyling:!1,sareeDraping:!1,eyelashExtension:!1,nailPolish:!1}),[S,pe]=s.useState([]),[F,ue]=s.useState([]);s.useEffect(()=>{try{const t=localStorage.getItem("vendor")||localStorage.getItem("user")||localStorage.getItem("vendorData");if(t){const a=JSON.parse(t);Q(a)}else{const a=localStorage.getItem("vendorId")||localStorage.getItem("userId");a&&Q({_id:a,id:a})}}catch(t){console.error("Error loading vendor info:",t)}},[]),s.useEffect(()=>{(async()=>{try{q(!0);const a=await v.get(`${x}/api/categories/modules/${be}`);ye(a.data.data||[])}catch{d("Failed to load categories")}finally{q(!1)}})()},[]),s.useEffect(()=>{(async()=>{try{K(!0);const a=await v.get(`${x}/api/makeup-types`);a.data.success?w(a.data.data):w([])}catch(a){console.error("Error fetching types:",a),w([])}finally{K(!1)}})()},[]),s.useEffect(()=>{if(!g){U(!1);return}(async()=>{var a,i;try{const l=(await v.get(`${x}/api/makeup-packages/${p}`)).data.data;X(l.packageTitle),Y(l.categories.map(r=>r._id)),Z(l.makeupType),V(l.basePrice),te(l.offerPrice),ae(l.description),ie(l.cancellationPolicy),re(l.advanceBookingAmount),oe(l.trialMakeupIncluded),ne(l.travelToVenue),ce(l.isActive),((a=l.includedServices)==null?void 0:a.length)>0&&y(l.includedServices.map(r=>({id:r._id,title:r.title,items:r.items}))),((i=l.gallery)==null?void 0:i.length)>0&&ue(l.gallery.map(r=>`${x}${r}`))}catch{d("Failed to load package")}finally{U(!1)}})()},[p,g]);const Pe=()=>{y(t=>[...t,{id:Date.now(),title:"",items:[]}])},Ie=(t,a,i)=>{y(n=>n.map(l=>l.id===t?{...l,[a]:a==="items"?i.split(",").map(r=>r.trim()).filter(Boolean):i}:l))},we=t=>{$.length>1&&y(a=>a.filter(i=>i.id!==t))},Te=t=>{const a=Array.from(t.target.files);if(S.length+F.length+a.length>5)return alert("Maximum 5 images allowed");pe(n=>[...n,...a])},Ae=t=>pe(a=>a.filter((i,n)=>n!==t)),Ee=t=>ue(a=>a.filter((i,n)=>n!==t)),Be=async()=>{var n,l;const t=(o==null?void 0:o._id)||(o==null?void 0:o.id);if(!t)return d("Vendor not authenticated");if(!T.trim())return d("Package title required");if(A.length===0)return d("Select categories");if(!E)return d("Select makeup type");if(!B)return d("Base price required");if(!M.trim())return d("Description required");const a=new FormData;a.append("module",be),a.append("packageTitle",T.trim()),a.append("description",M.trim()),A.forEach(r=>a.append("categories",r)),a.append("makeupType",E),a.append("basePrice",B),a.append("offerPrice",ee||"0"),a.append("cancellationPolicy",se),a.append("advanceBookingAmount",le),a.append("trialMakeupIncluded",D),a.append("travelToVenue",W),a.append("isActive",_),a.append("providerId",t);const i=$.filter(r=>r.title.trim()&&r.items.length>0).map(r=>({title:r.title.trim(),items:r.items}));a.append("includedServices",JSON.stringify(i)),S.forEach(r=>a.append("gallery",r));try{O(!0),d(""),P(""),g?(await v.put(`${x}/api/makeup-packages/${p}`,a),P("Package updated successfully!")):(await v.post(`${x}/api/makeup-packages`,a),P("Package created successfully!"))}catch(r){d(((l=(n=r.response)==null?void 0:n.data)==null?void 0:l.message)||"Error saving package")}finally{O(!1),window.scrollTo({top:0,behavior:"smooth"})}};return f||Se||ke?e.jsx(c,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:e.jsx(ge,{size:60})}):e.jsxs(c,{sx:{bgcolor:"#f9f9fc",minHeight:"100vh"},children:[e.jsxs(c,{sx:{bgcolor:"white",borderBottom:"1px solid #eee",p:2,px:4,position:"sticky",top:0,zIndex:10},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(C,{onClick:()=>b(-1),children:e.jsx(We,{})}),e.jsxs(m,{variant:"h5",fontWeight:"bold",children:[g?"Edit":"Add"," Makeup Package"]})]}),o&&e.jsxs(m,{variant:"body2",color:"text.secondary",sx:{ml:7},children:["Creating as: ",(o==null?void 0:o.firstName)||(o==null?void 0:o.email)||(o==null?void 0:o._id)]})]}),e.jsxs(c,{sx:{p:{xs:2,md:4}},children:[G&&e.jsx(he,{severity:"success",sx:{mb:3},children:G}),H&&e.jsx(he,{severity:"error",sx:{mb:3},children:H}),e.jsxs(L,{elevation:3,sx:{borderRadius:3,p:{xs:3,md:6}},children:[e.jsx(u,{fullWidth:!0,label:"Package Title *",value:T,onChange:t=>X(t.target.value),sx:{mb:3}}),e.jsxs(z,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsxs(me,{fullWidth:!0,children:[e.jsx(xe,{children:"Category *"}),e.jsx(fe,{multiple:!0,value:A,onChange:t=>Y(t.target.value),renderValue:t=>e.jsx(c,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(a=>{const i=I.find(n=>n._id===a);return e.jsx(_e,{label:(i==null?void 0:i.title)||"Unknown",size:"small"},a)})}),children:I.length===0?e.jsx(j,{disabled:!0,children:"No categories available"}):I.map(t=>e.jsx(j,{value:t._id,children:t.title},t._id))})]}),e.jsxs(me,{fullWidth:!0,children:[e.jsx(xe,{children:"Makeup Type *"}),e.jsxs(fe,{value:E,onChange:t=>Z(t.target.value),children:[e.jsx(j,{value:"",disabled:!0,children:"Select Type"}),J.length===0?e.jsx(j,{disabled:!0,children:"No makeup types available"}):J.map(t=>e.jsx(j,{value:t._id,children:t.name},t._id))]})]})]}),e.jsxs(z,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsx(u,{fullWidth:!0,label:"Base Price *",type:"number",value:B,onChange:t=>V(t.target.value)}),e.jsx(u,{fullWidth:!0,label:"Offer Price",type:"number",value:ee,onChange:t=>te(t.target.value),helperText:"Leave empty if no discount"}),e.jsx(u,{fullWidth:!0,label:"Advance Booking Amount",value:le,onChange:t=>re(t.target.value)})]}),e.jsx(u,{fullWidth:!0,label:"Description *",multiline:!0,rows:4,value:M,onChange:t=>ae(t.target.value),sx:{mb:4}}),e.jsx(m,{variant:"h6",sx:{mb:2,color:h},children:"Basic Add-ons"}),e.jsx(L,{variant:"outlined",sx:{p:3,mb:4,bgcolor:"#fafafa"},children:e.jsx($e,{row:!0,children:Object.keys(de).map(t=>e.jsx(k,{control:e.jsx(Fe,{checked:de[t],onChange:a=>Ce(i=>({...i,[t]:a.target.checked}))}),label:{hairStyling:"Hair Styling",sareeDraping:"Saree Draping",eyelashExtension:"Eyelash Extension",nailPolish:"Nail Polish"}[t]},t))})}),e.jsxs(c,{sx:{mb:4},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(m,{variant:"h6",sx:{color:h},children:"Custom Service Sections"}),e.jsx(je,{variant:"contained",startIcon:e.jsx(Le,{}),sx:{bgcolor:h},onClick:Pe,children:"Add Section"})]}),$.map(t=>e.jsx(Ue,{section:t,onChange:(a,i)=>Ie(t.id,a,i),onDelete:()=>we(t.id)},t.id))]}),e.jsx(u,{fullWidth:!0,label:"Cancellation Policy",multiline:!0,rows:3,value:se,onChange:t=>ie(t.target.value),sx:{mb:4}}),e.jsxs(z,{direction:"row",spacing:4,sx:{mb:4},children:[e.jsx(k,{control:e.jsx(N,{checked:D,onChange:()=>oe(!D)}),label:"Trial Makeup Included"}),e.jsx(k,{control:e.jsx(N,{checked:W,onChange:()=>ne(!W)}),label:"Travel to Venue"}),e.jsx(k,{control:e.jsx(N,{checked:_,onChange:()=>ce(!_)}),label:"Package Active"})]}),e.jsx(m,{variant:"h6",sx:{color:h,mb:2},children:"Gallery (Max 5)"}),e.jsxs(L,{onClick:()=>document.getElementById("gallery-input").click(),sx:{border:"2px dashed #ddd",borderRadius:2,p:4,textAlign:"center",cursor:"pointer",mb:4},children:[e.jsx("input",{id:"gallery-input",type:"file",hidden:!0,multiple:!0,accept:"image/*",onChange:Te}),S.length>0||F.length>0?e.jsxs(c,{sx:{display:"flex",flexWrap:"wrap",gap:2},children:[F.map((t,a)=>e.jsxs(c,{sx:{position:"relative"},children:[e.jsx("img",{src:t,alt:"",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(C,{onClick:i=>{i.stopPropagation(),Ee(a)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(ve,{fontSize:"small"})})]},`ex-${a}`)),S.map((t,a)=>e.jsxs(c,{sx:{position:"relative"},children:[e.jsx("img",{src:URL.createObjectURL(t),alt:"",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(C,{onClick:i=>{i.stopPropagation(),Ae(a)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(ve,{fontSize:"small"})})]},`new-${a}`))]}):e.jsxs(e.Fragment,{children:[e.jsx(ze,{sx:{fontSize:60,color:"#ccc"}}),e.jsx(m,{sx:{mt:2,color:h,fontWeight:"bold"},children:"Click to Upload Images"})]})]}),e.jsx(je,{fullWidth:!0,variant:"contained",size:"large",onClick:Be,disabled:R||!o,sx:{py:2,bgcolor:h,"&:hover":{bgcolor:"#c2185b"}},children:R?e.jsx(ge,{size:28,color:"inherit"}):g?"Update Package":"Create Package"})]})]})]})};export{Ke as default};
