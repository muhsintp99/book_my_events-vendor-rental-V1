import{r as o,f as ke,j as e,B as a,e as Se,C as Le,q as Re,T as c,a as k,b as v,y as oe,o as y,z as ae,Y as Ie,a1 as $e,H as le,a2 as Ue,c as Pe}from"./index-BPglAkNh.js";import{T as re,a as S}from"./Tabs-DRn_1dNi.js";import{C as Ve,V as Ee}from"./VideoLibrary-C-F-tmNY.js";import{T as Fe}from"./TableContainer-zMuQg4uS.js";import{T as We,a as G,b as l,c as Ae}from"./TableRow-BYYpuKk3.js";import{T as De}from"./TableHead-DdSuxs4C.js";import{C as ne}from"./Close-CemJsPGu.js";const r="https://api.bookmyevent.ae",L=ke.create({baseURL:r}),q="#e53935";function Ye(){const R=JSON.parse(localStorage.getItem("user")||"{}"),x=R==null?void 0:R._id,T=localStorage.getItem("moduleId"),[N,de]=o.useState(!1),[ce,z]=o.useState(!1),[m,I]=o.useState(0),[$,U]=o.useState(""),[H,P]=o.useState(""),[Y,V]=o.useState(""),[Oe,ue]=o.useState(null),[J,he]=o.useState(null),[xe,me]=o.useState([]),[p,E]=o.useState(null),[K,F]=o.useState([]),[W,C]=o.useState([]),[w,A]=o.useState(""),[g,D]=o.useState(null),[b,pe]=o.useState(0),[Q,ge]=o.useState([]),[be,O]=o.useState(!1),[X,fe]=o.useState([]),[Z,M]=o.useState(0),[je,_]=o.useState(!1),[f,ve]=o.useState("");o.useEffect(()=>{!x||!T||L.get(`/api/subscription/status/${x}?moduleId=${T}`).then(t=>{var i;const s=(i=t.data)==null?void 0:i.subscription;de((s==null?void 0:s.status)==="active"&&(s==null?void 0:s.isCurrent))})},[x,T]);const B=async()=>{const t=await L.get(`/api/portfolio/provider/${x}`);ge(t.data.data||[])};o.useEffect(()=>{B()},[]);const ye=t=>{if(!t)return null;const s=t.match(/(?:youtube\.com\/.*v=|youtu\.be\/)([^&]+)/);return s?`https://img.youtube.com/vi/${s[1]}/hqdefault.jpg`:null},Te=async()=>{if(!N)return alert("Upgrade plan required");if(!$.trim())return alert("Title required");if(m===1){if(!W.length&&!w)return alert("Please upload a video or add a video link");if(!g)return alert("Video thumbnail is required")}const t=new FormData;if(t.append("providerId",x),t.append("module",T),t.append("workTitle",$),t.append("description",H),t.append("tags",Y),m===0){if(!p)return alert("Thumbnail required");t.append("thumbnail",p),K.forEach(s=>t.append("images",s))}else W.forEach(s=>t.append("videos",s)),w&&t.append("videoLinks",JSON.stringify([w])),g&&t.append("videoThumbnail",g);z(!0),await L.post("/api/portfolio",t),z(!1),U(""),P(""),V(""),E(null),F([]),C([]),A(""),D(null),B()},Ce=async t=>{window.confirm("Delete portfolio?")&&(await L.delete(`/api/portfolio/${t}`),B())},we=t=>{var u,n,j;ue(t._id),U(t.workTitle||""),P(t.description||""),V(t.tags||"");const s=(u=t.media)==null?void 0:u.find(d=>d.type==="image"),i=(n=t.media)==null?void 0:n.find(d=>d.type==="video"||d.type==="videoLink");s&&(I(0),he(s.thumbnail||null),me(s.gallery||[]),E(null),F([])),i&&(I(1),C([]),A(((j=i.videoLinks)==null?void 0:j[0])||""),D(null)),window.scrollTo({top:0,behavior:"smooth"})},ee=b===0?Q.filter(t=>{var s;return(s=t.media)==null?void 0:s.some(i=>i.type==="image")}):Q.filter(t=>{var s;return(s=t.media)==null?void 0:s.some(i=>i.type==="video"||i.type==="videoLink")});return e.jsxs(a,{sx:{p:3,maxWidth:1800,mx:"auto"},children:[!N&&e.jsx(Se,{severity:"warning",sx:{mb:3},children:"Upgrade to premium to add portfolio works"}),e.jsx(Le,{sx:{mb:5,borderRadius:3,width:"100%"},children:e.jsxs(Re,{children:[e.jsx(c,{variant:"h5",fontWeight:700,mb:2,children:"Add Portfolio Work"}),e.jsxs(re,{value:m,onChange:(t,s)=>I(s),sx:{mb:3},children:[e.jsx(S,{label:"Images"}),e.jsx(S,{label:"Videos"})]}),e.jsx(k,{fullWidth:!0,label:"Title",value:$,onChange:t=>U(t.target.value),sx:{mb:3}}),e.jsx(k,{fullWidth:!0,multiline:!0,rows:3,label:"Description",value:H,onChange:t=>P(t.target.value),sx:{mb:3}}),e.jsx(k,{fullWidth:!0,label:"Tags",value:Y,onChange:t=>V(t.target.value),sx:{mb:4}}),m===0&&e.jsxs(e.Fragment,{children:[e.jsxs(v,{component:"label",variant:"contained",sx:{bgcolor:q,mb:2},children:[e.jsx(oe,{sx:{mr:1}})," Upload Thumbnail",e.jsx("input",{hidden:!0,type:"file",accept:"image/*",onChange:t=>E(t.target.files[0])})]}),J&&!p&&e.jsxs(a,{sx:{mb:3},children:[e.jsx(c,{variant:"caption",children:"Current Thumbnail"}),e.jsx("img",{src:`${r}/${J}`,style:{width:180,height:180,borderRadius:12,display:"block",marginTop:8}})]}),p&&e.jsxs(a,{sx:{mb:3},children:[e.jsx(c,{variant:"caption",children:"New Thumbnail"}),e.jsx("img",{src:URL.createObjectURL(p),style:{width:180,height:180,borderRadius:12,display:"block",marginTop:8}})]}),e.jsxs(v,{component:"label",variant:"outlined",sx:{mb:2},children:[e.jsx(Ve,{sx:{mr:1}})," Upload Gallery Images",e.jsx("input",{hidden:!0,multiple:!0,type:"file",accept:"image/*",onChange:t=>F([...t.target.files])})]}),e.jsxs(a,{sx:{display:"flex",gap:2,flexWrap:"wrap",mb:4},children:[xe.map((t,s)=>e.jsx("img",{src:`${r}/${t}`,style:{width:100,height:100,borderRadius:10,objectFit:"cover"}},`existing-${s}`)),K.map((t,s)=>e.jsx("img",{src:URL.createObjectURL(t),style:{width:100,height:100,borderRadius:10,border:"2px solid #4caf50",objectFit:"cover"}},`new-${s}`))]})]}),m===1&&e.jsxs(e.Fragment,{children:[e.jsxs(v,{component:"label",variant:"contained",sx:{bgcolor:q,mb:2},children:[e.jsx(Ee,{sx:{mr:1}})," Upload Videos",e.jsx("input",{hidden:!0,multiple:!0,type:"file",accept:"video/*",onChange:t=>C(Array.from(t.target.files))})]}),W.map((t,s)=>e.jsxs(a,{sx:{mb:2},children:[e.jsx("video",{src:URL.createObjectURL(t),controls:!0,style:{width:260,borderRadius:8}}),e.jsx(y,{color:"error",onClick:()=>C(i=>i.filter((u,n)=>n!==s)),children:e.jsx(ae,{})})]},s)),e.jsxs(v,{component:"label",variant:"outlined",sx:{mb:2},children:[e.jsx(oe,{sx:{mr:1}})," Upload Video Thumbnail",e.jsx("input",{hidden:!0,type:"file",accept:"image/*",onChange:t=>D(t.target.files[0])})]}),g&&e.jsxs(a,{sx:{mb:3},children:[e.jsx(c,{variant:"caption",children:"Video Thumbnail Preview"}),e.jsx("img",{src:URL.createObjectURL(g),style:{width:160,height:100,objectFit:"cover",borderRadius:8,display:"block",marginTop:8}})]}),e.jsx(k,{fullWidth:!0,label:"Video Link (YouTube / Vimeo)",value:w,onChange:t=>A(t.target.value),sx:{mb:3}})]}),e.jsx(v,{fullWidth:!0,variant:"contained",sx:{bgcolor:q,py:1.4},onClick:Te,children:"Add Portfolio"})]})}),e.jsxs(re,{value:b,onChange:(t,s)=>pe(s),sx:{mb:2},children:[e.jsx(S,{label:"Images"}),e.jsx(S,{label:"Videos"})]}),e.jsx(Fe,{component:Ie,sx:{borderRadius:3,width:"100%"},children:e.jsxs(We,{children:[e.jsx(De,{sx:{bgcolor:"#fdeaea"},children:e.jsxs(G,{children:[e.jsx(l,{children:"Work"}),e.jsx(l,{children:"Preview"}),e.jsx(l,{align:"center",children:"Count"}),e.jsx(l,{align:"right",children:"Action"})]})}),e.jsxs(Ae,{children:[ee.length===0&&e.jsx(G,{children:e.jsx(l,{colSpan:4,align:"center",children:e.jsx(c,{color:"text.secondary",children:"No portfolio items found"})})}),ee.map(t=>{var u,n,j,d,te;const s=t.media.find(h=>h.type==="image"),i=t.media.find(h=>h.type==="video"||h.type==="videoLink");return e.jsxs(G,{hover:!0,children:[e.jsxs(l,{children:[e.jsx(c,{fontWeight:600,children:t.workTitle}),e.jsx(c,{variant:"caption",color:"text.secondary",children:t.description})]}),e.jsxs(l,{children:[b===0&&s&&e.jsx("img",{src:`${r}/${s.thumbnail}`,style:{width:70,height:70,borderRadius:10,cursor:"pointer",objectFit:"cover"},onClick:()=>{fe(s.gallery||[]),M(0),O(!0)}}),b===1&&i&&e.jsxs(a,{sx:{cursor:"pointer"},onClick:()=>{var se,ie;const h=(se=i.videos)!=null&&se[0]?`${r}/${i.videos[0]}`:(ie=i.videoLinks)==null?void 0:ie[0];ve(h),_(!0)},children:[i.thumbnail&&e.jsx("img",{src:`${r}/${i.thumbnail}`,alt:"video thumbnail",style:{width:80,height:60,objectFit:"cover",borderRadius:6}}),!((u=i.videos)!=null&&u.length)&&((n=i.videoLinks)==null?void 0:n[0])&&e.jsx("img",{src:ye(i.videoLinks[0])||"/video-placeholder.png",alt:"video thumbnail",style:{width:80,height:60,objectFit:"cover",borderRadius:6}})]})]}),e.jsx(l,{align:"center",children:b===0?((j=s==null?void 0:s.gallery)==null?void 0:j.length)||0:(((d=i==null?void 0:i.videos)==null?void 0:d.length)||0)+(((te=i==null?void 0:i.videoLinks)==null?void 0:te.length)||0)}),e.jsx(l,{align:"right",children:e.jsxs(a,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[e.jsx(y,{size:"small",color:"primary",onClick:()=>we(t),children:e.jsx($e,{})}),e.jsx(y,{size:"small",color:"error",onClick:()=>Ce(t._id),children:e.jsx(ae,{})})]})})]},t._id)})]})]})}),e.jsx(le,{open:be,onClose:()=>O(!1),fullScreen:!0,children:e.jsxs(a,{sx:{bgcolor:"#000",height:"100vh",p:2},children:[e.jsx(y,{onClick:()=>O(!1),sx:{color:"#fff"},children:e.jsx(ne,{})}),e.jsx(a,{sx:{textAlign:"center",mt:2},children:e.jsx("img",{src:`${r}/${X[Z]}`,style:{maxHeight:"70vh",maxWidth:"100%"}})}),e.jsx(Ue,{sx:{my:2,bgcolor:"#333"}}),e.jsx(a,{sx:{display:"flex",justifyContent:"center",gap:1},children:X.map((t,s)=>e.jsx("img",{src:`${r}/${t}`,onClick:()=>M(s),style:{width:60,height:60,borderRadius:8,border:Z===s?"2px solid #fff":"1px solid #444",cursor:"pointer"}},s))})]})}),e.jsx(le,{open:je,onClose:()=>_(!1),fullScreen:!0,children:e.jsxs(a,{sx:{bgcolor:"#000",height:"100vh",p:2},children:[e.jsx(y,{onClick:()=>_(!1),sx:{color:"#fff"},children:e.jsx(ne,{})}),e.jsx(a,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"80%"},children:f!=null&&f.includes("http")?e.jsx("iframe",{src:f,width:"80%",height:"80%",frameBorder:"0",allowFullScreen:!0}):e.jsx("video",{src:f,controls:!0,style:{maxWidth:"80%"}})})]})}),ce&&e.jsx(Pe,{})]})}export{Ye as default};
