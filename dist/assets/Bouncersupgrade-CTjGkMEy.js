import{r as n,j as e,B as h,c as Z,T as i,e as P,G as C,C as W,q as $,w as R,a2 as D,s as L,X as E,b as _,N as ee,f as y}from"./index-CWJg_lwt.js";import{W as se}from"./WorkspacePremium-u47r4tpS.js";const B=120,te=3,b="https://api.bookmyevent.ae",u="#0f172a";function ne(){var k;const[M,T]=n.useState([]),[F,N]=n.useState(!0),[H,z]=n.useState(null),[O,V]=n.useState(null),[X,re]=n.useState(null),[I,c]=n.useState({open:!1,message:"",severity:"info"}),[p,A]=n.useState(null),[Y,S]=n.useState(!0),l=localStorage.getItem("moduleId"),j=JSON.parse(localStorage.getItem("user")||"{}"),m=j==null?void 0:j._id;n.useEffect(()=>{const t=new URLSearchParams(window.location.search).get("orderId");if(!t){S(!1);return}(async()=>{var a,r,f,g;try{c({open:!0,message:"Verifying payment...",severity:"info"});const o=await y.post(`${b}/api/payment/verify-subscription-payment`,{orderId:t});if(o.data.success){c({open:!0,message:"ðŸŽ‰ Premium Plan Activated!",severity:"success"});const v=typeof o.data.subscription.moduleId=="object"&&((a=o.data.subscription.moduleId)==null?void 0:a._id)||o.data.subscription.moduleId,w=await y.get(`${b}/api/subscription/status/${m}?moduleId=${v}`);if(w.data.success&&w.data.subscription){const x=w.data.subscription,U=typeof x.moduleId=="object"&&((r=x.moduleId)==null?void 0:r._id)||x.moduleId;localStorage.setItem("moduleId",U);const K=new Date(x.endDate),Q=Math.max(0,Math.ceil((K-new Date)/(1e3*60*60*24)));localStorage.setItem("upgrade",JSON.stringify({isSubscribed:!0,status:"active",plan:x.planId,module:U,access:{canAccess:!0,isExpired:!1,daysLeft:Q}})),A(x),window.history.replaceState({},"",window.location.pathname),setTimeout(()=>{window.location.replace("/bouncers/portfolio")},2e3)}}else c({open:!0,message:o.data.message||"Payment verification failed",severity:"error"})}catch(o){console.error("âŒ Payment verification error:",o),c({open:!0,message:((g=(f=o.response)==null?void 0:f.data)==null?void 0:g.message)||"Payment verification failed",severity:"error"})}finally{S(!1)}})()},[m,l]),n.useEffect(()=>{if(new URLSearchParams(window.location.search).get("orderId"))return;(async()=>{if(!m||!l){S(!1);return}try{const d=await y.get(`${b}/api/subscription/status/${m}?moduleId=${l}`);if(d.data.success&&d.data.subscription){const a=d.data.subscription;a.status==="active"&&a.isCurrent&&A(a)}}catch(d){console.error("âŒ API error:",d.message)}finally{S(!1)}})()},[m,l]),n.useEffect(()=>{l&&(async()=>{try{const t=await y.get(`${b}/api/subscription/plan/module/${l}`);T(t.data.plans||[])}catch{c({open:!0,message:"Failed to load plans",severity:"error"})}finally{N(!1)}})()},[l]);const G=()=>new Promise(s=>{if(window.Razorpay){s(!0);return}const t=document.createElement("script");t.src="https://checkout.razorpay.com/v1/checkout.js",t.async=!0,t.onload=()=>s(!0),t.onerror=()=>s(!1),document.body.appendChild(t)}),J=async s=>{if(!m||!l){c({open:!0,message:"User or module missing",severity:"warning"});return}try{if(z(s._id),!await G())throw new Error("Razorpay SDK failed to load");const d=await y.post(`${b}/api/razorpay/subscription/create`,{providerId:m,planId:s._id,customerEmail:j.email,customerPhone:j.mobile||"9999999999"}),{razorpay:a,customer:r}=d.data,f={key:a.key,subscription_id:a.subscriptionId,name:"Book My Event",description:`${s.name} Subscription`,image:"/logo.png",handler:async function(o){try{if((await y.post(`${b}/api/razorpay/subscription/verify`,o)).data.success)c({open:!0,message:"ðŸŽ‰ Subscription Activated!",severity:"success"}),setTimeout(()=>{window.location.replace("/bouncers/portfolio")},1500);else throw new Error("Verification failed")}catch{c({open:!0,message:"Payment verification failed",severity:"error"})}},prefill:{email:r.email,contact:r.phone},theme:{color:u}};new window.Razorpay(f).open()}catch(t){c({open:!0,message:t.message||"Payment failed",severity:"error"}),z(null)}};if(F||Y)return e.jsx(h,{sx:{minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(Z,{sx:{color:u}})});const q=s=>{var t;return((t=p==null?void 0:p.planId)==null?void 0:t._id)===s};return e.jsxs(h,{sx:{minHeight:"100vh",bgcolor:"#f9fafc",py:6},children:[e.jsxs(h,{maxWidth:"md",mx:"auto",px:2,children:[e.jsx(i,{variant:"h4",fontWeight:800,textAlign:"center",children:p?"Manage Your Plan":"Upgrade Your Plan"}),e.jsx(i,{textAlign:"center",color:"text.secondary",mb:3,children:"Choose the best plan for your Bouncers business"}),p?e.jsxs(P,{severity:"success",sx:{mb:4,border:"1px solid #4caf50"},children:["Current Plan: ",e.jsx("b",{children:((k=p.planId)==null?void 0:k.name)||"PREMIUM"})]}):e.jsxs(P,{severity:"info",sx:{mb:4,border:"1px solid #0f172a"},children:["Current Plan: ",e.jsx("b",{children:"FREE"})," - Upgrade to unlock premium features"]}),e.jsxs(C,{container:!0,spacing:3,justifyContent:"center",children:[!p&&e.jsx(C,{item:!0,xs:12,md:6,children:e.jsx(W,{sx:{height:"100%",borderRadius:4,border:"2px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:e.jsxs($,{children:[e.jsx(R,{label:"CURRENT PLAN",sx:{bgcolor:"#9e9e9e",color:"#fff",mb:2}}),e.jsx(i,{variant:"h6",fontWeight:800,children:"FREE"}),e.jsx(i,{color:"text.secondary",sx:{minHeight:48},children:"Basic access to get started"}),e.jsx(i,{variant:"h4",fontWeight:900,color:"#9e9e9e",mt:2,children:"â‚¹0"}),e.jsx(D,{sx:{my:2}}),e.jsx(L,{spacing:1,children:["Limited listings","Basic visibility","Standard support"].map(s=>e.jsxs(h,{display:"flex",alignItems:"center",children:[e.jsx(E,{sx:{color:"#9e9e9e",mr:1,fontSize:20}}),e.jsx(i,{variant:"body2",children:s})]},s))}),e.jsx(_,{fullWidth:!0,disabled:!0,sx:{mt:3,bgcolor:"#e0e0e0",color:"#757575",fontWeight:700,borderRadius:2},children:"Current Plan"})]})})}),M.map(s=>{var f,g;const t=O===s._id,d=X===s._id,a=H===s._id,r=q(s._id);return e.jsx(C,{item:!0,xs:12,md:6,children:e.jsx(W,{sx:{height:"100%",borderRadius:4,border:r?"3px solid #4caf50":`3px solid ${u}`,boxShadow:r?"0 4px 20px rgba(76, 175, 80, 0.2)":"0 4px 20px rgba(15, 23, 42, 0.2)"},children:e.jsxs($,{children:[e.jsx(R,{icon:r?e.jsx(E,{}):e.jsx(se,{}),label:r?"CURRENT PLAN":"BEST VALUE",sx:{bgcolor:r?"#4caf50":u,color:"#fff",mb:2,fontWeight:700}}),e.jsx(i,{variant:"h6",fontWeight:800,color:r?"#4caf50":u,children:s.name}),e.jsxs(i,{color:"text.secondary",sx:{minHeight:48},children:[t?s.description:`${((f=s.description)==null?void 0:f.slice(0,B))||""}...`,((g=s.description)==null?void 0:g.length)>B&&e.jsx(_,{size:"small",onClick:()=>V(t?null:s._id),children:t?"Read less":"Read more"})]}),e.jsxs(h,{sx:{mt:2},children:[e.jsx(R,{label:"ðŸŽ‰ Pre-Launch Offer",sx:{bgcolor:"#fff3cd",color:"#b45309",fontWeight:700,mb:1}}),e.jsxs(h,{sx:{display:"flex",alignItems:"baseline",gap:2},children:[e.jsx(i,{sx:{textDecoration:"line-through",color:"#9ca3af",fontSize:18},children:"â‚¹20,000"}),e.jsxs(i,{sx:{fontSize:32,fontWeight:900,color:r?"#4caf50":u},children:["â‚¹",s.price]}),e.jsx(i,{sx:{fontSize:14,color:"text.secondary"},children:"/ year"})]})]}),e.jsx(D,{sx:{my:2}}),e.jsx(L,{spacing:1,children:(d?s.features:s.features.slice(0,te)).map((o,v)=>e.jsxs(h,{display:"flex",alignItems:"flex-start",children:[e.jsx(E,{sx:{color:r?"#4caf50":u,mr:1,mt:.3,fontSize:20}}),e.jsx(i,{variant:"body2",children:o})]},v))}),e.jsx(_,{fullWidth:!0,disabled:a||r,onClick:()=>J(s),sx:{mt:3,bgcolor:r?"#e0e0e0":u,color:r?"#757575":"#fff",fontWeight:800,py:1.5,"&:hover":{bgcolor:r?"#e0e0e0":"#1e293b"}},children:r?"Current Plan":a?"Redirecting...":"Upgrade To Premium"})]})})},s._id)})]})]}),e.jsx(ee,{open:I.open,autoHideDuration:4e3,onClose:()=>c({...I,open:!1}),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(P,{severity:I.severity,children:I.message})})]})}export{ne as default};
