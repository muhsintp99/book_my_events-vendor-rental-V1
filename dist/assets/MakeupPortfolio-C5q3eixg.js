import{r as o,g as be,j as e,B as h,s as Q,v as X,aj as ve,o as ye,N as Z,T as R,q as p,f as g,G as ee,b as te,a7 as Ce,ag as Se}from"./index-2qmD94Bw.js";import{T as ke,a as se}from"./Tabs-BuYSG0v8.js";import{C as Ie}from"./CloudUpload-CNOBqvuA.js";import{C as Te}from"./Close-0FB6vH_5.js";import{V as ae,L as we}from"./VideoLibrary-CaKbmwrl.js";import{T as Le}from"./TableContainer-CWuvdMb5.js";import{T as Pe,a as De,b as E,c as r,d as Ue}from"./TableRow-DGUoSBh-.js";import{D as Ae}from"./Delete-D_YL6LB1.js";const oe="https://api.bookmyevent.ae",C=be.create({baseURL:oe}),l="#e53935";function Ne(){const S=JSON.parse(localStorage.getItem("user")||"{}"),d=S==null?void 0:S._id,x=localStorage.getItem("moduleId"),[u,m]=o.useState(!1),[ie,re]=o.useState(!0),[k,ne]=o.useState(0),[le,j]=o.useState(!1),[V,ce]=o.useState([]),[b,I]=o.useState(""),[T,w]=o.useState(""),[de,F]=o.useState([]),[L,W]=o.useState(""),[v,P]=o.useState([]),[O,_]=o.useState([]),[D,B]=o.useState([]),[U,N]=o.useState(""),[y,$]=o.useState({open:!1,message:"",severity:"success"});o.useEffect(()=>{(async()=>{var s;try{if(!d||!x){m(!1);return}const a=(s=(await C.get(`/api/subscription/status/${d}?moduleId=${x}`)).data)==null?void 0:s.subscription;if((a==null?void 0:a.status)==="active"&&(a!=null&&a.isCurrent)){m(!0);return}const i=JSON.parse(localStorage.getItem("upgrade")||"{}");(i==null?void 0:i.status)==="active"&&(i==null?void 0:i.module)===x?m(!0):m(!1)}catch{m(!1)}finally{re(!1)}})()},[d,x]),o.useEffect(()=>{d&&A()},[d]);const A=async()=>{try{j(!0);const t=await C.get(`/api/portfolio/provider/${d}`);ce(t.data.data||[])}catch{c("Failed to load portfolio","error")}finally{j(!1)}},c=(t,s="success")=>$({open:!0,message:t,severity:s}),ue=t=>{t.key==="Enter"&&L.trim()&&(t.preventDefault(),F(s=>[...s,L.trim()]),W(""))},fe=t=>{const s=Array.from(t.target.files);P(n=>n.concat(s.map(a=>({file:a,preview:URL.createObjectURL(a)}))))},xe=t=>{URL.revokeObjectURL(v[t].preview),P(s=>s.filter((n,a)=>a!==t))},pe=t=>{const s=Array.from(t.target.files);_(n=>n.concat(s.map(a=>({file:a,preview:URL.createObjectURL(a)}))))},me=()=>{U.trim()&&(B(t=>[...t,U.trim()]),N(""))},J=async t=>{var n,a;if(!u)return c("Upgrade to Premium to add portfolio","warning");if(!b.trim())return c("Title is required","warning");if(!t&&v.length===0)return c("Add at least one image","warning");if(t&&O.length===0&&D.length===0)return c("Add video file or link","warning");if(!x)return c("Module missing. Re-login.","error");const s=new FormData;s.append("providerId",d),s.append("module",x),s.append("workTitle",b),s.append("description",T),s.append("tags",JSON.stringify(de)),t?(O.forEach(i=>s.append("videos",i.file)),D.length>0&&s.append("videoLinks",JSON.stringify(D))):v.forEach(i=>s.append("images",i.file));try{j(!0),await C.post("/api/portfolio",s),c("Portfolio added"),he(),A()}catch(i){c(((a=(n=i.response)==null?void 0:n.data)==null?void 0:a.message)||"Upload failed","error")}finally{j(!1)}},he=()=>{I(""),w(""),F([]),P([]),_([]),B([])},ge=async t=>{if(window.confirm("Delete portfolio?"))try{await C.delete(`/api/portfolio/${t}`),A(),c("Deleted")}catch{c("Delete failed","error")}};return ie?e.jsx(h,{sx:{minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(Q,{sx:{color:l}})}):e.jsxs(h,{sx:{p:3},children:[le&&e.jsx(h,{sx:{position:"fixed",inset:0,bgcolor:"rgba(0,0,0,.4)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Q,{sx:{color:l}})}),!u&&e.jsx(X,{severity:"warning",sx:{mb:2},children:"You are on a FREE plan. Upgrade to add portfolio."}),e.jsx(ve,{open:y.open,autoHideDuration:4e3,onClose:()=>$({...y,open:!1}),children:e.jsx(X,{severity:y.severity,children:y.message})}),e.jsxs(ye,{children:[e.jsxs(ke,{value:k,onChange:(t,s)=>ne(s),TabIndicatorProps:{style:{backgroundColor:l}},children:[e.jsx(se,{label:"Images"}),e.jsx(se,{label:"Videos"})]}),k===0&&e.jsxs(Z,{children:[e.jsx(R,{variant:"h6",sx:{color:l},children:"Add Portfolio Images"}),e.jsx(p,{fullWidth:!0,label:"Title",value:b,onChange:t=>I(t.target.value),sx:{mb:2}}),e.jsx(p,{fullWidth:!0,multiline:!0,rows:3,label:"Description",value:T,onChange:t=>w(t.target.value),sx:{mb:2}}),e.jsx(p,{fullWidth:!0,label:"Add Tag (Enter)",value:L,onKeyDown:ue,onChange:t=>W(t.target.value),sx:{mb:2}}),e.jsxs(g,{component:"label",variant:"contained",sx:{bgcolor:l},disabled:!u,children:[e.jsx(Ie,{sx:{mr:1}})," Upload Images",e.jsx("input",{hidden:!0,multiple:!0,type:"file",accept:"image/*",onChange:fe})]}),e.jsx(ee,{container:!0,spacing:2,sx:{mt:2},children:v.map((t,s)=>e.jsx(ee,{item:!0,xs:6,md:3,children:e.jsxs(h,{sx:{position:"relative"},children:[e.jsx("img",{src:t.preview,alt:"",style:{width:"100%",height:120,objectFit:"cover"}}),e.jsx(te,{onClick:()=>xe(s),sx:{position:"absolute",top:4,right:4,bgcolor:l,color:"#fff"},children:e.jsx(Te,{})})]})},s))}),e.jsx(g,{fullWidth:!0,sx:{mt:3,bgcolor:l},variant:"contained",disabled:!u,onClick:()=>J(!1),children:"Add Portfolio"})]}),k===1&&e.jsxs(Z,{children:[e.jsx(R,{variant:"h6",sx:{color:l},children:"Add Portfolio Videos"}),e.jsx(p,{fullWidth:!0,label:"Title",value:b,onChange:t=>I(t.target.value),sx:{mb:2}}),e.jsx(p,{fullWidth:!0,multiline:!0,rows:3,label:"Description",value:T,onChange:t=>w(t.target.value),sx:{mb:2}}),e.jsxs(g,{component:"label",variant:"contained",sx:{bgcolor:l,mb:2},disabled:!u,children:[e.jsx(ae,{sx:{mr:1}})," Upload Videos",e.jsx("input",{hidden:!0,multiple:!0,type:"file",accept:"video/*",onChange:pe})]}),e.jsxs(h,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(p,{fullWidth:!0,label:"Video Link",value:U,onChange:t=>N(t.target.value)}),e.jsx(g,{variant:"contained",sx:{bgcolor:l},onClick:me,disabled:!u,children:e.jsx(we,{})})]}),e.jsx(g,{fullWidth:!0,sx:{bgcolor:l},variant:"contained",disabled:!u,onClick:()=>J(!0),children:"Add Video"})]})]}),e.jsx(R,{sx:{mt:4,mb:1,color:l},variant:"h6",children:"Portfolio List"}),e.jsx(Le,{component:Ce,children:e.jsxs(Pe,{children:[e.jsx(De,{sx:{bgcolor:"#fdeaea"},children:e.jsxs(E,{children:[e.jsx(r,{children:"SI"}),e.jsx(r,{children:"Title"}),e.jsx(r,{children:"Preview"}),e.jsx(r,{children:"Count"}),e.jsx(r,{children:"Tags"}),e.jsx(r,{children:"Actions"})]})}),e.jsx(Ue,{children:V.length===0?e.jsx(E,{children:e.jsx(r,{colSpan:6,align:"center",children:"No portfolio found"})}):V.map((t,s)=>{var H,q,z,G,M,K,Y;const n=((q=(H=t.media)==null?void 0:H.find(f=>f.type==="image"))==null?void 0:q.images)||[],a=((G=(z=t.media)==null?void 0:z.find(f=>f.type==="video"))==null?void 0:G.videos)||[],i=((K=(M=t.media)==null?void 0:M.find(f=>f.type==="videoLink"))==null?void 0:K.videoLinks)||[];return e.jsxs(E,{children:[e.jsx(r,{children:s+1}),e.jsx(r,{children:t.workTitle}),e.jsx(r,{children:n[0]?e.jsx("img",{src:`${oe}${n[0]}`,style:{width:60,height:50,objectFit:"cover"}}):e.jsx(ae,{color:"action"})}),e.jsx(r,{children:n.length+a.length+i.length}),e.jsx(r,{children:(Y=t.tags)==null?void 0:Y.map((f,je)=>e.jsx(Se,{size:"small",label:f,sx:{mr:.5}},je))}),e.jsx(r,{children:e.jsx(te,{color:"error",onClick:()=>ge(t._id),children:e.jsx(Ae,{})})})]},t._id)})})]})})]})}export{Ne as default};
