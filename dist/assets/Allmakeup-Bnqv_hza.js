import{r as o,j as e,B as f,T as y,x as T,a8 as B,S,s as C,g as j,t as b,h as A}from"./index-CGJ48FRi.js";import{T as D}from"./TableContainer-BfdQaVdu.js";import{T as I,a as h,b as r,c as E}from"./TableRow-iMeu6jXW.js";import{T as L}from"./TableHead-BG77M2YQ.js";const _=()=>{const[a,k]=o.useState(""),[x,m]=o.useState([]),[c,d]=o.useState(!0),[p,i]=o.useState(null),[g,v]=o.useState(null);o.useEffect(()=>{const s=localStorage.getItem("user");if(!s){i("User not logged in"),d(!1);return}const n=JSON.parse(s),t=n._id||n.id||n.providerId;if(!t||t==="null"){i("Invalid provider ID. Please login again."),d(!1);return}v(t)},[]),o.useEffect(()=>{(async()=>{var n,t;if(!g){i("Provider ID not found. Please login again."),d(!1);return}try{const l=await A.get(`https://api.bookmyevent.ae/api/bookings/provider/${g}`);m(l.data.data||l.data.bookings||[]),i(null)}catch(l){console.error("Error fetching bookings:",l),i(((t=(n=l.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to fetch bookings"),m([])}finally{d(!1)}})()},[g]);const w=s=>k(s.target.value),u=x.filter(s=>(s.fullName||"").toLowerCase().includes(a.toLowerCase())||(s.emailAddress||"").toLowerCase().includes(a.toLowerCase())||(s._id||"").toLowerCase().includes(a.toLowerCase()));return e.jsxs(f,{p:2,children:[e.jsx(y,{variant:"h4",gutterBottom:!0,children:"My Bookings"}),p&&e.jsx(T,{severity:"error",sx:{mb:2},children:p}),e.jsxs(B,{sx:{mt:2,width:"100%",borderRadius:"10px"},children:[e.jsxs(S,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"space-between",alignItems:{xs:"stretch",sm:"center"},p:2,children:[e.jsx(C,{label:"Search by Booking ID, Name, Email",variant:"outlined",size:"small",value:a,onChange:w,sx:{maxWidth:{sm:300}}}),e.jsx(j,{variant:"contained",color:"primary",children:"Export"})]}),e.jsx(D,{sx:{width:"100%",overflowX:"auto"},children:e.jsxs(I,{stickyHeader:!0,children:[e.jsx(L,{children:e.jsxs(h,{children:[e.jsx(r,{children:"S#"}),e.jsx(r,{children:"Booking ID"}),e.jsx(r,{children:"Module"}),e.jsx(r,{children:"Customer"}),e.jsx(r,{children:"Email"}),e.jsx(r,{children:"Booking Date"}),e.jsx(r,{children:"Guests"}),e.jsx(r,{children:"Amount"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Payment Status"}),e.jsx(r,{children:"Action"})]})}),e.jsxs(E,{children:[c&&e.jsx(h,{children:e.jsx(r,{colSpan:11,align:"center",children:e.jsx(b,{size:28})})}),!c&&u.map((s,n)=>{var t;return e.jsxs(h,{children:[e.jsx(r,{children:n+1}),e.jsxs(r,{children:["#",s._id.slice(-6)]}),e.jsx(r,{children:s.moduleType||"N/A"}),e.jsx(r,{children:s.fullName||"N/A"}),e.jsx(r,{children:s.emailAddress||"N/A"}),e.jsx(r,{children:new Date(s.bookingDate).toLocaleDateString()}),e.jsx(r,{children:s.numberOfGuests||"-"}),e.jsxs(r,{children:["â‚¹",((t=s.finalPrice)==null?void 0:t.toLocaleString())||0]}),e.jsx(r,{style:{color:s.status==="Accepted"?"green":s.status==="Rejected"?"red":"orange",fontWeight:600},children:s.status}),e.jsx(r,{style:{textTransform:"capitalize",color:s.paymentStatus==="completed"?"green":s.paymentStatus==="failed"?"red":"orange",fontWeight:600},children:s.paymentStatus}),e.jsx(r,{children:e.jsxs(S,{direction:"row",spacing:1,children:[e.jsx(j,{variant:"outlined",size:"small",color:"primary",children:"View"}),e.jsx(j,{variant:"outlined",size:"small",color:"secondary",children:"Download"})]})})]},s._id)}),!c&&u.length===0&&e.jsx(h,{children:e.jsx(r,{colSpan:11,align:"center",children:a?"No matching bookings found":"No bookings yet"})})]})]})})]}),!c&&x.length>0&&e.jsx(f,{mt:2,children:e.jsxs(y,{variant:"body2",color:"textSecondary",children:["Showing ",u.length," of ",x.length," bookings"]})})]})};export{_ as default};
