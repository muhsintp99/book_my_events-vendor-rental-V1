import{w as Je,r as i,j as e,B as d,t as ye,b as S,ak as He,T as b,x as Ce,ad as F,s as m,S as k,F as K,I as q,ag as Q,$ as T,C as Ke,a7 as qe,a9 as Qe,O as Xe,g as X,ar as Ie,f as Ye,al as Ze,h as C}from"./index-C4aZzemC.js";import{A as ve}from"./Add-DY64D3qI.js";import{C as Y}from"./Close-Bn6xFEdt.js";import{C as Se}from"./CloudUpload-DQlXTxqS.js";const g="#E91E63",v="https://api.bookmyevent.ae",ke="68e5fc09651cc12c1fc0f9c9",et=({variation:D,onChange:W,onDelete:y})=>e.jsxs(k,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"center",sx:{mb:2},children:[e.jsx(m,{label:"Variation Name (e.g. Half Kg)",value:D.name||"",onChange:u=>W("name",u.target.value),sx:{flex:1}}),e.jsx(m,{label:"Price (₹)",type:"number",value:D.price||"",onChange:u=>W("price",u.target.value),sx:{width:150}}),e.jsx(S,{onClick:y,color:"error",children:e.jsx(Ie,{})})]}),it=()=>{const D=Je(),y=new URLSearchParams(window.location.search).get("id"),u=!!y,[Z,I]=i.useState([{id:Date.now(),name:"",price:""}]),[we,ee]=i.useState(!0),[te,ae]=i.useState(!1),[se,L]=i.useState(""),[re,x]=i.useState(""),[Ae,Ee]=i.useState([]),[ie,N]=i.useState([]),[Te,De]=i.useState(!0),[p,Ne]=i.useState(null),[R,ne]=i.useState(""),[oe,le]=i.useState(""),[P,z]=i.useState(""),[_,U]=i.useState([]),[ce,de]=i.useState("Eggless"),[O,ge]=i.useState(""),[M,pe]=i.useState(""),[V,he]=i.useState(""),[G,ue]=i.useState(!0),[me,B]=i.useState([{id:Date.now(),name:"",price:""}]),[j,xe]=i.useState(null),[J,Pe]=i.useState(""),[$,fe]=i.useState([]),[H,be]=i.useState([]);i.useEffect(()=>{try{const t=localStorage.getItem("vendor")||localStorage.getItem("user")||localStorage.getItem("vendorData");t&&Ne(JSON.parse(t))}catch(t){console.error("Vendor load error:",t)}},[]),i.useEffect(()=>{(async()=>{var a;try{const s=localStorage.getItem("token"),c=((a=(await C.get(`${v}/api/categories/parents/${ke}`,{headers:{Authorization:`Bearer ${s}`}})).data)==null?void 0:a.data)||[];Ee(c),console.log("✅ Parent Categories Loaded:",c)}catch(s){console.error("❌ Failed to load parent categories:",s),x("Failed to load categories")}finally{De(!1)}})()},[]);const _e=async t=>{var s;const a=t.target.value;if(z(a),U([]),N([]),!!a)try{const o=localStorage.getItem("token"),f=((s=(await C.get(`${v}/api/categories/parents/${a}/subcategories`,{headers:{Authorization:`Bearer ${o}`}})).data)==null?void 0:s.data)||[];N(f),console.log("✅ Subcategories Loaded:",f)}catch(o){console.error("❌ Failed to load subcategories:",o),N([])}};i.useEffect(()=>{if(!u){ee(!1);return}(async()=>{var a,s,o,c,f,w,A,E,r;try{const{data:n}=await C.get(`${v}/api/cakes/${y}`),l=n.data;if(ne(l.name),le(l.shortDescription),(s=(a=l.category)==null?void 0:a.parentCategory)!=null&&s._id){const h=l.category.parentCategory._id;z(h);const Ve=localStorage.getItem("token"),Ge=await C.get(`${v}/api/categories/parents/${h}/subcategories`,{headers:{Authorization:`Bearer ${Ve}`}});N(((o=Ge.data)==null?void 0:o.data)||[]),U([l.category._id])}else(c=l.category)!=null&&c._id&&z(l.category._id);de(l.itemType),ge(((f=l.nutrition)==null?void 0:f.join(", "))||""),pe(((w=l.allergenIngredients)==null?void 0:w.join(", "))||""),he(((A=l.searchTags)==null?void 0:A.join(", "))||""),ue(l.isActive),((E=l.variations)==null?void 0:E.length)>0&&B(l.variations.map(h=>({id:h._id||Date.now(),name:h.name,price:h.price}))),l.addons&&l.addons.length>0?I(l.addons.map(h=>({id:h._id||Date.now(),name:h.name,price:h.price}))):I([{id:Date.now(),name:"",price:"",isActive:!0}]),l.thumbnail&&Pe(l.thumbnail),((r=l.images)==null?void 0:r.length)>0&&be(l.images)}catch(n){console.error("Failed to load cake:",n),x("Failed to load cake details")}finally{ee(!1)}})()},[u,y]);const Be=()=>{B(t=>[...t,{id:Date.now(),name:"",price:""}])},$e=(t,a,s)=>{B(o=>o.map(c=>c.id===t?{...c,[a]:s}:c))},Fe=t=>{B(a=>a.filter(s=>s.id!==t))},We=t=>{const a=t.target.files[0];a&&xe(a)},Le=()=>{I(t=>[...t,{id:Date.now(),name:"",price:""}])},je=(t,a,s)=>{I(o=>o.map(c=>c.id===t?{...c,[a]:s}:c))},Re=t=>{I(a=>a.filter(s=>s.id!==t))},ze=t=>{const a=Array.from(t.target.files);if($.length+H.length+a.length>10){alert("Maximum 10 gallery images allowed");return}fe(o=>[...o,...a])},Ue=t=>fe(a=>a.filter((s,o)=>o!==t)),Oe=t=>be(a=>a.filter((s,o)=>o!==t)),Me=async()=>{var c,f,w,A,E;const t=(p==null?void 0:p._id)||(p==null?void 0:p.id);if(!t){x("Vendor not authenticated");return}if(!R.trim()){x("Cake name is required");return}if(!P){x("Select a category");return}if(!j&&!J){x("Thumbnail image is required");return}const a=new FormData;if(a.append("name",R),a.append("shortDescription",oe),a.append("module",ke),a.append("category",P),a.append("itemType",ce),a.append("isActive",G),a.append("provider",t),_.length>0&&a.append("subCategories",JSON.stringify(_)),O.trim()){const r=O.split(",").map(n=>n.trim()).filter(Boolean);a.append("nutrition",JSON.stringify(r))}if(M.trim()){const r=M.split(",").map(n=>n.trim()).filter(Boolean);a.append("allergenIngredients",JSON.stringify(r))}if(V.trim()){const r=V.split(",").map(n=>n.trim()).filter(Boolean);a.append("searchTags",JSON.stringify(r))}const s=Z.filter(r=>r.name&&r.price).map(({name:r,price:n})=>({name:r,price:Number(n)}));Array.isArray(s)&&s.length>0&&a.append("addons",JSON.stringify(s));const o=me.filter(r=>r.name&&r.price).map(({name:r,price:n})=>({name:r,price:Number(n)}));o.length>0&&a.append("variations",JSON.stringify(o)),j&&a.append("thumbnail",j),$.forEach(r=>{a.append("images",r)});try{ae(!0),x(""),L("");let r;if(u?(r=await C.put(`${v}/api/cakes/${y}`,a,{headers:{"Content-Type":"multipart/form-data"}}),L("Cake updated successfully!")):(r=await C.post(`${v}/api/cakes`,a,{headers:{"Content-Type":"multipart/form-data"}}),L("Cake created successfully!")),r.data.success&&r.data.data){const n=r.data.data;console.log("✅ Cake Package Created/Updated:",{id:n._id,name:n.name,cakeId:n.cakeId,category:(c=n.category)==null?void 0:c.title,provider:(f=n.provider)==null?void 0:f.storeName,thumbnail:n.thumbnail,priceInfo:n.priceInfo,variations:n.variations,module:(w=n.module)==null?void 0:w.title})}}catch(r){console.error("Submit error:",r),x(((E=(A=r.response)==null?void 0:A.data)==null?void 0:E.message)||"Error saving cake")}finally{ae(!1),window.scrollTo({top:0,behavior:"smooth"})}};return we||Te?e.jsx(d,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:e.jsx(ye,{size:60,sx:{color:g}})}):e.jsxs(d,{sx:{bgcolor:"#f9f9fc",minHeight:"100vh"},children:[e.jsxs(d,{sx:{bgcolor:"white",borderBottom:"1px solid #eee",p:2,px:4,position:"sticky",top:0,zIndex:10},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(S,{onClick:()=>D(-1),children:e.jsx(He,{})}),e.jsxs(b,{variant:"h5",fontWeight:"bold",children:[u?"Edit":"Add"," Cake Package"]})]}),p&&e.jsxs(b,{variant:"body2",color:"text.secondary",sx:{ml:7},children:["Creating as: ",p.firstName," ",p.lastName]})]}),e.jsxs(d,{sx:{p:{xs:2,md:4}},children:[se&&e.jsx(Ce,{severity:"success",sx:{mb:3},children:se}),re&&e.jsx(Ce,{severity:"error",sx:{mb:3},children:re}),e.jsxs(F,{elevation:3,sx:{borderRadius:3,p:{xs:3,md:6}},children:[e.jsx(m,{fullWidth:!0,label:"Cake Name *",value:R,onChange:t=>ne(t.target.value),sx:{mb:3}}),e.jsx(m,{fullWidth:!0,label:"Short Description *",multiline:!0,rows:2,value:oe,onChange:t=>le(t.target.value),sx:{mb:3}}),e.jsxs(k,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsxs(K,{fullWidth:!0,children:[e.jsx(q,{children:"Parent Category *"}),e.jsxs(Q,{value:P,onChange:_e,children:[e.jsx(T,{value:"",children:"Select Parent Category"}),Ae.map(t=>e.jsx(T,{value:t._id,children:t.title},t._id))]})]}),e.jsxs(K,{fullWidth:!0,disabled:!P,children:[e.jsx(q,{children:"Sub Categories"}),e.jsx(Q,{multiple:!0,value:_,onChange:t=>U(t.target.value),input:e.jsx(Xe,{}),renderValue:t=>e.jsx(d,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(a=>{const s=ie.find(o=>o._id===a);return e.jsx(Qe,{label:(s==null?void 0:s.title)||a,size:"small"},a)})}),children:ie.map(t=>e.jsxs(T,{value:t._id,children:[e.jsx(Ke,{checked:_.includes(t._id)}),e.jsx(qe,{primary:t.title})]},t._id))})]})]}),e.jsx(k,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3,alignItems:"center"},children:e.jsxs(K,{fullWidth:!0,children:[e.jsx(q,{children:"Item Type"}),e.jsxs(Q,{value:ce,onChange:t=>de(t.target.value),children:[e.jsx(T,{value:"Eggless",children:"Eggless"}),e.jsx(T,{value:"Egg",children:"Egg"})]})]})}),e.jsxs(k,{direction:{xs:"column",md:"row"},spacing:3,sx:{mb:3},children:[e.jsx(m,{fullWidth:!0,label:"Nutrition (comma separated)",placeholder:"e.g. Sugar, Milk, Flour",value:O,onChange:t=>ge(t.target.value)}),e.jsx(m,{fullWidth:!0,label:"Allergen Ingredients (comma separated)",placeholder:"e.g. Nuts, Gluten",value:M,onChange:t=>pe(t.target.value)})]}),e.jsxs(d,{sx:{mb:4},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(b,{variant:"h6",sx:{color:g},children:"Variations (Size/Weight)"}),e.jsx(X,{variant:"contained",startIcon:e.jsx(ve,{}),sx:{bgcolor:g,"&:hover":{bgcolor:"#c2185b"}},onClick:Be,children:"Add Variation"})]}),me.map(t=>e.jsx(et,{variation:t,onChange:(a,s)=>$e(t.id,a,s),onDelete:()=>Fe(t.id)},t.id))]}),e.jsxs(d,{sx:{mb:4},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(b,{variant:"h6",sx:{color:g},children:"Cake Add-ons"}),e.jsx(X,{variant:"outlined",startIcon:e.jsx(ve,{}),onClick:Le,sx:{borderColor:g,color:g},children:"Add Add-on"})]}),Z.map(t=>e.jsx(F,{sx:{p:2,mb:2,border:"1px solid #eee",borderRadius:2},children:e.jsxs(k,{direction:{xs:"column",md:"row"},spacing:2,alignItems:"center",children:[e.jsx(m,{label:"Add-on Name",placeholder:"e.g. Birthday Candles",value:t.name,onChange:a=>je(t.id,"name",a.target.value),fullWidth:!0}),e.jsx(m,{label:"Price (₹)",type:"number",value:t.price,onChange:a=>je(t.id,"price",a.target.value),sx:{width:160}}),e.jsx(S,{color:"error",onClick:()=>Re(t.id),children:e.jsx(Ie,{})})]})},t.id))]}),e.jsx(m,{fullWidth:!0,label:"Search Tags (comma separated)",placeholder:"e.g. chocolate, birthday, wedding",value:V,onChange:t=>he(t.target.value),sx:{mb:4}}),e.jsx(k,{direction:"row",spacing:4,sx:{mb:4},children:e.jsx(Ye,{control:e.jsx(Ze,{checked:G,onChange:()=>ue(!G),sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:g}}}),label:"Active"})}),e.jsx(b,{variant:"h6",sx:{color:g,mb:2},children:"Thumbnail Image *"}),e.jsxs(F,{onClick:()=>document.getElementById("thumbnail-input").click(),sx:{border:"2px dashed #ddd",borderRadius:2,p:4,textAlign:"center",cursor:"pointer",mb:4},children:[e.jsx("input",{id:"thumbnail-input",type:"file",hidden:!0,accept:"image/*",onChange:We}),j||J?e.jsxs(d,{sx:{position:"relative",display:"inline-block"},children:[e.jsx("img",{src:j?URL.createObjectURL(j):J,alt:"Thumbnail",style:{width:200,height:200,objectFit:"cover",borderRadius:8}}),j&&e.jsx(S,{onClick:t=>{t.stopPropagation(),xe(null)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(Y,{})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{sx:{fontSize:60,color:"#ccc"}}),e.jsx(b,{sx:{mt:2,color:g,fontWeight:"bold"},children:"Click to Upload Thumbnail"})]})]}),e.jsx(b,{variant:"h6",sx:{color:g,mb:2},children:"Gallery Images (Max 10)"}),e.jsxs(F,{onClick:()=>document.getElementById("gallery-input").click(),sx:{border:"2px dashed #ddd",borderRadius:2,p:4,textAlign:"center",cursor:"pointer",mb:4},children:[e.jsx("input",{id:"gallery-input",type:"file",hidden:!0,multiple:!0,accept:"image/*",onChange:ze}),$.length>0||H.length>0?e.jsxs(d,{sx:{display:"flex",flexWrap:"wrap",gap:2,justifyContent:"center"},children:[H.map((t,a)=>e.jsxs(d,{sx:{position:"relative"},children:[e.jsx("img",{src:t,alt:"",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(S,{onClick:s=>{s.stopPropagation(),Oe(a)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(Y,{fontSize:"small"})})]},`ex-${a}`)),$.map((t,a)=>e.jsxs(d,{sx:{position:"relative"},children:[e.jsx("img",{src:URL.createObjectURL(t),alt:"",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(S,{onClick:s=>{s.stopPropagation(),Ue(a)},sx:{position:"absolute",top:-8,right:-8,bgcolor:"white"},children:e.jsx(Y,{fontSize:"small"})})]},`new-${a}`))]}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{sx:{fontSize:60,color:"#ccc"}}),e.jsx(b,{sx:{mt:2,color:g,fontWeight:"bold"},children:"Click to Upload Gallery Images"})]})]}),e.jsx(X,{fullWidth:!0,variant:"contained",size:"large",onClick:Me,disabled:te||!p,sx:{py:2,bgcolor:g,"&:hover":{bgcolor:"#c2185b"}},children:te?e.jsx(ye,{size:28,color:"inherit"}):u?"Update Cake Package":"Create Cake Package"})]})]})]})};export{it as default};
