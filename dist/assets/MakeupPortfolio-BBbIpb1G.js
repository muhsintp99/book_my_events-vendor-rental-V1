import{r as a,g as be,j as e,B as h,s as Q,a6 as X,aj as ve,o as ye,M as Z,T as R,q as f,f as m,G as ee,b as te,a7 as Ce,ag as ke}from"./index-CE2Glvdc.js";import{T as Ie,a as se}from"./Tabs-DF2SgGd-.js";import{C as Se}from"./CloudUpload-BEdqEQ24.js";import{C as Te}from"./Close-CjSo4SJV.js";import{V as ae,L as we}from"./VideoLibrary-CPzkeZDu.js";import{T as Le}from"./TableContainer-ZsjqeuyX.js";import{T as Pe,a as De,b as E,c as r,d as Ue}from"./TableRow-BPfpVs8Y.js";import{D as Ae}from"./Delete-DvB3r7ya.js";const ie="https://api.bookmyevent.ae",C=be.create({baseURL:ie}),n="#e53935";function $e(){const k=JSON.parse(localStorage.getItem("user")||"{}"),d=k==null?void 0:k._id,x=localStorage.getItem("moduleId"),[c,g]=a.useState(!1),[oe,re]=a.useState(!0),[I,ne]=a.useState(0),[le,j]=a.useState(!1),[V,de]=a.useState([]),[b,S]=a.useState(""),[T,w]=a.useState(""),[ce,F]=a.useState([]),[L,W]=a.useState(""),[v,P]=a.useState([]),[_,B]=a.useState([]),[D,O]=a.useState([]),[U,$]=a.useState(""),[y,N]=a.useState({open:!1,message:"",severity:"success"});a.useEffect(()=>{(async()=>{var s,i;try{if(!d||!x){g(!1);return}((i=(s=(await C.get(`/api/subscription/status/${d}?moduleId=${x}`)).data)==null?void 0:s.subscription)==null?void 0:i.status)==="active"?g(!0):g(!1)}catch{g(!1)}finally{re(!1)}})()},[d,x]),a.useEffect(()=>{d&&A()},[d]);const A=async()=>{try{j(!0);const t=await C.get(`/api/portfolio/provider/${d}`);de(t.data.data||[])}catch{l("Failed to load portfolio","error")}finally{j(!1)}},l=(t,s="success")=>N({open:!0,message:t,severity:s}),ue=t=>{t.key==="Enter"&&L.trim()&&(t.preventDefault(),F(s=>[...s,L.trim()]),W(""))},pe=t=>{const s=Array.from(t.target.files);P(i=>i.concat(s.map(o=>({file:o,preview:URL.createObjectURL(o)}))))},fe=t=>{URL.revokeObjectURL(v[t].preview),P(s=>s.filter((i,o)=>o!==t))},xe=t=>{const s=Array.from(t.target.files);B(i=>i.concat(s.map(o=>({file:o,preview:URL.createObjectURL(o)}))))},he=()=>{U.trim()&&(O(t=>[...t,U.trim()]),$(""))},H=async t=>{var i,o;if(!c)return l("Upgrade to Premium to add portfolio","warning");if(!b.trim())return l("Title is required","warning");if(!t&&v.length===0)return l("Add at least one image","warning");if(t&&_.length===0&&D.length===0)return l("Add video file or link","warning");if(!x)return l("Module missing. Re-login.","error");const s=new FormData;s.append("providerId",d),s.append("module",x),s.append("workTitle",b),s.append("description",T),s.append("tags",JSON.stringify(ce)),t?(_.forEach(u=>s.append("videos",u.file)),D.length>0&&s.append("videoLinks",JSON.stringify(D))):v.forEach(u=>s.append("images",u.file));try{j(!0),await C.post("/api/portfolio",s),l("Portfolio added"),me(),A()}catch(u){l(((o=(i=u.response)==null?void 0:i.data)==null?void 0:o.message)||"Upload failed","error")}finally{j(!1)}},me=()=>{S(""),w(""),F([]),P([]),B([]),O([])},ge=async t=>{if(window.confirm("Delete portfolio?"))try{await C.delete(`/api/portfolio/${t}`),A(),l("Deleted")}catch{l("Delete failed","error")}};return oe?e.jsx(h,{sx:{minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(Q,{sx:{color:n}})}):e.jsxs(h,{sx:{p:3},children:[le&&e.jsx(h,{sx:{position:"fixed",inset:0,bgcolor:"rgba(0,0,0,.4)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Q,{sx:{color:n}})}),!c&&e.jsx(X,{severity:"warning",sx:{mb:2},children:"You are on a FREE plan. Upgrade to add portfolio."}),e.jsx(ve,{open:y.open,autoHideDuration:4e3,onClose:()=>N({...y,open:!1}),children:e.jsx(X,{severity:y.severity,children:y.message})}),e.jsxs(ye,{children:[e.jsxs(Ie,{value:I,onChange:(t,s)=>ne(s),TabIndicatorProps:{style:{backgroundColor:n}},children:[e.jsx(se,{label:"Images"}),e.jsx(se,{label:"Videos"})]}),I===0&&e.jsxs(Z,{children:[e.jsx(R,{variant:"h6",sx:{color:n},children:"Add Portfolio Images"}),e.jsx(f,{fullWidth:!0,label:"Title",value:b,onChange:t=>S(t.target.value),sx:{mb:2}}),e.jsx(f,{fullWidth:!0,multiline:!0,rows:3,label:"Description",value:T,onChange:t=>w(t.target.value),sx:{mb:2}}),e.jsx(f,{fullWidth:!0,label:"Add Tag (Enter)",value:L,onKeyDown:ue,onChange:t=>W(t.target.value),sx:{mb:2}}),e.jsxs(m,{component:"label",variant:"contained",sx:{bgcolor:n},disabled:!c,children:[e.jsx(Se,{sx:{mr:1}})," Upload Images",e.jsx("input",{hidden:!0,multiple:!0,type:"file",accept:"image/*",onChange:pe})]}),e.jsx(ee,{container:!0,spacing:2,sx:{mt:2},children:v.map((t,s)=>e.jsx(ee,{item:!0,xs:6,md:3,children:e.jsxs(h,{sx:{position:"relative"},children:[e.jsx("img",{src:t.preview,alt:"",style:{width:"100%",height:120,objectFit:"cover"}}),e.jsx(te,{onClick:()=>fe(s),sx:{position:"absolute",top:4,right:4,bgcolor:n,color:"#fff"},children:e.jsx(Te,{})})]})},s))}),e.jsx(m,{fullWidth:!0,sx:{mt:3,bgcolor:n},variant:"contained",disabled:!c,onClick:()=>H(!1),children:"Add Portfolio"})]}),I===1&&e.jsxs(Z,{children:[e.jsx(R,{variant:"h6",sx:{color:n},children:"Add Portfolio Videos"}),e.jsx(f,{fullWidth:!0,label:"Title",value:b,onChange:t=>S(t.target.value),sx:{mb:2}}),e.jsx(f,{fullWidth:!0,multiline:!0,rows:3,label:"Description",value:T,onChange:t=>w(t.target.value),sx:{mb:2}}),e.jsxs(m,{component:"label",variant:"contained",sx:{bgcolor:n,mb:2},disabled:!c,children:[e.jsx(ae,{sx:{mr:1}})," Upload Videos",e.jsx("input",{hidden:!0,multiple:!0,type:"file",accept:"video/*",onChange:xe})]}),e.jsxs(h,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(f,{fullWidth:!0,label:"Video Link",value:U,onChange:t=>$(t.target.value)}),e.jsx(m,{variant:"contained",sx:{bgcolor:n},onClick:he,disabled:!c,children:e.jsx(we,{})})]}),e.jsx(m,{fullWidth:!0,sx:{bgcolor:n},variant:"contained",disabled:!c,onClick:()=>H(!0),children:"Add Video"})]})]}),e.jsx(R,{sx:{mt:4,mb:1,color:n},variant:"h6",children:"Portfolio List"}),e.jsx(Le,{component:Ce,children:e.jsxs(Pe,{children:[e.jsx(De,{sx:{bgcolor:"#fdeaea"},children:e.jsxs(E,{children:[e.jsx(r,{children:"SI"}),e.jsx(r,{children:"Title"}),e.jsx(r,{children:"Preview"}),e.jsx(r,{children:"Count"}),e.jsx(r,{children:"Tags"}),e.jsx(r,{children:"Actions"})]})}),e.jsx(Ue,{children:V.length===0?e.jsx(E,{children:e.jsx(r,{colSpan:6,align:"center",children:"No portfolio found"})}):V.map((t,s)=>{var J,M,q,z,G,K,Y;const i=((M=(J=t.media)==null?void 0:J.find(p=>p.type==="image"))==null?void 0:M.images)||[],o=((z=(q=t.media)==null?void 0:q.find(p=>p.type==="video"))==null?void 0:z.videos)||[],u=((K=(G=t.media)==null?void 0:G.find(p=>p.type==="videoLink"))==null?void 0:K.videoLinks)||[];return e.jsxs(E,{children:[e.jsx(r,{children:s+1}),e.jsx(r,{children:t.workTitle}),e.jsx(r,{children:i[0]?e.jsx("img",{src:`${ie}${i[0]}`,style:{width:60,height:50,objectFit:"cover"}}):e.jsx(ae,{color:"action"})}),e.jsx(r,{children:i.length+o.length+u.length}),e.jsx(r,{children:(Y=t.tags)==null?void 0:Y.map((p,je)=>e.jsx(ke,{size:"small",label:p,sx:{mr:.5}},je))}),e.jsx(r,{children:e.jsx(te,{color:"error",onClick:()=>ge(t._id),children:e.jsx(Ae,{})})})]},t._id)})})]})})]})}export{$e as default};
