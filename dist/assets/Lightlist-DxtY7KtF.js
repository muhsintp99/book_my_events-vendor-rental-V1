import{a as J,r,j as e,B as n,a7 as K,S as b,T as a,h as c,o as I,K as $,t as Q,b as X,v as Z,bh as B,G as h,V as ee,d as A,aq as se,af as te,ac as ae,ah as E,as as R,ai as _,D as re,aj as z,ak as ie}from"./index-CYOhujfk.js";import{A as ne}from"./Add-B94w46PM.js";import{S as oe}from"./Search-Cy2wkmMw.js";import{C as ce}from"./CardMedia-BL7zTQ78.js";import{C as le}from"./Close-pqYWaVkC.js";const P="https://api.bookmyevent.ae/api/mehandi";function ge(){const u=J(),[p,y]=r.useState([]),[F,v]=r.useState(!0),[g,o]=r.useState({open:!1,message:"",severity:"success"}),[j,V]=r.useState(""),[H,m]=r.useState(!1),[O,f]=r.useState(!1),[t,Y]=r.useState(null),[D,L]=r.useState(null),l=localStorage.getItem("token"),k=JSON.parse(localStorage.getItem("user")||"{}"),C=k==null?void 0:k._id,N=s=>s?`https://api.bookmyevent.ae/${s.startsWith("/")?s.slice(1):s}`:null,w=s=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(s||0),T=r.useCallback(async()=>{if(!C||!l){o({open:!0,message:"Please login again",severity:"error"}),v(!1);return}v(!0);try{const s=await fetch(`${P}/vendor/${C}`,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}});if(!s.ok)throw new Error("Failed to load packages");const i=await s.json();i.success&&y(i.data||[])}catch(s){o({open:!0,message:s.message,severity:"error"})}finally{v(!1)}},[C,l]);r.useEffect(()=>{T()},[T]);const q=s=>{Y(s),m(!0)},G=async(s,i)=>{try{(await(await fetch(`${P}/${s}/toggle-active`,{method:"PATCH",headers:{Authorization:`Bearer ${l}`}})).json()).success&&(y(U=>U.map(S=>S._id===s?{...S,isActive:!i}:S)),o({open:!0,message:"Status updated",severity:"success"}))}catch{o({open:!0,message:"Failed to update status",severity:"error"})}},M=async()=>{try{(await(await fetch(`${P}/${D}`,{method:"DELETE",headers:{Authorization:`Bearer ${l}`}})).json()).success&&(y(d=>d.filter(x=>x._id!==D)),o({open:!0,message:"Package deleted",severity:"success"}))}catch{o({open:!0,message:"Delete failed",severity:"error"})}finally{f(!1),L(null)}},W=r.useMemo(()=>p.filter(s=>{var d,x;if(!j)return!0;const i=j.toLowerCase();return((d=s.packageName)==null?void 0:d.toLowerCase().includes(i))||((x=s.description)==null?void 0:x.toLowerCase().includes(i))}),[p,j]);return e.jsxs(n,{sx:{bgcolor:"#f5f7fa",minHeight:"100vh",pb:4},children:[e.jsx(n,{sx:{background:"linear-gradient(135deg, #673ab7 0%, #4527a0 100%)",color:"white",py:4,px:3,borderRadius:"0 0 24px 24px",boxShadow:"0 4px 20px rgba(103, 58, 183, 0.3)"},children:e.jsx(K,{maxWidth:"xl",children:e.jsxs(b,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(n,{children:[e.jsx(a,{variant:"h4",sx:{fontWeight:700,mb:.5},children:"Light & Sound Packages"}),e.jsxs(a,{variant:"body2",sx:{opacity:.9},children:[p.length," total packages â€¢ ",p.filter(s=>s.isActive).length," active"]})]}),e.jsx(c,{variant:"contained",size:"large",startIcon:e.jsx(ne,{}),onClick:()=>u("/light/addpackage"),sx:{bgcolor:"white",color:"#673ab7",fontWeight:600,px:3,"&:hover":{bgcolor:"#f5f5f5",transform:"translateY(-2px)"},transition:"all 0.3s",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:"Add New Package"})]})})}),e.jsxs(n,{sx:{width:"100%",px:2,mt:4},children:[e.jsx(I,{sx:{mb:3,borderRadius:3,boxShadow:"0 2px 12px rgba(0,0,0,0.08)"},children:e.jsx($,{children:e.jsx(Q,{fullWidth:!0,placeholder:"Search by package name or description...",value:j,onChange:s=>V(s.target.value),InputProps:{startAdornment:e.jsx(X,{position:"start",children:e.jsx(oe,{sx:{color:"#673ab7",fontSize:28}})}),sx:{borderRadius:2}}})})}),F?e.jsx(n,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(Z,{size:60,sx:{color:"#673ab7"}})}):W.length===0?e.jsxs(I,{sx:{textAlign:"center",py:8},children:[e.jsx(B,{sx:{fontSize:80,color:"#ddd",mb:2}}),e.jsx(a,{variant:"h5",color:"text.secondary",children:"No packages found"}),e.jsx(c,{variant:"contained",sx:{mt:3,bgcolor:"#673ab7"},onClick:()=>u("/light/addpackage"),children:"Create Your First Package"})]}):e.jsx(h,{container:!0,spacing:3,children:W.map(s=>e.jsx(h,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsxs(I,{sx:{height:"100%",borderRadius:3,transition:"0.3s","&:hover":{transform:"translateY(-8px)"}},children:[e.jsx(n,{sx:{position:"relative",pt:"75%",bgcolor:"#f5f5f5"},children:s.image?e.jsx(ce,{component:"img",image:N(s.image),alt:s.packageName,sx:{position:"absolute",top:0,width:"100%",height:"100%",objectFit:"cover"}}):e.jsx(n,{sx:{position:"absolute",top:0,width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(B,{sx:{fontSize:60,color:"#ccc"}})})}),e.jsxs($,{sx:{p:2.5},children:[e.jsx(a,{variant:"h6",sx:{fontWeight:700,mb:1},noWrap:!0,children:s.packageName}),e.jsx(a,{variant:"h5",sx:{fontWeight:700,color:"#673ab7",mb:2},children:w(s.packagePrice)}),e.jsxs(b,{direction:"row",spacing:1,children:[e.jsx(c,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(ee,{}),onClick:()=>q(s),children:"View"}),e.jsx(A,{color:"primary",onClick:()=>u(`/light/edit/${s._id}`),children:e.jsx(se,{})}),e.jsx(A,{color:"error",onClick:()=>{L(s._id),f(!0)},children:e.jsx(te,{})})]}),e.jsxs(n,{sx:{mt:2,pt:2,borderTop:"1px solid #f0f0f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(a,{variant:"body2",fontWeight:500,children:"Status"}),e.jsx(ae,{checked:s.isActive,onChange:()=>G(s._id,s.isActive)})]})]})]})},s._id))})]}),e.jsxs(E,{open:H,onClose:()=>m(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(R,{sx:{bgcolor:"#673ab7",color:"white"},children:e.jsxs(b,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(a,{variant:"h6",children:t==null?void 0:t.packageName}),e.jsx(A,{onClick:()=>m(!1),sx:{color:"white"},children:e.jsx(le,{})})]})}),e.jsx(_,{dividers:!0,children:t&&e.jsxs(h,{container:!0,spacing:3,children:[e.jsx(h,{item:!0,xs:12,md:5,children:t.image&&e.jsx("img",{src:N(t.image),alt:t.packageName,style:{width:"100%",borderRadius:"12px"}})}),e.jsxs(h,{item:!0,xs:12,md:7,children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Description"}),e.jsx(a,{variant:"body1",color:"text.secondary",paragraph:!0,children:t.description}),e.jsx(re,{sx:{my:2}}),e.jsxs(b,{spacing:1,children:[e.jsx(a,{variant:"h6",children:"Pricing"}),e.jsxs(a,{variant:"body1",children:["Full Price: ",e.jsx("b",{children:w(t.packagePrice)})]}),e.jsxs(a,{variant:"body1",children:["Advance: ",e.jsx("b",{children:w(t.advanceBookingAmount)})]})]})]})]})}),e.jsxs(z,{sx:{p:2},children:[e.jsx(c,{onClick:()=>m(!1),children:"Close"}),e.jsx(c,{variant:"contained",sx:{bgcolor:"#673ab7"},onClick:()=>u(`/light/edit/${t==null?void 0:t._id}`),children:"Edit Package"})]})]}),e.jsxs(E,{open:O,onClose:()=>f(!1),children:[e.jsx(R,{children:"Delete Package?"}),e.jsx(_,{children:"This action cannot be undone."}),e.jsxs(z,{children:[e.jsx(c,{onClick:()=>f(!1),children:"Cancel"}),e.jsx(c,{color:"error",variant:"contained",onClick:M,children:"Delete"})]})]}),e.jsx(ie,{open:g.open,autoHideDuration:6e3,onClose:()=>o({...g,open:!1}),children:e.jsx(a,{sx:{bgcolor:g.severity==="success"?"success.main":"error.main",color:"white",p:2,borderRadius:1},children:g.message})})]})}export{ge as default};
