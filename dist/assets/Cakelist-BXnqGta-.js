import{c as Fe,j as e,r as o,B as m,an as Re,ao as Ve,T as r,g,a9 as ye,S as j,s as He,a as Me,F as Ue,ad as Ge,X as be,t as Oe,a5 as y,aj as Qe,ba as _,b as E,V as Ye,ap as qe,aa as Ce,ab as ke,ac as Ie,p as Se,q as F,G as p,b9 as Je,D as A,ae as we,am as Xe,x as Ke}from"./index-BAGMfAhD.js";import{A as Ze}from"./Add-BuQCDwlT.js";import{S as es}from"./Search-C31FRy8o.js";import{R as ss,D as ts}from"./Refresh-BsDjNDT4.js";import{T as as}from"./TableContainer-DXk1VB7t.js";import{T as rs,a as T,b as n,c as is}from"./TableRow-Bm8fXQl0.js";import{T as ns}from"./TableHead-BeCaNvqA.js";import{E as os}from"./Edit-tRyC-05P.js";import{C as ls}from"./Close-D-pJi_r3.js";import{C as cs}from"./CardMedia-C7FiNnLb.js";import{I as ds}from"./Image-DDSZGP9a.js";import{C as xs}from"./Category-C_ct6WQK.js";import{L as Ee}from"./Label-7-rUqGZc.js";import{R as hs}from"./Restaurant-Di7FbpNs.js";import{S as ms}from"./Schedule-CHdKoEqv.js";import{C as ps}from"./CheckCircle-CUI9eUBJ.js";import{I as us}from"./Info-BVu69DHu.js";import{A as Ae}from"./AttachMoney-CFuulJb_.js";import{L as gs}from"./LocalOffer-BuH5YsvY.js";import{D as js}from"./DialogContentText-DSy3q8Vn.js";import{S as fs}from"./Skeleton-lbOrbvUK.js";const vs=Fe(e.jsx("path",{d:"m23 12-2.44-2.79.34-3.69-3.61-.82-1.89-3.2L12 2.96 8.6 1.5 6.71 4.69 3.1 5.5l.34 3.7L1 12l2.44 2.79-.34 3.7 3.61.82L8.6 22.5l3.4-1.47 3.4 1.46 1.89-3.19 3.61-.82-.34-3.69zm-12.91 4.72-3.8-3.81 1.48-1.48 2.32 2.33 5.85-5.87 1.48 1.48z"})),R="https://api.bookmyevent.ae/api/cakes";function Vs(){var O,Q,Y,q,J,X,K,Z,ee,se,te,ae,re,ie,ne,oe,le,ce,de,xe,he,me,pe,ue;const[f,P]=o.useState([]),[V,D]=o.useState(!0),[C,u]=o.useState({open:!1,message:"",severity:"success"}),[v,H]=o.useState({search:"",category:""}),[W,Te]=o.useState(""),[Pe,k]=o.useState(!1),[De,I]=o.useState(!1),[t,We]=o.useState(null),[M,U]=o.useState(null),[S,G]=o.useState(0),b=localStorage.getItem("token"),L=JSON.parse(localStorage.getItem("vendor")||localStorage.getItem("user")||"{}"),z=L==null?void 0:L._id,N=s=>s?s.startsWith("http")?s:`https://api.bookmyevent.ae/${s.startsWith("/")?s.slice(1):s}`:null,Le=({src:s,alt:a,title:i})=>{var w;const[c,d]=o.useState(!1),[l,h]=o.useState(!0);return!s||c?e.jsx(F,{variant:"rounded",sx:{width:70,height:70,bgcolor:"#E91E63",fontSize:"1.8rem",fontWeight:"bold",color:"white"},children:((w=i==null?void 0:i[0])==null?void 0:w.toUpperCase())||"C"}):e.jsxs(m,{sx:{position:"relative"},children:[l&&e.jsx(fs,{variant:"rectangular",width:70,height:70,sx:{borderRadius:2}}),e.jsx(F,{variant:"rounded",src:s,alt:a,sx:{width:70,height:70,borderRadius:2,display:l?"none":"block"},imgProps:{onLoad:()=>h(!1),onError:()=>{d(!0),h(!1)}}})]})},B=o.useCallback(async()=>{if(!z||!b){u({open:!0,message:"Please login again",severity:"error"}),D(!1);return}D(!0);try{const s=await fetch(`${R}/provider/${z}`,{headers:{Authorization:`Bearer ${b}`,"Content-Type":"application/json"}});if(!s.ok)throw new Error("Failed to load cake packages");const a=await s.json();a.success&&P(a.data||[])}catch(s){u({open:!0,message:s.message,severity:"error"})}finally{D(!1)}},[z,b]);o.useEffect(()=>{B()},[B]),o.useEffect(()=>{const s=setTimeout(()=>H(a=>({...a,search:W})),400);return()=>clearTimeout(s)},[W]);const ze=s=>{We(s),G(0),k(!0)},Ne=async(s,a)=>{try{(await(await fetch(`${R}/${s}/toggle-active`,{method:"PATCH",headers:{Authorization:`Bearer ${b}`}})).json()).success&&(P(d=>d.map(l=>l._id===s?{...l,isActive:!a}:l)),u({open:!0,message:"Status updated",severity:"success"}))}catch{u({open:!0,message:"Failed to update status",severity:"error"})}},Be=async()=>{try{(await(await fetch(`${R}/${M}`,{method:"DELETE",headers:{Authorization:`Bearer ${b}`}})).json()).success&&(P(i=>i.filter(c=>c._id!==M)),u({open:!0,message:"Cake package deleted",severity:"success"}))}catch{u({open:!0,message:"Delete failed",severity:"error"})}finally{I(!1),U(null)}},$=o.useMemo(()=>f.filter(s=>{var c,d;const a=!v.search||((c=s.name)==null?void 0:c.toLowerCase().includes(v.search.toLowerCase())),i=!v.category||((d=s.category)==null?void 0:d._id)===v.category;return a&&i}),[f,v]),$e=o.useMemo(()=>{const s=new Map;return f.forEach(a=>{a.category&&s.set(a.category._id,a.category)}),Array.from(s.values())},[f]),_e=()=>{const s=["No","Name","Category","Type","Unit Price","Final Price","Status"],a=$.map((h,w)=>{var ge,je,fe,ve;return[w+1,h.name||"",((ge=h.category)==null?void 0:ge.title)||"",h.itemType||"",((je=h.priceInfo)==null?void 0:je.unitPrice)||0,((fe=h.priceInfo)==null?void 0:fe.unitPrice)-(((ve=h.priceInfo)==null?void 0:ve.discount)||0)||0,h.isActive?"Active":"Inactive"]}),i=[s.join(","),...a.map(h=>h.join(","))].join(`
`),c=new Blob([i],{type:"text/csv"}),d=URL.createObjectURL(c),l=document.createElement("a");l.href=d,l.download=`cake_packages_${new Date().toISOString().slice(0,10)}.csv`,l.click()},x=({icon:s,label:a,value:i,chip:c,success:d,error:l})=>e.jsxs(m,{sx:{display:"flex",alignItems:"flex-start",gap:2,py:1.5,borderBottom:"1px solid #f0f0f0"},children:[e.jsx(m,{sx:{color:"#E91E63",mt:.5},children:s}),e.jsxs(m,{sx:{flex:1},children:[e.jsx(r,{variant:"caption",color:"text.secondary",sx:{fontWeight:500},children:a}),c?e.jsx(y,{label:i,size:"small",color:d?"success":l?"error":"default",sx:{mt:.5}}):e.jsx(r,{variant:"body2",sx:{fontWeight:500,mt:.3},children:i||"Not specified"})]})]});return e.jsxs(m,{sx:{bgcolor:"#fafafa",minHeight:"100vh",p:3},children:[e.jsx(Re,{position:"static",color:"transparent",elevation:0,children:e.jsxs(Ve,{children:[e.jsxs(r,{variant:"h5",sx:{flexGrow:1,fontWeight:600},children:["My Cake Packages (",f.length,")"]}),e.jsx(g,{variant:"contained",startIcon:e.jsx(Ze,{}),sx:{bgcolor:"#E91E63","&:hover":{bgcolor:"#c2185b"}},onClick:()=>window.location.href="/cake/addpackage",children:"Add New Package"})]})}),e.jsx(ye,{sx:{p:2,mt:3},children:e.jsxs(j,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"center",children:[e.jsx(He,{size:"small",placeholder:"Search cake packages...",value:W,onChange:s=>Te(s.target.value),InputProps:{startAdornment:e.jsx(Me,{position:"start",children:e.jsx(es,{})})},sx:{width:{xs:"100%",sm:300}}}),e.jsx(Ue,{size:"small",sx:{minWidth:180},children:e.jsxs(Ge,{value:v.category,onChange:s=>H(a=>({...a,category:s.target.value})),displayEmpty:!0,children:[e.jsx(be,{value:"",children:"All Categories"}),$e.map(s=>e.jsx(be,{value:s._id,children:s.title},s._id))]})}),e.jsxs(m,{sx:{ml:"auto",gap:1,display:"flex"},children:[e.jsx(g,{variant:"outlined",startIcon:e.jsx(ss,{}),onClick:B,children:"Refresh"}),e.jsx(g,{variant:"outlined",startIcon:e.jsx(ts,{}),onClick:_e,children:"Export CSV"})]})]})}),e.jsx(ye,{sx:{mt:3},children:e.jsx(as,{sx:{maxHeight:"70vh"},children:e.jsxs(rs,{stickyHeader:!0,children:[e.jsx(ns,{children:e.jsxs(T,{sx:{bgcolor:"#f8f9fa"},children:[e.jsx(n,{children:"#"}),e.jsx(n,{children:"Image"}),e.jsx(n,{children:"Cake Name"}),e.jsx(n,{children:"Category"}),e.jsx(n,{children:"Type"}),e.jsx(n,{align:"right",children:"Price"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Actions"})]})}),e.jsxs(is,{children:[V&&e.jsx(T,{children:e.jsx(n,{colSpan:8,align:"center",children:e.jsx(Oe,{})})}),!V&&$.length===0&&e.jsx(T,{children:e.jsxs(n,{colSpan:8,align:"center",sx:{py:8},children:[e.jsx(r,{variant:"h6",color:"text.secondary",children:f.length===0?"No cake packages created yet":"No packages match your search"}),e.jsx(g,{variant:"contained",sx:{mt:2,bgcolor:"#E91E63"},onClick:()=>window.location.href="/cake/addpackage",children:"Create Your First Cake Package"})]})}),$.map((s,a)=>{var i,c,d,l;return e.jsxs(T,{hover:!0,children:[e.jsx(n,{children:a+1}),e.jsx(n,{children:e.jsx(Le,{src:N(s.thumbnail),alt:s.name,title:s.name})}),e.jsx(n,{children:e.jsx(r,{fontWeight:"medium",children:s.name})}),e.jsx(n,{children:e.jsx(y,{label:((i=s.category)==null?void 0:i.title)||"N/A",size:"small",color:"primary",variant:"outlined"})}),e.jsx(n,{children:e.jsx(y,{label:s.itemType||"N/A",size:"small",color:s.itemType==="Veg"?"success":"error"})}),e.jsxs(n,{align:"right",children:[e.jsxs(r,{fontWeight:"bold",color:"primary",children:["₹",(d=(c=s.priceInfo)==null?void 0:c.unitPrice)==null?void 0:d.toLocaleString()]}),((l=s.priceInfo)==null?void 0:l.discount)>0&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Discount: ₹",s.priceInfo.discount]})]}),e.jsx(n,{children:e.jsx(Qe,{checked:s.isActive,onChange:()=>Ne(s._id,s.isActive),color:"success"})}),e.jsx(n,{children:e.jsxs(j,{direction:"row",spacing:.5,children:[e.jsx(_,{title:"View Details",children:e.jsx(E,{size:"small",onClick:()=>ze(s),children:e.jsx(Ye,{fontSize:"small"})})}),e.jsx(_,{title:"Edit Package",children:e.jsx(E,{size:"small",color:"primary",onClick:()=>{window.location.href=`/cake/addpackage?id=${s._id}`},children:e.jsx(os,{fontSize:"small"})})}),e.jsx(_,{title:"Delete",children:e.jsx(E,{size:"small",color:"error",onClick:()=>{U(s._id),I(!0)},children:e.jsx(qe,{fontSize:"small"})})})]})})]},s._id)})]})]})})}),e.jsxs(Ce,{open:Pe,onClose:()=>k(!1),maxWidth:"md",fullWidth:!0,scroll:"paper",children:[e.jsxs(ke,{sx:{bgcolor:"#E91E63",color:"white",pr:6},children:[e.jsx(r,{variant:"h6",children:t==null?void 0:t.name}),e.jsxs(r,{variant:"caption",sx:{opacity:.9},children:["ID: ",t==null?void 0:t.cakeId]}),e.jsx(E,{sx:{position:"absolute",right:8,top:8,color:"white"},onClick:()=>k(!1),children:e.jsx(ls,{})})]}),e.jsx(Ie,{dividers:!0,sx:{p:0},children:t&&e.jsxs(m,{children:[e.jsxs(m,{sx:{bgcolor:"#1a1a1a",p:2},children:[e.jsx(m,{sx:{display:"flex",justifyContent:"center",mb:2},children:(O=t.images)!=null&&O[S]||t.thumbnail?e.jsx(Se,{elevation:3,sx:{maxWidth:500},children:e.jsx(cs,{component:"img",height:"300",image:N(((Q=t.images)==null?void 0:Q[S])||t.thumbnail),alt:t.name,sx:{objectFit:"cover"}})}):e.jsx(m,{sx:{height:300,width:"100%",maxWidth:500,bgcolor:"#333",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:2},children:e.jsx(ds,{sx:{fontSize:80,color:"#666"}})})}),((Y=t.images)==null?void 0:Y.length)>1&&e.jsx(m,{sx:{display:"flex",gap:1,justifyContent:"center",flexWrap:"wrap"},children:t.images.map((s,a)=>e.jsx(F,{variant:"rounded",src:N(s),onClick:()=>G(a),sx:{width:60,height:60,cursor:"pointer",border:S===a?"3px solid #E91E63":"3px solid transparent",opacity:S===a?1:.7,"&:hover":{opacity:1}}},a))})]}),e.jsx(m,{sx:{p:3},children:e.jsxs(p,{container:!0,spacing:3,children:[e.jsxs(p,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"subtitle1",sx:{fontWeight:600,mb:2,color:"#E91E63"},children:"Basic Information"}),e.jsx(x,{icon:e.jsx(xs,{}),label:"Category",value:((q=t.category)==null?void 0:q.title)||"None"}),e.jsx(x,{icon:e.jsx(Ee,{}),label:"Sub Categories",value:((J=t.subCategories)==null?void 0:J.map(s=>s.title).join(", "))||"None"}),e.jsx(x,{icon:e.jsx(hs,{}),label:"Item Type",value:t.itemType,chip:!0,success:t.itemType==="Veg",error:t.itemType==="Non-Veg"}),e.jsx(x,{icon:e.jsx(vs,{}),label:"Halal Certified",value:t.isHalal?"Yes":"No",chip:!0,success:t.isHalal}),e.jsx(x,{icon:e.jsx(ms,{}),label:"Available Time",value:`${((X=t.timeSchedule)==null?void 0:X.startTime)||"N/A"} - ${((K=t.timeSchedule)==null?void 0:K.endTime)||"N/A"}`}),e.jsx(x,{icon:e.jsx(ps,{}),label:"Status",value:t.isActive?"Active":"Inactive",chip:!0,success:t.isActive,error:!t.isActive}),e.jsx(x,{icon:e.jsx(us,{}),label:"Description",value:t.shortDescription})]}),e.jsxs(p,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"subtitle1",sx:{fontWeight:600,mb:2,color:"#E91E63"},children:"Pricing Information"}),e.jsx(x,{icon:e.jsx(Ae,{}),label:"Unit Price",value:`₹${(ee=(Z=t.priceInfo)==null?void 0:Z.unitPrice)==null?void 0:ee.toLocaleString()}`}),e.jsx(x,{icon:e.jsx(gs,{}),label:"Discount",value:(se=t.priceInfo)!=null&&se.discount?`₹${(ae=(te=t.priceInfo)==null?void 0:te.discount)==null?void 0:ae.toLocaleString()} (${(re=t.priceInfo)==null?void 0:re.discountType})`:"No discount"}),e.jsx(x,{icon:e.jsx(Ae,{}),label:"Final Price",value:e.jsxs(r,{sx:{color:"#E91E63",fontWeight:"bold"},children:["₹",(((ie=t.priceInfo)==null?void 0:ie.unitPrice)-(((ne=t.priceInfo)==null?void 0:ne.discount)||0)).toLocaleString()]})}),e.jsx(x,{icon:e.jsx(Je,{}),label:"Advance Booking Amount",value:(oe=t.priceInfo)!=null&&oe.advanceBookingAmount?`₹${(le=t.priceInfo)==null?void 0:le.advanceBookingAmount}`:"Not specified"}),e.jsx(x,{icon:e.jsx(Ee,{}),label:"Max Purchase Qty",value:((ce=t.priceInfo)==null?void 0:ce.maxPurchaseQty)||"No limit"})]}),((de=t.variations)==null?void 0:de.length)>0&&e.jsxs(p,{item:!0,xs:12,children:[e.jsx(A,{sx:{my:2}}),e.jsx(r,{variant:"subtitle1",sx:{fontWeight:600,mb:2,color:"#E91E63"},children:"Available Variations"}),e.jsx(j,{direction:"row",spacing:2,flexWrap:"wrap",useFlexGap:!0,children:t.variations.map((s,a)=>{var i;return e.jsxs(Se,{variant:"outlined",sx:{p:2,minWidth:150},children:[e.jsx(r,{variant:"body2",fontWeight:"bold",children:s.name}),e.jsxs(r,{variant:"h6",color:"primary",children:["₹",(i=s.price)==null?void 0:i.toLocaleString()]})]},a)})})]}),(((xe=t.nutrition)==null?void 0:xe.length)>0||((he=t.allergenIngredients)==null?void 0:he.length)>0)&&e.jsxs(p,{item:!0,xs:12,children:[e.jsx(A,{sx:{my:2}}),e.jsx(r,{variant:"subtitle1",sx:{fontWeight:600,mb:2,color:"#E91E63"},children:"Nutritional Information"}),e.jsxs(p,{container:!0,spacing:2,children:[((me=t.nutrition)==null?void 0:me.length)>0&&e.jsxs(p,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"body2",fontWeight:"bold",gutterBottom:!0,children:"Nutrition:"}),e.jsx(j,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:t.nutrition.map((s,a)=>e.jsx(y,{label:s,size:"small",color:"success",variant:"outlined"},a))})]}),((pe=t.allergenIngredients)==null?void 0:pe.length)>0&&e.jsxs(p,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"body2",fontWeight:"bold",gutterBottom:!0,children:"Allergens:"}),e.jsx(j,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:t.allergenIngredients.map((s,a)=>e.jsx(y,{label:s,size:"small",color:"error",variant:"outlined"},a))})]})]})]}),((ue=t.searchTags)==null?void 0:ue.length)>0&&e.jsxs(p,{item:!0,xs:12,children:[e.jsx(A,{sx:{my:2}}),e.jsx(r,{variant:"subtitle1",sx:{fontWeight:600,mb:2,color:"#E91E63"},children:"Search Tags"}),e.jsx(j,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:t.searchTags.map((s,a)=>e.jsx(y,{label:s,size:"small"},a))})]}),e.jsxs(p,{item:!0,xs:12,children:[e.jsx(A,{sx:{my:2}}),e.jsxs(j,{direction:"row",spacing:4,sx:{color:"text.secondary"},children:[e.jsxs(r,{variant:"caption",children:["Created: ",new Date(t.createdAt).toLocaleString()]}),e.jsxs(r,{variant:"caption",children:["Updated: ",new Date(t.updatedAt).toLocaleString()]})]})]})]})})]})}),e.jsx(we,{sx:{p:2},children:e.jsx(g,{variant:"contained",sx:{bgcolor:"#E91E63"},onClick:()=>k(!1),children:"Close"})})]}),e.jsxs(Ce,{open:De,onClose:()=>I(!1),children:[e.jsx(ke,{children:"Delete Cake Package?"}),e.jsx(Ie,{children:e.jsx(js,{children:"This action cannot be undone. This cake package will be permanently deleted."})}),e.jsxs(we,{children:[e.jsx(g,{onClick:()=>I(!1),children:"Cancel"}),e.jsx(g,{color:"error",variant:"contained",onClick:Be,children:"Delete Permanently"})]})]}),e.jsx(Xe,{open:C.open,autoHideDuration:4e3,onClose:()=>u({...C,open:!1}),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(Ke,{severity:C.severity,variant:"filled",children:C.message})})]})}export{Vs as default};
