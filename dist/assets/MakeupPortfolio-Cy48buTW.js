import{r as i,g as pe,j as e,B as o,v as me,o as fe,N as ge,T as g,q as j,f as b,b as x,a7 as je,a8 as Z,D as be,s as ve}from"./index-DGIydyV2.js";import{T as M,a as v}from"./Tabs-DExOjK7W.js";import{C as ye}from"./CloudUpload-1H0thaep.js";import{C as Ce,V as ee}from"./VideoLibrary-DvJAET-n.js";import{D as te}from"./Delete-DlrCC7JC.js";import{T as Te}from"./TableContainer-j5SqZxhh.js";import{T as Se,a as we,b as P,c as a,d as ke}from"./TableRow-BvOv-VL8.js";import{C as se}from"./Close-Wkdvzo4D.js";const h="https://api.bookmyevent.ae",y=pe.create({baseURL:h}),U="#e53935";function Ve(){const C=JSON.parse(localStorage.getItem("user")||"{}"),n=C==null?void 0:C._id,u=localStorage.getItem("moduleId"),[W,re]=i.useState(!1),[ie,$]=i.useState(!1),[p,oe]=i.useState(0),[T,A]=i.useState(""),[V,D]=i.useState(""),[E,F]=i.useState(""),[m,B]=i.useState(null),[O,_]=i.useState([]),[G,S]=i.useState([]),[w,q]=i.useState(""),[d,ae]=i.useState(0),[N,le]=i.useState([]),[ne,k]=i.useState(!1),[H,de]=i.useState([]),[J,Y]=i.useState(0),[ce,I]=i.useState(!1),[c,xe]=i.useState("");i.useEffect(()=>{!n||!u||y.get(`/api/subscription/status/${n}?moduleId=${u}`).then(t=>{var r;const s=(r=t.data)==null?void 0:r.subscription;re((s==null?void 0:s.status)==="active"&&(s==null?void 0:s.isCurrent))})},[n,u]);const L=async()=>{const t=await y.get(`/api/portfolio/provider/${n}`);le(t.data.data||[])};i.useEffect(()=>{L()},[]);const he=async()=>{if(!W)return alert("Upgrade plan required");if(!T.trim())return alert("Title required");const t=new FormData;if(t.append("providerId",n),t.append("module",u),t.append("workTitle",T),t.append("description",V),t.append("tags",E),p===0){if(!m)return alert("Thumbnail required");t.append("thumbnail",m),O.forEach(s=>t.append("images",s))}else G.forEach(s=>t.append("videos",s)),w&&t.append("videoLinks",JSON.stringify([w]));$(!0),await y.post("/api/portfolio",t),$(!1),A(""),D(""),F(""),B(null),_([]),S([]),q(""),L()},ue=async t=>{window.confirm("Delete portfolio?")&&(await y.delete(`/api/portfolio/${t}`),L())},z=d===0?N.filter(t=>{var s;return(s=t.media)==null?void 0:s.some(r=>r.type==="image")}):N.filter(t=>{var s;return(s=t.media)==null?void 0:s.some(r=>r.type==="video"||r.type==="videoLink")});return e.jsxs(o,{sx:{p:3,maxWidth:1800,mx:"auto"},children:[!W&&e.jsx(me,{severity:"warning",sx:{mb:3},children:"Upgrade to premium to add portfolio works"}),e.jsx(fe,{sx:{mb:5,borderRadius:3,width:"100%"},children:e.jsxs(ge,{children:[e.jsx(g,{variant:"h5",fontWeight:700,mb:2,children:"Add Portfolio Work"}),e.jsxs(M,{value:p,onChange:(t,s)=>oe(s),sx:{mb:3},children:[e.jsx(v,{label:"Images"}),e.jsx(v,{label:"Videos"})]}),e.jsx(j,{fullWidth:!0,label:"Title",value:T,onChange:t=>A(t.target.value),sx:{mb:3}}),e.jsx(j,{fullWidth:!0,multiline:!0,rows:3,label:"Description",value:V,onChange:t=>D(t.target.value),sx:{mb:3}}),e.jsx(j,{fullWidth:!0,label:"Tags",value:E,onChange:t=>F(t.target.value),sx:{mb:4}}),p===0&&e.jsxs(e.Fragment,{children:[e.jsxs(b,{component:"label",variant:"contained",sx:{bgcolor:U,mb:2},children:[e.jsx(ye,{sx:{mr:1}})," Upload Thumbnail",e.jsx("input",{hidden:!0,type:"file",accept:"image/*",onChange:t=>B(t.target.files[0])})]}),m&&e.jsx(o,{sx:{mb:3},children:e.jsx("img",{src:URL.createObjectURL(m),style:{width:180,height:180,borderRadius:12}})}),e.jsxs(b,{component:"label",variant:"outlined",sx:{mb:2},children:[e.jsx(Ce,{sx:{mr:1}})," Upload Gallery Images",e.jsx("input",{hidden:!0,multiple:!0,type:"file",accept:"image/*",onChange:t=>_([...t.target.files])})]}),e.jsx(o,{sx:{display:"flex",gap:2,flexWrap:"wrap",mb:4},children:O.map((t,s)=>e.jsx("img",{src:URL.createObjectURL(t),style:{width:100,height:100,borderRadius:10}},s))})]}),p===1&&e.jsxs(e.Fragment,{children:[e.jsxs(b,{component:"label",variant:"contained",sx:{bgcolor:U,mb:2},children:[e.jsx(ee,{sx:{mr:1}})," Upload Videos",e.jsx("input",{hidden:!0,multiple:!0,type:"file",accept:"video/*",onChange:t=>S(Array.from(t.target.files))})]}),G.map((t,s)=>e.jsxs(o,{sx:{mb:2},children:[e.jsx("video",{src:URL.createObjectURL(t),controls:!0,style:{width:260,borderRadius:8}}),e.jsx(x,{color:"error",onClick:()=>S(r=>r.filter((R,f)=>f!==s)),children:e.jsx(te,{})})]},s)),e.jsx(j,{fullWidth:!0,label:"Video Link (YouTube / Vimeo)",value:w,onChange:t=>q(t.target.value),sx:{mb:3}})]}),e.jsx(b,{fullWidth:!0,variant:"contained",sx:{bgcolor:U,py:1.4},onClick:he,children:"Add Portfolio"})]})}),e.jsxs(M,{value:d,onChange:(t,s)=>ae(s),sx:{mb:2},children:[e.jsx(v,{label:"Images"}),e.jsx(v,{label:"Videos"})]}),e.jsx(Te,{component:je,sx:{borderRadius:3,width:"100%"},children:e.jsxs(Se,{children:[e.jsx(we,{sx:{bgcolor:"#fdeaea"},children:e.jsxs(P,{children:[e.jsx(a,{children:"Work"}),e.jsx(a,{children:"Preview"}),e.jsx(a,{align:"center",children:"Count"}),e.jsx(a,{align:"right",children:"Action"})]})}),e.jsxs(ke,{children:[z.length===0&&e.jsx(P,{children:e.jsx(a,{colSpan:4,align:"center",children:e.jsx(g,{color:"text.secondary",children:"No portfolio items found"})})}),z.map(t=>{var R,f,K;const s=t.media.find(l=>l.type==="image"),r=t.media.find(l=>l.type==="video"||l.type==="videoLink");return e.jsxs(P,{hover:!0,children:[e.jsxs(a,{children:[e.jsx(g,{fontWeight:600,children:t.workTitle}),e.jsx(g,{variant:"caption",color:"text.secondary",children:t.description})]}),e.jsxs(a,{children:[d===0&&s&&e.jsx("img",{src:`${h}/${s.thumbnail}`,style:{width:70,height:70,borderRadius:10,cursor:"pointer",objectFit:"cover"},onClick:()=>{de(s.gallery||[]),Y(0),k(!0)}}),d===1&&r&&e.jsx(x,{color:"primary",onClick:()=>{var Q,X;const l=(Q=r.videos)!=null&&Q[0]?`${h}/${r.videos[0]}`:(X=r.videoLinks)==null?void 0:X[0];xe(l),I(!0)},children:e.jsx(ee,{})})]}),e.jsx(a,{align:"center",children:d===0?((R=s==null?void 0:s.gallery)==null?void 0:R.length)||0:(((f=r==null?void 0:r.videos)==null?void 0:f.length)||0)+(((K=r==null?void 0:r.videoLinks)==null?void 0:K.length)||0)}),e.jsx(a,{align:"right",children:e.jsx(x,{color:"error",onClick:()=>ue(t._id),children:e.jsx(te,{})})})]},t._id)})]})]})}),e.jsx(Z,{open:ne,onClose:()=>k(!1),fullScreen:!0,children:e.jsxs(o,{sx:{bgcolor:"#000",height:"100vh",p:2},children:[e.jsx(x,{onClick:()=>k(!1),sx:{color:"#fff"},children:e.jsx(se,{})}),e.jsx(o,{sx:{textAlign:"center",mt:2},children:e.jsx("img",{src:`${h}/${H[J]}`,style:{maxHeight:"70vh",maxWidth:"100%"}})}),e.jsx(be,{sx:{my:2,bgcolor:"#333"}}),e.jsx(o,{sx:{display:"flex",justifyContent:"center",gap:1},children:H.map((t,s)=>e.jsx("img",{src:`${h}/${t}`,onClick:()=>Y(s),style:{width:60,height:60,borderRadius:8,border:J===s?"2px solid #fff":"1px solid #444",cursor:"pointer"}},s))})]})}),e.jsx(Z,{open:ce,onClose:()=>I(!1),fullScreen:!0,children:e.jsxs(o,{sx:{bgcolor:"#000",height:"100vh",p:2},children:[e.jsx(x,{onClick:()=>I(!1),sx:{color:"#fff"},children:e.jsx(se,{})}),e.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"80%"},children:c!=null&&c.includes("http")?e.jsx("iframe",{src:c,width:"80%",height:"80%",frameBorder:"0",allowFullScreen:!0}):e.jsx("video",{src:c,controls:!0,style:{maxWidth:"80%"}})})]})}),ie&&e.jsx(ve,{})]})}export{Ve as default};
