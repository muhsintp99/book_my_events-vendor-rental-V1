import{u as Ce,w as we,ae as Se,r as c,j as e,B as n,b as B,af as ie,T as s,ag as ke,S as O,f as _,am as Ae,aj as re,v as ne,q as m,E as ue,a as Ie}from"./index-BJj5dOw1.js";import{A as Be}from"./Autocomplete-CcMptirH.js";import{A as Ee}from"./Add-C0onBclN.js";import{D as Te}from"./Delete-BPy-YEYS.js";import{C as oe}from"./Close-Dpd_QUj9.js";import{C as se}from"./CloudUpload-7TeyGxZn.js";const le=ue(n)(({theme:o})=>({border:"2px dashed #e0e0e0",borderRadius:o.shape.borderRadius,padding:o.spacing(3),textAlign:"center",backgroundColor:o.palette.grey[50],cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"150px","&:hover":{borderColor:"#E15B65"},'& input[type="file"]':{display:"none"}})),de=ue(n)({position:"relative",display:"inline-block"}),E="https://api.bookmyevent.ae",Fe=()=>{try{const o=localStorage.getItem("user");if(!o)return null;const u=JSON.parse(o);return(u==null?void 0:u._id)||null}catch(o){return console.error("getProviderId parse error",o),null}},ce=()=>localStorage.getItem("token")||sessionStorage.getItem("token")||null,$=o=>{if(!o)return"/placeholder.jpg";let u=String(o||"").toLowerCase().replace(/^uploads/i,"/uploads");return u.startsWith("/")||(u="/"+u),`${E}${u}`},Pe=(o=[])=>o.map(u=>({value:u._id,label:u.title||u.name||"Untitled"})),Ue=()=>{var ee,te;const o=Ce(),u=we(),U=Se(),[ge,H]=c.useState("form"),[h,z]=c.useState({packageTitle:"",subtitle:"",description:"",startingPrice:"",advanceBookingAmount:""}),[G,y]=c.useState([{id:Date.now(),heading:"",includes:""}]),[T,b]=c.useState(null),[F,L]=c.useState([]),[pe,N]=c.useState({}),[C,P]=c.useState(null),[W,D]=c.useState([]),[J,j]=c.useState(!1),[q,w]=c.useState(""),[V,S]=c.useState("success"),[i,X]=c.useState(null),[K,Q]=c.useState(!0);c.useEffect(()=>{let t=!1;return(async()=>{try{Q(!0);const r=ce(),l=localStorage.getItem("moduleId");l||console.warn("No moduleId in localStorage");const g={Accept:"application/json"};r&&(g.Authorization=`Bearer ${r}`);const f=l?`${E}/api/categories/modules/${l}`:`${E}/api/categories`,d=await fetch(f,{headers:g});if(!d.ok)throw new Error(`Failed to load categories: ${d.status}`);const v=await d.json();if(!t)if(v.success&&Array.isArray(v.data)){const A=Pe(v.data);L(A);const R={};(v.data||[]).forEach(I=>{R[I._id]=I.title||I.name||""}),N(R)}else L([]),N({})}catch(r){console.error("fetchCategories error",r),L([]),N({})}finally{t||Q(!1)}})(),()=>{t=!0}},[]),c.useEffect(()=>{var t;if((t=U.state)!=null&&t.editPackage){const a=U.state.editPackage;X(a),Y(a)}},[U.state]),c.useEffect(()=>{var t,a;if(i&&F.length>0&&!T&&((t=i.categories)==null?void 0:t.length)>0){const r=((a=i.categories[0])==null?void 0:a._id)||i.categories[0],l=F.find(g=>g.value===r);b(l||{value:r,label:pe[r]||"Uncategorized"})}},[F,i]);const Y=t=>{var r,l,g;z({packageTitle:t.title||"",subtitle:t.subtitle||"",description:t.description||"",startingPrice:((r=t.price)==null?void 0:r.toString())||"",advanceBookingAmount:((l=t.advanceBookingAmount)==null?void 0:l.toString())||""}),y((t.includes||[]).map((f,d)=>({id:Date.now()+d,heading:f.title||"",includes:(f.items||[]).join(", ")})));const a=(g=t.categories)==null?void 0:g[0];b(a?{value:a._id||a,label:a.title||a.name||""}:null),P(null),D([])},k=t=>{const{name:a,value:r}=t.target;z(l=>({...l,[a]:r}))},Z=(t,a,r)=>{y(l=>l.map(g=>g.id===t?{...g,[a]:r}:g))},he=()=>y(t=>[...t,{id:Date.now(),heading:"",includes:""}]),me=t=>y(a=>a.filter(r=>r.id!==t)),xe=t=>{var r;const a=(r=t.target.files)==null?void 0:r[0];a&&P(a)},be=t=>{const a=Array.from(t.target.files||[]);a.length&&D(r=>[...r,...a])},je=t=>D(a=>a.filter((r,l)=>l!==t)),fe=()=>P(null),M=(t,a)=>{a!=="clickaway"&&j(!1)},ve=()=>{i&&Y(i),H("form")},ye=async t=>{var ae;t.preventDefault();const a=ce();if(!a){w("Authentication required"),S("error"),j(!0);return}const r=Fe();if(!r){console.error("Provider ID missing. user:",localStorage.getItem("user")),w("Provider ID missing. Please login as vendor."),S("error"),j(!0);return}const l=localStorage.getItem("moduleId")||((ae=i==null?void 0:i.module)==null?void 0:ae._id)||(i==null?void 0:i.module)||"",g=G.filter(p=>p.includes&&p.includes.trim()).map(p=>({title:p.heading.trim()||"Section",items:p.includes.split(",").map(x=>x.trim()).filter(Boolean)})),f=parseFloat(h.startingPrice)||0,d=new FormData;d.append("providerId",r),l&&d.append("module",l),d.append("title",h.packageTitle||"Custom Package"),d.append("subtitle",h.subtitle||""),d.append("description",h.description||""),d.append("cateringType","custom"),d.append("includes",JSON.stringify(g)),T?d.append("categories",JSON.stringify([T.value])):d.append("categories",JSON.stringify([])),d.append("price",String(f));const v=parseFloat(h.advanceBookingAmount)||0;d.append("advanceBookingAmount",String(v)),C&&d.append("thumbnail",C),W.forEach(p=>d.append("images",p));const A=!!(i!=null&&i._id),R=A?`${E}/api/catering/${i._id}`:`${E}/api/catering`,I=A?"PUT":"POST";try{const p=await fetch(R,{method:I,body:d,headers:{Authorization:`Bearer ${a}`}}),x=await p.json().catch(()=>({success:!1,message:"Invalid JSON response"}));if(!p.ok){console.error("Save failed",x),w(x.error||x.message||"Failed to save"),S("error"),j(!0);return}z({packageTitle:"",subtitle:"",description:"",startingPrice:"",advanceBookingAmount:""}),y([{id:Date.now(),heading:"",includes:""}]),b(null),P(null),D([]),X(x.data||null),H("preview"),w(x.message||`Catering ${A?"updated":"created"} successfully`),S("success"),j(!0)}catch(p){console.error("submit error",p),w("Error saving catering: "+(p.message||p)),S("error"),j(!0)}};return ge==="preview"&&i?e.jsx(n,{sx:{p:3,backgroundColor:o.palette.grey[100],minHeight:"100vh",width:"100%"},children:e.jsxs(n,{sx:{width:"100%",margin:"auto",backgroundColor:"white",borderRadius:o.shape.borderRadius,boxShadow:o.shadows[1],p:3,overflowX:"hidden"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx(B,{onClick:()=>u(-1),color:"primary",children:e.jsx(ie,{})}),e.jsx(s,{variant:"h5",children:"Package Preview"})]}),e.jsxs(n,{sx:{position:"relative",mb:3},children:[e.jsx("img",{src:$(i.thumbnail),alt:i.title,style:{width:"100%",height:200,objectFit:"cover",borderRadius:8},onError:t=>{t.target.onerror=null,t.target.src="/placeholder.jpg"}}),e.jsxs(n,{sx:{position:"absolute",bottom:0,left:0,right:0,background:"linear-gradient(transparent, rgba(0,0,0,0.7))",color:"white",p:2},children:[e.jsx(s,{variant:"h6",children:i.title||"Untitled Package"}),e.jsx(s,{variant:"body2",children:i.subtitle||""})]})]}),e.jsx(s,{variant:"body1",sx:{mb:3,textAlign:"justify"},children:i.description||"No description available."}),i.categories&&i.categories.length>0&&e.jsxs(n,{sx:{mb:3},children:[e.jsx(s,{variant:"h6",sx:{mb:1},children:"Category"}),e.jsx(ke,{label:((ee=i.categories[0])==null?void 0:ee.title)||i.categories[0]||"Uncategorized",variant:"outlined",color:"primary"})]}),e.jsx(s,{variant:"h6",sx:{mb:2},children:"Includes"}),(i.includes||[]).map((t,a)=>{var r;return e.jsxs(n,{sx:{mb:2},children:[e.jsx(s,{variant:"subtitle1",sx:{mb:1,fontWeight:"medium"},children:t.title||"Untitled Section"}),e.jsx(O,{component:"ul",spacing:.5,sx:{pl:2,mb:0},children:((r=t.items)==null?void 0:r.map((l,g)=>e.jsx(s,{variant:"body2",component:"li",children:l},g)))||e.jsx(s,{variant:"body2",color:"text.secondary",children:"No items"})})]},a)}),e.jsxs(n,{sx:{textAlign:"center",mb:3},children:[e.jsx(s,{variant:"h6",sx:{mb:.5},children:"Starting Price"}),e.jsxs(s,{variant:"h4",color:"primary",children:["₹",i.price||0," Per Head"]}),i.advanceBookingAmount>0&&e.jsxs(s,{variant:"body2",color:"text.secondary",children:["Advance Booking Amount: ₹",i.advanceBookingAmount]})]}),e.jsxs(n,{sx:{mb:3},children:[e.jsx(s,{variant:"subtitle1",sx:{mb:1},children:"Gallery"}),e.jsx(O,{direction:"row",spacing:2,sx:{flexWrap:"wrap",justifyContent:"center"},children:(i.images||[]).slice(0,6).map((t,a)=>e.jsx(n,{sx:{position:"relative"},children:e.jsx("img",{src:$(t),alt:`Gallery ${a+1}`,style:{width:150,height:150,objectFit:"cover",borderRadius:8},onError:r=>{r.target.onerror=null,r.target.src="/placeholder.jpg"}})},a))})]}),e.jsx(n,{sx:{display:"flex",gap:2,justifyContent:"center"},children:e.jsx(_,{variant:"outlined",startIcon:e.jsx(Ae,{}),onClick:ve,sx:{color:"#E15B65",borderColor:"#E15B65"},children:"Edit Menu"})}),e.jsx(re,{open:J,autoHideDuration:6e3,onClose:M,anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(ne,{onClose:M,severity:V,sx:{width:"100%"},children:q})})]})}):e.jsx(n,{sx:{p:3,backgroundColor:o.palette.grey[100],minHeight:"100vh",width:"100%"},children:e.jsxs(n,{sx:{width:"100%",margin:"auto",backgroundColor:"white",borderRadius:o.shape.borderRadius,boxShadow:o.shadows[1],p:3,overflowX:"hidden"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[i&&e.jsx(B,{onClick:()=>u(-1),color:"primary",children:e.jsx(ie,{})}),e.jsx(s,{variant:"h5",children:i?"Edit Menu":"Add New Menu"})]}),e.jsxs(n,{component:"form",onSubmit:ye,children:[e.jsx(m,{fullWidth:!0,label:"Package Title",name:"packageTitle",value:h.packageTitle,onChange:k,placeholder:"Type package title",sx:{mb:2},variant:"outlined"}),e.jsx(m,{fullWidth:!0,label:"Subtitle",name:"subtitle",value:h.subtitle,onChange:k,placeholder:"Type subtitle",sx:{mb:2},variant:"outlined"}),e.jsx(m,{fullWidth:!0,label:"Description",name:"description",value:h.description,onChange:k,placeholder:"Type description",multiline:!0,rows:3,sx:{mb:2},variant:"outlined"}),e.jsx(Be,{fullWidth:!0,options:F,getOptionLabel:t=>t.label,isOptionEqualToValue:(t,a)=>t.value===(a==null?void 0:a.value),value:T,onChange:(t,a)=>b(a),renderInput:t=>e.jsx(m,{...t,label:"Category",placeholder:K?"Loading categories...":"Select a category",sx:{mb:2},variant:"outlined",disabled:K})}),e.jsxs(n,{sx:{mb:3},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(s,{variant:"subtitle1",children:"Menu List"}),e.jsx(_,{variant:"contained",size:"small",onClick:he,startIcon:e.jsx(Ee,{}),sx:{backgroundColor:"#E15B65",color:"white"},children:"Add"})]}),G.map(t=>e.jsxs(n,{sx:{border:`1px solid ${o.palette.grey[300]}`,borderRadius:1,p:2,mb:2},children:[e.jsx(m,{fullWidth:!0,label:"Add heading here",value:t.heading,onChange:a=>Z(t.id,"heading",a.target.value),sx:{mb:2},variant:"outlined"}),e.jsxs(n,{sx:{display:"flex",gap:1,alignItems:"flex-end"},children:[e.jsx(m,{fullWidth:!0,label:"Includes",value:t.includes,onChange:a=>Z(t.id,"includes",a.target.value),multiline:!0,rows:3,sx:{flex:1},variant:"outlined",placeholder:"Enter items separated by commas"}),e.jsx(B,{onClick:()=>me(t.id),color:"error",sx:{alignSelf:"flex-end"},children:e.jsx(Te,{})})]})]},t.id))]}),e.jsxs(n,{sx:{display:"flex",gap:3,mb:3},children:[e.jsxs(n,{sx:{flex:1},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Thumbnail Image"}),e.jsxs(le,{onClick:()=>document.getElementById("thumbnail-upload").click(),children:[C?e.jsxs(n,{sx:{textAlign:"center"},children:[e.jsxs(de,{children:[e.jsx("img",{src:URL.createObjectURL(C),alt:"Thumbnail preview",style:{maxWidth:"100%",maxHeight:100,objectFit:"contain",marginBottom:o.spacing(1)}}),e.jsx(B,{onClick:fe,size:"small",sx:{position:"absolute",top:-8,right:-8,backgroundColor:"white",color:"error",boxShadow:o.shadows[2]},children:e.jsx(oe,{fontSize:"small"})})]}),e.jsx(s,{variant:"body2",color:"text.secondary",children:C.name})]}):i!=null&&i.thumbnail?e.jsxs(n,{sx:{textAlign:"center"},children:[e.jsx("img",{src:$(i.thumbnail),alt:"Current thumbnail",style:{maxWidth:"100%",maxHeight:100,objectFit:"contain",marginBottom:o.spacing(1)},onError:t=>{t.target.onerror=null,t.target.src="/placeholder.jpg"}}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Current thumbnail. Click to replace."})]}):e.jsxs(n,{children:[e.jsx(se,{sx:{fontSize:40,color:o.palette.grey[400],mb:1}}),e.jsx(s,{variant:"body2",color:"#E15B65",sx:{mb:.5,fontWeight:"medium"},children:"Click to upload"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Or drag and drop"})]}),e.jsx("input",{type:"file",id:"thumbnail-upload",hidden:!0,accept:"image/jpeg,image/png,image/jpg",onChange:xe})]})]}),e.jsxs(n,{sx:{flex:1},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Gallery Images"}),e.jsxs(le,{onClick:()=>document.getElementById("gallery-upload").click(),children:[W.length>0?e.jsxs(n,{sx:{textAlign:"center"},children:[e.jsx(O,{direction:"row",flexWrap:"wrap",spacing:1,sx:{justifyContent:"center",mb:1},children:W.map((t,a)=>e.jsxs(de,{children:[e.jsx("img",{src:URL.createObjectURL(t),alt:`Gallery preview ${a+1}`,style:{width:100,height:100,objectFit:"cover",borderRadius:4}}),e.jsx(B,{onClick:()=>je(a),size:"small",sx:{position:"absolute",top:-8,right:-8,backgroundColor:"white",color:"error",boxShadow:o.shadows[2]},children:e.jsx(oe,{fontSize:"small"})})]},a))}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:[W.length," image(s) selected"]})]}):e.jsxs(n,{children:[e.jsx(se,{sx:{fontSize:40,color:o.palette.grey[400],mb:1}}),e.jsx(s,{variant:"body2",color:"#E15B65",sx:{mb:.5,fontWeight:"medium"},children:"Click to upload"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Or drag and drop"})]}),e.jsx("input",{type:"file",id:"gallery-upload",hidden:!0,accept:"image/jpeg,image/png,image/jpg",multiple:!0,onChange:be})]}),((te=i==null?void 0:i.images)==null?void 0:te.length)>0&&e.jsxs(n,{sx:{mt:2},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,color:"text.secondary",children:"Existing Images"}),e.jsx(O,{direction:"row",flexWrap:"wrap",spacing:1,children:i.images.map((t,a)=>e.jsx(n,{sx:{position:"relative"},children:e.jsx("img",{src:$(t),alt:`Existing gallery ${a+1}`,style:{width:100,height:100,objectFit:"cover",borderRadius:4},onError:r=>{r.target.onerror=null,r.target.src="/placeholder.jpg"}})},a))})]})]})]}),e.jsxs(n,{sx:{mb:3,display:"flex",gap:2},children:[e.jsx(m,{fullWidth:!0,label:"₹ Price (Starting From)",name:"startingPrice",value:h.startingPrice,onChange:k,type:"number",inputProps:{min:0},InputProps:{endAdornment:e.jsx(Ie,{position:"end",children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"Per Head"})})},variant:"outlined"}),e.jsx(m,{fullWidth:!0,label:"₹ Advance Booking Amount",name:"advanceBookingAmount",value:h.advanceBookingAmount,onChange:k,type:"number",inputProps:{min:0},variant:"outlined",helperText:"Amount to be paid in advance"})]}),e.jsx(_,{type:"submit",variant:"contained",fullWidth:!0,sx:{backgroundColor:"#E15B65",color:"white",py:1.5},children:i?"Update Menu":"Create Menu"})]}),e.jsx(re,{open:J,autoHideDuration:6e3,onClose:M,anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(ne,{onClose:M,severity:V,sx:{width:"100%"},children:q})})]})})};export{Ue as default};
