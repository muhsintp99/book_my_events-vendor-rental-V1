import{r as c,j as e,x as P,B as y,t as A,a8 as De,b as Ce,ar as Ie,g as F,aa as Te,ab as we,ac as Be,T as k,aq as Me,s as x,a as p,P as Ne,aE as Pe,aF as Ae,aG as Fe,aH as We,aI as Le,aJ as Ee,F as J,I as q,af as Q,_ as g,aK as X,aL as ze,aM as Oe,f as Z,C as ee,aN as Re}from"./index-C6q0eJfO.js";const v="https://api.bookmyevent.ae";function He(){const[d,te]=c.useState(new Date),[S,ne]=c.useState(new Date().getDate()),[oe,W]=c.useState(!1),[L,E]=c.useState([]),[C,I]=c.useState([]),[T,se]=c.useState([]),[ae,z]=c.useState(!1),[D,i]=c.useState(null),[O,w]=c.useState(!1),[R,_]=c.useState(null),[a,b]=c.useState({fullName:"",contactNumber:"",emailAddress:"",address:"",numberOfGuests:"",additionalNotes:"",moduleId:"",vehicleId:"",tripType:"perDay",days:1,hours:null,distanceKm:null,bookingDate:new Date().toISOString().split("T")[0],timeSlot:[],paymentType:"Cash",bookingType:"Direct"}),m=(()=>{let t=localStorage.getItem("providerId")||localStorage.getItem("userId");if(!t){const n=localStorage.getItem("user");if(n)try{const s=JSON.parse(n);t=s._id||s.id||s.userId}catch(s){console.error("Error parsing user from localStorage:",s)}}return t})();c.useEffect(()=>{m?($(),le(),re()):i("Provider ID not found. Please log in again.")},[d,m]),c.useEffect(()=>{T.length===1&&!a.moduleId&&b(t=>({...t,moduleId:T[0]._id}))},[T]);const $=async()=>{if(!m){i("Provider ID is required");return}z(!0),i(null);try{const n=await(await fetch(`${v}/api/bookings/provider/${m}`)).json();n.success?E(n.data||[]):i(n.message||"Failed to fetch bookings")}catch(t){i("Error connecting to server"),console.error("Fetch error:",t)}finally{z(!1)}},re=async()=>{try{const n=await(await fetch(`${v}/api/modules`)).json(),r=((n==null?void 0:n.data)||(n==null?void 0:n.modules)||(Array.isArray(n)?n:[])).find(l=>(l.title||"").toLowerCase()==="transport");if(!r){i("Transport module not found in system");return}se([r]),b(l=>({...l,moduleId:r._id})),console.log("✅ Transport module fixed:",r._id)}catch(t){console.error("Fetch modules error:",t),i("Failed to fetch modules")}},le=async()=>{try{const n=await(await fetch(`${v}/api/vehicles/provider/${m}`)).json();n.success?I(n.data||[]):I([])}catch(t){console.error("Fetch vehicles error:",t),I([])}},ie=async t=>{if(window.confirm("Are you sure you want to delete this booking?")){_(t),i(null);try{const s=await(await fetch(`${v}/api/bookings/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})).json();s.success?(E(r=>r.filter(l=>l._id!==t)),alert("Booking deleted successfully!")):i(s.message||"Failed to delete booking")}catch(n){i("Error deleting booking: "+n.message),console.error("Delete error:",n)}finally{_(null)}}},B=new Date,de=B.getDate(),ce=B.getMonth(),ue=B.getFullYear(),G=(()=>{const t=d.getFullYear(),n=d.getMonth(),s=new Date(t,n+1,0).getDate(),r={};for(let l=1;l<=s;l++){const U=L.filter(K=>{const N=new Date(K.bookingDate);return N.getDate()===l&&N.getMonth()===n&&N.getFullYear()===t&&K.bookingType==="Direct"});U.length===0?r[l]="free":U.length>=2?r[l]="booked":r[l]="available"}return r})(),f=L.filter(t=>{const n=new Date(t.bookingDate);return n.getDate()===S&&n.getMonth()===d.getMonth()&&n.getFullYear()===d.getFullYear()&&t.bookingType==="Direct"}),ge=t=>{const n=t.getFullYear(),s=t.getMonth(),r=new Date(n,s,1).getDay(),l=new Date(n,s+1,0).getDate();return{firstDay:r,daysInMonth:l}},{firstDay:he,daysInMonth:xe}=ge(d),pe=d.toLocaleDateString("en-US",{month:"long",year:"numeric"}),me=t=>{switch(t){case"booked":return"#ef5350";case"available":return"#ffd54f";case"free":return"#66bb6a";default:return"#66bb6a"}},fe=t=>{switch(t){case"Accepted":return"#7e57c2";case"Pending":return"#ffd54f";case"Rejected":return"#e57373";default:return"#ef5350"}},Y=t=>{te(new Date(d.getFullYear(),d.getMonth()+t,1))},ye=()=>{const t=[];["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].forEach(s=>t.push(e.jsx("div",{style:o.weekDay,children:s},s)));for(let s=0;s<he;s++)t.push(e.jsx("div",{},`empty-${s}`));for(let s=1;s<=xe;s++){const r=G[s]||"free",l=s===de&&d.getMonth()===ce&&d.getFullYear()===ue;t.push(e.jsxs("div",{onClick:()=>ne(s),style:o.dayCell,children:[e.jsx("div",{style:{...o.dayNumber,...l?o.todayNumber:{}},children:s}),e.jsx("div",{style:{...o.statusDot,backgroundColor:me(r)}})]},s))}return t},H=G[S]||"free",be=()=>f.length===0?"No bookings - All slots available":H==="booked"?`${f.length} bookings - Fully booked`:H==="available"?`${f.length} booking - Some slots available`:"All slots available",je=()=>new Date(d.getFullYear(),d.getMonth(),S).toLocaleDateString("en-US",{weekday:"short"}),h=t=>{const{name:n,value:s}=t.target;b(r=>({...r,[n]:s}))},V=t=>{b(n=>{const s=n.timeSlot.includes(t)?n.timeSlot.filter(r=>r!==t):[...n.timeSlot,t];return{...n,timeSlot:s}})},ke=async()=>{w(!0),i(null);try{if(!a.bookingDate){i("Please select booking date"),w(!1);return}const t={moduleId:a.moduleId,bookingType:a.bookingType,bookingDate:a.bookingDate,vehicleId:a.vehicleId,tripType:a.tripType,days:a.tripType==="perDay"?Number(a.days):null,hours:a.tripType==="hourly"?Number(a.hours):null,distanceKm:a.tripType==="distanceWise"?Number(a.distanceKm):null,timeSlot:a.timeSlot,fullName:a.fullName,contactNumber:a.contactNumber,emailAddress:a.emailAddress,address:a.address,paymentType:a.paymentType};a.packageId&&(t.packageId=a.packageId);const s=await(await fetch(`${v}/api/bookings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();s.success?(alert("Booking created successfully!"),M(),$(),ve()):i(s.message||"Failed to create booking")}catch(t){i("Error creating booking: "+t.message),console.error("Submit error:",t)}finally{w(!1)}},ve=()=>{b({fullName:"",contactNumber:"",emailAddress:"",address:"",numberOfGuests:"",additionalNotes:"",moduleId:"",vehicleId:"",bookingDate:new Date().toISOString().split("T")[0],timeSlot:[],paymentType:"Cash",bookingType:"Direct"})},Se=()=>{W(!0)},M=()=>{W(!1),i(null)},o={container:{width:"100%",margin:"0 auto",padding:"40px",backgroundColor:"#fafafa",minHeight:"100vh",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},navigation:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"32px",padding:"0 20px"},navButton:{padding:"12px",border:"none",background:"#fff",cursor:"pointer",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},monthTitle:{fontSize:"28px",fontStyle:"italic",fontWeight:"400",color:"#333"},calendarGrid:{backgroundColor:"#fff",borderRadius:"16px",marginBottom:"32px",padding:"32px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)"},grid:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"16px"},weekDay:{textAlign:"center",padding:"12px",color:"#999",fontSize:"16px",fontWeight:"500"},dayCell:{position:"relative",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px 0",cursor:"pointer",borderRadius:"16px",transition:"background-color 0.2s"},dayNumber:{fontSize:"20px",fontWeight:"400",color:"#333",marginBottom:"6px"},todayNumber:{backgroundColor:"#ef5350",color:"#fff",borderRadius:"50%",width:"52px",height:"52px",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"600"},statusDot:{width:"10px",height:"10px",borderRadius:"50%"},legend:{backgroundColor:"#fff",borderRadius:"12px",padding:"24px",marginBottom:"32px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)"},legendContainer:{display:"flex",alignItems:"center",justifyContent:"center",gap:"24px",flexWrap:"wrap"},legendItem:{display:"flex",alignItems:"center",gap:"8px"},legendDot:{width:"12px",height:"12px",borderRadius:"50%"},legendText:{fontSize:"15px",color:"#666"},selectedInfo:{marginBottom:"24px"},selectedHeader:{display:"flex",alignItems:"center",gap:"24px"},selectedNumber:{fontSize:"64px",fontWeight:"300",color:"#333"},selectedDetails:{display:"flex",flexDirection:"column"},selectedTitle:{fontSize:"22px",fontWeight:"500",color:"#333",marginBottom:"6px"},selectedStatus:{fontSize:"16px",color:"#666"},selectedDay:{fontSize:"14px",color:"#999",marginLeft:"100px",marginTop:"6px"},bookingsTitle:{fontSize:"22px",fontWeight:"500",marginBottom:"20px",color:"#333"},bookingsContainer:{display:"flex",flexDirection:"column",gap:"20px"},bookingCard:{borderRadius:"20px",padding:"28px",color:"#fff",position:"relative",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},bookingHeader:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"8px"},bookingName:{fontSize:"24px",fontWeight:"500",marginBottom:"10px"},bookingLocation:{fontSize:"15px",marginBottom:"14px"},noBookings:{backgroundColor:"#f5f5f5",borderRadius:"20px",padding:"48px",textAlign:"center"},noBookingsTitle:{fontSize:"24px",fontWeight:"500",marginBottom:"10px",color:"#333"},noBookingsText:{fontSize:"16px",color:"#666"},floatingButton:{position:"fixed",bottom:"32px",right:"32px",backgroundColor:"#ef5350",color:"#fff",borderRadius:"50%",width:"64px",height:"64px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 6px 16px rgba(0,0,0,0.3)",cursor:"pointer",transition:"background-color 0.2s, transform 0.2s"}},j={display:"flex",alignItems:"center",gap:1,mb:2,color:"#ef5350",fontWeight:600},u={color:"#ef5350",fontSize:24};return e.jsxs("div",{style:o.container,children:[!m&&e.jsx(P,{severity:"warning",sx:{mb:3},children:"Provider ID not found. Please make sure you're logged in. You may need to log out and log in again."}),ae&&e.jsx(y,{display:"flex",justifyContent:"center",mb:3,children:e.jsx(A,{})}),D&&e.jsx(P,{severity:"error",sx:{mb:3},children:D}),e.jsxs("div",{style:o.navigation,children:[e.jsx("button",{onClick:()=>Y(-1),style:o.navButton,onMouseEnter:t=>t.currentTarget.style.backgroundColor="#f0f0f0",onMouseLeave:t=>t.currentTarget.style.backgroundColor="#fff",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsx("h2",{style:o.monthTitle,children:pe}),e.jsx("button",{onClick:()=>Y(1),style:o.navButton,onMouseEnter:t=>t.currentTarget.style.backgroundColor="#f0f0f0",onMouseLeave:t=>t.currentTarget.style.backgroundColor="#fff",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M9 18l6-6-6-6"})})})]}),e.jsx("div",{style:o.calendarGrid,children:e.jsx("div",{style:o.grid,children:ye()})}),e.jsx("div",{style:o.legend,children:e.jsxs("div",{style:o.legendContainer,children:[e.jsxs("div",{style:o.legendItem,children:[e.jsx("div",{style:{...o.legendDot,backgroundColor:"#ef5350"}}),e.jsx("span",{style:o.legendText,children:"Fully Booked"})]}),e.jsxs("div",{style:o.legendItem,children:[e.jsx("div",{style:{...o.legendDot,backgroundColor:"#ffd54f"}}),e.jsx("span",{style:o.legendText,children:"Slots Available"})]}),e.jsxs("div",{style:o.legendItem,children:[e.jsx("div",{style:{...o.legendDot,backgroundColor:"#66bb6a"}}),e.jsx("span",{style:o.legendText,children:"Fully Free"})]})]})}),e.jsxs("div",{style:o.selectedInfo,children:[e.jsxs("div",{style:o.selectedHeader,children:[e.jsx("span",{style:o.selectedNumber,children:S}),e.jsxs("div",{style:o.selectedDetails,children:[e.jsx("h3",{style:o.selectedTitle,children:"Selected Date"}),e.jsx("p",{style:o.selectedStatus,children:be()})]})]}),e.jsx("p",{style:o.selectedDay,children:je()})]}),f.length>0&&e.jsxs("div",{children:[e.jsx("h3",{style:o.bookingsTitle,children:"Today's Bookings"}),e.jsx("div",{style:o.bookingsContainer,children:f.map(t=>{var n,s;return e.jsxs("div",{style:{...o.bookingCard,backgroundColor:fe(t.status)},children:[e.jsxs("div",{style:o.bookingHeader,children:[(n=t.timeSlot)!=null&&n.length?t.timeSlot.map(r=>`${r.label} (${r.time})`).join(", "):"All Day",e.jsxs(y,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(De,{label:t.status,size:"small",style:{backgroundColor:"rgba(255,255,255,0.3)",color:t.status==="Pending"?"#000":"#fff"}}),e.jsx(Ce,{size:"small",onClick:()=>ie(t._id),disabled:R===t._id,sx:{color:"white",backgroundColor:"rgba(0,0,0,0.2)","&:hover":{backgroundColor:"rgba(0,0,0,0.3)"}},children:R===t._id?e.jsx(A,{size:20,sx:{color:"white"}}):e.jsx(Ie,{fontSize:"small"})})]})]}),e.jsxs("h4",{style:o.bookingName,children:["Booked by ",t.fullName]}),e.jsx("p",{style:o.bookingLocation,children:((s=t.vehicleId)==null?void 0:s.name)||"Vehicle not specified"}),e.jsxs("div",{style:{fontSize:"14px",marginTop:"8px"},children:[e.jsxs("div",{children:["Guests: ",t.numberOfGuests||"N/A"]}),e.jsxs("div",{children:["Contact: ",t.contactNumber]}),e.jsxs("div",{children:["Email: ",t.emailAddress]})]})]},t._id)})})]}),f.length===0&&e.jsxs("div",{style:o.noBookings,children:[e.jsx("div",{style:{margin:"0 auto 20px",width:"100px",height:"100px"},children:e.jsxs("svg",{width:"100",height:"100",viewBox:"0 0 80 80",fill:"none",children:[e.jsx("rect",{x:"10",y:"15",width:"60",height:"50",rx:"4",stroke:"#ccc",strokeWidth:"2",fill:"none"}),e.jsx("path",{d:"M25 15 L25 10 M55 15 L55 10",stroke:"#ccc",strokeWidth:"2"}),e.jsx("path",{d:"M20 25 L60 25",stroke:"#ccc",strokeWidth:"2"}),e.jsx("path",{d:"M35 45 L45 45 M35 45 L40 40 M35 45 L40 50",stroke:"#66bb6a",strokeWidth:"2",strokeLinecap:"round"})]})}),e.jsx("h4",{style:o.noBookingsTitle,children:"No Bookings Today"}),e.jsx("p",{style:o.noBookingsText,children:"All slots are available for booking"})]}),e.jsx(F,{variant:"contained",style:o.floatingButton,onClick:Se,children:e.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 5v14M5 12h14"})})}),e.jsxs(Te,{fullScreen:!0,open:oe,onClose:M,children:[e.jsx(we,{children:e.jsxs(y,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(F,{onClick:M,variant:"text",size:"small",children:"←"}),"Add Booking"]})}),e.jsx("div",{style:{alignSelf:"center"},children:e.jsxs(Be,{sx:{p:3,backgroundColor:"white",width:"500px"},children:[D&&e.jsx(P,{severity:"error",sx:{mb:2},children:D}),e.jsxs(y,{mb:4,children:[e.jsxs(k,{variant:"h6",sx:j,children:[e.jsx(Me,{sx:u}),"Booking Details"]}),e.jsx(x,{fullWidth:!0,name:"fullName",label:"Full Name",variant:"outlined",value:a.fullName,onChange:h,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(Ne,{sx:u})})},sx:{mb:2}}),e.jsx(x,{fullWidth:!0,name:"contactNumber",label:"Contact Number",variant:"outlined",value:a.contactNumber,onChange:h,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(Pe,{sx:u})})},sx:{mb:2}}),e.jsx(x,{fullWidth:!0,name:"emailAddress",label:"Email Address",variant:"outlined",value:a.emailAddress,onChange:h,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(Ae,{sx:u})})},sx:{mb:2}}),e.jsx(x,{fullWidth:!0,name:"address",label:"Address",variant:"outlined",value:a.address,onChange:h,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(Fe,{sx:u})})},sx:{mb:2}}),e.jsx(x,{fullWidth:!0,name:"numberOfGuests",label:"Number of Guests",type:"number",variant:"outlined",value:a.numberOfGuests,onChange:h,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(We,{sx:u})})},sx:{mb:2}}),e.jsx(x,{fullWidth:!0,name:"additionalNotes",label:"Additional Notes (Optional)",multiline:!0,rows:3,variant:"outlined",value:a.additionalNotes,onChange:h,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(Le,{sx:u})})}})]}),e.jsxs(y,{mb:4,children:[e.jsxs(k,{variant:"h6",sx:j,children:[e.jsx(Ee,{sx:u}),"Select Vehicle"]}),e.jsxs(J,{fullWidth:!0,variant:"outlined",sx:{mb:2},children:[e.jsx(q,{children:"Select Vehicle"}),e.jsxs(Q,{name:"vehicleId",value:a.vehicleId,onChange:h,label:"Select Vehicle",children:[e.jsx(g,{value:"",children:e.jsx("em",{children:C.length===0?"No vehicles available":`Select Vehicle (${C.length} available)`})}),C.map(t=>{var n;return e.jsxs(g,{value:t._id,children:[t.name," • ",t.seatingCapacity," Seater • AED ",(n=t.pricing)==null?void 0:n.perDay,"/day"]},t._id)})]})]}),e.jsxs(k,{variant:"h6",sx:j,children:[e.jsx(X,{sx:u}),"Select Booking Date"]}),e.jsx(x,{fullWidth:!0,name:"bookingDate",type:"date",variant:"outlined",value:a.bookingDate,onChange:h,InputLabelProps:{shrink:!0},sx:{mb:2},InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(X,{sx:u})})},helperText:"Select any date - past, present, or future"}),e.jsxs(k,{variant:"h6",sx:j,children:[e.jsx(ze,{sx:u}),"Select Time Slots"]}),e.jsxs(Oe,{sx:{mb:3},children:[e.jsx(Z,{control:e.jsx(ee,{checked:a.timeSlot.includes("Morning"),onChange:()=>V("Morning")}),label:"Morning Slot 9:00 AM - 1:00 PM"}),e.jsx(Z,{control:e.jsx(ee,{checked:a.timeSlot.includes("Evening"),onChange:()=>V("Evening")}),label:"Evening Slot 6:00 PM - 10:00 PM"})]}),e.jsxs(k,{variant:"h6",sx:j,children:[e.jsx(Re,{sx:u}),"Payment Method"]}),e.jsxs(J,{fullWidth:!0,variant:"outlined",sx:{mb:2},children:[e.jsx(q,{children:"Payment Type"}),e.jsxs(Q,{name:"paymentType",value:a.paymentType,onChange:h,label:"Payment Type",children:[e.jsx(g,{value:"Cash",children:"Cash"}),e.jsx(g,{value:"Card",children:"Card"}),e.jsx(g,{value:"UPI",children:"UPI"}),e.jsx(g,{value:"GPay",children:"GPay"}),e.jsx(g,{value:"PhonePe",children:"PhonePe"}),e.jsx(g,{value:"Paytm",children:"Paytm"}),e.jsx(g,{value:"Bank Transfer",children:"Bank Transfer"}),e.jsx(g,{value:"Net Banking",children:"Net Banking"}),e.jsx(g,{value:"Other",children:"Other"})]})]})]}),e.jsx(y,{children:e.jsx(F,{variant:"contained",fullWidth:!0,onClick:ke,disabled:O,sx:{backgroundColor:"#ef5350",color:"white",fontWeight:600,py:1.5,borderRadius:2,"&:hover":{backgroundColor:"#e53935"}},children:O?e.jsx(A,{size:24,color:"inherit"}):"Submit Booking"})})]})})]})]})}export{He as default};
