import{c as Se,j as e,r as x,B as r,d as F,aB as ye,T as c,ar as Ie,S as m,a1 as y,h as I,G as P,am as J,a3 as V,af as ke,au as K,ah as De,as as ve,bt as we,bu as Ce,bv as Me,ai as Ae,x as Ne,an as T,t as g,b as k,q as We,at as Re,aC as Fe,F as Pe,I as Te,ab as Be,U as Le,aE as Oe,v as Ee}from"./index-CYOhujfk.js";import{A as ze}from"./AccessTime-DjnY83jR.js";const $e=Se(e.jsx("path",{d:"m6 14 3 3v5h6v-5l3-3V9H6zm5-12h2v3h-2zM3.5 5.88l1.41-1.41 2.12 2.12L5.62 8zm13.46.71 2.12-2.12 1.41 1.41L18.38 8z"})),D="https://api.bookmyevent.ae",n="#673ab7";function Ve(){const[d,Q]=x.useState(new Date),[b,X]=x.useState(new Date().getDate()),[Z,A]=x.useState(!1),[B,L]=x.useState([]),[ee,N]=x.useState([]),[v,te]=x.useState([]),[Ye,O]=x.useState(!1),[E,u]=x.useState(null),[z,$]=x.useState(!1),[_e,Y]=x.useState(null),[s,w]=x.useState({fullName:"",contactNumber:"",emailAddress:"",address:"",numberOfGuests:"",additionalNotes:"",moduleId:"",packageId:"",bookingDate:new Date().toISOString().split("T")[0],timeSlot:[],paymentType:"Cash",bookingType:"Direct"}),j=(()=>{let t=localStorage.getItem("providerId")||localStorage.getItem("userId");if(!t){const o=localStorage.getItem("user");if(o)try{const a=JSON.parse(o);t=a._id||a.id||a.userId}catch(a){console.error("Error parsing user from localStorage:",a)}}return t})();x.useEffect(()=>{j&&(_(),oe(),se())},[d,j]),x.useEffect(()=>{v.length===1&&!s.moduleId&&w(t=>({...t,moduleId:v[0]._id}))},[v]);const _=async()=>{if(!j){u("Provider ID is required");return}O(!0),u(null);try{const o=await(await fetch(`${D}/api/bookings/provider/${j}`)).json();if(o.success){const a=(o.data||[]).filter(l=>{const i=String(l.moduleType||"").toLowerCase();return i.includes("light")||i.includes("sound")});L(a)}else u(o.message||"Failed to fetch bookings")}catch(t){u("Error connecting to server"),console.error("Fetch error:",t)}finally{O(!1)}},oe=async()=>{try{const o=await(await fetch(`${D}/api/modules`)).json(),l=(o.success?o.data||o.modules||[]:Array.isArray(o)?o:[]).filter(i=>{const R=(i.title||i.name||"").toLowerCase();return R.includes("light")||R.includes("sound")});te(l)}catch(t){console.error("Fetch modules error:",t),u("Failed to fetch modules: "+t.message)}},se=async()=>{try{const o=await(await fetch(`${D}/api/light/vendor/${j}`)).json();o.success?N(o.data||[]):N([])}catch(t){console.error("Fetch light packages error:",t),N([])}},re=async t=>{if(window.confirm("Are you sure you want to delete this booking?")){Y(t),u(null);try{const a=await(await fetch(`${D}/api/bookings/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})).json();a.success?(L(l=>l.filter(i=>i._id!==t)),alert("Booking deleted successfully!")):u(a.message||"Failed to delete booking")}catch(o){u("Error deleting booking: "+o.message)}finally{Y(null)}}},W=new Date,ne=W.getDate(),ae=W.getMonth(),ie=W.getFullYear(),le=(()=>{const t=d.getFullYear(),o=d.getMonth(),a=new Date(t,o+1,0).getDate(),l={};for(let i=1;i<=a;i++){const q=B.filter(M=>{const f=new Date(M.bookingDate);return f.getDate()===i&&f.getMonth()===o&&f.getFullYear()===t&&M.bookingType==="Direct"}).reduce((M,f)=>M+(Array.isArray(f.timeSlot)?f.timeSlot.length:1),0);q===0?l[i]="free":q>=3?l[i]="booked":l[i]="available"}return l})(),S=B.filter(t=>{const o=new Date(t.bookingDate);return o.getDate()===b&&o.getMonth()===d.getMonth()&&o.getFullYear()===d.getFullYear()&&t.bookingType==="Direct"}),{firstDay:de,daysInMonth:ce}=(()=>{const t=d.getFullYear(),o=d.getMonth();return{firstDay:new Date(t,o,1).getDay(),daysInMonth:new Date(t,o+1,0).getDate()}})(),xe=d.toLocaleDateString("en-US",{month:"long",year:"numeric"}),ue=t=>t==="booked"?"#ef5350":t==="available"?"#ffd54f":"#66bb6a",G=t=>{Q(new Date(d.getFullYear(),d.getMonth()+t,1))},he=()=>{const t=[];["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].forEach(o=>t.push(e.jsx(r,{sx:{textAlign:"center",p:{xs:"8px 4px",md:"16px"},color:"#777",fontSize:{xs:"11px",md:"14px"},fontWeight:"600"},children:o},o)));for(let o=0;o<de;o++)t.push(e.jsx(r,{sx:{display:{xs:"none",md:"block"},bgcolor:"#f9f9f9",borderRadius:"12px"}},`empty-${o}`));for(let o=1;o<=ce;o++){const a=le[o]||"free",l=o===ne&&d.getMonth()===ae&&d.getFullYear()===ie,i=o===b;t.push(e.jsxs(r,{onClick:()=>X(o),sx:{position:"relative",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:{xs:"50px",md:"100px"},cursor:"pointer",borderRadius:{xs:"8px",md:"16px"},transition:"all 0.3s",bgcolor:i?y(n,.05):"#fff",border:i?`1px solid ${n}`:"1px solid #f0f0f0","&:hover":{transform:{md:"translateY(-4px)"},boxShadow:"0 6px 16px rgba(0,0,0,0.08)",borderColor:n,zIndex:1}},children:[e.jsx(r,{sx:{fontSize:{xs:"14px",md:"22px"},fontWeight:l||i?"600":"400",color:l?"#fff":i?n:"#333",width:{xs:"28px",md:"48px"},height:{xs:"28px",md:"48px"},display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",bgcolor:l?n:"transparent",mb:{xs:"2px",md:"8px"}},children:o}),e.jsx(r,{sx:{width:{xs:"6px",md:"10px"},height:{xs:"6px",md:"10px"},borderRadius:"50%",bgcolor:ue(a)}})]},o))}return t},p=t=>{const{name:o,value:a}=t.target;w(l=>({...l,[o]:a}))},pe=t=>{w(o=>{const a=o.timeSlot.includes(t)?o.timeSlot.filter(l=>l!==t):[...o.timeSlot,t];return{...o,timeSlot:a}})},ge=async()=>{if(!s.fullName.trim()||!s.contactNumber.trim()||!s.moduleId||!s.packageId||!s.timeSlot.length){u("Please fill all required fields and select at least one time slot");return}$(!0),u(null);try{const t={moduleId:s.moduleId,lightId:s.packageId,fullName:s.fullName,contactNumber:s.contactNumber,emailAddress:s.emailAddress,address:s.address,bookingDate:s.bookingDate,timeSlot:s.timeSlot,paymentType:s.paymentType,numberOfGuests:Number(s.numberOfGuests)||1,additionalNotes:s.additionalNotes,bookingType:"Direct",status:"Accepted",paymentStatus:"Paid"},a=await(await fetch(`${D}/api/bookings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();a.success?(alert("Booking created successfully!"),A(!1),_(),fe()):u(a.message||"Failed to create booking")}catch{u("Error creating booking")}finally{$(!1)}},fe=()=>{var t;w({fullName:"",contactNumber:"",emailAddress:"",address:"",numberOfGuests:"",additionalNotes:"",moduleId:((t=v[0])==null?void 0:t._id)||"",packageId:"",bookingDate:new Date().toISOString().split("T")[0],timeSlot:[],paymentType:"Cash",bookingType:"Direct"})},[h,C]=x.useState(0),me=()=>C(t=>t+1),be=()=>C(t=>t-1),je=()=>{A(!0),C(0)},H=()=>{A(!1),u(null),C(0)},U=["Customer Info","Service Details","Schedule & Notes"];return e.jsxs(r,{sx:{width:"100%",p:{xs:"8px",md:"40px"},bgcolor:"#fafafa",minHeight:"100vh"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:{xs:"16px",md:"32px"},px:{xs:"4px",md:"20px"}},children:[e.jsx(F,{onClick:()=>G(-1),sx:{bgcolor:"#fff",border:"1px solid #f0f0f0",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:e.jsx(ye,{})}),e.jsx(c,{sx:{fontSize:{xs:"20px",md:"32px"},fontWeight:"600"},children:xe}),e.jsx(F,{onClick:()=>G(1),sx:{bgcolor:"#fff",border:"1px solid #f0f0f0",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:e.jsx(Ie,{})})]}),e.jsx(r,{sx:{bgcolor:"#fff",borderRadius:{xs:"16px",md:"24px"},p:{xs:"12px 8px",md:"40px"},mb:{xs:"24px",md:"40px"},border:"1px solid #f0f0f0",boxShadow:"0 10px 30px rgba(0,0,0,0.04)"},children:e.jsx(r,{sx:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:{xs:"4px",md:"16px"}},children:he()})}),e.jsx(r,{sx:{bgcolor:"#fff",borderRadius:"12px",p:"24px",mb:"32px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)"},children:e.jsxs(m,{direction:"row",justifyContent:"center",spacing:3,flexWrap:"wrap",children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(r,{sx:{width:12,height:12,borderRadius:"50%",bgcolor:"#ef5350"}}),e.jsx(c,{color:"#666",children:"Fully Booked"})]}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(r,{sx:{width:12,height:12,borderRadius:"50%",bgcolor:"#ffd54f"}}),e.jsx(c,{color:"#666",children:"Slots Available"})]}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(r,{sx:{width:12,height:12,borderRadius:"50%",bgcolor:"#66bb6a"}}),e.jsx(c,{color:"#666",children:"Fully Free"})]})]})}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:{xs:2,md:4},bgcolor:"#fff",borderRadius:"24px",p:{xs:"20px",md:"32px"},mb:"32px",border:"1px solid #f0f0f0",boxShadow:"0 4px 20px rgba(0,0,0,0.03)"},children:[e.jsxs(r,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minWidth:{xs:70,md:100},height:{xs:70,md:100},bgcolor:n,borderRadius:"20px",color:"#fff",boxShadow:`0 8px 16px ${y(n,.2)}`},children:[e.jsx(c,{sx:{fontSize:"12px",fontWeight:"600"},children:new Date(d.getFullYear(),d.getMonth(),b).toLocaleDateString("en-US",{weekday:"short"})}),e.jsx(c,{sx:{fontSize:{xs:28,md:40},fontWeight:700},children:b})]}),e.jsxs(r,{sx:{flex:1},children:[e.jsx(c,{variant:"h6",fontWeight:700,color:"#333",children:S.length===0?"No Bookings":`${S.length} Direct Bookings`}),e.jsx(c,{color:"#999",fontSize:"14px",children:S.length===0?"All slots available for manual entry":"Reserved slots for this date"})]}),e.jsx(I,{variant:"contained",onClick:je,sx:{bgcolor:n,borderRadius:"12px",px:4,height:48,fontWeight:700,"&:hover":{bgcolor:"#5e35b1"}},children:"Add Booking"})]}),e.jsx(P,{container:!0,spacing:3,children:S.length===0?e.jsx(P,{item:!0,xs:12,children:e.jsx(J,{sx:{p:4,textAlign:"center",borderRadius:"24px",border:"2px dashed #eee"},children:e.jsx(c,{color:"#999",children:"No bookings scheduled for this date."})})}):S.map(t=>e.jsx(P,{item:!0,xs:12,md:6,lg:4,children:e.jsxs(J,{sx:{p:3,borderRadius:"24px",position:"relative",overflow:"hidden",border:"1px solid #f0f0f0",boxShadow:"0 8px 20px rgba(0,0,0,0.02)"},children:[e.jsx(r,{sx:{position:"absolute",top:0,left:0,width:4,height:"100%",bgcolor:n}}),e.jsxs(m,{direction:"row",justifyContent:"space-between",mb:2,children:[e.jsx(V,{label:Array.isArray(t.timeSlot)?t.timeSlot.join(", "):typeof t.timeSlot=="object"?t.timeSlot.label:t.timeSlot,size:"small",icon:e.jsx(ze,{sx:{fontSize:14}}),sx:{bgcolor:y(n,.1),color:n,fontWeight:700}}),e.jsx(F,{size:"small",onClick:()=>re(t._id),sx:{color:"#ccc","&:hover":{color:"#ef5350"}},children:e.jsx(ke,{fontSize:"small"})})]}),e.jsx(c,{variant:"h6",fontWeight:800,mb:2,children:t.fullName}),e.jsxs(m,{spacing:1,children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5,color:"#666"},children:[e.jsx(K,{sx:{fontSize:16}}),e.jsx(c,{variant:"body2",children:t.contactNumber})]}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5,color:"#666"},children:[e.jsx($e,{sx:{fontSize:16}}),e.jsx(c,{variant:"body2",children:"Light & Sound Service"})]})]})]})},t._id))}),e.jsxs(De,{open:Z,onClose:H,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:"28px",p:1}},children:[e.jsxs(ve,{children:[e.jsx(c,{variant:"h4",fontWeight:800,sx:{mt:2,textAlign:"center"},children:"Create Manual Booking"}),e.jsx(r,{sx:{width:"80%",mx:"auto",mt:3,mb:1},children:e.jsx(we,{activeStep:h,alternativeLabel:!0,children:U.map(t=>e.jsx(Ce,{sx:{"& .MuiStepIcon-root.Mui-active":{color:n},"& .MuiStepIcon-root.Mui-completed":{color:n}},children:e.jsx(Me,{children:t})},t))})})]}),e.jsxs(Ae,{sx:{px:4,pb:4,pt:2,minHeight:400},children:[E&&e.jsx(Ne,{severity:"error",sx:{mb:3,borderRadius:"14px"},children:E}),e.jsxs(r,{sx:{mt:2},children:[h===0&&e.jsx(T,{in:h===0,children:e.jsxs(m,{spacing:3,children:[e.jsx(g,{fullWidth:!0,label:"Full Name",name:"fullName",value:s.fullName,onChange:p,InputProps:{startAdornment:e.jsx(k,{position:"start",children:e.jsx(We,{sx:{color:n}})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:"16px"}}}),e.jsx(g,{fullWidth:!0,label:"Contact Number",name:"contactNumber",value:s.contactNumber,onChange:p,InputProps:{startAdornment:e.jsx(k,{position:"start",children:e.jsx(K,{sx:{color:n}})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:"16px"}}}),e.jsx(g,{fullWidth:!0,label:"Email Address",type:"email",name:"emailAddress",value:s.emailAddress,onChange:p,InputProps:{startAdornment:e.jsx(k,{position:"start",children:e.jsx(Re,{sx:{color:n}})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:"16px"}}}),e.jsx(g,{fullWidth:!0,label:"Service Address",name:"address",value:s.address,onChange:p,InputProps:{startAdornment:e.jsx(k,{position:"start",children:e.jsx(Fe,{sx:{color:n}})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:"16px"}}})]})}),h===1&&e.jsx(T,{in:h===1,children:e.jsxs(m,{spacing:3,children:[e.jsxs(Pe,{fullWidth:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:"16px"}},children:[e.jsx(Te,{children:"Select Light Package"}),e.jsx(Be,{label:"Select Light Package",name:"packageId",value:s.packageId,onChange:p,children:ee.map(t=>e.jsx(Le,{value:t._id,children:t.packageName},t._id))})]}),e.jsx(g,{fullWidth:!0,label:"Number of Guests",type:"number",name:"numberOfGuests",value:s.numberOfGuests,onChange:p,InputProps:{startAdornment:e.jsx(k,{position:"start",children:e.jsx(Oe,{sx:{color:n}})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:"16px"}}}),e.jsxs(r,{children:[e.jsx(c,{variant:"subtitle1",fontWeight:700,color:"text.secondary",sx:{mb:1},children:"Selected Date"}),e.jsx(g,{fullWidth:!0,disabled:!0,value:new Date(d.getFullYear(),d.getMonth(),b).toLocaleDateString("en-US",{dateStyle:"full"}),sx:{"& .MuiOutlinedInput-root":{borderRadius:"16px",bgcolor:"#f8fafc"}}})]})]})}),h===2&&e.jsx(T,{in:h===2,children:e.jsxs(r,{children:[e.jsx(c,{variant:"subtitle1",fontWeight:700,sx:{mb:2,color:n},children:"Preferred Time Slots"}),e.jsx(r,{sx:{display:"flex",flexWrap:"wrap",gap:1.5,mb:4},children:["Morning (9AM-12PM)","Afternoon (12PM-4PM)","Evening (4PM-8PM)","Night (8PM-12AM)"].map(t=>e.jsx(V,{label:t,onClick:()=>pe(t),sx:{borderRadius:"12px",height:45,px:1.5,fontSize:"0.9rem",fontWeight:600,border:"1px solid",borderColor:s.timeSlot.includes(t)?n:"rgba(0,0,0,0.1)",bgcolor:s.timeSlot.includes(t)?n:"#fff",color:s.timeSlot.includes(t)?"#fff":"#666",transition:"0.3s","&:hover":{bgcolor:s.timeSlot.includes(t)?"#5e35b1":y(n,.05)}}},t))}),e.jsx(g,{fullWidth:!0,multiline:!0,rows:4,label:"Special Instructions / Notes",name:"additionalNotes",value:s.additionalNotes,onChange:p,placeholder:"Type any specific requests here...",sx:{"& .MuiOutlinedInput-root":{borderRadius:"20px"}}})]})})]}),e.jsxs(m,{direction:"row",spacing:2,sx:{mt:6},children:[h>0?e.jsx(I,{fullWidth:!0,onClick:be,sx:{borderRadius:"16px",fontWeight:700,height:55,border:"2px solid #eee",color:"#666","&:hover":{border:"2px solid #ccc"}},children:"Back"}):e.jsx(I,{fullWidth:!0,onClick:H,sx:{borderRadius:"16px",fontWeight:700,height:55,border:"2px solid #eee",color:"#666","&:hover":{border:"2px solid #ccc"}},children:"Cancel"}),h<U.length-1?e.jsx(I,{fullWidth:!0,variant:"contained",onClick:me,sx:{borderRadius:"16px",fontWeight:700,height:55,bgcolor:n,"&:hover":{bgcolor:"#5e35b1"}},children:"Next Step"}):e.jsx(I,{fullWidth:!0,variant:"contained",onClick:ge,disabled:z,sx:{borderRadius:"16px",fontWeight:700,height:55,bgcolor:n,boxShadow:`0 8px 16px ${y(n,.3)}`,"&:hover":{bgcolor:"#5e35b1"}},children:z?e.jsx(Ee,{size:24,color:"inherit"}):"Confirm Booking"})]})]})]})]})}export{Ve as default};
